void 0===Date.now&&(Date.now=function(){return(new Date).valueOf()});var TWEEN=TWEEN||function(){var n=[];return{REVISION:"14",getAll:function(){return n},removeAll:function(){n=[]},add:function(t){n.push(t)},remove:function(t){var r=n.indexOf(t);-1!==r&&n.splice(r,1)},update:function(t){if(0===n.length)return!1;var r=0;for(t=void 0!==t?t:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();r<n.length;)n[r].update(t)?r++:n.splice(r,1);return!0}}}();TWEEN.Tween=function(n){var t=n,r={},i={},u={},o=1e3,e=0,a=!1,f=!1,c=!1,s=0,h=null,l=TWEEN.Easing.Linear.None,p=TWEEN.Interpolation.Linear,E=[],I=null,v=!1,w=null,M=null,d=null;for(var O in n)r[O]=parseFloat(n[O],10);this.to=function(n,t){return void 0!==t&&(o=t),i=n,this},this.start=function(n){for(var o in TWEEN.add(this),f=!0,v=!1,h=void 0!==n?n:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),h+=s,i){if(i[o]instanceof Array){if(0===i[o].length)continue;i[o]=[t[o]].concat(i[o])}r[o]=t[o],r[o]instanceof Array==!1&&(r[o]*=1),u[o]=r[o]||0}return this},this.stop=function(){return f?(TWEEN.remove(this),f=!1,null!==d&&d.call(t),this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var n=0,t=E.length;n<t;n++)E[n].stop()},this.delay=function(n){return s=n,this},this.repeat=function(n){return e=n,this},this.yoyo=function(n){return a=n,this},this.easing=function(n){return l=n,this},this.interpolation=function(n){return p=n,this},this.chain=function(){return E=arguments,this},this.onStart=function(n){return I=n,this},this.onUpdate=function(n){return w=n,this},this.onComplete=function(n){return M=n,this},this.onStop=function(n){return d=n,this},this.update=function(n){var f;if(n<h)return!0;!1===v&&(null!==I&&I.call(t),v=!0);var d=(n-h)/o,O=l(d=d>1?1:d);for(f in i){var N=r[f]||0,T=i[f];T instanceof Array?t[f]=p(T,O):("string"==typeof T&&(T=N+parseFloat(T,10)),"number"==typeof T&&(t[f]=N+(T-N)*O))}if(null!==w&&w.call(t,O),1==d){if(e>0){for(f in isFinite(e)&&e--,u){if("string"==typeof i[f]&&(u[f]=u[f]+parseFloat(i[f],10)),a){var g=u[f];u[f]=i[f],i[f]=g}r[f]=u[f]}return a&&(c=!c),h=n+s,!0}null!==M&&M.call(t);for(var m=0,W=E.length;m<W;m++)E[m].start(n);return!1}return!0}},TWEEN.Easing={Linear:{None:function(n){return n}},Quadratic:{In:function(n){return n*n},Out:function(n){return n*(2-n)},InOut:function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)}},Cubic:{In:function(n){return n*n*n},Out:function(n){return--n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)}},Quartic:{In:function(n){return n*n*n*n},Out:function(n){return 1- --n*n*n*n},InOut:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)}},Quintic:{In:function(n){return n*n*n*n*n},Out:function(n){return--n*n*n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)}},Sinusoidal:{In:function(n){return 1-Math.cos(n*Math.PI/2)},Out:function(n){return Math.sin(n*Math.PI/2)},InOut:function(n){return.5*(1-Math.cos(Math.PI*n))}},Exponential:{In:function(n){return 0===n?0:Math.pow(1024,n-1)},Out:function(n){return 1===n?1:1-Math.pow(2,-10*n)},InOut:function(n){return 0===n?0:1===n?1:(n*=2)<1?.5*Math.pow(1024,n-1):.5*(2-Math.pow(2,-10*(n-1)))}},Circular:{In:function(n){return 1-Math.sqrt(1-n*n)},Out:function(n){return Math.sqrt(1- --n*n)},InOut:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)}},Elastic:{In:function(n){var t,r=.1;return 0===n?0:1===n?1:(!r||r<1?(r=1,t=.1):t=.4*Math.asin(1/r)/(2*Math.PI),-r*Math.pow(2,10*(n-=1))*Math.sin((n-t)*(2*Math.PI)/.4))},Out:function(n){var t,r=.1;return 0===n?0:1===n?1:(!r||r<1?(r=1,t=.1):t=.4*Math.asin(1/r)/(2*Math.PI),r*Math.pow(2,-10*n)*Math.sin((n-t)*(2*Math.PI)/.4)+1)},InOut:function(n){var t,r=.1,i=.4;return 0===n?0:1===n?1:(!r||r<1?(r=1,t=.1):t=i*Math.asin(1/r)/(2*Math.PI),(n*=2)<1?r*Math.pow(2,10*(n-=1))*Math.sin((n-t)*(2*Math.PI)/i)*-.5:r*Math.pow(2,-10*(n-=1))*Math.sin((n-t)*(2*Math.PI)/i)*.5+1)}},Back:{In:function(n){var t=1.70158;return n*n*((t+1)*n-t)},Out:function(n){var t=1.70158;return--n*n*((t+1)*n+t)+1},InOut:function(n){var t=2.5949095;return(n*=2)<1?n*n*((t+1)*n-t)*.5:.5*((n-=2)*n*((t+1)*n+t)+2)}},Bounce:{In:function(n){return 1-TWEEN.Easing.Bounce.Out(1-n)},Out:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},InOut:function(n){return n<.5?.5*TWEEN.Easing.Bounce.In(2*n):.5*TWEEN.Easing.Bounce.Out(2*n-1)+.5}}},TWEEN.Interpolation={Linear:function(n,t){var r=n.length-1,i=r*t,u=Math.floor(i),o=TWEEN.Interpolation.Utils.Linear;return t<0?o(n[0],n[1],i):t>1?o(n[r],n[r-1],r-i):o(n[u],n[u+1>r?r:u+1],i-u)},Bezier:function(n,t){var r,i=0,u=n.length-1,o=Math.pow,e=TWEEN.Interpolation.Utils.Bernstein;for(r=0;r<=u;r++)i+=o(1-t,u-r)*o(t,r)*n[r]*e(u,r);return i},CatmullRom:function(n,t){var r=n.length-1,i=r*t,u=Math.floor(i),o=TWEEN.Interpolation.Utils.CatmullRom;return n[0]===n[r]?(t<0&&(u=Math.floor(i=r*(1+t))),o(n[(u-1+r)%r],n[u],n[(u+1)%r],n[(u+2)%r],i-u)):t<0?n[0]-(o(n[0],n[0],n[1],n[1],-i)-n[0]):t>1?n[r]-(o(n[r],n[r],n[r-1],n[r-1],i-r)-n[r]):o(n[u?u-1:0],n[u],n[r<u+1?r:u+1],n[r<u+2?r:u+2],i-u)},Utils:{Linear:function(n,t,r){return(t-n)*r+n},Bernstein:function(n,t){var r=TWEEN.Interpolation.Utils.Factorial;return r(n)/r(t)/r(n-t)},Factorial:function(){var n=[1];return function(t){var r,i=1;if(n[t])return n[t];for(r=t;r>1;r--)i*=r;return n[t]=i}}(),CatmullRom:function(n,t,r,i,u){var o=.5*(r-n),e=.5*(i-t),a=u*u;return(2*t-2*r+o+e)*(u*a)+(-3*t+3*r-2*o-e)*a+o*u+t}}};;
(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory(global):typeof define==="function"&&define.amd?define(factory):factory(global)})(typeof self!=="undefined"?self:typeof window!=="undefined"?window:typeof global!=="undefined"?global:this,function(global){"use strict";global=global||{};var _Base64=global.Base64;var version="2.5.1";var buffer;if(typeof module!=="undefined"&&module.exports){try{buffer=eval("require('buffer').Buffer")}catch(err){buffer=undefined}}var b64chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var b64tab=function(bin){var t={};for(var i=0,l=bin.length;i<l;i++)t[bin.charAt(i)]=i;return t}(b64chars);var fromCharCode=String.fromCharCode;var cb_utob=function(c){if(c.length<2){var cc=c.charCodeAt(0);return cc<128?c:cc<2048?fromCharCode(192|cc>>>6)+fromCharCode(128|cc&63):fromCharCode(224|cc>>>12&15)+fromCharCode(128|cc>>>6&63)+fromCharCode(128|cc&63)}else{var cc=65536+(c.charCodeAt(0)-55296)*1024+(c.charCodeAt(1)-56320);return fromCharCode(240|cc>>>18&7)+fromCharCode(128|cc>>>12&63)+fromCharCode(128|cc>>>6&63)+fromCharCode(128|cc&63)}};var re_utob=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g;var utob=function(u){return u.replace(re_utob,cb_utob)};var cb_encode=function(ccc){var padlen=[0,2,1][ccc.length%3],ord=ccc.charCodeAt(0)<<16|(ccc.length>1?ccc.charCodeAt(1):0)<<8|(ccc.length>2?ccc.charCodeAt(2):0),chars=[b64chars.charAt(ord>>>18),b64chars.charAt(ord>>>12&63),padlen>=2?"=":b64chars.charAt(ord>>>6&63),padlen>=1?"=":b64chars.charAt(ord&63)];return chars.join("")};var btoa=global.btoa?function(b){return global.btoa(b)}:function(b){return b.replace(/[\s\S]{1,3}/g,cb_encode)};var _encode=buffer?buffer.from&&Uint8Array&&buffer.from!==Uint8Array.from?function(u){return(u.constructor===buffer.constructor?u:buffer.from(u)).toString("base64")}:function(u){return(u.constructor===buffer.constructor?u:new buffer(u)).toString("base64")}:function(u){return btoa(utob(u))};var encode=function(u,urisafe){return!urisafe?_encode(String(u)):_encode(String(u)).replace(/[+\/]/g,function(m0){return m0=="+"?"-":"_"}).replace(/=/g,"")};var encodeURI=function(u){return encode(u,true)};var re_btou=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g");var cb_btou=function(cccc){switch(cccc.length){case 4:var cp=(7&cccc.charCodeAt(0))<<18|(63&cccc.charCodeAt(1))<<12|(63&cccc.charCodeAt(2))<<6|63&cccc.charCodeAt(3),offset=cp-65536;return fromCharCode((offset>>>10)+55296)+fromCharCode((offset&1023)+56320);case 3:return fromCharCode((15&cccc.charCodeAt(0))<<12|(63&cccc.charCodeAt(1))<<6|63&cccc.charCodeAt(2));default:return fromCharCode((31&cccc.charCodeAt(0))<<6|63&cccc.charCodeAt(1))}};var btou=function(b){return b.replace(re_btou,cb_btou)};var cb_decode=function(cccc){var len=cccc.length,padlen=len%4,n=(len>0?b64tab[cccc.charAt(0)]<<18:0)|(len>1?b64tab[cccc.charAt(1)]<<12:0)|(len>2?b64tab[cccc.charAt(2)]<<6:0)|(len>3?b64tab[cccc.charAt(3)]:0),chars=[fromCharCode(n>>>16),fromCharCode(n>>>8&255),fromCharCode(n&255)];chars.length-=[0,0,2,1][padlen];return chars.join("")};var _atob=global.atob?function(a){return global.atob(a)}:function(a){return a.replace(/\S{1,4}/g,cb_decode)};var atob=function(a){return _atob(String(a).replace(/[^A-Za-z0-9\+\/]/g,""))};var _decode=buffer?buffer.from&&Uint8Array&&buffer.from!==Uint8Array.from?function(a){return(a.constructor===buffer.constructor?a:buffer.from(a,"base64")).toString()}:function(a){return(a.constructor===buffer.constructor?a:new buffer(a,"base64")).toString()}:function(a){return btou(_atob(a))};var decode=function(a){return _decode(String(a).replace(/[-_]/g,function(m0){return m0=="-"?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))};var noConflict=function(){var Base64=global.Base64;global.Base64=_Base64;return Base64};global.Base64={VERSION:version,atob:atob,btoa:btoa,fromBase64:decode,toBase64:encode,utob:utob,encode:encode,encodeURI:encodeURI,btou:btou,decode:decode,noConflict:noConflict,__buffer__:buffer};if(typeof Object.defineProperty==="function"){var noEnum=function(v){return{value:v,enumerable:false,writable:true,configurable:true}};global.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",noEnum(function(){return decode(this)}));Object.defineProperty(String.prototype,"toBase64",noEnum(function(urisafe){return encode(this,urisafe)}));Object.defineProperty(String.prototype,"toBase64URI",noEnum(function(){return encode(this,true)}))}}if(global["Meteor"]){Base64=global.Base64}if(typeof module!=="undefined"&&module.exports){module.exports.Base64=global.Base64}else if(typeof define==="function"&&define.amd){define([],function(){return global.Base64})}return{Base64:global.Base64}});;
/*
 bytebuffer.js (c) 2015 Daniel Wirtz <dcode@dcode.io>
 Backing buffer: ArrayBuffer, Accessor: Uint8Array
 Released under the Apache License, Version 2.0
 see: https://github.com/dcodeIO/bytebuffer.js for details
*/
function u(k){function g(a,b,c){"undefined"===typeof a&&(a=g.DEFAULT_CAPACITY);"undefined"===typeof b&&(b=g.DEFAULT_ENDIAN);"undefined"===typeof c&&(c=g.DEFAULT_NOASSERT);if(!c){a|=0;if(0>a)throw RangeError("Illegal capacity");b=!!b;c=!!c}this.buffer=0===a?v:new ArrayBuffer(a);this.view=0===a?null:new Uint8Array(this.buffer);this.offset=0;this.markedOffset=-1;this.limit=a;this.littleEndian=b;this.noAssert=c}function m(a){var b=0;return function(){return b<a.length?a.charCodeAt(b++):null}}function s(){var a=
[],b=[];return function(){if(0===arguments.length)return b.join("")+w.apply(String,a);1024<a.length+arguments.length&&(b.push(w.apply(String,a)),a.length=0);Array.prototype.push.apply(a,arguments)}}function x(a,b,c,d,f){var n;n=8*f-d-1;var h=(1<<n)-1,e=h>>1,g=-7;f=c?f-1:0;var q=c?-1:1,k=a[b+f];f+=q;c=k&(1<<-g)-1;k>>=-g;for(g+=n;0<g;c=256*c+a[b+f],f+=q,g-=8);n=c&(1<<-g)-1;c>>=-g;for(g+=d;0<g;n=256*n+a[b+f],f+=q,g-=8);if(0===c)c=1-e;else{if(c===h)return n?NaN:Infinity*(k?-1:1);n+=Math.pow(2,d);c-=e}return(k?
-1:1)*n*Math.pow(2,c-d)}function z(a,b,c,d,f,n){var e,g=8*n-f-1,t=(1<<g)-1,k=t>>1,y=23===f?Math.pow(2,-24)-Math.pow(2,-77):0;n=d?0:n-1;var l=d?1:-1,m=0>b||0===b&&0>1/b?1:0;b=Math.abs(b);isNaN(b)||Infinity===b?(b=isNaN(b)?1:0,d=t):(d=Math.floor(Math.log(b)/Math.LN2),1>b*(e=Math.pow(2,-d))&&(d--,e*=2),b=1<=d+k?b+y/e:b+y*Math.pow(2,1-k),2<=b*e&&(d++,e/=2),d+k>=t?(b=0,d=t):1<=d+k?(b=(b*e-1)*Math.pow(2,f),d+=k):(b=b*Math.pow(2,k-1)*Math.pow(2,f),d=0));for(;8<=f;a[c+n]=b&255,n+=l,b/=256,f-=8);d=d<<f|b;
for(g+=f;0<g;a[c+n]=d&255,n+=l,d/=256,g-=8);a[c+n-l]|=128*m}g.VERSION="5.0.0";g.LITTLE_ENDIAN=!0;g.BIG_ENDIAN=!1;g.DEFAULT_CAPACITY=16;g.DEFAULT_ENDIAN=g.BIG_ENDIAN;g.DEFAULT_NOASSERT=!1;g.Long=k||null;var e=g.prototype;Object.defineProperty(e,"__isByteBuffer__",{value:!0,enumerable:!1,configurable:!1});var v=new ArrayBuffer(0),w=String.fromCharCode;g.accessor=function(){return Uint8Array};g.allocate=function(a,b,c){return new g(a,b,c)};g.concat=function(a,b,c,d){if("boolean"===typeof b||"string"!==
typeof b)d=c,c=b,b=void 0;for(var f=0,e=0,h=a.length,p;e<h;++e)g.isByteBuffer(a[e])||(a[e]=g.wrap(a[e],b)),p=a[e].limit-a[e].offset,0<p&&(f+=p);if(0===f)return new g(0,c,d);b=new g(f,c,d);for(e=0;e<h;)c=a[e++],p=c.limit-c.offset,0>=p||(b.view.set(c.view.subarray(c.offset,c.limit),b.offset),b.offset+=p);b.limit=b.offset;b.offset=0;return b};g.isByteBuffer=function(a){return!0===(a&&a.__isByteBuffer__)};g.type=function(){return ArrayBuffer};g.wrap=function(a,b,c,d){"string"!==typeof b&&(d=c,c=b,b=void 0);
if("string"===typeof a)switch("undefined"===typeof b&&(b="utf8"),b){case "base64":return g.fromBase64(a,c);case "hex":return g.fromHex(a,c);case "binary":return g.fromBinary(a,c);case "utf8":return g.fromUTF8(a,c);case "debug":return g.fromDebug(a,c);default:throw Error("Unsupported encoding: "+b);}if(null===a||"object"!==typeof a)throw TypeError("Illegal buffer");if(g.isByteBuffer(a))return b=e.clone.call(a),b.markedOffset=-1,b;if(a instanceof Uint8Array)b=new g(0,c,d),0<a.length&&(b.buffer=a.buffer,
b.offset=a.byteOffset,b.limit=a.byteOffset+a.byteLength,b.view=new Uint8Array(a.buffer));else if(a instanceof ArrayBuffer)b=new g(0,c,d),0<a.byteLength&&(b.buffer=a,b.offset=0,b.limit=a.byteLength,b.view=0<a.byteLength?new Uint8Array(a):null);else if("[object Array]"===Object.prototype.toString.call(a))for(b=new g(a.length,c,d),b.limit=a.length,c=0;c<a.length;++c)b.view[c]=a[c];else throw TypeError("Illegal buffer");return b};e.readBytes=function(a,b){var c="undefined"===typeof b;c&&(b=this.offset);
if(!this.noAssert){if("number"!==typeof b||0!==b%1)throw TypeError("Illegal offset: "+b+" (not an integer)");b>>>=0;if(0>b||b+a>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+"+a+") <= "+this.buffer.byteLength);}var d=this.slice(b,b+a);c&&(this.offset+=a);return d};e.writeBytes=e.append;e.writeInt8=function(a,b){var c="undefined"===typeof b;c&&(b=this.offset);if(!this.noAssert){if("number"!==typeof a||0!==a%1)throw TypeError("Illegal value: "+a+" (not an integer)");a|=0;if("number"!==
typeof b||0!==b%1)throw TypeError("Illegal offset: "+b+" (not an integer)");b>>>=0;if(0>b||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength);}b+=1;var d=this.buffer.byteLength;b>d&&this.resize((d*=2)>b?d:b);this.view[b-1]=a;c&&(this.offset+=1);return this};e.writeByte=e.writeInt8;e.readInt8=function(a){var b="undefined"===typeof a;b&&(a=this.offset);if(!this.noAssert){if("number"!==typeof a||0!==a%1)throw TypeError("Illegal offset: "+a+" (not an integer)");
a>>>=0;if(0>a||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength);}a=this.view[a];128===(a&128)&&(a=-(255-a+1));b&&(this.offset+=1);return a};e.readByte=e.readInt8;e.writeUint8=function(a,b){var c="undefined"===typeof b;c&&(b=this.offset);if(!this.noAssert){if("number"!==typeof a||0!==a%1)throw TypeError("Illegal value: "+a+" (not an integer)");a>>>=0;if("number"!==typeof b||0!==b%1)throw TypeError("Illegal offset: "+b+" (not an integer)");b>>>=
0;if(0>b||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength);}b+=1;var d=this.buffer.byteLength;b>d&&this.resize((d*=2)>b?d:b);this.view[b-1]=a;c&&(this.offset+=1);return this};e.writeUInt8=e.writeUint8;e.readUint8=function(a){var b="undefined"===typeof a;b&&(a=this.offset);if(!this.noAssert){if("number"!==typeof a||0!==a%1)throw TypeError("Illegal offset: "+a+" (not an integer)");a>>>=0;if(0>a||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+
a+" (+1) <= "+this.buffer.byteLength);}a=this.view[a];b&&(this.offset+=1);return a};e.readUInt8=e.readUint8;e.writeInt16=function(a,b){var c="undefined"===typeof b;c&&(b=this.offset);if(!this.noAssert){if("number"!==typeof a||0!==a%1)throw TypeError("Illegal value: "+a+" (not an integer)");a|=0;if("number"!==typeof b||0!==b%1)throw TypeError("Illegal offset: "+b+" (not an integer)");b>>>=0;if(0>b||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength);
}b+=2;var d=this.buffer.byteLength;b>d&&this.resize((d*=2)>b?d:b);b-=2;this.littleEndian?(this.view[b+1]=(a&65280)>>>8,this.view[b]=a&255):(this.view[b]=(a&65280)>>>8,this.view[b+1]=a&255);c&&(this.offset+=2);return this};e.writeShort=e.writeInt16;e.readInt16=function(a){var b="undefined"===typeof a;b&&(a=this.offset);if(!this.noAssert){if("number"!==typeof a||0!==a%1)throw TypeError("Illegal offset: "+a+" (not an integer)");a>>>=0;if(0>a||a+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+
a+" (+2) <= "+this.buffer.byteLength);}var c=0;this.littleEndian?(c=this.view[a],c|=this.view[a+1]<<8):(c=this.view[a]<<8,c|=this.view[a+1]);32768===(c&32768)&&(c=-(65535-c+1));b&&(this.offset+=2);return c};e.readShort=e.readInt16;e.writeUint16=function(a,b){var c="undefined"===typeof b;c&&(b=this.offset);if(!this.noAssert){if("number"!==typeof a||0!==a%1)throw TypeError("Illegal value: "+a+" (not an integer)");a>>>=0;if("number"!==typeof b||0!==b%1)throw TypeError("Illegal offset: "+b+" (not an integer)");
b>>>=0;if(0>b||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength);}b+=2;var d=this.buffer.byteLength;b>d&&this.resize((d*=2)>b?d:b);b-=2;this.littleEndian?(this.view[b+1]=(a&65280)>>>8,this.view[b]=a&255):(this.view[b]=(a&65280)>>>8,this.view[b+1]=a&255);c&&(this.offset+=2);return this};e.writeUInt16=e.writeUint16;e.readUint16=function(a){var b="undefined"===typeof a;b&&(a=this.offset);if(!this.noAssert){if("number"!==typeof a||0!==a%1)throw TypeError("Illegal offset: "+
a+" (not an integer)");a>>>=0;if(0>a||a+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+2) <= "+this.buffer.byteLength);}var c=0;this.littleEndian?(c=this.view[a],c|=this.view[a+1]<<8):(c=this.view[a]<<8,c|=this.view[a+1]);b&&(this.offset+=2);return c};e.readUInt16=e.readUint16;e.writeInt32=function(a,b){var c="undefined"===typeof b;c&&(b=this.offset);if(!this.noAssert){if("number"!==typeof a||0!==a%1)throw TypeError("Illegal value: "+a+" (not an integer)");a|=0;if("number"!==
typeof b||0!==b%1)throw TypeError("Illegal offset: "+b+" (not an integer)");b>>>=0;if(0>b||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength);}b+=4;var d=this.buffer.byteLength;b>d&&this.resize((d*=2)>b?d:b);b-=4;this.littleEndian?(this.view[b+3]=a>>>24&255,this.view[b+2]=a>>>16&255,this.view[b+1]=a>>>8&255,this.view[b]=a&255):(this.view[b]=a>>>24&255,this.view[b+1]=a>>>16&255,this.view[b+2]=a>>>8&255,this.view[b+3]=a&255);c&&(this.offset+=4);
return this};e.writeInt=e.writeInt32;e.readInt32=function(a){var b="undefined"===typeof a;b&&(a=this.offset);if(!this.noAssert){if("number"!==typeof a||0!==a%1)throw TypeError("Illegal offset: "+a+" (not an integer)");a>>>=0;if(0>a||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength);}var c=0;this.littleEndian?(c=this.view[a+2]<<16,c|=this.view[a+1]<<8,c|=this.view[a],c+=this.view[a+3]<<24>>>0):(c=this.view[a+1]<<16,c|=this.view[a+2]<<8,c|=this.view[a+
3],c+=this.view[a]<<24>>>0);b&&(this.offset+=4);return c|0};e.readInt=e.readInt32;e.writeUint32=function(a,b){var c="undefined"===typeof b;c&&(b=this.offset);if(!this.noAssert){if("number"!==typeof a||0!==a%1)throw TypeError("Illegal value: "+a+" (not an integer)");a>>>=0;if("number"!==typeof b||0!==b%1)throw TypeError("Illegal offset: "+b+" (not an integer)");b>>>=0;if(0>b||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength);}b+=4;var d=this.buffer.byteLength;
b>d&&this.resize((d*=2)>b?d:b);b-=4;this.littleEndian?(this.view[b+3]=a>>>24&255,this.view[b+2]=a>>>16&255,this.view[b+1]=a>>>8&255,this.view[b]=a&255):(this.view[b]=a>>>24&255,this.view[b+1]=a>>>16&255,this.view[b+2]=a>>>8&255,this.view[b+3]=a&255);c&&(this.offset+=4);return this};e.writeUInt32=e.writeUint32;e.readUint32=function(a){var b="undefined"===typeof a;b&&(a=this.offset);if(!this.noAssert){if("number"!==typeof a||0!==a%1)throw TypeError("Illegal offset: "+a+" (not an integer)");a>>>=0;if(0>
a||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength);}var c=0;this.littleEndian?(c=this.view[a+2]<<16,c|=this.view[a+1]<<8,c|=this.view[a],c+=this.view[a+3]<<24>>>0):(c=this.view[a+1]<<16,c|=this.view[a+2]<<8,c|=this.view[a+3],c+=this.view[a]<<24>>>0);b&&(this.offset+=4);return c};e.readUInt32=e.readUint32;k&&(e.writeInt64=function(a,b){var c="undefined"===typeof b;c&&(b=this.offset);if(!this.noAssert){if("number"===typeof a)a=k.fromNumber(a);
else if("string"===typeof a)a=k.fromString(a);else if(!(a&&a instanceof k))throw TypeError("Illegal value: "+a+" (not an integer or Long)");if("number"!==typeof b||0!==b%1)throw TypeError("Illegal offset: "+b+" (not an integer)");b>>>=0;if(0>b||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength);}"number"===typeof a?a=k.fromNumber(a):"string"===typeof a&&(a=k.fromString(a));b+=8;var d=this.buffer.byteLength;b>d&&this.resize((d*=2)>b?d:b);b-=8;
var d=a.low,f=a.high;this.littleEndian?(this.view[b+3]=d>>>24&255,this.view[b+2]=d>>>16&255,this.view[b+1]=d>>>8&255,this.view[b]=d&255,b+=4,this.view[b+3]=f>>>24&255,this.view[b+2]=f>>>16&255,this.view[b+1]=f>>>8&255,this.view[b]=f&255):(this.view[b]=f>>>24&255,this.view[b+1]=f>>>16&255,this.view[b+2]=f>>>8&255,this.view[b+3]=f&255,b+=4,this.view[b]=d>>>24&255,this.view[b+1]=d>>>16&255,this.view[b+2]=d>>>8&255,this.view[b+3]=d&255);c&&(this.offset+=8);return this},e.writeLong=e.writeInt64,e.readInt64=
function(a){var b="undefined"===typeof a;b&&(a=this.offset);if(!this.noAssert){if("number"!==typeof a||0!==a%1)throw TypeError("Illegal offset: "+a+" (not an integer)");a>>>=0;if(0>a||a+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+8) <= "+this.buffer.byteLength);}var c=0,d=0;this.littleEndian?(c=this.view[a+2]<<16,c|=this.view[a+1]<<8,c|=this.view[a],c+=this.view[a+3]<<24>>>0,a+=4,d=this.view[a+2]<<16,d|=this.view[a+1]<<8,d|=this.view[a],d+=this.view[a+3]<<24>>>0):(d=this.view[a+
1]<<16,d|=this.view[a+2]<<8,d|=this.view[a+3],d+=this.view[a]<<24>>>0,a+=4,c=this.view[a+1]<<16,c|=this.view[a+2]<<8,c|=this.view[a+3],c+=this.view[a]<<24>>>0);a=new k(c,d,!1);b&&(this.offset+=8);return a},e.readLong=e.readInt64,e.writeUint64=function(a,b){var c="undefined"===typeof b;c&&(b=this.offset);if(!this.noAssert){if("number"===typeof a)a=k.fromNumber(a);else if("string"===typeof a)a=k.fromString(a);else if(!(a&&a instanceof k))throw TypeError("Illegal value: "+a+" (not an integer or Long)");
if("number"!==typeof b||0!==b%1)throw TypeError("Illegal offset: "+b+" (not an integer)");b>>>=0;if(0>b||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength);}"number"===typeof a?a=k.fromNumber(a):"string"===typeof a&&(a=k.fromString(a));b+=8;var d=this.buffer.byteLength;b>d&&this.resize((d*=2)>b?d:b);b-=8;var d=a.low,f=a.high;this.littleEndian?(this.view[b+3]=d>>>24&255,this.view[b+2]=d>>>16&255,this.view[b+1]=d>>>8&255,this.view[b]=d&255,b+=4,
this.view[b+3]=f>>>24&255,this.view[b+2]=f>>>16&255,this.view[b+1]=f>>>8&255,this.view[b]=f&255):(this.view[b]=f>>>24&255,this.view[b+1]=f>>>16&255,this.view[b+2]=f>>>8&255,this.view[b+3]=f&255,b+=4,this.view[b]=d>>>24&255,this.view[b+1]=d>>>16&255,this.view[b+2]=d>>>8&255,this.view[b+3]=d&255);c&&(this.offset+=8);return this},e.writeUInt64=e.writeUint64,e.readUint64=function(a){var b="undefined"===typeof a;b&&(a=this.offset);if(!this.noAssert){if("number"!==typeof a||0!==a%1)throw TypeError("Illegal offset: "+
a+" (not an integer)");a>>>=0;if(0>a||a+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+8) <= "+this.buffer.byteLength);}var c=0,d=0;this.littleEndian?(c=this.view[a+2]<<16,c|=this.view[a+1]<<8,c|=this.view[a],c+=this.view[a+3]<<24>>>0,a+=4,d=this.view[a+2]<<16,d|=this.view[a+1]<<8,d|=this.view[a],d+=this.view[a+3]<<24>>>0):(d=this.view[a+1]<<16,d|=this.view[a+2]<<8,d|=this.view[a+3],d+=this.view[a]<<24>>>0,a+=4,c=this.view[a+1]<<16,c|=this.view[a+2]<<8,c|=this.view[a+3],c+=
this.view[a]<<24>>>0);a=new k(c,d,!0);b&&(this.offset+=8);return a},e.readUInt64=e.readUint64);e.writeFloat32=function(a,b){var c="undefined"===typeof b;c&&(b=this.offset);if(!this.noAssert){if("number"!==typeof a)throw TypeError("Illegal value: "+a+" (not a number)");if("number"!==typeof b||0!==b%1)throw TypeError("Illegal offset: "+b+" (not an integer)");b>>>=0;if(0>b||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength);}b+=4;var d=this.buffer.byteLength;
b>d&&this.resize((d*=2)>b?d:b);z(this.view,a,b-4,this.littleEndian,23,4);c&&(this.offset+=4);return this};e.writeFloat=e.writeFloat32;e.readFloat32=function(a){var b="undefined"===typeof a;b&&(a=this.offset);if(!this.noAssert){if("number"!==typeof a||0!==a%1)throw TypeError("Illegal offset: "+a+" (not an integer)");a>>>=0;if(0>a||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength);}a=x(this.view,a,this.littleEndian,23,4);b&&(this.offset+=4);return a};
e.readFloat=e.readFloat32;e.writeFloat64=function(a,b){var c="undefined"===typeof b;c&&(b=this.offset);if(!this.noAssert){if("number"!==typeof a)throw TypeError("Illegal value: "+a+" (not a number)");if("number"!==typeof b||0!==b%1)throw TypeError("Illegal offset: "+b+" (not an integer)");b>>>=0;if(0>b||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength);}b+=8;var d=this.buffer.byteLength;b>d&&this.resize((d*=2)>b?d:b);z(this.view,a,b-8,this.littleEndian,
52,8);c&&(this.offset+=8);return this};e.writeDouble=e.writeFloat64;e.readFloat64=function(a){var b="undefined"===typeof a;b&&(a=this.offset);if(!this.noAssert){if("number"!==typeof a||0!==a%1)throw TypeError("Illegal offset: "+a+" (not an integer)");a>>>=0;if(0>a||a+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+8) <= "+this.buffer.byteLength);}a=x(this.view,a,this.littleEndian,52,8);b&&(this.offset+=8);return a};e.readDouble=e.readFloat64;g.MAX_VARINT32_BYTES=5;g.calculateVarint32=
function(a){a>>>=0;return 128>a?1:16384>a?2:2097152>a?3:268435456>a?4:5};g.zigZagEncode32=function(a){return((a|=0)<<1^a>>31)>>>0};g.zigZagDecode32=function(a){return a>>>1^-(a&1)|0};e.writeVarint32=function(a,b){var c="undefined"===typeof b;c&&(b=this.offset);if(!this.noAssert){if("number"!==typeof a||0!==a%1)throw TypeError("Illegal value: "+a+" (not an integer)");a|=0;if("number"!==typeof b||0!==b%1)throw TypeError("Illegal offset: "+b+" (not an integer)");b>>>=0;if(0>b||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+
b+" (+0) <= "+this.buffer.byteLength);}var d=g.calculateVarint32(a),f;b+=d;f=this.buffer.byteLength;b>f&&this.resize((f*=2)>b?f:b);b-=d;for(a>>>=0;128<=a;)f=a&127|128,this.view[b++]=f,a>>>=7;this.view[b++]=a;return c?(this.offset=b,this):d};e.writeVarint32ZigZag=function(a,b){return this.writeVarint32(g.zigZagEncode32(a),b)};e.readVarint32=function(a){var b="undefined"===typeof a;b&&(a=this.offset);if(!this.noAssert){if("number"!==typeof a||0!==a%1)throw TypeError("Illegal offset: "+a+" (not an integer)");
a>>>=0;if(0>a||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength);}var c=0,d=0,f;do{if(!this.noAssert&&a>this.limit)throw a=Error("Truncated"),a.truncated=!0,a;f=this.view[a++];5>c&&(d|=(f&127)<<7*c);++c}while(0!==(f&128));d|=0;return b?(this.offset=a,d):{value:d,length:c}};e.readVarint32ZigZag=function(a){a=this.readVarint32(a);"object"===typeof a?a.value=g.zigZagDecode32(a.value):a=g.zigZagDecode32(a);return a};k&&(g.MAX_VARINT64_BYTES=10,g.calculateVarint64=
function(a){"number"===typeof a?a=k.fromNumber(a):"string"===typeof a&&(a=k.fromString(a));var b=a.toInt()>>>0,c=a.shiftRightUnsigned(28).toInt()>>>0;a=a.shiftRightUnsigned(56).toInt()>>>0;return 0==a?0==c?16384>b?128>b?1:2:2097152>b?3:4:16384>c?128>c?5:6:2097152>c?7:8:128>a?9:10},g.zigZagEncode64=function(a){"number"===typeof a?a=k.fromNumber(a,!1):"string"===typeof a?a=k.fromString(a,!1):!1!==a.unsigned&&(a=a.toSigned());return a.shiftLeft(1).xor(a.shiftRight(63)).toUnsigned()},g.zigZagDecode64=
function(a){"number"===typeof a?a=k.fromNumber(a,!1):"string"===typeof a?a=k.fromString(a,!1):!1!==a.unsigned&&(a=a.toSigned());return a.shiftRightUnsigned(1).xor(a.and(k.ONE).toSigned().negate()).toSigned()},e.writeVarint64=function(a,b){var c="undefined"===typeof b;c&&(b=this.offset);if(!this.noAssert){if("number"===typeof a)a=k.fromNumber(a);else if("string"===typeof a)a=k.fromString(a);else if(!(a&&a instanceof k))throw TypeError("Illegal value: "+a+" (not an integer or Long)");if("number"!==
typeof b||0!==b%1)throw TypeError("Illegal offset: "+b+" (not an integer)");b>>>=0;if(0>b||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength);}"number"===typeof a?a=k.fromNumber(a,!1):"string"===typeof a?a=k.fromString(a,!1):!1!==a.unsigned&&(a=a.toSigned());var d=g.calculateVarint64(a),f=a.toInt()>>>0,e=a.shiftRightUnsigned(28).toInt()>>>0,h=a.shiftRightUnsigned(56).toInt()>>>0;b+=d;var p=this.buffer.byteLength;b>p&&this.resize((p*=2)>b?p:b);
b-=d;switch(d){case 10:this.view[b+9]=h>>>7&1;case 9:this.view[b+8]=9!==d?h|128:h&127;case 8:this.view[b+7]=8!==d?e>>>21|128:e>>>21&127;case 7:this.view[b+6]=7!==d?e>>>14|128:e>>>14&127;case 6:this.view[b+5]=6!==d?e>>>7|128:e>>>7&127;case 5:this.view[b+4]=5!==d?e|128:e&127;case 4:this.view[b+3]=4!==d?f>>>21|128:f>>>21&127;case 3:this.view[b+2]=3!==d?f>>>14|128:f>>>14&127;case 2:this.view[b+1]=2!==d?f>>>7|128:f>>>7&127;case 1:this.view[b]=1!==d?f|128:f&127}return c?(this.offset+=d,this):d},e.writeVarint64ZigZag=
function(a,b){return this.writeVarint64(g.zigZagEncode64(a),b)},e.readVarint64=function(a){var b="undefined"===typeof a;b&&(a=this.offset);if(!this.noAssert){if("number"!==typeof a||0!==a%1)throw TypeError("Illegal offset: "+a+" (not an integer)");a>>>=0;if(0>a||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength);}var c=a,d=0,f=0,e=0,h=0,h=this.view[a++],d=h&127;if(h&128&&(h=this.view[a++],d|=(h&127)<<7,h&128||this.noAssert&&"undefined"===typeof h)&&
(h=this.view[a++],d|=(h&127)<<14,h&128||this.noAssert&&"undefined"===typeof h)&&(h=this.view[a++],d|=(h&127)<<21,h&128||this.noAssert&&"undefined"===typeof h)&&(h=this.view[a++],f=h&127,h&128||this.noAssert&&"undefined"===typeof h)&&(h=this.view[a++],f|=(h&127)<<7,h&128||this.noAssert&&"undefined"===typeof h)&&(h=this.view[a++],f|=(h&127)<<14,h&128||this.noAssert&&"undefined"===typeof h)&&(h=this.view[a++],f|=(h&127)<<21,h&128||this.noAssert&&"undefined"===typeof h)&&(h=this.view[a++],e=h&127,h&128||
this.noAssert&&"undefined"===typeof h)&&(h=this.view[a++],e|=(h&127)<<7,h&128||this.noAssert&&"undefined"===typeof h))throw Error("Buffer overrun");d=k.fromBits(d|f<<28,f>>>4|e<<24,!1);return b?(this.offset=a,d):{value:d,length:a-c}},e.readVarint64ZigZag=function(a){(a=this.readVarint64(a))&&a.value instanceof k?a.value=g.zigZagDecode64(a.value):a=g.zigZagDecode64(a);return a});e.writeCString=function(a,b){var c="undefined"===typeof b;c&&(b=this.offset);var d,f=a.length;if(!this.noAssert){if("string"!==
typeof a)throw TypeError("Illegal str: Not a string");for(d=0;d<f;++d)if(0===a.charCodeAt(d))throw RangeError("Illegal str: Contains NULL-characters");if("number"!==typeof b||0!==b%1)throw TypeError("Illegal offset: "+b+" (not an integer)");b>>>=0;if(0>b||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength);}f=l.a(m(a))[1];b+=f+1;d=this.buffer.byteLength;b>d&&this.resize((d*=2)>b?d:b);b-=f+1;l.b(m(a),function(a){this.view[b++]=a}.bind(this));this.view[b++]=
0;return c?(this.offset=b,this):f};e.readCString=function(a){var b="undefined"===typeof a;b&&(a=this.offset);if(!this.noAssert){if("number"!==typeof a||0!==a%1)throw TypeError("Illegal offset: "+a+" (not an integer)");a>>>=0;if(0>a||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength);}var c=a,d,f=-1;l.c(function(){if(0===f)return null;if(a>=this.limit)throw RangeError("Illegal range: Truncated data, "+a+" < "+this.limit);f=this.view[a++];return 0===
f?null:f}.bind(this),d=s(),!0);return b?(this.offset=a,d()):{string:d(),length:a-c}};e.writeIString=function(a,b){var c="undefined"===typeof b;c&&(b=this.offset);if(!this.noAssert){if("string"!==typeof a)throw TypeError("Illegal str: Not a string");if("number"!==typeof b||0!==b%1)throw TypeError("Illegal offset: "+b+" (not an integer)");b>>>=0;if(0>b||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength);}var d=b,f;f=l.a(m(a),this.noAssert)[1];b+=
4+f;var e=this.buffer.byteLength;b>e&&this.resize((e*=2)>b?e:b);b-=4+f;this.littleEndian?(this.view[b+3]=f>>>24&255,this.view[b+2]=f>>>16&255,this.view[b+1]=f>>>8&255,this.view[b]=f&255):(this.view[b]=f>>>24&255,this.view[b+1]=f>>>16&255,this.view[b+2]=f>>>8&255,this.view[b+3]=f&255);b+=4;l.b(m(a),function(a){this.view[b++]=a}.bind(this));if(b!==d+4+f)throw RangeError("Illegal range: Truncated data, "+b+" == "+(b+4+f));return c?(this.offset=b,this):b-d};e.readIString=function(a){var b="undefined"===
typeof a;b&&(a=this.offset);if(!this.noAssert){if("number"!==typeof a||0!==a%1)throw TypeError("Illegal offset: "+a+" (not an integer)");a>>>=0;if(0>a||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength);}var c=a,d=this.readUint32(a),d=this.readUTF8String(d,g.METRICS_BYTES,a+=4);a+=d.length;return b?(this.offset=a,d.string):{string:d.string,length:a-c}};g.METRICS_CHARS="c";g.METRICS_BYTES="b";e.writeUTF8String=function(a,b){var c="undefined"===
typeof b;c&&(b=this.offset);if(!this.noAssert){if("number"!==typeof b||0!==b%1)throw TypeError("Illegal offset: "+b+" (not an integer)");b>>>=0;if(0>b||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength);}var d,f=b;d=l.a(m(a))[1];b+=d;var e=this.buffer.byteLength;b>e&&this.resize((e*=2)>b?e:b);b-=d;l.b(m(a),function(a){this.view[b++]=a}.bind(this));return c?(this.offset=b,this):b-f};e.writeString=e.writeUTF8String;g.calculateUTF8Chars=function(a){return l.a(m(a))[0]};
g.calculateUTF8Bytes=function(a){return l.a(m(a))[1]};g.calculateString=g.calculateUTF8Bytes;e.readUTF8String=function(a,b,c){"number"===typeof b&&(c=b,b=void 0);var d="undefined"===typeof c;d&&(c=this.offset);"undefined"===typeof b&&(b=g.METRICS_CHARS);if(!this.noAssert){if("number"!==typeof a||0!==a%1)throw TypeError("Illegal length: "+a+" (not an integer)");a|=0;if("number"!==typeof c||0!==c%1)throw TypeError("Illegal offset: "+c+" (not an integer)");c>>>=0;if(0>c||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+
c+" (+0) <= "+this.buffer.byteLength);}var f=0,e=c,h;if(b===g.METRICS_CHARS){h=s();l.f(function(){return f<a&&c<this.limit?this.view[c++]:null}.bind(this),function(a){++f;l.e(a,h)});if(f!==a)throw RangeError("Illegal range: Truncated data, "+f+" == "+a);return d?(this.offset=c,h()):{string:h(),length:c-e}}if(b===g.METRICS_BYTES){if(!this.noAssert){if("number"!==typeof c||0!==c%1)throw TypeError("Illegal offset: "+c+" (not an integer)");c>>>=0;if(0>c||c+a>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+
c+" (+"+a+") <= "+this.buffer.byteLength);}var p=c+a;l.c(function(){return c<p?this.view[c++]:null}.bind(this),h=s(),this.noAssert);if(c!==p)throw RangeError("Illegal range: Truncated data, "+c+" == "+p);return d?(this.offset=c,h()):{string:h(),length:c-e}}throw TypeError("Unsupported metrics: "+b);};e.readString=e.readUTF8String;e.writeVString=function(a,b){var c="undefined"===typeof b;c&&(b=this.offset);if(!this.noAssert){if("string"!==typeof a)throw TypeError("Illegal str: Not a string");if("number"!==
typeof b||0!==b%1)throw TypeError("Illegal offset: "+b+" (not an integer)");b>>>=0;if(0>b||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength);}var d=b,f,e;f=l.a(m(a),this.noAssert)[1];e=g.calculateVarint32(f);b+=e+f;var h=this.buffer.byteLength;b>h&&this.resize((h*=2)>b?h:b);b-=e+f;b+=this.writeVarint32(f,b);l.b(m(a),function(a){this.view[b++]=a}.bind(this));if(b!==d+f+e)throw RangeError("Illegal range: Truncated data, "+b+" == "+(b+f+e));return c?
(this.offset=b,this):b-d};e.readVString=function(a){var b="undefined"===typeof a;b&&(a=this.offset);if(!this.noAssert){if("number"!==typeof a||0!==a%1)throw TypeError("Illegal offset: "+a+" (not an integer)");a>>>=0;if(0>a||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength);}var c=a,d=this.readVarint32(a),d=this.readUTF8String(d.value,g.METRICS_BYTES,a+=d.length);a+=d.length;return b?(this.offset=a,d.string):{string:d.string,length:a-c}};e.append=
function(a,b,c){if("number"===typeof b||"string"!==typeof b)c=b,b=void 0;var d="undefined"===typeof c;d&&(c=this.offset);if(!this.noAssert){if("number"!==typeof c||0!==c%1)throw TypeError("Illegal offset: "+c+" (not an integer)");c>>>=0;if(0>c||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength);}a instanceof g||(a=g.wrap(a,b));b=a.limit-a.offset;if(0>=b)return this;c+=b;var f=this.buffer.byteLength;c>f&&this.resize((f*=2)>c?f:c);this.view.set(a.view.subarray(a.offset,
a.limit),c-b);a.offset+=b;d&&(this.offset+=b);return this};e.appendTo=function(a,b){a.append(this,b);return this};e.assert=function(a){this.noAssert=!a;return this};e.capacity=function(){return this.buffer.byteLength};e.clear=function(){this.offset=0;this.limit=this.buffer.byteLength;this.markedOffset=-1;return this};e.clone=function(a){var b=new g(0,this.littleEndian,this.noAssert);a?(b.buffer=new ArrayBuffer(this.buffer.byteLength),b.view=new Uint8Array(b.buffer)):(b.buffer=this.buffer,b.view=this.view);
b.offset=this.offset;b.markedOffset=this.markedOffset;b.limit=this.limit;return b};e.compact=function(a,b){"undefined"===typeof a&&(a=this.offset);"undefined"===typeof b&&(b=this.limit);if(!this.noAssert){if("number"!==typeof a||0!==a%1)throw TypeError("Illegal begin: Not an integer");a>>>=0;if("number"!==typeof b||0!==b%1)throw TypeError("Illegal end: Not an integer");b>>>=0;if(0>a||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength);}if(0===
a&&b===this.buffer.byteLength)return this;var c=b-a;if(0===c)return this.buffer=v,this.view=null,0<=this.markedOffset&&(this.markedOffset-=a),this.limit=this.offset=0,this;var d=new ArrayBuffer(c),f=new Uint8Array(d);f.set(this.view.subarray(a,b));this.buffer=d;this.view=f;0<=this.markedOffset&&(this.markedOffset-=a);this.offset=0;this.limit=c;return this};e.copy=function(a,b){"undefined"===typeof a&&(a=this.offset);"undefined"===typeof b&&(b=this.limit);if(!this.noAssert){if("number"!==typeof a||
0!==a%1)throw TypeError("Illegal begin: Not an integer");a>>>=0;if("number"!==typeof b||0!==b%1)throw TypeError("Illegal end: Not an integer");b>>>=0;if(0>a||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength);}if(a===b)return new g(0,this.littleEndian,this.noAssert);var c=b-a,d=new g(c,this.littleEndian,this.noAssert);d.offset=0;d.limit=c;0<=d.markedOffset&&(d.markedOffset-=a);this.copyTo(d,0,a,b);return d};e.copyTo=function(a,b,c,d){var f,
e;if(!this.noAssert&&!g.isByteBuffer(a))throw TypeError("Illegal target: Not a ByteBuffer");b=(e="undefined"===typeof b)?a.offset:b|0;c=(f="undefined"===typeof c)?this.offset:c|0;d="undefined"===typeof d?this.limit:d|0;if(0>b||b>a.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+b+" <= "+a.buffer.byteLength);if(0>c||d>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+c+" <= "+this.buffer.byteLength);var h=d-c;if(0===h)return a;a.ensureCapacity(b+h);a.view.set(this.view.subarray(c,
d),b);f&&(this.offset+=h);e&&(a.offset+=h);return this};e.ensureCapacity=function(a){var b=this.buffer.byteLength;return b<a?this.resize((b*=2)>a?b:a):this};e.fill=function(a,b,c){var d="undefined"===typeof b;d&&(b=this.offset);"string"===typeof a&&0<a.length&&(a=a.charCodeAt(0));"undefined"===typeof b&&(b=this.offset);"undefined"===typeof c&&(c=this.limit);if(!this.noAssert){if("number"!==typeof a||0!==a%1)throw TypeError("Illegal value: "+a+" (not an integer)");a|=0;if("number"!==typeof b||0!==
b%1)throw TypeError("Illegal begin: Not an integer");b>>>=0;if("number"!==typeof c||0!==c%1)throw TypeError("Illegal end: Not an integer");c>>>=0;if(0>b||b>c||c>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+b+" <= "+c+" <= "+this.buffer.byteLength);}if(b>=c)return this;for(;b<c;)this.view[b++]=a;d&&(this.offset=b);return this};e.flip=function(){this.limit=this.offset;this.offset=0;return this};e.mark=function(a){a="undefined"===typeof a?this.offset:a;if(!this.noAssert){if("number"!==
typeof a||0!==a%1)throw TypeError("Illegal offset: "+a+" (not an integer)");a>>>=0;if(0>a||a+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+0) <= "+this.buffer.byteLength);}this.markedOffset=a;return this};e.order=function(a){if(!this.noAssert&&"boolean"!==typeof a)throw TypeError("Illegal littleEndian: Not a boolean");this.littleEndian=!!a;return this};e.LE=function(a){this.littleEndian="undefined"!==typeof a?!!a:!0;return this};e.BE=function(a){this.littleEndian="undefined"!==
typeof a?!a:!1;return this};e.prepend=function(a,b,c){if("number"===typeof b||"string"!==typeof b)c=b,b=void 0;var d="undefined"===typeof c;d&&(c=this.offset);if(!this.noAssert){if("number"!==typeof c||0!==c%1)throw TypeError("Illegal offset: "+c+" (not an integer)");c>>>=0;if(0>c||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength);}a instanceof g||(a=g.wrap(a,b));b=a.limit-a.offset;if(0>=b)return this;var f=b-c;if(0<f){var e=new ArrayBuffer(this.buffer.byteLength+
f),h=new Uint8Array(e);h.set(this.view.subarray(c,this.buffer.byteLength),b);this.buffer=e;this.view=h;this.offset+=f;0<=this.markedOffset&&(this.markedOffset+=f);this.limit+=f;c+=f}else new Uint8Array(this.buffer);this.view.set(a.view.subarray(a.offset,a.limit),c-b);a.offset=a.limit;d&&(this.offset-=b);return this};e.prependTo=function(a,b){a.prepend(this,b);return this};e.printDebug=function(a){"function"!==typeof a&&(a=console.log.bind(console));a(this.toString()+"\n-------------------------------------------------------------------\n"+
this.toDebug(!0))};e.remaining=function(){return this.limit-this.offset};e.reset=function(){0<=this.markedOffset?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0;return this};e.resize=function(a){if(!this.noAssert){if("number"!==typeof a||0!==a%1)throw TypeError("Illegal capacity: "+a+" (not an integer)");a|=0;if(0>a)throw RangeError("Illegal capacity: 0 <= "+a);}if(this.buffer.byteLength<a){a=new ArrayBuffer(a);var b=new Uint8Array(a);b.set(this.view);this.buffer=a;this.view=b}return this};
e.reverse=function(a,b){"undefined"===typeof a&&(a=this.offset);"undefined"===typeof b&&(b=this.limit);if(!this.noAssert){if("number"!==typeof a||0!==a%1)throw TypeError("Illegal begin: Not an integer");a>>>=0;if("number"!==typeof b||0!==b%1)throw TypeError("Illegal end: Not an integer");b>>>=0;if(0>a||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength);}if(a===b)return this;Array.prototype.reverse.call(this.view.subarray(a,b));return this};
e.skip=function(a){if(!this.noAssert){if("number"!==typeof a||0!==a%1)throw TypeError("Illegal length: "+a+" (not an integer)");a|=0}var b=this.offset+a;if(!this.noAssert&&(0>b||b>this.buffer.byteLength))throw RangeError("Illegal length: 0 <= "+this.offset+" + "+a+" <= "+this.buffer.byteLength);this.offset=b;return this};e.slice=function(a,b){"undefined"===typeof a&&(a=this.offset);"undefined"===typeof b&&(b=this.limit);if(!this.noAssert){if("number"!==typeof a||0!==a%1)throw TypeError("Illegal begin: Not an integer");
a>>>=0;if("number"!==typeof b||0!==b%1)throw TypeError("Illegal end: Not an integer");b>>>=0;if(0>a||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength);}var c=this.clone();c.offset=a;c.limit=b;return c};e.toBuffer=function(a){var b=this.offset,c=this.limit;if(!this.noAssert){if("number"!==typeof b||0!==b%1)throw TypeError("Illegal offset: Not an integer");b>>>=0;if("number"!==typeof c||0!==c%1)throw TypeError("Illegal limit: Not an integer");
c>>>=0;if(0>b||b>c||c>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+b+" <= "+c+" <= "+this.buffer.byteLength);}if(!a&&0===b&&c===this.buffer.byteLength)return this.buffer;if(b===c)return v;a=new ArrayBuffer(c-b);(new Uint8Array(a)).set((new Uint8Array(this.buffer)).subarray(b,c),0);return a};e.toArrayBuffer=e.toBuffer;e.toString=function(a,b,c){if("undefined"===typeof a)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+
")";"number"===typeof a&&(c=b=a="utf8");switch(a){case "utf8":return this.toUTF8(b,c);case "base64":return this.toBase64(b,c);case "hex":return this.toHex(b,c);case "binary":return this.toBinary(b,c);case "debug":return this.toDebug();case "columns":return this.m();default:throw Error("Unsupported encoding: "+a);}};var A=function(){for(var a={},b=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,
116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],c=[],d=0,f=b.length;d<f;++d)c[b[d]]=d;a.h=function(a,c){for(var d,f;null!==(d=a());)c(b[d>>2&63]),f=(d&3)<<4,null!==(d=a())?(f|=d>>4&15,c(b[(f|d>>4&15)&63]),f=(d&15)<<2,null!==(d=a())?(c(b[(f|d>>6&3)&63]),c(b[d&63])):(c(b[f&63]),c(61))):(c(b[f&63]),c(61),c(61))};a.g=function(a,b){function d(a){throw Error("Illegal character code: "+a);}for(var f,e,g;null!==(f=a());)if(e=c[f],"undefined"===typeof e&&d(f),null!==(f=a())&&(g=c[f],"undefined"===
typeof g&&d(f),b(e<<2>>>0|(g&48)>>4),null!==(f=a()))){e=c[f];if("undefined"===typeof e)if(61===f)break;else d(f);b((g&15)<<4>>>0|(e&60)>>2);if(null!==(f=a())){g=c[f];if("undefined"===typeof g)if(61===f)break;else d(f);b((e&3)<<6>>>0|g)}}};a.test=function(a){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(a)};return a}();e.toBase64=function(a,b){"undefined"===typeof a&&(a=this.offset);"undefined"===typeof b&&(b=this.limit);a|=0;b|=0;if(0>a||b>this.capacity||a>b)throw RangeError("begin, end");
var c;A.h(function(){return a<b?this.view[a++]:null}.bind(this),c=s());return c()};g.fromBase64=function(a,b){if("string"!==typeof a)throw TypeError("str");var c=new g(a.length/4*3,b),d=0;A.g(m(a),function(a){c.view[d++]=a});c.limit=d;return c};g.btoa=function(a){return g.fromBinary(a).toBase64()};g.atob=function(a){return g.fromBase64(a).toBinary()};e.toBinary=function(a,b){"undefined"===typeof a&&(a=this.offset);"undefined"===typeof b&&(b=this.limit);a|=0;b|=0;if(0>a||b>this.capacity()||a>b)throw RangeError("begin, end");
if(a===b)return"";for(var c=[],d=[];a<b;)c.push(this.view[a++]),1024<=c.length&&(d.push(String.fromCharCode.apply(String,c)),c=[]);return d.join("")+String.fromCharCode.apply(String,c)};g.fromBinary=function(a,b){if("string"!==typeof a)throw TypeError("str");for(var c=0,d=a.length,f,e=new g(d,b);c<d;){f=a.charCodeAt(c);if(255<f)throw RangeError("illegal char code: "+f);e.view[c++]=f}e.limit=d;return e};e.toDebug=function(a){for(var b=-1,c=this.buffer.byteLength,d,f="",e="",g="";b<c;){-1!==b&&(d=this.view[b],
f=16>d?f+("0"+d.toString(16).toUpperCase()):f+d.toString(16).toUpperCase(),a&&(e+=32<d&&127>d?String.fromCharCode(d):"."));++b;if(a&&0<b&&0===b%16&&b!==c){for(;51>f.length;)f+=" ";g+=f+e+"\n";f=e=""}f=b===this.offset&&b===this.limit?f+(b===this.markedOffset?"!":"|"):b===this.offset?f+(b===this.markedOffset?"[":"<"):b===this.limit?f+(b===this.markedOffset?"]":">"):f+(b===this.markedOffset?"'":a||0!==b&&b!==c?" ":"")}if(a&&" "!==f){for(;51>f.length;)f+=" ";g+=f+e+"\n"}return a?g:f};g.fromDebug=function(a,
b,c){var d=a.length;b=new g((d+1)/3|0,b,c);for(var f=0,e=0,h,k=!1,l=!1,q=!1,m=!1,r=!1;f<d;){switch(h=a.charAt(f++)){case "!":if(!c){if(l||q||m){r=!0;break}l=q=m=!0}b.offset=b.markedOffset=b.limit=e;k=!1;break;case "|":if(!c){if(l||m){r=!0;break}l=m=!0}b.offset=b.limit=e;k=!1;break;case "[":if(!c){if(l||q){r=!0;break}l=q=!0}b.offset=b.markedOffset=e;k=!1;break;case "<":if(!c){if(l){r=!0;break}l=!0}b.offset=e;k=!1;break;case "]":if(!c){if(m||q){r=!0;break}m=q=!0}b.limit=b.markedOffset=e;k=!1;break;
case ">":if(!c){if(m){r=!0;break}m=!0}b.limit=e;k=!1;break;case "'":if(!c){if(q){r=!0;break}q=!0}b.markedOffset=e;k=!1;break;case " ":k=!1;break;default:if(!c&&k){r=!0;break}h=parseInt(h+a.charAt(f++),16);if(!c&&(isNaN(h)||0>h||255<h))throw TypeError("Illegal str: Not a debug encoded string");b.view[e++]=h;k=!0}if(r)throw TypeError("Illegal str: Invalid symbol at "+f);}if(!c){if(!l||!m)throw TypeError("Illegal str: Missing offset or limit");if(e<b.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+
e+" < "+d);}return b};e.toHex=function(a,b){a="undefined"===typeof a?this.offset:a;b="undefined"===typeof b?this.limit:b;if(!this.noAssert){if("number"!==typeof a||0!==a%1)throw TypeError("Illegal begin: Not an integer");a>>>=0;if("number"!==typeof b||0!==b%1)throw TypeError("Illegal end: Not an integer");b>>>=0;if(0>a||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength);}for(var c=Array(b-a),d;a<b;)d=this.view[a++],16>d?c.push("0",d.toString(16)):
c.push(d.toString(16));return c.join("")};g.fromHex=function(a,b,c){if(!c){if("string"!==typeof a)throw TypeError("Illegal str: Not a string");if(0!==a.length%2)throw TypeError("Illegal str: Length not a multiple of 2");}var d=a.length;b=new g(d/2|0,b);for(var f,e=0,h=0;e<d;e+=2){f=parseInt(a.substring(e,e+2),16);if(!c&&(!isFinite(f)||0>f||255<f))throw TypeError("Illegal str: Contains non-hex characters");b.view[h++]=f}b.limit=h;return b};var l=function(){var a={j:1114111,i:function(a,c){var d=null;
"number"===typeof a&&(d=a,a=function(){return null});for(;null!==d||null!==(d=a());)128>d?c(d&127):(2048>d?c(d>>6&31|192):(65536>d?c(d>>12&15|224):(c(d>>18&7|240),c(d>>12&63|128)),c(d>>6&63|128)),c(d&63|128)),d=null},f:function(a,c){function d(a){a=a.slice(0,a.indexOf(null));var b=Error(a.toString());b.name="TruncatedError";b.bytes=a;throw b;}for(var f,e,g,k;null!==(f=a());)if(0===(f&128))c(f);else if(192===(f&224))null===(e=a())&&d([f,e]),c((f&31)<<6|e&63);else if(224===(f&240))null!==(e=a())&&null!==
(g=a())||d([f,e,g]),c((f&15)<<12|(e&63)<<6|g&63);else if(240===(f&248))null!==(e=a())&&null!==(g=a())&&null!==(k=a())||d([f,e,g,k]),c((f&7)<<18|(e&63)<<12|(g&63)<<6|k&63);else throw RangeError("Illegal starting byte: "+f);},d:function(a,c){for(var d,f=null;null!==(d=null!==f?f:a());)55296<=d&&57343>=d&&null!==(f=a())&&56320<=f&&57343>=f?(c(1024*(d-55296)+f-56320+65536),f=null):c(d);null!==f&&c(f)},e:function(a,c){var d=null;"number"===typeof a&&(d=a,a=function(){return null});for(;null!==d||null!==
(d=a());)65535>=d?c(d):(d-=65536,c((d>>10)+55296),c(d%1024+56320)),d=null},b:function(b,c){a.d(b,function(b){a.i(b,c)})},c:function(b,c){a.f(b,function(b){a.e(b,c)})},k:function(a){return 128>a?1:2048>a?2:65536>a?3:4},l:function(a){for(var c,d=0;null!==(c=a());)d+=128>c?1:2048>c?2:65536>c?3:4;return d},a:function(b){var c=0,d=0;a.d(b,function(a){++c;d+=128>a?1:2048>a?2:65536>a?3:4});return[c,d]}};return a}();e.toUTF8=function(a,b){"undefined"===typeof a&&(a=this.offset);"undefined"===typeof b&&(b=
this.limit);if(!this.noAssert){if("number"!==typeof a||0!==a%1)throw TypeError("Illegal begin: Not an integer");a>>>=0;if("number"!==typeof b||0!==b%1)throw TypeError("Illegal end: Not an integer");b>>>=0;if(0>a||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength);}var c;try{l.c(function(){return a<b?this.view[a++]:null}.bind(this),c=s())}catch(d){if(a!==b)throw RangeError("Illegal range: Truncated data, "+a+" != "+b);}return c()};g.fromUTF8=
function(a,b,c){if(!c&&"string"!==typeof a)throw TypeError("Illegal str: Not a string");var d=new g(l.a(m(a),!0)[1],b,c),e=0;l.b(m(a),function(a){d.view[e++]=a});d.limit=e;return d};return g}if("function"===typeof define&&define.amd)define(["long"],u);else if("function"===typeof require&&"object"===typeof module&&module&&module.exports){var B=module,C,D;try{D=require("long")}catch(E){}C=u(D);B.exports=C}else(this.dcodeIO=this.dcodeIO||{}).ByteBuffer=u(this.dcodeIO.Long);
;
/*
 protobuf.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 Released under the Apache License, Version 2.0
 see: https://github.com/dcodeIO/protobuf.js for details
*/
(function(h,u){"function"===typeof define&&define.amd?define(["bytebuffer"],u):"function"===typeof require&&"object"===typeof module&&module&&module.exports?module.exports=u(require("bytebuffer"),!0):(h.dcodeIO=h.dcodeIO||{}).ProtoBuf=u(h.dcodeIO.ByteBuffer)})(this,function(h,u){var d={};d.ByteBuffer=h;d.Long=h.Long||null;d.VERSION="5.0.1";d.WIRE_TYPES={};d.WIRE_TYPES.VARINT=0;d.WIRE_TYPES.BITS64=1;d.WIRE_TYPES.LDELIM=2;d.WIRE_TYPES.STARTGROUP=3;d.WIRE_TYPES.ENDGROUP=4;d.WIRE_TYPES.BITS32=5;d.PACKABLE_WIRE_TYPES=
[d.WIRE_TYPES.VARINT,d.WIRE_TYPES.BITS64,d.WIRE_TYPES.BITS32];d.TYPES={int32:{name:"int32",wireType:d.WIRE_TYPES.VARINT,defaultValue:0},uint32:{name:"uint32",wireType:d.WIRE_TYPES.VARINT,defaultValue:0},sint32:{name:"sint32",wireType:d.WIRE_TYPES.VARINT,defaultValue:0},int64:{name:"int64",wireType:d.WIRE_TYPES.VARINT,defaultValue:d.Long?d.Long.ZERO:void 0},uint64:{name:"uint64",wireType:d.WIRE_TYPES.VARINT,defaultValue:d.Long?d.Long.UZERO:void 0},sint64:{name:"sint64",wireType:d.WIRE_TYPES.VARINT,
defaultValue:d.Long?d.Long.ZERO:void 0},bool:{name:"bool",wireType:d.WIRE_TYPES.VARINT,defaultValue:!1},"double":{name:"double",wireType:d.WIRE_TYPES.BITS64,defaultValue:0},string:{name:"string",wireType:d.WIRE_TYPES.LDELIM,defaultValue:""},bytes:{name:"bytes",wireType:d.WIRE_TYPES.LDELIM,defaultValue:null},fixed32:{name:"fixed32",wireType:d.WIRE_TYPES.BITS32,defaultValue:0},sfixed32:{name:"sfixed32",wireType:d.WIRE_TYPES.BITS32,defaultValue:0},fixed64:{name:"fixed64",wireType:d.WIRE_TYPES.BITS64,
defaultValue:d.Long?d.Long.UZERO:void 0},sfixed64:{name:"sfixed64",wireType:d.WIRE_TYPES.BITS64,defaultValue:d.Long?d.Long.ZERO:void 0},"float":{name:"float",wireType:d.WIRE_TYPES.BITS32,defaultValue:0},"enum":{name:"enum",wireType:d.WIRE_TYPES.VARINT,defaultValue:0},message:{name:"message",wireType:d.WIRE_TYPES.LDELIM,defaultValue:null},group:{name:"group",wireType:d.WIRE_TYPES.STARTGROUP,defaultValue:null}};d.MAP_KEY_TYPES=[d.TYPES.int32,d.TYPES.sint32,d.TYPES.sfixed32,d.TYPES.uint32,d.TYPES.fixed32,
d.TYPES.int64,d.TYPES.sint64,d.TYPES.sfixed64,d.TYPES.uint64,d.TYPES.fixed64,d.TYPES.bool,d.TYPES.string,d.TYPES.bytes];d.ID_MIN=1;d.ID_MAX=536870911;d.convertFieldsToCamelCase=!1;d.populateAccessors=!0;d.populateDefaults=!0;d.Util=function(){var b={};b.IS_NODE=!("object"!==typeof process||"[object process]"!==process+""||process.browser);b.XHR=function(){for(var b=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},
function(){return new ActiveXObject("Microsoft.XMLHTTP")}],d=null,h=0;h<b.length;h++){try{d=b[h]()}catch(n){continue}break}if(!d)throw Error("XMLHttpRequest is not supported");return d};b.fetch=function(d,p){p&&"function"!=typeof p&&(p=null);if(b.IS_NODE){var h=require("fs");if(p)h.readFile(d,function(b,d){b?p(null):p(""+d)});else try{return h.readFileSync(d)}catch(n){return null}}else{var k=b.XHR();k.open("GET",d,p?!0:!1);k.setRequestHeader("Accept","text/plain");"function"===typeof k.overrideMimeType&&
k.overrideMimeType("text/plain");if(p)k.onreadystatechange=function(){4==k.readyState&&(200==k.status||0==k.status&&"string"===typeof k.responseText?p(k.responseText):p(null))},4!=k.readyState&&k.send(null);else return k.send(null),200==k.status||0==k.status&&"string"===typeof k.responseText?k.responseText:null}};b.toCamelCase=function(b){return b.replace(/_([a-zA-Z])/g,function(b,d){return d.toUpperCase()})};return b}();d.Lang={DELIM:/[\s\{\}=;:\[\],'"\(\)<>]/g,RULE:/^(?:required|optional|repeated|map)$/,
TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,FQTYPEREF:/^(?:\.[a-zA-Z][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+|([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?)|inf|nan)$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0[xX][0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?|inf|nan)$/,
BOOL:/^(?:true|false)$/i,ID:/^(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\s/,STRING:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")|(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,STRING_DQ:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,STRING_SQ:/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g};d.DotProto=function(b,d){function h(b,c){var a=-1,l=1;"-"==b.charAt(0)&&(l=-1,b=b.substring(1));if(d.NUMBER_DEC.test(b))a=parseInt(b);else if(d.NUMBER_HEX.test(b))a=parseInt(b.substring(2),16);
else if(d.NUMBER_OCT.test(b))a=parseInt(b.substring(1),8);else throw Error("illegal id value: "+(0>l?"-":"")+b);a=l*a|0;if(!c&&0>a)throw Error("illegal id value: "+(0>l?"-":"")+b);return a}function q(b){var c=1;"-"==b.charAt(0)&&(c=-1,b=b.substring(1));if(d.NUMBER_DEC.test(b))return c*parseInt(b,10);if(d.NUMBER_HEX.test(b))return c*parseInt(b.substring(2),16);if(d.NUMBER_OCT.test(b))return c*parseInt(b.substring(1),8);if("inf"===b)return Infinity*c;if("nan"===b)return NaN;if(d.NUMBER_FLT.test(b))return c*
parseFloat(b);throw Error("illegal number value: "+(0>c?"-":"")+b);}function n(b,c,d){"undefined"===typeof b[c]?b[c]=d:(Array.isArray(b[c])||(b[c]=[b[c]]),b[c].push(d))}var k={},a=function(b){this.source=b+"";this.index=0;this.line=1;this.stack=[];this._stringOpen=null},e=a.prototype;e._readString=function(){var b='"'===this._stringOpen?d.STRING_DQ:d.STRING_SQ;b.lastIndex=this.index-1;var c=b.exec(this.source);if(!c)throw Error("unterminated string");this.index=b.lastIndex;this.stack.push(this._stringOpen);
this._stringOpen=null;return c[1]};e.next=function(){if(0<this.stack.length)return this.stack.shift();if(this.index>=this.source.length)return null;if(null!==this._stringOpen)return this._readString();var b,c;do{for(b=!1;d.WHITESPACE.test(c=this.source.charAt(this.index));)if("\n"===c&&++this.line,++this.index===this.source.length)return null;if("/"===this.source.charAt(this.index))if(++this.index,"/"===this.source.charAt(this.index)){for(;"\n"!==this.source.charAt(++this.index);)if(this.index==this.source.length)return null;
++this.index;++this.line;b=!0}else if("*"===(c=this.source.charAt(this.index))){do{"\n"===c&&++this.line;if(++this.index===this.source.length)return null;b=c;c=this.source.charAt(this.index)}while("*"!==b||"/"!==c);++this.index;b=!0}else return"/"}while(b);if(this.index===this.source.length)return null;c=this.index;d.DELIM.lastIndex=0;if(!d.DELIM.test(this.source.charAt(c++)))for(;c<this.source.length&&!d.DELIM.test(this.source.charAt(c));)++c;c=this.source.substring(this.index,this.index=c);if('"'===
c||"'"===c)this._stringOpen=c;return c};e.peek=function(){if(0===this.stack.length){var b=this.next();if(null===b)return null;this.stack.push(b)}return this.stack[0]};e.skip=function(b){var c=this.next();if(c!==b)throw Error("illegal '"+c+"', '"+b+"' expected");};e.omit=function(b){return this.peek()===b?(this.next(),!0):!1};e.toString=function(){return"Tokenizer ("+this.index+"/"+this.source.length+" at line "+this.line+")"};k.Tokenizer=a;var f=function(b){this.tn=new a(b);this.proto3=!1},e=f.prototype;
e.parse=function(){var b={name:"[ROOT]","package":null,messages:[],enums:[],imports:[],options:{},services:[]},c,a=!0,l;try{for(;c=this.tn.next();)switch(c){case "package":if(!a||null!==b["package"])throw Error("unexpected 'package'");c=this.tn.next();if(!d.TYPEREF.test(c))throw Error("illegal package name: "+c);this.tn.skip(";");b["package"]=c;break;case "import":if(!a)throw Error("unexpected 'import'");c=this.tn.peek();("public"===c||(l="weak"===c))&&this.tn.next();c=this._readString();this.tn.skip(";");
l||b.imports.push(c);break;case "syntax":if(!a)throw Error("unexpected 'syntax'");this.tn.skip("=");"proto3"===(b.syntax=this._readString())&&(this.proto3=!0);this.tn.skip(";");break;case "message":this._parseMessage(b,null);a=!1;break;case "enum":this._parseEnum(b);a=!1;break;case "option":this._parseOption(b);break;case "service":this._parseService(b);break;case "extend":this._parseExtend(b);break;default:throw Error("unexpected '"+c+"'");}}catch(e){throw e.message="Parse error at line "+this.tn.line+
": "+e.message,e;}delete b.name;return b};f.parse=function(b){return(new f(b)).parse()};e._readString=function(){var b="",c;do{c=this.tn.next();if("'"!==c&&'"'!==c)throw Error("illegal string delimiter: "+c);b+=this.tn.next();this.tn.skip(c);c=this.tn.peek()}while('"'===c||'"'===c);return b};e._readValue=function(b){var c=this.tn.peek();if('"'===c||"'"===c)return this._readString();this.tn.next();if(d.NUMBER.test(c))return q(c);if(d.BOOL.test(c))return"true"===c.toLowerCase();if(b&&d.TYPEREF.test(c))return c;
throw Error("illegal value: "+c);};e._parseOption=function(b,c){var a=this.tn.next(),l=!1;"("===a&&(l=!0,a=this.tn.next());if(!d.TYPEREF.test(a))throw Error("illegal option name: "+a);var e=a;l&&(this.tn.skip(")"),e="("+e+")",a=this.tn.peek(),d.FQTYPEREF.test(a)&&(e+=a,this.tn.next()));this.tn.skip("=");this._parseOptionValue(b,e);c||this.tn.skip(";")};e._parseOptionValue=function(b,c){var a=this.tn.peek();if("{"!==a)n(b.options,c,this._readValue(!0));else for(this.tn.skip("{");"}"!==(a=this.tn.next());){if(!d.NAME.test(a))throw Error("illegal option name: "+
c+"."+a);this.tn.omit(":")?n(b.options,c+"."+a,this._readValue(!0)):this._parseOptionValue(b,c+"."+a)}};e._parseService=function(b){var c=this.tn.next();if(!d.NAME.test(c))throw Error("illegal service name at line "+this.tn.line+": "+c);var a={name:c,rpc:{},options:{}};for(this.tn.skip("{");"}"!==(c=this.tn.next());)if("option"===c)this._parseOption(a);else if("rpc"===c)this._parseServiceRPC(a);else throw Error("illegal service token: "+c);this.tn.omit(";");b.services.push(a)};e._parseServiceRPC=
function(b){var c=this.tn.next();if(!d.NAME.test(c))throw Error("illegal rpc service method name: "+c);var a=c,l={request:null,response:null,request_stream:!1,response_stream:!1,options:{}};this.tn.skip("(");c=this.tn.next();"stream"===c.toLowerCase()&&(l.request_stream=!0,c=this.tn.next());if(!d.TYPEREF.test(c))throw Error("illegal rpc service request type: "+c);l.request=c;this.tn.skip(")");c=this.tn.next();if("returns"!==c.toLowerCase())throw Error("illegal rpc service request type delimiter: "+
c);this.tn.skip("(");c=this.tn.next();"stream"===c.toLowerCase()&&(l.response_stream=!0,c=this.tn.next());l.response=c;this.tn.skip(")");c=this.tn.peek();if("{"===c){for(this.tn.next();"}"!==(c=this.tn.next());)if("option"===c)this._parseOption(l);else throw Error("illegal rpc service token: "+c);this.tn.omit(";")}else this.tn.skip(";");"undefined"===typeof b.rpc&&(b.rpc={});b.rpc[a]=l};e._parseMessage=function(b,c){var a=!!c,l=this.tn.next(),e={name:"",fields:[],enums:[],messages:[],options:{},services:[],
oneofs:{}};if(!d.NAME.test(l))throw Error("illegal "+(a?"group":"message")+" name: "+l);e.name=l;a&&(this.tn.skip("="),c.id=h(this.tn.next()),e.isGroup=!0);l=this.tn.peek();"["===l&&c&&this._parseFieldOptions(c);for(this.tn.skip("{");"}"!==(l=this.tn.next());)if(d.RULE.test(l))this._parseMessageField(e,l);else if("oneof"===l)this._parseMessageOneOf(e);else if("enum"===l)this._parseEnum(e);else if("message"===l)this._parseMessage(e);else if("option"===l)this._parseOption(e);else if("service"===l)this._parseService(e);
else if("extensions"===l)e.extensions=this._parseExtensionRanges();else if("reserved"===l)this._parseIgnored();else if("extend"===l)this._parseExtend(e);else if(d.TYPEREF.test(l)){if(!this.proto3)throw Error("illegal field rule: "+l);this._parseMessageField(e,"optional",l)}else throw Error("illegal message token: "+l);this.tn.omit(";");b.messages.push(e);return e};e._parseIgnored=function(){for(;";"!==this.tn.peek();)this.tn.next();this.tn.skip(";")};e._parseMessageField=function(b,c,a){if(!d.RULE.test(c))throw Error("illegal message field rule: "+
c);var e={rule:c,type:"",name:"",options:{},id:0};if("map"===c){if(a)throw Error("illegal type: "+a);this.tn.skip("<");c=this.tn.next();if(!d.TYPE.test(c)&&!d.TYPEREF.test(c))throw Error("illegal message field type: "+c);e.keytype=c;this.tn.skip(",");c=this.tn.next();if(!d.TYPE.test(c)&&!d.TYPEREF.test(c))throw Error("illegal message field: "+c);e.type=c;this.tn.skip(">");c=this.tn.next();if(!d.NAME.test(c))throw Error("illegal message field name: "+c);e.name=c;this.tn.skip("=");e.id=h(this.tn.next());
c=this.tn.peek();"["===c&&this._parseFieldOptions(e);this.tn.skip(";")}else if(a="undefined"!==typeof a?a:this.tn.next(),"group"===a){c=this._parseMessage(b,e);if(!/^[A-Z]/.test(c.name))throw Error("illegal group name: "+c.name);e.type=c.name;e.name=c.name.toLowerCase();this.tn.omit(";")}else{if(!d.TYPE.test(a)&&!d.TYPEREF.test(a))throw Error("illegal message field type: "+a);e.type=a;c=this.tn.next();if(!d.NAME.test(c))throw Error("illegal message field name: "+c);e.name=c;this.tn.skip("=");e.id=
h(this.tn.next());c=this.tn.peek();"["===c&&this._parseFieldOptions(e);this.tn.skip(";")}b.fields.push(e);return e};e._parseMessageOneOf=function(b){var c=this.tn.next();if(!d.NAME.test(c))throw Error("illegal oneof name: "+c);var a=c,e=[];for(this.tn.skip("{");"}"!==(c=this.tn.next());)c=this._parseMessageField(b,"optional",c),c.oneof=a,e.push(c.id);this.tn.omit(";");b.oneofs[a]=e};e._parseFieldOptions=function(b){this.tn.skip("[");for(var c=!0;"]"!==this.tn.peek();)c||this.tn.skip(","),this._parseOption(b,
!0),c=!1;this.tn.next()};e._parseEnum=function(b){var c={name:"",values:[],options:{}},a=this.tn.next();if(!d.NAME.test(a))throw Error("illegal name: "+a);c.name=a;for(this.tn.skip("{");"}"!==(a=this.tn.next());)if("option"===a)this._parseOption(c);else{if(!d.NAME.test(a))throw Error("illegal name: "+a);this.tn.skip("=");var e={name:a,id:h(this.tn.next(),!0)},a=this.tn.peek();"["===a&&this._parseFieldOptions({options:{}});this.tn.skip(";");c.values.push(e)}this.tn.omit(";");b.enums.push(c)};e._parseExtensionRanges=
function(){var a=[],c,d;do{for(d=[];;){c=this.tn.next();switch(c){case "min":c=b.ID_MIN;break;case "max":c=b.ID_MAX;break;default:c=q(c)}d.push(c);if(2===d.length)break;if("to"!==this.tn.peek()){d.push(c);break}this.tn.next()}a.push(d)}while(this.tn.omit(","));this.tn.skip(";");return a};e._parseExtend=function(b){var a=this.tn.next();if(!d.TYPEREF.test(a))throw Error("illegal extend reference: "+a);var e={ref:a,fields:[]};for(this.tn.skip("{");"}"!==(a=this.tn.next());)if(d.RULE.test(a))this._parseMessageField(e,
a);else if(d.TYPEREF.test(a)){if(!this.proto3)throw Error("illegal field rule: "+a);this._parseMessageField(e,"optional",a)}else throw Error("illegal extend token: "+a);this.tn.omit(";");b.messages.push(e);return e};e.toString=function(){return"Parser at line "+this.tn.line};k.Parser=f;return k}(d,d.Lang);d.Reflect=function(b){function d(g,m){if(g&&"number"===typeof g.low&&"number"===typeof g.high&&"boolean"===typeof g.unsigned&&g.low===g.low&&g.high===g.high)return new b.Long(g.low,g.high,"undefined"===
typeof m?g.unsigned:m);if("string"===typeof g)return b.Long.fromString(g,m||!1,10);if("number"===typeof g)return b.Long.fromNumber(g,m||!1);throw Error("not convertible to Long");}function p(g,m){var a=m.readVarint32(),c=a&7,a=a>>>3;switch(c){case b.WIRE_TYPES.VARINT:do a=m.readUint8();while(128===(a&128));break;case b.WIRE_TYPES.BITS64:m.offset+=8;break;case b.WIRE_TYPES.LDELIM:a=m.readVarint32();m.offset+=a;break;case b.WIRE_TYPES.STARTGROUP:p(a,m);break;case b.WIRE_TYPES.ENDGROUP:if(a===g)return!1;
throw Error("Illegal GROUPEND after unknown group: "+a+" ("+g+" expected)");case b.WIRE_TYPES.BITS32:m.offset+=4;break;default:throw Error("Illegal wire type in unknown group "+g+": "+c);}return!0}var q={},n=function(g,b,a){this.builder=g;this.parent=b;this.name=a},k=n.prototype;k.fqn=function(){var g=this.name,b=this;do{b=b.parent;if(null==b)break;g=b.name+"."+g}while(1);return g};k.toString=function(g){return(g?this.className+" ":"")+this.fqn()};k.build=function(){throw Error(this.toString(!0)+
" cannot be built directly");};q.T=n;var a=function(g,b,a,c,d){n.call(this,g,b,a);this.className="Namespace";this.children=[];this.options=c||{};this.syntax=d||"proto2"},k=a.prototype=Object.create(n.prototype);k.getChildren=function(b){b=b||null;if(null==b)return this.children.slice();for(var a=[],c=0,d=this.children.length;c<d;++c)this.children[c]instanceof b&&a.push(this.children[c]);return a};k.addChild=function(b){var a;if(a=this.getChild(b.name))if(a instanceof s.Field&&a.name!==a.originalName&&
null===this.getChild(a.originalName))a.name=a.originalName;else if(b instanceof s.Field&&b.name!==b.originalName&&null===this.getChild(b.originalName))b.name=b.originalName;else throw Error("Duplicate name in namespace "+this.toString(!0)+": "+b.name);this.children.push(b)};k.getChild=function(b){for(var a="number"===typeof b?"id":"name",c=0,d=this.children.length;c<d;++c)if(this.children[c][a]===b)return this.children[c];return null};k.resolve=function(b,a){var c="string"===typeof b?b.split("."):
b,d=this,e=0;if(""===c[e]){for(;null!==d.parent;)d=d.parent;e++}do{do{if(!(d instanceof q.Namespace)){d=null;break}d=d.getChild(c[e]);if(!(d&&d instanceof q.T)||a&&!(d instanceof q.Namespace)){d=null;break}e++}while(e<c.length);if(null!=d)break;if(null!==this.parent)return this.parent.resolve(b,a)}while(null!=d);return d};k.qn=function(b){var a=[],c=b;do a.unshift(c.name),c=c.parent;while(null!==c);for(c=1;c<=a.length;c++){var d=a.slice(a.length-c);if(b===this.resolve(d,b instanceof q.Namespace))return d.join(".")}return b.fqn()};
k.build=function(){for(var b={},c=this.children,d=0,e=c.length,l;d<e;++d)l=c[d],l instanceof a&&(b[l.name]=l.build());Object.defineProperty&&Object.defineProperty(b,"$options",{value:this.buildOpt()});return b};k.buildOpt=function(){for(var b={},a=Object.keys(this.options),c=0,d=a.length;c<d;++c)b[a[c]]=this.options[a[c]];return b};k.getOption=function(b){return"undefined"===typeof b?this.options:"undefined"!==typeof this.options[b]?this.options[b]:null};q.Namespace=a;var e=function(g,a,c,d){this.type=
g;this.resolvedType=a;this.isMapKey=c;this.syntax=d;if(c&&0>b.MAP_KEY_TYPES.indexOf(g))throw Error("Invalid map key type: "+g.name);},f=e.prototype;e.defaultFieldValue=function(g){"string"===typeof g&&(g=b.TYPES[g]);if("undefined"===typeof g.defaultValue)throw Error("default value for type "+g.name+" is not supported");return g==b.TYPES.bytes?new h(0):g.defaultValue};f.verifyValue=function(g){function a(b,g){throw Error("Illegal value for "+c.toString(!0)+" of type "+c.type.name+": "+b+" ("+g+")");
}var c=this;switch(this.type){case b.TYPES.int32:case b.TYPES.sint32:case b.TYPES.sfixed32:return("number"!==typeof g||g===g&&0!==g%1)&&a(typeof g,"not an integer"),4294967295<g?g|0:g;case b.TYPES.uint32:case b.TYPES.fixed32:return("number"!==typeof g||g===g&&0!==g%1)&&a(typeof g,"not an integer"),0>g?g>>>0:g;case b.TYPES.int64:case b.TYPES.sint64:case b.TYPES.sfixed64:if(b.Long)try{return d(g,!1)}catch(e){a(typeof g,e.message)}else a(typeof g,"requires Long.js");case b.TYPES.uint64:case b.TYPES.fixed64:if(b.Long)try{return d(g,
!0)}catch(l){a(typeof g,l.message)}else a(typeof g,"requires Long.js");case b.TYPES.bool:return"boolean"!==typeof g&&a(typeof g,"not a boolean"),g;case b.TYPES["float"]:case b.TYPES["double"]:return"number"!==typeof g&&a(typeof g,"not a number"),g;case b.TYPES.string:return"string"===typeof g||g&&g instanceof String||a(typeof g,"not a string"),""+g;case b.TYPES.bytes:return h.isByteBuffer(g)?g:h.wrap(g,"base64");case b.TYPES["enum"]:for(var f=this.resolvedType.getChildren(b.Reflect.Enum.Value),k=
0;k<f.length;k++)if(f[k].name==g||f[k].id==g)return f[k].id;if("proto3"===this.syntax)return("number"!==typeof g||g===g&&0!==g%1)&&a(typeof g,"not an integer"),(4294967295<g||0>g)&&a(typeof g,"not in range for uint32"),g;a(g,"not a valid enum value");case b.TYPES.group:case b.TYPES.message:g&&"object"===typeof g||a(typeof g,"object expected");if(g instanceof this.resolvedType.clazz)return g;if(g instanceof b.Builder.Message){var f={},k;for(k in g)g.hasOwnProperty(k)&&(f[k]=g[k]);g=f}return new this.resolvedType.clazz(g)}throw Error("[INTERNAL] Illegal value for "+
this.toString(!0)+": "+g+" (undefined type "+this.type+")");};f.calculateLength=function(g,a){if(null===a)return 0;var c;switch(this.type){case b.TYPES.int32:return 0>a?h.calculateVarint64(a):h.calculateVarint32(a);case b.TYPES.uint32:return h.calculateVarint32(a);case b.TYPES.sint32:return h.calculateVarint32(h.zigZagEncode32(a));case b.TYPES.fixed32:case b.TYPES.sfixed32:case b.TYPES["float"]:return 4;case b.TYPES.int64:case b.TYPES.uint64:return h.calculateVarint64(a);case b.TYPES.sint64:return h.calculateVarint64(h.zigZagEncode64(a));
case b.TYPES.fixed64:case b.TYPES.sfixed64:return 8;case b.TYPES.bool:return 1;case b.TYPES["enum"]:return h.calculateVarint32(a);case b.TYPES["double"]:return 8;case b.TYPES.string:return c=h.calculateUTF8Bytes(a),h.calculateVarint32(c)+c;case b.TYPES.bytes:if(0>a.remaining())throw Error("Illegal value for "+this.toString(!0)+": "+a.remaining()+" bytes remaining");return h.calculateVarint32(a.remaining())+a.remaining();case b.TYPES.message:return c=this.resolvedType.calculate(a),h.calculateVarint32(c)+
c;case b.TYPES.group:return c=this.resolvedType.calculate(a),c+h.calculateVarint32(g<<3|b.WIRE_TYPES.ENDGROUP)}throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+a+" (unknown type)");};f.encodeValue=function(g,a,c){if(null===a)return c;switch(this.type){case b.TYPES.int32:0>a?c.writeVarint64(a):c.writeVarint32(a);break;case b.TYPES.uint32:c.writeVarint32(a);break;case b.TYPES.sint32:c.writeVarint32ZigZag(a);break;case b.TYPES.fixed32:c.writeUint32(a);break;case b.TYPES.sfixed32:c.writeInt32(a);
break;case b.TYPES.int64:case b.TYPES.uint64:c.writeVarint64(a);break;case b.TYPES.sint64:c.writeVarint64ZigZag(a);break;case b.TYPES.fixed64:c.writeUint64(a);break;case b.TYPES.sfixed64:c.writeInt64(a);break;case b.TYPES.bool:"string"===typeof a?c.writeVarint32("false"===a.toLowerCase()?0:!!a):c.writeVarint32(a?1:0);break;case b.TYPES["enum"]:c.writeVarint32(a);break;case b.TYPES["float"]:c.writeFloat32(a);break;case b.TYPES["double"]:c.writeFloat64(a);break;case b.TYPES.string:c.writeVString(a);
break;case b.TYPES.bytes:if(0>a.remaining())throw Error("Illegal value for "+this.toString(!0)+": "+a.remaining()+" bytes remaining");g=a.offset;c.writeVarint32(a.remaining());c.append(a);a.offset=g;break;case b.TYPES.message:g=(new h).LE();this.resolvedType.encode(a,g);c.writeVarint32(g.offset);c.append(g.flip());break;case b.TYPES.group:this.resolvedType.encode(a,c);c.writeVarint32(g<<3|b.WIRE_TYPES.ENDGROUP);break;default:throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+
a+" (unknown type)");}return c};f.decode=function(a,c,d){if(c!=this.type.wireType)throw Error("Unexpected wire type for element");switch(this.type){case b.TYPES.int32:return a.readVarint32()|0;case b.TYPES.uint32:return a.readVarint32()>>>0;case b.TYPES.sint32:return a.readVarint32ZigZag()|0;case b.TYPES.fixed32:return a.readUint32()>>>0;case b.TYPES.sfixed32:return a.readInt32()|0;case b.TYPES.int64:return a.readVarint64();case b.TYPES.uint64:return a.readVarint64().toUnsigned();case b.TYPES.sint64:return a.readVarint64ZigZag();
case b.TYPES.fixed64:return a.readUint64();case b.TYPES.sfixed64:return a.readInt64();case b.TYPES.bool:return!!a.readVarint32();case b.TYPES["enum"]:return a.readVarint32();case b.TYPES["float"]:return a.readFloat();case b.TYPES["double"]:return a.readDouble();case b.TYPES.string:return a.readVString();case b.TYPES.bytes:d=a.readVarint32();if(a.remaining()<d)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+d+" required but got only "+a.remaining());c=a.clone();c.limit=c.offset+d;
a.offset+=d;return c;case b.TYPES.message:return d=a.readVarint32(),this.resolvedType.decode(a,d);case b.TYPES.group:return this.resolvedType.decode(a,-1,d)}throw Error("[INTERNAL] Illegal decode type");};f.valueFromString=function(a){if(!this.isMapKey)throw Error("valueFromString() called on non-map-key element");switch(this.type){case b.TYPES.int32:case b.TYPES.sint32:case b.TYPES.sfixed32:case b.TYPES.uint32:case b.TYPES.fixed32:return this.verifyValue(parseInt(a));case b.TYPES.int64:case b.TYPES.sint64:case b.TYPES.sfixed64:case b.TYPES.uint64:case b.TYPES.fixed64:return this.verifyValue(a);
case b.TYPES.bool:return"true"===a;case b.TYPES.string:return this.verifyValue(a);case b.TYPES.bytes:return h.fromBinary(a)}};f.valueToString=function(a){if(!this.isMapKey)throw Error("valueToString() called on non-map-key element");return this.type===b.TYPES.bytes?a.toString("binary"):a.toString()};q.Element=e;var s=function(b,c,d,e,l,f){a.call(this,b,c,d,e,f);this.className="Message";this.extensions=void 0;this.clazz=null;this.isGroup=!!l;this._fieldsByName=this._fieldsById=this._fields=null},f=
s.prototype=Object.create(a.prototype);f.build=function(a){if(this.clazz&&!a)return this.clazz;a=function(b,a){function c(a,g,d,e){if(null===a||"object"!==typeof a){if(e&&e instanceof b.Reflect.Enum){var m=b.Reflect.Enum.getName(e.object,a);if(null!==m)return m}return a}if(h.isByteBuffer(a))return g?a.toBase64():a.toBuffer();if(b.Long.isLong(a))return d?a.toString():b.Long.fromValue(a);var l;if(Array.isArray(a))return l=[],a.forEach(function(a,b){l[b]=c(a,g,d,e)}),l;l={};if(a instanceof b.Map){for(var m=
a.entries(),f=m.next();!f.done;f=m.next())l[a.keyElem.valueToString(f.value[0])]=c(f.value[1],g,d,a.valueElem.resolvedType);return l}var m=a.$type,f=void 0,k;for(k in a)a.hasOwnProperty(k)&&(m&&(f=m.getChild(k))?l[k]=c(a[k],g,d,f.resolvedType):l[k]=c(a[k],g,d));return l}var g=a.getChildren(b.Reflect.Message.Field),d=a.getChildren(b.Reflect.Message.OneOf),e=function(c,m){b.Builder.Message.call(this);for(var l=0,f=d.length;l<f;++l)this[d[l].name]=null;l=0;for(f=g.length;l<f;++l){var k=g[l];this[k.name]=
k.repeated?[]:k.map?new b.Map(k):null;!k.required&&"proto3"!==a.syntax||null===k.defaultValue||(this[k.name]=k.defaultValue)}if(0<arguments.length)if(1!==arguments.length||null===c||"object"!==typeof c||!("function"!==typeof c.encode||c instanceof e)||Array.isArray(c)||c instanceof b.Map||h.isByteBuffer(c)||c instanceof ArrayBuffer||b.Long&&c instanceof b.Long)for(l=0,f=arguments.length;l<f;++l)"undefined"!==typeof(k=arguments[l])&&this.$set(g[l].name,k);else this.$set(c)},m=e.prototype=Object.create(b.Builder.Message.prototype);
m.add=function(c,g,d){var e=a._fieldsByName[c];if(!d){if(!e)throw Error(this+"#"+c+" is undefined");if(!(e instanceof b.Reflect.Message.Field))throw Error(this+"#"+c+" is not a field: "+e.toString(!0));if(!e.repeated)throw Error(this+"#"+c+" is not a repeated field");g=e.verifyValue(g,!0)}null===this[c]&&(this[c]=[]);this[c].push(g);return this};m.$add=m.add;m.set=function(c,g,d){if(c&&"object"===typeof c){d=g;for(var e in c)c.hasOwnProperty(e)&&"undefined"!==typeof(g=c[e])&&this.$set(e,g,d);return this}e=
a._fieldsByName[c];if(d)this[c]=g;else{if(!e)throw Error(this+"#"+c+" is not a field: undefined");if(!(e instanceof b.Reflect.Message.Field))throw Error(this+"#"+c+" is not a field: "+e.toString(!0));this[e.name]=g=e.verifyValue(g)}e&&e.oneof&&(d=this[e.oneof.name],null!==g?(null!==d&&d!==e.name&&(this[d]=null),this[e.oneof.name]=e.name):d===c&&(this[e.oneof.name]=null));return this};m.$set=m.set;m.get=function(c,g){if(g)return this[c];var d=a._fieldsByName[c];if(!(d&&d instanceof b.Reflect.Message.Field))throw Error(this+
"#"+c+" is not a field: undefined");if(!(d instanceof b.Reflect.Message.Field))throw Error(this+"#"+c+" is not a field: "+d.toString(!0));return this[d.name]};m.$get=m.get;for(var l=0;l<g.length;l++){var f=g[l];f instanceof b.Reflect.Message.ExtensionField||a.builder.options.populateAccessors&&function(b){var c=b.originalName.replace(/(_[a-zA-Z])/g,function(a){return a.toUpperCase().replace("_","")}),c=c.substring(0,1).toUpperCase()+c.substring(1),g=b.originalName.replace(/([A-Z])/g,function(a){return"_"+
a}),d=function(a,c){this[b.name]=c?a:b.verifyValue(a);return this},e=function(){return this[b.name]};null===a.getChild("set"+c)&&(m["set"+c]=d);null===a.getChild("set_"+g)&&(m["set_"+g]=d);null===a.getChild("get"+c)&&(m["get"+c]=e);null===a.getChild("get_"+g)&&(m["get_"+g]=e)}(f)}m.encode=function(b,c){"boolean"===typeof b&&(c=b,b=void 0);var g=!1;b||(b=new h,g=!0);var d=b.littleEndian;try{return a.encode(this,b.LE(),c),(g?b.flip():b).LE(d)}catch(e){throw b.LE(d),e;}};e.encode=function(b,a,c){return(new e(b)).encode(a,
c)};m.calculate=function(){return a.calculate(this)};m.encodeDelimited=function(b,c){var g=!1;b||(b=new h,g=!0);var d=(new h).LE();a.encode(this,d,c).flip();b.writeVarint32(d.remaining());b.append(d);return g?b.flip():b};m.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(b){throw b.encoded&&(b.encoded=b.encoded.toArrayBuffer()),b;}};m.toArrayBuffer=m.encodeAB;m.encodeNB=function(){try{return this.encode().toBuffer()}catch(b){throw b.encoded&&(b.encoded=b.encoded.toBuffer()),b;}};
m.toBuffer=m.encodeNB;m.encode64=function(){try{return this.encode().toBase64()}catch(b){throw b.encoded&&(b.encoded=b.encoded.toBase64()),b;}};m.toBase64=m.encode64;m.encodeHex=function(){try{return this.encode().toHex()}catch(b){throw b.encoded&&(b.encoded=b.encoded.toHex()),b;}};m.toHex=m.encodeHex;m.toRaw=function(b,a){return c(this,!!b,!!a,this.$type)};m.encodeJSON=function(){return JSON.stringify(c(this,!0,!0,this.$type))};e.decode=function(b,c,g){"string"===typeof c&&(g=c);"string"===typeof b&&
(b=h.wrap(b,g?g:"base64"));b=h.isByteBuffer(b)?b:h.wrap(b);c=b.littleEndian;try{var d=a.decode(b.LE());b.LE(c);return d}catch(e){throw b.LE(c),e;}};e.decodeDelimited=function(b,c){"string"===typeof b&&(b=h.wrap(b,c?c:"base64"));b=h.isByteBuffer(b)?b:h.wrap(b);if(1>b.remaining())return null;var g=b.offset,d=b.readVarint32();if(b.remaining()<d)return b.offset=g,null;try{var e=a.decode(b.slice(b.offset,b.offset+d).LE());b.offset+=d;return e}catch(m){throw b.offset+=d,m;}};e.decode64=function(b){return e.decode(b,
"base64")};e.decodeHex=function(b){return e.decode(b,"hex")};e.decodeJSON=function(b){return new e(JSON.parse(b))};m.toString=function(){return a.toString()};Object.defineProperty&&(Object.defineProperty(e,"$options",{value:a.buildOpt()}),Object.defineProperty(m,"$options",{value:e.$options}),Object.defineProperty(e,"$type",{value:a}),Object.defineProperty(m,"$type",{value:a}));return e}(b,this);this._fields=[];this._fieldsById={};this._fieldsByName={};for(var c=0,d=this.children.length,e;c<d;c++)if(e=
this.children[c],e instanceof t||e instanceof s||e instanceof w){if(a.hasOwnProperty(e.name))throw Error("Illegal reflect child of "+this.toString(!0)+": "+e.toString(!0)+" cannot override static property '"+e.name+"'");a[e.name]=e.build()}else if(e instanceof s.Field)e.build(),this._fields.push(e),this._fieldsById[e.id]=e,this._fieldsByName[e.name]=e;else if(!(e instanceof s.OneOf||e instanceof l))throw Error("Illegal reflect child of "+this.toString(!0)+": "+this.children[c].toString(!0));return this.clazz=
a};f.encode=function(b,a,c){for(var d=null,e,l=0,f=this._fields.length,k;l<f;++l)e=this._fields[l],k=b[e.name],e.required&&null===k?null===d&&(d=e):e.encode(c?k:e.verifyValue(k),a,b);if(null!==d)throw b=Error("Missing at least one required field for "+this.toString(!0)+": "+d),b.encoded=a,b;return a};f.calculate=function(b){for(var a=0,c=0,d=this._fields.length,e,l;c<d;++c){e=this._fields[c];l=b[e.name];if(e.required&&null===l)throw Error("Missing at least one required field for "+this.toString(!0)+
": "+e);a+=e.calculate(l,b)}return a};f.decode=function(a,c,d){c="number"===typeof c?c:-1;for(var e=a.offset,l=new this.clazz,f,k,s;a.offset<e+c||-1===c&&0<a.remaining();){f=a.readVarint32();k=f&7;s=f>>>3;if(k===b.WIRE_TYPES.ENDGROUP){if(s!==d)throw Error("Illegal group end indicator for "+this.toString(!0)+": "+s+" ("+(d?d+" expected":"not a group")+")");break}if(f=this._fieldsById[s])f.repeated&&!f.options.packed?l[f.name].push(f.decode(k,a)):f.map?(k=f.decode(k,a),l[f.name].set(k[0],k[1])):(l[f.name]=
f.decode(k,a),f.oneof&&(k=l[f.oneof.name],null!==k&&k!==f.name&&(l[k]=null),l[f.oneof.name]=f.name));else switch(k){case b.WIRE_TYPES.VARINT:a.readVarint32();break;case b.WIRE_TYPES.BITS32:a.offset+=4;break;case b.WIRE_TYPES.BITS64:a.offset+=8;break;case b.WIRE_TYPES.LDELIM:f=a.readVarint32();a.offset+=f;break;case b.WIRE_TYPES.STARTGROUP:for(;p(s,a););break;default:throw Error("Illegal wire type for unknown field "+s+" in "+this.toString(!0)+"#decode: "+k);}}a=0;for(c=this._fields.length;a<c;++a)if(f=
this._fields[a],null===l[f.name])if("proto3"===this.syntax)l[f.name]=f.defaultValue;else{if(f.required)throw a=Error("Missing at least one required field for "+this.toString(!0)+": "+f.name),a.decoded=l,a;b.populateDefaults&&null!==f.defaultValue&&(l[f.name]=f.defaultValue)}return l};q.Message=s;var c=function(a,c,d,e,l,f,k,h,r,p){n.call(this,a,c,f);this.className="Message.Field";this.required="required"===d;this.repeated="repeated"===d;this.map="map"===d;this.keyType=e||null;this.type=l;this.resolvedType=
null;this.id=k;this.options=h||{};this.defaultValue=null;this.oneof=r||null;this.syntax=p||"proto2";this.originalName=this.name;this.keyElement=this.element=null;!this.builder.options.convertFieldsToCamelCase||this instanceof s.ExtensionField||(this.name=b.Util.toCamelCase(this.name))},f=c.prototype=Object.create(n.prototype);f.build=function(){this.element=new e(this.type,this.resolvedType,!1,this.syntax);this.map&&(this.keyElement=new e(this.keyType,void 0,!0,this.syntax));"proto3"!==this.syntax||
this.repeated||this.map?"undefined"!==typeof this.options["default"]&&(this.defaultValue=this.verifyValue(this.options["default"])):this.defaultValue=e.defaultFieldValue(this.type)};f.verifyValue=function(a,c){function d(b,a){throw Error("Illegal value for "+e.toString(!0)+" of type "+e.type.name+": "+b+" ("+a+")");}c=c||!1;var e=this;if(null===a)return this.required&&d(typeof a,"required"),"proto3"===this.syntax&&this.type!==b.TYPES.message&&d(typeof a,"proto3 field without field presence cannot be null"),
null;var l;if(this.repeated&&!c){Array.isArray(a)||(a=[a]);var f=[];for(l=0;l<a.length;l++)f.push(this.element.verifyValue(a[l]));return f}if(this.map&&!c){if(a instanceof b.Map)return a;a instanceof Object||d(typeof a,"expected ProtoBuf.Map or raw object for map field");return new b.Map(this,a)}!this.repeated&&Array.isArray(a)&&d(typeof a,"no array expected");return this.element.verifyValue(a)};f.hasWirePresence=function(a,c){if("proto3"!==this.syntax)return null!==a;if(this.oneof&&c[this.oneof.name]===
this.name)return!0;switch(this.type){case b.TYPES.int32:case b.TYPES.sint32:case b.TYPES.sfixed32:case b.TYPES.uint32:case b.TYPES.fixed32:return 0!==a;case b.TYPES.int64:case b.TYPES.sint64:case b.TYPES.sfixed64:case b.TYPES.uint64:case b.TYPES.fixed64:return 0!==a.low||0!==a.high;case b.TYPES.bool:return a;case b.TYPES["float"]:case b.TYPES["double"]:return 0!==a;case b.TYPES.string:return 0<a.length;case b.TYPES.bytes:return 0<a.remaining();case b.TYPES["enum"]:return 0!==a;case b.TYPES.message:return null!==
a;default:return!0}};f.encode=function(a,c,d){if(null===this.type||"object"!==typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===a||this.repeated&&0==a.length)return c;try{if(this.repeated){var e;if(this.options.packed&&0<=b.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)){c.writeVarint32(this.id<<3|b.WIRE_TYPES.LDELIM);c.ensureCapacity(c.offset+=1);var l=c.offset;for(e=0;e<a.length;e++)this.element.encodeValue(this.id,a[e],c);var f=c.offset-
l,k=h.calculateVarint32(f);if(1<k){var s=c.slice(l,c.offset),l=l+(k-1);c.offset=l;c.append(s)}c.writeVarint32(f,l-k)}else for(e=0;e<a.length;e++)c.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,a[e],c)}else this.map?a.forEach(function(a,d,e){e=h.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,d)+h.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,a);c.writeVarint32(this.id<<3|b.WIRE_TYPES.LDELIM);c.writeVarint32(e);
c.writeVarint32(8|this.keyType.wireType);this.keyElement.encodeValue(1,d,c);c.writeVarint32(16|this.type.wireType);this.element.encodeValue(2,a,c)},this):this.hasWirePresence(a,d)&&(c.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,a,c))}catch(r){throw Error("Illegal value for "+this.toString(!0)+": "+a+" ("+r+")");}return c};f.calculate=function(a,c){a=this.verifyValue(a);if(null===this.type||"object"!==typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+
": "+this.type);if(null===a||this.repeated&&0==a.length)return 0;var d=0;try{if(this.repeated){var e,l;if(this.options.packed&&0<=b.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)){d+=h.calculateVarint32(this.id<<3|b.WIRE_TYPES.LDELIM);for(e=l=0;e<a.length;e++)l+=this.element.calculateLength(this.id,a[e]);d+=h.calculateVarint32(l);d+=l}else for(e=0;e<a.length;e++)d+=h.calculateVarint32(this.id<<3|this.type.wireType),d+=this.element.calculateLength(this.id,a[e])}else this.map?a.forEach(function(a,
c,e){a=h.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,c)+h.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,a);d+=h.calculateVarint32(this.id<<3|b.WIRE_TYPES.LDELIM);d+=h.calculateVarint32(a);d+=a},this):this.hasWirePresence(a,c)&&(d+=h.calculateVarint32(this.id<<3|this.type.wireType),d+=this.element.calculateLength(this.id,a))}catch(f){throw Error("Illegal value for "+this.toString(!0)+": "+a+" ("+f+")");}return d};f.decode=function(a,c,d){if(!(!this.map&&
a==this.type.wireType||!d&&this.repeated&&this.options.packed&&a==b.WIRE_TYPES.LDELIM||this.map&&a==b.WIRE_TYPES.LDELIM))throw Error("Illegal wire type for field "+this.toString(!0)+": "+a+" ("+this.type.wireType+" expected)");if(a==b.WIRE_TYPES.LDELIM&&this.repeated&&this.options.packed&&0<=b.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)&&!d){a=c.readVarint32();a=c.offset+a;for(d=[];c.offset<a;)d.push(this.decode(this.type.wireType,c,!0));return d}if(this.map){var l=e.defaultFieldValue(this.keyType);
d=e.defaultFieldValue(this.type);a=c.readVarint32();if(c.remaining()<a)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+a+" required but got only "+c.remaining());var f=c.clone();f.limit=f.offset+a;for(c.offset+=a;0<f.remaining();)if(c=f.readVarint32(),a=c&7,c>>>=3,1===c)l=this.keyElement.decode(f,a,c);else if(2===c)d=this.element.decode(f,a,c);else throw Error("Unexpected tag in map field key/value submessage");return[l,d]}return this.element.decode(c,a,this.id)};q.Message.Field=
c;f=function(a,b,d,e,l,f,k){c.call(this,a,b,d,null,e,l,f,k)};f.prototype=Object.create(c.prototype);q.Message.ExtensionField=f;q.Message.OneOf=function(a,b,c){n.call(this,a,b,c);this.fields=[]};var t=function(b,c,d,e,l){a.call(this,b,c,d,e,l);this.className="Enum";this.object=null};t.getName=function(a,b){for(var c=Object.keys(a),d=0,e;d<c.length;++d)if(a[e=c[d]]===b)return e;return null};(t.prototype=Object.create(a.prototype)).build=function(a){if(this.object&&!a)return this.object;a=new b.Builder.Enum;
for(var c=this.getChildren(t.Value),d=0,e=c.length;d<e;++d)a[c[d].name]=c[d].id;Object.defineProperty&&Object.defineProperty(a,"$options",{value:this.buildOpt(),enumerable:!1});return this.object=a};q.Enum=t;f=function(a,b,c,d){n.call(this,a,b,c);this.className="Enum.Value";this.id=d};f.prototype=Object.create(n.prototype);q.Enum.Value=f;var l=function(a,b,c,d){n.call(this,a,b,c);this.field=d};l.prototype=Object.create(n.prototype);q.Extension=l;var w=function(b,c,d,e){a.call(this,b,c,d,e);this.className=
"Service";this.clazz=null};(w.prototype=Object.create(a.prototype)).build=function(a){return this.clazz&&!a?this.clazz:this.clazz=function(a,b){for(var c=function(b){a.Builder.Service.call(this);this.rpcImpl=b||function(a,b,c){setTimeout(c.bind(this,Error("Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services")),0)}},d=c.prototype=Object.create(a.Builder.Service.prototype),e=b.getChildren(a.Reflect.Service.RPCMethod),l=0;l<e.length;l++)(function(a){d[a.name]=function(c,d){try{try{c=
a.resolvedRequestType.clazz.decode(h.wrap(c))}catch(e){if(!(e instanceof TypeError))throw e;}if(null===c||"object"!==typeof c)throw Error("Illegal arguments");c instanceof a.resolvedRequestType.clazz||(c=new a.resolvedRequestType.clazz(c));this.rpcImpl(a.fqn(),c,function(c,e){if(c)d(c);else{null===e&&(e="");try{e=a.resolvedResponseType.clazz.decode(e)}catch(l){}e&&e instanceof a.resolvedResponseType.clazz?d(null,e):d(Error("Illegal response type received in service method "+b.name+"#"+a.name))}})}catch(l){setTimeout(d.bind(this,
l),0)}};c[a.name]=function(b,d,e){(new c(b))[a.name](d,e)};Object.defineProperty&&(Object.defineProperty(c[a.name],"$options",{value:a.buildOpt()}),Object.defineProperty(d[a.name],"$options",{value:c[a.name].$options}))})(e[l]);Object.defineProperty&&(Object.defineProperty(c,"$options",{value:b.buildOpt()}),Object.defineProperty(d,"$options",{value:c.$options}),Object.defineProperty(c,"$type",{value:b}),Object.defineProperty(d,"$type",{value:b}));return c}(b,this)};q.Service=w;var v=function(a,b,
c,d){n.call(this,a,b,c);this.className="Service.Method";this.options=d||{}};(v.prototype=Object.create(n.prototype)).buildOpt=k.buildOpt;q.Service.Method=v;k=function(a,b,c,d,e,l,f,k){v.call(this,a,b,c,k);this.className="Service.RPCMethod";this.requestName=d;this.responseName=e;this.requestStream=l;this.responseStream=f;this.resolvedResponseType=this.resolvedRequestType=null};k.prototype=Object.create(v.prototype);q.Service.RPCMethod=k;return q}(d);d.Builder=function(b,d,h){function q(a){a.messages&&
a.messages.forEach(function(b){b.syntax=a.syntax;q(b)});a.enums&&a.enums.forEach(function(b){b.syntax=a.syntax})}var n=function(a){this.ptr=this.ns=new h.Namespace(this,null,"");this.resolved=!1;this.result=null;this.files={};this.importRoot=null;this.options=a||{}},k=n.prototype;n.isMessage=function(a){return"string"!==typeof a.name||"undefined"!==typeof a.values||"undefined"!==typeof a.rpc?!1:!0};n.isMessageField=function(a){return"string"!==typeof a.rule||"string"!==typeof a.name||"string"!==typeof a.type||
"undefined"===typeof a.id?!1:!0};n.isEnum=function(a){return"string"===typeof a.name&&"undefined"!==typeof a.values&&Array.isArray(a.values)&&0!==a.values.length?!0:!1};n.isService=function(a){return"string"===typeof a.name&&"object"===typeof a.rpc&&a.rpc?!0:!1};n.isExtend=function(a){return"string"!==typeof a.ref?!1:!0};k.reset=function(){this.ptr=this.ns;return this};k.define=function(a){if("string"!==typeof a||!d.TYPEREF.test(a))throw Error("illegal namespace: "+a);a.split(".").forEach(function(a){var b=
this.ptr.getChild(a);null===b&&this.ptr.addChild(b=new h.Namespace(this,this.ptr,a));this.ptr=b},this);return this};k.create=function(a){if(!a)return this;if(Array.isArray(a)){if(0===a.length)return this;a=a.slice()}else a=[a];for(var d=[a];0<d.length;){a=d.pop();if(!Array.isArray(a))throw Error("not a valid namespace: "+JSON.stringify(a));for(;0<a.length;){var f=a.shift();if(n.isMessage(f)){var k=new h.Message(this,this.ptr,f.name,f.options,f.isGroup,f.syntax),c={};f.oneofs&&Object.keys(f.oneofs).forEach(function(a){k.addChild(c[a]=
new h.Message.OneOf(this,k,a))},this);f.fields&&f.fields.forEach(function(a){if(null!==k.getChild(a.id|0))throw Error("duplicate or invalid field id in "+k.name+": "+a.id);if(a.options&&"object"!==typeof a.options)throw Error("illegal field options in "+k.name+"#"+a.name);var b=null;if("string"===typeof a.oneof&&!(b=c[a.oneof]))throw Error("illegal oneof in "+k.name+"#"+a.name+": "+a.oneof);a=new h.Message.Field(this,k,a.rule,a.keytype,a.type,a.name,a.id,a.options,b,f.syntax);b&&b.fields.push(a);
k.addChild(a)},this);var r=[];f.enums&&f.enums.forEach(function(a){r.push(a)});f.messages&&f.messages.forEach(function(a){r.push(a)});f.services&&f.services.forEach(function(a){r.push(a)});f.extensions&&(k.extensions="number"===typeof f.extensions[0]?[f.extensions]:f.extensions);this.ptr.addChild(k);if(0<r.length){d.push(a);a=r;r=null;this.ptr=k;k=null;continue}r=null}else if(n.isEnum(f))k=new h.Enum(this,this.ptr,f.name,f.options,f.syntax),f.values.forEach(function(a){k.addChild(new h.Enum.Value(this,
k,a.name,a.id))},this),this.ptr.addChild(k);else if(n.isService(f))k=new h.Service(this,this.ptr,f.name,f.options),Object.keys(f.rpc).forEach(function(a){var b=f.rpc[a];k.addChild(new h.Service.RPCMethod(this,k,a,b.request,b.response,!!b.request_stream,!!b.response_stream,b.options))},this),this.ptr.addChild(k);else if(n.isExtend(f))if(k=this.ptr.resolve(f.ref,!0))f.fields.forEach(function(a){if(null!==k.getChild(a.id|0))throw Error("duplicate extended field id in "+k.name+": "+a.id);if(k.extensions){var c=
!1;k.extensions.forEach(function(b){a.id>=b[0]&&a.id<=b[1]&&(c=!0)});if(!c)throw Error("illegal extended field id in "+k.name+": "+a.id+" (not within valid ranges)");}var d=a.name;this.options.convertFieldsToCamelCase&&(d=b.Util.toCamelCase(d));var d=new h.Message.ExtensionField(this,k,a.rule,a.type,this.ptr.fqn()+"."+d,a.id,a.options),e=new h.Extension(this,this.ptr,a.name,d);d.extension=e;this.ptr.addChild(e);k.addChild(d)},this);else{if(!/\.?google\.protobuf\./.test(f.ref))throw Error("extended message "+
f.ref+" is not defined");}else throw Error("not a valid definition: "+JSON.stringify(f));k=f=null}a=null;this.ptr=this.ptr.parent}this.resolved=!1;this.result=null;return this};k["import"]=function(a,d){var k="/";if("string"===typeof d){b.Util.IS_NODE&&(d=require("path").resolve(d));if(!0===this.files[d])return this.reset();this.files[d]=!0}else if("object"===typeof d){var h=d.root;b.Util.IS_NODE&&(h=require("path").resolve(h));if(0<=h.indexOf("\\")||0<=d.file.indexOf("\\"))k="\\";h=h+k+d.file;if(!0===
this.files[h])return this.reset();this.files[h]=!0}if(a.imports&&0<a.imports.length){var c=!1;if("object"===typeof d){if(this.importRoot=d.root,c=!0,h=this.importRoot,d=d.file,0<=h.indexOf("\\")||0<=d.indexOf("\\"))k="\\"}else"string"===typeof d?this.importRoot?h=this.importRoot:0<=d.indexOf("/")?(h=d.replace(/\/[^\/]*$/,""),""===h&&(h="/")):0<=d.indexOf("\\")?(h=d.replace(/\\[^\\]*$/,""),k="\\"):h=".":h=null;for(var r=0;r<a.imports.length;r++)if("string"===typeof a.imports[r]){if(!h)throw Error("cannot determine import root");
var l=a.imports[r];if("google/protobuf/descriptor.proto"!==l&&(l=h+k+l,!0!==this.files[l])){/\.proto$/i.test(l)&&!b.DotProto&&(l=l.replace(/\.proto$/,".json"));var n=b.Util.fetch(l);if(null===n)throw Error("failed to import '"+l+"' in '"+d+"': file not found");if(/\.json$/i.test(l))this["import"](JSON.parse(n+""),l);else this["import"](b.DotProto.Parser.parse(n),l)}}else if(d)if(/\.(\w+)$/.test(d))this["import"](a.imports[r],d.replace(/^(.+)\.(\w+)$/,function(a,b,c){return b+"_import"+r+"."+c}));
else this["import"](a.imports[r],d+"_import"+r);else this["import"](a.imports[r]);c&&(this.importRoot=null)}a["package"]&&this.define(a["package"]);a.syntax&&q(a);var p=this.ptr;a.options&&Object.keys(a.options).forEach(function(b){p.options[b]=a.options[b]});a.messages&&(this.create(a.messages),this.ptr=p);a.enums&&(this.create(a.enums),this.ptr=p);a.services&&(this.create(a.services),this.ptr=p);a["extends"]&&this.create(a["extends"]);return this.reset()};k.resolveAll=function(){var a;if(null==
this.ptr||"object"===typeof this.ptr.type)return this;if(this.ptr instanceof h.Namespace)this.ptr.children.forEach(function(a){this.ptr=a;this.resolveAll()},this);else if(this.ptr instanceof h.Message.Field){if(d.TYPE.test(this.ptr.type))this.ptr.type=b.TYPES[this.ptr.type];else{if(!d.TYPEREF.test(this.ptr.type))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);a=(this.ptr instanceof h.Message.ExtensionField?this.ptr.extension.parent:this.ptr.parent).resolve(this.ptr.type,
!0);if(!a)throw Error("unresolvable type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);this.ptr.resolvedType=a;if(a instanceof h.Enum){if(this.ptr.type=b.TYPES["enum"],"proto3"===this.ptr.syntax&&"proto3"!==a.syntax)throw Error("proto3 message cannot reference proto2 enum");}else if(a instanceof h.Message)this.ptr.type=a.isGroup?b.TYPES.group:b.TYPES.message;else throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);}if(this.ptr.map){if(!d.TYPE.test(this.ptr.keyType))throw Error("illegal key type for map field in "+
this.ptr.toString(!0)+": "+this.ptr.keyType);this.ptr.keyType=b.TYPES[this.ptr.keyType]}}else if(this.ptr instanceof b.Reflect.Service.Method)if(this.ptr instanceof b.Reflect.Service.RPCMethod){a=this.ptr.parent.resolve(this.ptr.requestName,!0);if(!(a&&a instanceof b.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.requestName);this.ptr.resolvedRequestType=a;a=this.ptr.parent.resolve(this.ptr.responseName,!0);if(!(a&&a instanceof b.Reflect.Message))throw Error("Illegal type reference in "+
this.ptr.toString(!0)+": "+this.ptr.responseName);this.ptr.resolvedResponseType=a}else throw Error("illegal service type in "+this.ptr.toString(!0));else if(!(this.ptr instanceof b.Reflect.Message.OneOf||this.ptr instanceof b.Reflect.Extension||this.ptr instanceof b.Reflect.Enum.Value))throw Error("illegal object in namespace: "+typeof this.ptr+": "+this.ptr);return this.reset()};k.build=function(a){this.reset();this.resolved||(this.resolveAll(),this.resolved=!0,this.result=null);null===this.result&&
(this.result=this.ns.build());if(!a)return this.result;a="string"===typeof a?a.split("."):a;for(var b=this.result,d=0;d<a.length;d++)if(b[a[d]])b=b[a[d]];else{b=null;break}return b};k.lookup=function(a,b){return a?this.ns.resolve(a,b):this.ns};k.toString=function(){return"Builder"};n.Message=function(){};n.Enum=function(){};n.Service=function(){};return n}(d,d.Lang,d.Reflect);d.Map=function(b,d){function h(b){var a=0;return{next:function(){return a<b.length?{done:!1,value:b[a++]}:{done:!0}}}}var q=
function(b,a){if(!b.map)throw Error("field is not a map");this.field=b;this.keyElem=new d.Element(b.keyType,null,!0,b.syntax);this.valueElem=new d.Element(b.type,b.resolvedType,!1,b.syntax);this.map={};Object.defineProperty(this,"size",{get:function(){return Object.keys(this.map).length}});if(a)for(var e=Object.keys(a),f=0;f<e.length;f++){var h=this.keyElem.valueFromString(e[f]),c=this.valueElem.verifyValue(a[e[f]]);this.map[this.keyElem.valueToString(h)]={key:h,value:c}}},n=q.prototype;n.clear=function(){this.map=
{}};n["delete"]=function(b){b=this.keyElem.valueToString(this.keyElem.verifyValue(b));var a=b in this.map;delete this.map[b];return a};n.entries=function(){for(var b=[],a=Object.keys(this.map),d=0,f;d<a.length;d++)b.push([(f=this.map[a[d]]).key,f.value]);return h(b)};n.keys=function(){for(var b=[],a=Object.keys(this.map),d=0;d<a.length;d++)b.push(this.map[a[d]].key);return h(b)};n.values=function(){for(var b=[],a=Object.keys(this.map),d=0;d<a.length;d++)b.push(this.map[a[d]].value);return h(b)};n.forEach=
function(b,a){for(var d=Object.keys(this.map),f=0,h;f<d.length;f++)b.call(a,(h=this.map[d[f]]).value,h.key,this)};n.set=function(b,a){var d=this.keyElem.verifyValue(b),f=this.valueElem.verifyValue(a);this.map[this.keyElem.valueToString(d)]={key:d,value:f};return this};n.get=function(b){b=this.keyElem.valueToString(this.keyElem.verifyValue(b));return b in this.map?this.map[b].value:void 0};n.has=function(b){return this.keyElem.valueToString(this.keyElem.verifyValue(b))in this.map};return q}(d,d.Reflect);
d.loadProto=function(b,h,p){if("string"===typeof h||h&&"string"===typeof h.file&&"string"===typeof h.root)p=h,h=void 0;return d.loadJson(d.DotProto.Parser.parse(b),h,p)};d.protoFromString=d.loadProto;d.loadProtoFile=function(b,h,p){h&&"object"===typeof h?(p=h,h=null):h&&"function"===typeof h||(h=null);if(h)return d.Util.fetch("string"===typeof b?b:b.root+"/"+b.file,function(n){if(null===n)h(Error("Failed to fetch file"));else try{h(null,d.loadProto(n,p,b))}catch(k){h(k)}});var q=d.Util.fetch("object"===
typeof b?b.root+"/"+b.file:b);return null===q?null:d.loadProto(q,p,b)};d.protoFromFile=d.loadProtoFile;d.newBuilder=function(b){b=b||{};"undefined"===typeof b.convertFieldsToCamelCase&&(b.convertFieldsToCamelCase=d.convertFieldsToCamelCase);"undefined"===typeof b.populateAccessors&&(b.populateAccessors=d.populateAccessors);return new d.Builder(b)};d.loadJson=function(b,h,p){if("string"===typeof h||h&&"string"===typeof h.file&&"string"===typeof h.root)p=h,h=null;h&&"object"===typeof h||(h=d.newBuilder());
"string"===typeof b&&(b=JSON.parse(b));h["import"](b,p);h.resolveAll();return h};d.loadJsonFile=function(b,h,p){h&&"object"===typeof h?(p=h,h=null):h&&"function"===typeof h||(h=null);if(h)return d.Util.fetch("string"===typeof b?b:b.root+"/"+b.file,function(n){if(null===n)h(Error("Failed to fetch file"));else try{h(null,d.loadJson(JSON.parse(n),p,b))}catch(k){h(k)}});var q=d.Util.fetch("object"===typeof b?b.root+"/"+b.file:b);return null===q?null:d.loadJson(JSON.parse(q),p,b)};return d});
;
/*!
 * EventEmitter v5.2.6 - git.io/ee
 * Unlicense - http://unlicense.org/
 * Oliver Caldwell - https://oli.me.uk/
 * @preserve
 */
!function(e){"use strict";function t(){}function n(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function r(e){return function(){return this[e].apply(this,arguments)}}function i(e){return"function"==typeof e||e instanceof RegExp||!(!e||"object"!=typeof e)&&i(e.listener)}var s=t.prototype,o=e.EventEmitter;s.getListeners=function(e){var t,n,r=this._getEvents();if(e instanceof RegExp){t={};for(n in r)r.hasOwnProperty(n)&&e.test(n)&&(t[n]=r[n])}else t=r[e]||(r[e]=[]);return t},s.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},s.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},s.addListener=function(e,t){if(!i(t))throw new TypeError("listener must be a function");var r,s=this.getListenersAsObject(e),o="object"==typeof t;for(r in s)s.hasOwnProperty(r)&&-1===n(s[r],t)&&s[r].push(o?t:{listener:t,once:!1});return this},s.on=r("addListener"),s.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},s.once=r("addOnceListener"),s.defineEvent=function(e){return this.getListeners(e),this},s.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},s.removeListener=function(e,t){var r,i,s=this.getListenersAsObject(e);for(i in s)s.hasOwnProperty(i)&&-1!==(r=n(s[i],t))&&s[i].splice(r,1);return this},s.off=r("removeListener"),s.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},s.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},s.manipulateListeners=function(e,t,n){var r,i,s=e?this.removeListener:this.addListener,o=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(r=n.length;r--;)s.call(this,t,n[r]);else for(r in t)t.hasOwnProperty(r)&&(i=t[r])&&("function"==typeof i?s.call(this,r,i):o.call(this,r,i));return this},s.removeEvent=function(e){var t,n=typeof e,r=this._getEvents();if("string"===n)delete r[e];else if(e instanceof RegExp)for(t in r)r.hasOwnProperty(t)&&e.test(t)&&delete r[t];else delete this._events;return this},s.removeAllListeners=r("removeEvent"),s.emitEvent=function(e,t){var n,r,i,s,o=this.getListenersAsObject(e);for(s in o)if(o.hasOwnProperty(s))for(n=o[s].slice(0),i=0;i<n.length;i++)r=n[i],!0===r.once&&this.removeListener(e,r.listener),r.listener.apply(this,t||[])===this._getOnceReturnValue()&&this.removeListener(e,r.listener);return this},s.trigger=r("emitEvent"),s.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},s.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},s._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},s._getEvents=function(){return this._events||(this._events={})},t.noConflict=function(){return e.EventEmitter=o,t},"function"==typeof define&&define.amd?define(function(){return t}):"object"==typeof module&&module.exports?module.exports=t:e.EventEmitter=t}("undefined"!=typeof window?window:this||{});;
/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).THREE={})}(this,(function(t){"use strict";const e="143",i=100,n=300,r=301,s=302,a=303,o=304,l=306,c=1e3,h=1001,u=1002,d=1003,p=1004,f=1005,m=1006,g=1007,_=1008,v=1009,x=1012,y=1014,M=1015,b=1016,S=1020,w=1023,T=1026,E=1027,A=33776,R=33777,C=33778,L=33779,P=35840,I=35841,D=35842,N=35843,O=37492,F=37496,U=37808,B=37809,z=37810,G=37811,k=37812,H=37813,V=37814,W=37815,X=37816,j=37817,q=37818,Y=37819,Z=37820,J=37821,K=36492,Q=2300,$=2301,tt=2302,et=2400,it=2401,nt=2402,rt=2500,st=2501,at=3e3,ot=3001,lt="srgb",ct="srgb-linear",ht=7680,ut=35044,dt="300 es",pt=1035;class ft{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const i=this._listeners[t];if(void 0!==i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const i=e.slice(0);for(let e=0,n=i.length;e<n;e++)i[e].call(this,t);t.target=null}}}const mt=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let gt=1234567;const _t=Math.PI/180,vt=180/Math.PI;function xt(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(mt[255&t]+mt[t>>8&255]+mt[t>>16&255]+mt[t>>24&255]+"-"+mt[255&e]+mt[e>>8&255]+"-"+mt[e>>16&15|64]+mt[e>>24&255]+"-"+mt[63&i|128]+mt[i>>8&255]+"-"+mt[i>>16&255]+mt[i>>24&255]+mt[255&n]+mt[n>>8&255]+mt[n>>16&255]+mt[n>>24&255]).toLowerCase()}function yt(t,e,i){return Math.max(e,Math.min(i,t))}function Mt(t,e){return(t%e+e)%e}function bt(t,e,i){return(1-i)*t+i*e}function St(t){return 0==(t&t-1)&&0!==t}function wt(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Tt(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}var Et=Object.freeze({__proto__:null,DEG2RAD:_t,RAD2DEG:vt,generateUUID:xt,clamp:yt,euclideanModulo:Mt,mapLinear:function(t,e,i,n,r){return n+(t-e)*(r-n)/(i-e)},inverseLerp:function(t,e,i){return t!==e?(i-t)/(e-t):0},lerp:bt,damp:function(t,e,i,n){return bt(t,e,1-Math.exp(-i*n))},pingpong:function(t,e=1){return e-Math.abs(Mt(t,2*e)-e)},smoothstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*(3-2*t)},smootherstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){void 0!==t&&(gt=t);let e=gt+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function(t){return t*_t},radToDeg:function(t){return t*vt},isPowerOfTwo:St,ceilPowerOfTwo:wt,floorPowerOfTwo:Tt,setQuaternionFromProperEuler:function(t,e,i,n,r){const s=Math.cos,a=Math.sin,o=s(i/2),l=a(i/2),c=s((e+n)/2),h=a((e+n)/2),u=s((e-n)/2),d=a((e-n)/2),p=s((n-e)/2),f=a((n-e)/2);switch(r){case"XYX":t.set(o*h,l*u,l*d,o*c);break;case"YZY":t.set(l*d,o*h,l*u,o*c);break;case"ZXZ":t.set(l*u,l*d,o*h,o*c);break;case"XZX":t.set(o*h,l*f,l*p,o*c);break;case"YXY":t.set(l*p,o*h,l*f,o*c);break;case"ZYZ":t.set(l*f,l*p,o*h,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:function(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}},denormalize:function(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}});class At{constructor(t=0,e=0){At.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),n=Math.sin(e),r=this.x-t.x,s=this.y-t.y;return this.x=r*i-s*n+t.x,this.y=r*n+s*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Rt{constructor(){Rt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(t,e,i,n,r,s,a,o,l){const c=this.elements;return c[0]=t,c[1]=n,c[2]=a,c[3]=e,c[4]=r,c[5]=o,c[6]=i,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,r=this.elements,s=i[0],a=i[3],o=i[6],l=i[1],c=i[4],h=i[7],u=i[2],d=i[5],p=i[8],f=n[0],m=n[3],g=n[6],_=n[1],v=n[4],x=n[7],y=n[2],M=n[5],b=n[8];return r[0]=s*f+a*_+o*y,r[3]=s*m+a*v+o*M,r[6]=s*g+a*x+o*b,r[1]=l*f+c*_+h*y,r[4]=l*m+c*v+h*M,r[7]=l*g+c*x+h*b,r[2]=u*f+d*_+p*y,r[5]=u*m+d*v+p*M,r[8]=u*g+d*x+p*b,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],c=t[8];return e*s*c-e*a*l-i*r*c+i*a*o+n*r*l-n*s*o}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],c=t[8],h=c*s-a*l,u=a*o-c*r,d=l*r-s*o,p=e*h+i*u+n*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=h*f,t[1]=(n*l-c*i)*f,t[2]=(a*i-n*s)*f,t[3]=u*f,t[4]=(c*e-n*o)*f,t[5]=(n*r-a*e)*f,t[6]=d*f,t[7]=(i*o-l*e)*f,t[8]=(s*e-i*r)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,n,r,s,a){const o=Math.cos(r),l=Math.sin(r);return this.set(i*o,i*l,-i*(o*s+l*a)+s+t,-n*l,n*o,-n*(-l*s+o*a)+a+e,0,0,1),this}scale(t,e){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),n=this.elements,r=n[0],s=n[3],a=n[6],o=n[1],l=n[4],c=n[7];return n[0]=e*r+i*o,n[3]=e*s+i*l,n[6]=e*a+i*c,n[1]=-i*r+e*o,n[4]=-i*s+e*l,n[7]=-i*a+e*c,this}translate(t,e){const i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<9;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}function Ct(t){for(let e=t.length-1;e>=0;--e)if(t[e]>65535)return!0;return!1}const Lt={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Pt(t,e){return new Lt[t](e)}function It(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function Dt(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Nt(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}const Ot={[lt]:{[ct]:Dt},[ct]:{[lt]:Nt}},Ft={legacyMode:!0,get workingColorSpace(){return ct},set workingColorSpace(t){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(t,e,i){if(this.legacyMode||e===i||!e||!i)return t;if(Ot[e]&&void 0!==Ot[e][i]){const n=Ot[e][i];return t.r=n(t.r),t.g=n(t.g),t.b=n(t.b),t}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)}},Ut={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Bt={r:0,g:0,b:0},zt={h:0,s:0,l:0},Gt={h:0,s:0,l:0};function kt(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}function Ht(t,e){return e.r=t.r,e.g=t.g,e.b=t.b,e}class Vt{constructor(t,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===e&&void 0===i?this.set(t):this.setRGB(t,e,i)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e="srgb"){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,Ft.toWorkingColorSpace(this,e),this}setRGB(t,e,i,n="srgb-linear"){return this.r=t,this.g=e,this.b=i,Ft.toWorkingColorSpace(this,n),this}setHSL(t,e,i,n="srgb-linear"){if(t=Mt(t,1),e=yt(e,0,1),i=yt(i,0,1),0===e)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+e):i+e-i*e,r=2*i-n;this.r=kt(r,n,t+1/3),this.g=kt(r,n,t),this.b=kt(r,n,t-1/3)}return Ft.toWorkingColorSpace(this,n),this}setStyle(t,e="srgb"){function i(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let t;const r=n[1],s=n[2];switch(r){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,Ft.toWorkingColorSpace(this,e),i(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,Ft.toWorkingColorSpace(this,e),i(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){const n=parseFloat(t[1])/360,r=parseInt(t[2],10)/100,s=parseInt(t[3],10)/100;return i(t[4]),this.setHSL(n,r,s,e)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=n[1],i=t.length;if(3===i)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,Ft.toWorkingColorSpace(this,e),this;if(6===i)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,Ft.toWorkingColorSpace(this,e),this}return t&&t.length>0?this.setColorName(t,e):this}setColorName(t,e="srgb"){const i=Ut[t.toLowerCase()];return void 0!==i?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Dt(t.r),this.g=Dt(t.g),this.b=Dt(t.b),this}copyLinearToSRGB(t){return this.r=Nt(t.r),this.g=Nt(t.g),this.b=Nt(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t="srgb"){return Ft.fromWorkingColorSpace(Ht(this,Bt),t),yt(255*Bt.r,0,255)<<16^yt(255*Bt.g,0,255)<<8^yt(255*Bt.b,0,255)<<0}getHexString(t="srgb"){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e="srgb-linear"){Ft.fromWorkingColorSpace(Ht(this,Bt),e);const i=Bt.r,n=Bt.g,r=Bt.b,s=Math.max(i,n,r),a=Math.min(i,n,r);let o,l;const c=(a+s)/2;if(a===s)o=0,l=0;else{const t=s-a;switch(l=c<=.5?t/(s+a):t/(2-s-a),s){case i:o=(n-r)/t+(n<r?6:0);break;case n:o=(r-i)/t+2;break;case r:o=(i-n)/t+4}o/=6}return t.h=o,t.s=l,t.l=c,t}getRGB(t,e="srgb-linear"){return Ft.fromWorkingColorSpace(Ht(this,Bt),e),t.r=Bt.r,t.g=Bt.g,t.b=Bt.b,t}getStyle(t="srgb"){return Ft.fromWorkingColorSpace(Ht(this,Bt),t),t!==lt?`color(${t} ${Bt.r} ${Bt.g} ${Bt.b})`:`rgb(${255*Bt.r|0},${255*Bt.g|0},${255*Bt.b|0})`}offsetHSL(t,e,i){return this.getHSL(zt),zt.h+=t,zt.s+=e,zt.l+=i,this.setHSL(zt.h,zt.s,zt.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(zt),t.getHSL(Gt);const i=bt(zt.h,Gt.h,e),n=bt(zt.s,Gt.s,e),r=bt(zt.l,Gt.l,e);return this.setHSL(i,n,r),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let Wt;Vt.NAMES=Ut;class Xt{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Wt&&(Wt=It("canvas")),Wt.width=t.width,Wt.height=t.height;const i=Wt.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=Wt}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=It("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const n=i.getImageData(0,0,t.width,t.height),r=n.data;for(let t=0;t<r.length;t++)r[t]=255*Dt(r[t]/255);return i.putImageData(n,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*Dt(e[t]/255)):e[t]=Dt(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}class jt{constructor(t=null){this.isSource=!0,this.uuid=xt(),this.data=t,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(null!==n){let t;if(Array.isArray(n)){t=[];for(let e=0,i=n.length;e<i;e++)n[e].isDataTexture?t.push(qt(n[e].image)):t.push(qt(n[e]))}else t=qt(n);i.url=t}return e||(t.images[this.uuid]=i),i}}function qt(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?Xt.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Yt=0;class Zt extends ft{constructor(t=Zt.DEFAULT_IMAGE,e=Zt.DEFAULT_MAPPING,i=1001,n=1001,r=1006,s=1008,a=1023,o=1009,l=1,c=3e3){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Yt++}),this.uuid=xt(),this.name="",this.source=new jt(t),this.mipmaps=[],this.mapping=e,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new At(0,0),this.repeat=new At(1,1),this.center=new At(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Rt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==n)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case c:t.x=t.x-Math.floor(t.x);break;case h:t.x=t.x<0?0:1;break;case u:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case c:t.y=t.y-Math.floor(t.y);break;case h:t.y=t.y<0?0:1;break;case u:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}}Zt.DEFAULT_IMAGE=null,Zt.DEFAULT_MAPPING=n;class Jt{constructor(t=0,e=0,i=0,n=1){Jt.prototype.isVector4=!0,this.x=t,this.y=e,this.z=i,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,r=this.w,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*n+s[12]*r,this.y=s[1]*e+s[5]*i+s[9]*n+s[13]*r,this.z=s[2]*e+s[6]*i+s[10]*n+s[14]*r,this.w=s[3]*e+s[7]*i+s[11]*n+s[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,n,r;const s=.01,a=.1,o=t.elements,l=o[0],c=o[4],h=o[8],u=o[1],d=o[5],p=o[9],f=o[2],m=o[6],g=o[10];if(Math.abs(c-u)<s&&Math.abs(h-f)<s&&Math.abs(p-m)<s){if(Math.abs(c+u)<a&&Math.abs(h+f)<a&&Math.abs(p+m)<a&&Math.abs(l+d+g-3)<a)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,o=(d+1)/2,_=(g+1)/2,v=(c+u)/4,x=(h+f)/4,y=(p+m)/4;return t>o&&t>_?t<s?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(t),n=v/i,r=x/i):o>_?o<s?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(o),i=v/n,r=y/n):_<s?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(_),i=x/r,n=y/r),this.set(i,n,r,e),this}let _=Math.sqrt((m-p)*(m-p)+(h-f)*(h-f)+(u-c)*(u-c));return Math.abs(_)<.001&&(_=1),this.x=(m-p)/_,this.y=(h-f)/_,this.z=(u-c)/_,this.w=Math.acos((l+d+g-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Kt extends ft{constructor(t,e,i={}){super(),this.isWebGLRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new Jt(0,0,t,e),this.scissorTest=!1,this.viewport=new Jt(0,0,t,e);const n={width:t,height:e,depth:1};this.texture=new Zt(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:m,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,this.samples=void 0!==i.samples?i.samples:0}setSize(t,e,i=1){this.width===t&&this.height===e&&this.depth===i||(this.width=t,this.height=e,this.depth=i,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new jt(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Qt extends Zt{constructor(t=null,e=1,i=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:i,depth:n},this.magFilter=d,this.minFilter=d,this.wrapR=h,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class $t extends Zt{constructor(t=null,e=1,i=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:i,depth:n},this.magFilter=d,this.minFilter=d,this.wrapR=h,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class te{constructor(t=0,e=0,i=0,n=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=n}static slerpFlat(t,e,i,n,r,s,a){let o=i[n+0],l=i[n+1],c=i[n+2],h=i[n+3];const u=r[s+0],d=r[s+1],p=r[s+2],f=r[s+3];if(0===a)return t[e+0]=o,t[e+1]=l,t[e+2]=c,void(t[e+3]=h);if(1===a)return t[e+0]=u,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(h!==f||o!==u||l!==d||c!==p){let t=1-a;const e=o*u+l*d+c*p+h*f,i=e>=0?1:-1,n=1-e*e;if(n>Number.EPSILON){const r=Math.sqrt(n),s=Math.atan2(r,e*i);t=Math.sin(t*s)/r,a=Math.sin(a*s)/r}const r=a*i;if(o=o*t+u*r,l=l*t+d*r,c=c*t+p*r,h=h*t+f*r,t===1-a){const t=1/Math.sqrt(o*o+l*l+c*c+h*h);o*=t,l*=t,c*=t,h*=t}}t[e]=o,t[e+1]=l,t[e+2]=c,t[e+3]=h}static multiplyQuaternionsFlat(t,e,i,n,r,s){const a=i[n],o=i[n+1],l=i[n+2],c=i[n+3],h=r[s],u=r[s+1],d=r[s+2],p=r[s+3];return t[e]=a*p+c*h+o*d-l*u,t[e+1]=o*p+c*u+l*h-a*d,t[e+2]=l*p+c*d+a*u-o*h,t[e+3]=c*p-a*h-o*u-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=t._x,n=t._y,r=t._z,s=t._order,a=Math.cos,o=Math.sin,l=a(i/2),c=a(n/2),h=a(r/2),u=o(i/2),d=o(n/2),p=o(r/2);switch(s){case"XYZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"YXZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"ZXY":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"ZYX":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"YZX":this._x=u*c*h+l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h-u*d*p;break;case"XZY":this._x=u*c*h-l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],n=e[4],r=e[8],s=e[1],a=e[5],o=e[9],l=e[2],c=e[6],h=e[10],u=i+a+h;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(c-o)*t,this._y=(r-l)*t,this._z=(s-n)*t}else if(i>a&&i>h){const t=2*Math.sqrt(1+i-a-h);this._w=(c-o)/t,this._x=.25*t,this._y=(n+s)/t,this._z=(r+l)/t}else if(a>h){const t=2*Math.sqrt(1+a-i-h);this._w=(r-l)/t,this._x=(n+s)/t,this._y=.25*t,this._z=(o+c)/t}else{const t=2*Math.sqrt(1+h-i-a);this._w=(s-n)/t,this._x=(r+l)/t,this._y=(o+c)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(yt(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const n=Math.min(1,e/i);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,n=t._y,r=t._z,s=t._w,a=e._x,o=e._y,l=e._z,c=e._w;return this._x=i*c+s*a+n*l-r*o,this._y=n*c+s*o+r*a-i*l,this._z=r*c+s*l+i*o-n*a,this._w=s*c-i*a-n*o-r*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const i=this._x,n=this._y,r=this._z,s=this._w;let a=s*t._w+i*t._x+n*t._y+r*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=s,this._x=i,this._y=n,this._z=r,this;const o=1-a*a;if(o<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*i+e*this._x,this._y=t*n+e*this._y,this._z=t*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(o),c=Math.atan2(l,a),h=Math.sin((1-e)*c)/l,u=Math.sin(e*c)/l;return this._w=s*h+this._w*u,this._x=i*h+this._x*u,this._y=n*h+this._y*u,this._z=r*h+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),n=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(n),i*Math.sin(r),i*Math.cos(r),e*Math.sin(n))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class ee{constructor(t=0,e=0,i=0){ee.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(ne.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(ne.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*n,this.y=r[1]*e+r[4]*i+r[7]*n,this.z=r[2]*e+r[5]*i+r[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,r=t.elements,s=1/(r[3]*e+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*n+r[12])*s,this.y=(r[1]*e+r[5]*i+r[9]*n+r[13])*s,this.z=(r[2]*e+r[6]*i+r[10]*n+r[14])*s,this}applyQuaternion(t){const e=this.x,i=this.y,n=this.z,r=t.x,s=t.y,a=t.z,o=t.w,l=o*e+s*n-a*i,c=o*i+a*e-r*n,h=o*n+r*i-s*e,u=-r*e-s*i-a*n;return this.x=l*o+u*-r+c*-a-h*-s,this.y=c*o+u*-s+h*-r-l*-a,this.z=h*o+u*-a+l*-s-c*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n,this.y=r[1]*e+r[5]*i+r[9]*n,this.z=r[2]*e+r[6]*i+r[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,n=t.y,r=t.z,s=e.x,a=e.y,o=e.z;return this.x=n*o-r*a,this.y=r*s-i*o,this.z=i*a-n*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return ie.copy(this).projectOnVector(t),this.sub(ie)}reflect(t){return this.sub(ie.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(yt(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const n=Math.sin(e)*t;return this.x=n*Math.sin(i),this.y=Math.cos(e)*t,this.z=n*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const ie=new ee,ne=new te;class re{constructor(t=new ee(1/0,1/0,1/0),e=new ee(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,a=-1/0;for(let o=0,l=t.length;o<l;o+=3){const l=t[o],c=t[o+1],h=t[o+2];l<e&&(e=l),c<i&&(i=c),h<n&&(n=h),l>r&&(r=l),c>s&&(s=c),h>a&&(a=h)}return this.min.set(e,i,n),this.max.set(r,s,a),this}setFromBufferAttribute(t){let e=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,a=-1/0;for(let o=0,l=t.count;o<l;o++){const l=t.getX(o),c=t.getY(o),h=t.getZ(o);l<e&&(e=l),c<i&&(i=c),h<n&&(n=h),l>r&&(r=l),c>s&&(s=c),h>a&&(a=h)}return this.min.set(e,i,n),this.max.set(r,s,a),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=ae.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const i=t.geometry;if(void 0!==i)if(e&&null!=i.attributes&&void 0!==i.attributes.position){const e=i.attributes.position;for(let i=0,n=e.count;i<n;i++)ae.fromBufferAttribute(e,i).applyMatrix4(t.matrixWorld),this.expandByPoint(ae)}else null===i.boundingBox&&i.computeBoundingBox(),oe.copy(i.boundingBox),oe.applyMatrix4(t.matrixWorld),this.union(oe);const n=t.children;for(let t=0,i=n.length;t<i;t++)this.expandByObject(n[t],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,ae),ae.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(fe),me.subVectors(this.max,fe),le.subVectors(t.a,fe),ce.subVectors(t.b,fe),he.subVectors(t.c,fe),ue.subVectors(ce,le),de.subVectors(he,ce),pe.subVectors(le,he);let e=[0,-ue.z,ue.y,0,-de.z,de.y,0,-pe.z,pe.y,ue.z,0,-ue.x,de.z,0,-de.x,pe.z,0,-pe.x,-ue.y,ue.x,0,-de.y,de.x,0,-pe.y,pe.x,0];return!!ve(e,le,ce,he,me)&&(e=[1,0,0,0,1,0,0,0,1],!!ve(e,le,ce,he,me)&&(ge.crossVectors(ue,de),e=[ge.x,ge.y,ge.z],ve(e,le,ce,he,me)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return ae.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=.5*this.getSize(ae).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(se[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),se[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),se[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),se[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),se[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),se[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),se[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),se[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(se)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const se=[new ee,new ee,new ee,new ee,new ee,new ee,new ee,new ee],ae=new ee,oe=new re,le=new ee,ce=new ee,he=new ee,ue=new ee,de=new ee,pe=new ee,fe=new ee,me=new ee,ge=new ee,_e=new ee;function ve(t,e,i,n,r){for(let s=0,a=t.length-3;s<=a;s+=3){_e.fromArray(t,s);const a=r.x*Math.abs(_e.x)+r.y*Math.abs(_e.y)+r.z*Math.abs(_e.z),o=e.dot(_e),l=i.dot(_e),c=n.dot(_e);if(Math.max(-Math.max(o,l,c),Math.min(o,l,c))>a)return!1}return!0}const xe=new re,ye=new ee,Me=new ee,be=new ee;class Se{constructor(t=new ee,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;void 0!==e?i.copy(e):xe.setFromPoints(t).getCenter(i);let n=0;for(let e=0,r=t.length;e<r;e++)n=Math.max(n,i.distanceToSquared(t[e]));return this.radius=Math.sqrt(n),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){be.subVectors(t,this.center);const e=be.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),i=.5*(t-this.radius);this.center.add(be.multiplyScalar(i/t)),this.radius+=i}return this}union(t){return!0===this.center.equals(t.center)?Me.set(0,0,1).multiplyScalar(t.radius):Me.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(ye.copy(t.center).add(Me)),this.expandByPoint(ye.copy(t.center).sub(Me)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const we=new ee,Te=new ee,Ee=new ee,Ae=new ee,Re=new ee,Ce=new ee,Le=new ee;class Pe{constructor(t=new ee,e=new ee(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,we)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=we.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(we.copy(this.direction).multiplyScalar(e).add(this.origin),we.distanceToSquared(t))}distanceSqToSegment(t,e,i,n){Te.copy(t).add(e).multiplyScalar(.5),Ee.copy(e).sub(t).normalize(),Ae.copy(this.origin).sub(Te);const r=.5*t.distanceTo(e),s=-this.direction.dot(Ee),a=Ae.dot(this.direction),o=-Ae.dot(Ee),l=Ae.lengthSq(),c=Math.abs(1-s*s);let h,u,d,p;if(c>0)if(h=s*o-a,u=s*a-o,p=r*c,h>=0)if(u>=-p)if(u<=p){const t=1/c;h*=t,u*=t,d=h*(h+s*u+2*a)+u*(s*h+u+2*o)+l}else u=r,h=Math.max(0,-(s*u+a)),d=-h*h+u*(u+2*o)+l;else u=-r,h=Math.max(0,-(s*u+a)),d=-h*h+u*(u+2*o)+l;else u<=-p?(h=Math.max(0,-(-s*r+a)),u=h>0?-r:Math.min(Math.max(-r,-o),r),d=-h*h+u*(u+2*o)+l):u<=p?(h=0,u=Math.min(Math.max(-r,-o),r),d=u*(u+2*o)+l):(h=Math.max(0,-(s*r+a)),u=h>0?r:Math.min(Math.max(-r,-o),r),d=-h*h+u*(u+2*o)+l);else u=s>0?-r:r,h=Math.max(0,-(s*u+a)),d=-h*h+u*(u+2*o)+l;return i&&i.copy(this.direction).multiplyScalar(h).add(this.origin),n&&n.copy(Ee).multiplyScalar(u).add(Te),d}intersectSphere(t,e){we.subVectors(t.center,this.origin);const i=we.dot(this.direction),n=we.dot(we)-i*i,r=t.radius*t.radius;if(n>r)return null;const s=Math.sqrt(r-n),a=i-s,o=i+s;return a<0&&o<0?null:a<0?this.at(o,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return null===i?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,n,r,s,a,o;const l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return l>=0?(i=(t.min.x-u.x)*l,n=(t.max.x-u.x)*l):(i=(t.max.x-u.x)*l,n=(t.min.x-u.x)*l),c>=0?(r=(t.min.y-u.y)*c,s=(t.max.y-u.y)*c):(r=(t.max.y-u.y)*c,s=(t.min.y-u.y)*c),i>s||r>n?null:((r>i||i!=i)&&(i=r),(s<n||n!=n)&&(n=s),h>=0?(a=(t.min.z-u.z)*h,o=(t.max.z-u.z)*h):(a=(t.max.z-u.z)*h,o=(t.min.z-u.z)*h),i>o||a>n?null:((a>i||i!=i)&&(i=a),(o<n||n!=n)&&(n=o),n<0?null:this.at(i>=0?i:n,e)))}intersectsBox(t){return null!==this.intersectBox(t,we)}intersectTriangle(t,e,i,n,r){Re.subVectors(e,t),Ce.subVectors(i,t),Le.crossVectors(Re,Ce);let s,a=this.direction.dot(Le);if(a>0){if(n)return null;s=1}else{if(!(a<0))return null;s=-1,a=-a}Ae.subVectors(this.origin,t);const o=s*this.direction.dot(Ce.crossVectors(Ae,Ce));if(o<0)return null;const l=s*this.direction.dot(Re.cross(Ae));if(l<0)return null;if(o+l>a)return null;const c=-s*Ae.dot(Le);return c<0?null:this.at(c/a,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Ie{constructor(){Ie.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(t,e,i,n,r,s,a,o,l,c,h,u,d,p,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=n,g[1]=r,g[5]=s,g[9]=a,g[13]=o,g[2]=l,g[6]=c,g[10]=h,g[14]=u,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Ie).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,n=1/De.setFromMatrixColumn(t,0).length(),r=1/De.setFromMatrixColumn(t,1).length(),s=1/De.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=0,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=0,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,i=t.x,n=t.y,r=t.z,s=Math.cos(i),a=Math.sin(i),o=Math.cos(n),l=Math.sin(n),c=Math.cos(r),h=Math.sin(r);if("XYZ"===t.order){const t=s*c,i=s*h,n=a*c,r=a*h;e[0]=o*c,e[4]=-o*h,e[8]=l,e[1]=i+n*l,e[5]=t-r*l,e[9]=-a*o,e[2]=r-t*l,e[6]=n+i*l,e[10]=s*o}else if("YXZ"===t.order){const t=o*c,i=o*h,n=l*c,r=l*h;e[0]=t+r*a,e[4]=n*a-i,e[8]=s*l,e[1]=s*h,e[5]=s*c,e[9]=-a,e[2]=i*a-n,e[6]=r+t*a,e[10]=s*o}else if("ZXY"===t.order){const t=o*c,i=o*h,n=l*c,r=l*h;e[0]=t-r*a,e[4]=-s*h,e[8]=n+i*a,e[1]=i+n*a,e[5]=s*c,e[9]=r-t*a,e[2]=-s*l,e[6]=a,e[10]=s*o}else if("ZYX"===t.order){const t=s*c,i=s*h,n=a*c,r=a*h;e[0]=o*c,e[4]=n*l-i,e[8]=t*l+r,e[1]=o*h,e[5]=r*l+t,e[9]=i*l-n,e[2]=-l,e[6]=a*o,e[10]=s*o}else if("YZX"===t.order){const t=s*o,i=s*l,n=a*o,r=a*l;e[0]=o*c,e[4]=r-t*h,e[8]=n*h+i,e[1]=h,e[5]=s*c,e[9]=-a*c,e[2]=-l*c,e[6]=i*h+n,e[10]=t-r*h}else if("XZY"===t.order){const t=s*o,i=s*l,n=a*o,r=a*l;e[0]=o*c,e[4]=-h,e[8]=l*c,e[1]=t*h+r,e[5]=s*c,e[9]=i*h-n,e[2]=n*h-i,e[6]=a*c,e[10]=r*h+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Oe,t,Fe)}lookAt(t,e,i){const n=this.elements;return ze.subVectors(t,e),0===ze.lengthSq()&&(ze.z=1),ze.normalize(),Ue.crossVectors(i,ze),0===Ue.lengthSq()&&(1===Math.abs(i.z)?ze.x+=1e-4:ze.z+=1e-4,ze.normalize(),Ue.crossVectors(i,ze)),Ue.normalize(),Be.crossVectors(ze,Ue),n[0]=Ue.x,n[4]=Be.x,n[8]=ze.x,n[1]=Ue.y,n[5]=Be.y,n[9]=ze.y,n[2]=Ue.z,n[6]=Be.z,n[10]=ze.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,r=this.elements,s=i[0],a=i[4],o=i[8],l=i[12],c=i[1],h=i[5],u=i[9],d=i[13],p=i[2],f=i[6],m=i[10],g=i[14],_=i[3],v=i[7],x=i[11],y=i[15],M=n[0],b=n[4],S=n[8],w=n[12],T=n[1],E=n[5],A=n[9],R=n[13],C=n[2],L=n[6],P=n[10],I=n[14],D=n[3],N=n[7],O=n[11],F=n[15];return r[0]=s*M+a*T+o*C+l*D,r[4]=s*b+a*E+o*L+l*N,r[8]=s*S+a*A+o*P+l*O,r[12]=s*w+a*R+o*I+l*F,r[1]=c*M+h*T+u*C+d*D,r[5]=c*b+h*E+u*L+d*N,r[9]=c*S+h*A+u*P+d*O,r[13]=c*w+h*R+u*I+d*F,r[2]=p*M+f*T+m*C+g*D,r[6]=p*b+f*E+m*L+g*N,r[10]=p*S+f*A+m*P+g*O,r[14]=p*w+f*R+m*I+g*F,r[3]=_*M+v*T+x*C+y*D,r[7]=_*b+v*E+x*L+y*N,r[11]=_*S+v*A+x*P+y*O,r[15]=_*w+v*R+x*I+y*F,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],n=t[8],r=t[12],s=t[1],a=t[5],o=t[9],l=t[13],c=t[2],h=t[6],u=t[10],d=t[14];return t[3]*(+r*o*h-n*l*h-r*a*u+i*l*u+n*a*d-i*o*d)+t[7]*(+e*o*d-e*l*u+r*s*u-n*s*d+n*l*c-r*o*c)+t[11]*(+e*l*h-e*a*d-r*s*h+i*s*d+r*a*c-i*l*c)+t[15]*(-n*a*c-e*o*h+e*a*u+n*s*h-i*s*u+i*o*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],c=t[8],h=t[9],u=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],_=h*m*l-f*u*l+f*o*d-a*m*d-h*o*g+a*u*g,v=p*u*l-c*m*l-p*o*d+s*m*d+c*o*g-s*u*g,x=c*f*l-p*h*l+p*a*d-s*f*d-c*a*g+s*h*g,y=p*h*o-c*f*o-p*a*u+s*f*u+c*a*m-s*h*m,M=e*_+i*v+n*x+r*y;if(0===M)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const b=1/M;return t[0]=_*b,t[1]=(f*u*r-h*m*r-f*n*d+i*m*d+h*n*g-i*u*g)*b,t[2]=(a*m*r-f*o*r+f*n*l-i*m*l-a*n*g+i*o*g)*b,t[3]=(h*o*r-a*u*r-h*n*l+i*u*l+a*n*d-i*o*d)*b,t[4]=v*b,t[5]=(c*m*r-p*u*r+p*n*d-e*m*d-c*n*g+e*u*g)*b,t[6]=(p*o*r-s*m*r-p*n*l+e*m*l+s*n*g-e*o*g)*b,t[7]=(s*u*r-c*o*r+c*n*l-e*u*l-s*n*d+e*o*d)*b,t[8]=x*b,t[9]=(p*h*r-c*f*r-p*i*d+e*f*d+c*i*g-e*h*g)*b,t[10]=(s*f*r-p*a*r+p*i*l-e*f*l-s*i*g+e*a*g)*b,t[11]=(c*a*r-s*h*r-c*i*l+e*h*l+s*i*d-e*a*d)*b,t[12]=y*b,t[13]=(c*f*n-p*h*n+p*i*u-e*f*u-c*i*m+e*h*m)*b,t[14]=(p*a*n-s*f*n-p*i*o+e*f*o+s*i*m-e*a*m)*b,t[15]=(s*h*n-c*a*n+c*i*o-e*h*o-s*i*u+e*a*u)*b,this}scale(t){const e=this.elements,i=t.x,n=t.y,r=t.z;return e[0]*=i,e[4]*=n,e[8]*=r,e[1]*=i,e[5]*=n,e[9]*=r,e[2]*=i,e[6]*=n,e[10]*=r,e[3]*=i,e[7]*=n,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),n=Math.sin(e),r=1-i,s=t.x,a=t.y,o=t.z,l=r*s,c=r*a;return this.set(l*s+i,l*a-n*o,l*o+n*a,0,l*a+n*o,c*a+i,c*o-n*s,0,l*o-n*a,c*o+n*s,r*o*o+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,n,r,s){return this.set(1,i,r,0,t,1,s,0,e,n,1,0,0,0,0,1),this}compose(t,e,i){const n=this.elements,r=e._x,s=e._y,a=e._z,o=e._w,l=r+r,c=s+s,h=a+a,u=r*l,d=r*c,p=r*h,f=s*c,m=s*h,g=a*h,_=o*l,v=o*c,x=o*h,y=i.x,M=i.y,b=i.z;return n[0]=(1-(f+g))*y,n[1]=(d+x)*y,n[2]=(p-v)*y,n[3]=0,n[4]=(d-x)*M,n[5]=(1-(u+g))*M,n[6]=(m+_)*M,n[7]=0,n[8]=(p+v)*b,n[9]=(m-_)*b,n[10]=(1-(u+f))*b,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,e,i){const n=this.elements;let r=De.set(n[0],n[1],n[2]).length();const s=De.set(n[4],n[5],n[6]).length(),a=De.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),t.x=n[12],t.y=n[13],t.z=n[14],Ne.copy(this);const o=1/r,l=1/s,c=1/a;return Ne.elements[0]*=o,Ne.elements[1]*=o,Ne.elements[2]*=o,Ne.elements[4]*=l,Ne.elements[5]*=l,Ne.elements[6]*=l,Ne.elements[8]*=c,Ne.elements[9]*=c,Ne.elements[10]*=c,e.setFromRotationMatrix(Ne),i.x=r,i.y=s,i.z=a,this}makePerspective(t,e,i,n,r,s){const a=this.elements,o=2*r/(e-t),l=2*r/(i-n),c=(e+t)/(e-t),h=(i+n)/(i-n),u=-(s+r)/(s-r),d=-2*s*r/(s-r);return a[0]=o,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=h,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,i,n,r,s){const a=this.elements,o=1/(e-t),l=1/(i-n),c=1/(s-r),h=(e+t)*o,u=(i+n)*l,d=(s+r)*c;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-h,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<16;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}const De=new ee,Ne=new Ie,Oe=new ee(0,0,0),Fe=new ee(1,1,1),Ue=new ee,Be=new ee,ze=new ee,Ge=new Ie,ke=new te;class He{constructor(t=0,e=0,i=0,n=He.DefaultOrder){this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,n=this._order){return this._x=t,this._y=e,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const n=t.elements,r=n[0],s=n[4],a=n[8],o=n[1],l=n[5],c=n[9],h=n[2],u=n[6],d=n[10];switch(e){case"XYZ":this._y=Math.asin(yt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-yt(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-h,r),this._z=0);break;case"ZXY":this._x=Math.asin(yt(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-yt(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(yt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,r)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-yt(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return Ge.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Ge,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return ke.setFromEuler(this),this.setFromQuaternion(ke,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}He.DefaultOrder="XYZ",He.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Ve{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}isEnabled(t){return 0!=(this.mask&(1<<t|0))}}let We=0;const Xe=new ee,je=new te,qe=new Ie,Ye=new ee,Ze=new ee,Je=new ee,Ke=new te,Qe=new ee(1,0,0),$e=new ee(0,1,0),ti=new ee(0,0,1),ei={type:"added"},ii={type:"removed"};class ni extends ft{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:We++}),this.uuid=xt(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ni.DefaultUp.clone();const t=new ee,e=new He,i=new te,n=new ee(1,1,1);e._onChange((function(){i.setFromEuler(e,!1)})),i._onChange((function(){e.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Ie},normalMatrix:{value:new Rt}}),this.matrix=new Ie,this.matrixWorld=new Ie,this.matrixAutoUpdate=ni.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Ve,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return je.setFromAxisAngle(t,e),this.quaternion.multiply(je),this}rotateOnWorldAxis(t,e){return je.setFromAxisAngle(t,e),this.quaternion.premultiply(je),this}rotateX(t){return this.rotateOnAxis(Qe,t)}rotateY(t){return this.rotateOnAxis($e,t)}rotateZ(t){return this.rotateOnAxis(ti,t)}translateOnAxis(t,e){return Xe.copy(t).applyQuaternion(this.quaternion),this.position.add(Xe.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Qe,t)}translateY(t){return this.translateOnAxis($e,t)}translateZ(t){return this.translateOnAxis(ti,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(qe.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?Ye.copy(t):Ye.set(t,e,i);const n=this.parent;this.updateWorldMatrix(!0,!1),Ze.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?qe.lookAt(Ze,Ye,this.up):qe.lookAt(Ye,Ze,this.up),this.quaternion.setFromRotationMatrix(qe),n&&(qe.extractRotation(n.matrixWorld),je.setFromRotationMatrix(qe),this.quaternion.premultiply(je.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(ei)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(ii)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(ii)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),qe.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),qe.multiply(t.parent.matrixWorld)),t.applyMatrix4(qe),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,n=this.children.length;i<n;i++){const n=this.children[i].getObjectByProperty(t,e);if(void 0!==n)return n}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ze,t,Je),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ze,Ke,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].updateMatrixWorld(t)}updateWorldMatrix(t,e){const i=this.parent;if(!0===t&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,i=t.length;e<i;e++)t[e].updateWorldMatrix(!1,!0)}}toJSON(t){const e=void 0===t||"string"==typeof t,i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const n={};function r(e,i){return void 0===e[i.uuid]&&(e[i.uuid]=i.toJSON(t)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const i=e.shapes;if(Array.isArray(i))for(let e=0,n=i.length;e<n;e++){const n=i[e];r(t.shapes,n)}else r(t.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let i=0,n=this.material.length;i<n;i++)e.push(r(t.materials,this.material[i]));n.material=e}else n.material=r(t.materials,this.material);if(this.children.length>0){n.children=[];for(let e=0;e<this.children.length;e++)n.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let e=0;e<this.animations.length;e++){const i=this.animations[e];n.animations.push(r(t.animations,i))}}if(e){const e=s(t.geometries),n=s(t.materials),r=s(t.textures),a=s(t.images),o=s(t.shapes),l=s(t.skeletons),c=s(t.animations),h=s(t.nodes);e.length>0&&(i.geometries=e),n.length>0&&(i.materials=n),r.length>0&&(i.textures=r),a.length>0&&(i.images=a),o.length>0&&(i.shapes=o),l.length>0&&(i.skeletons=l),c.length>0&&(i.animations=c),h.length>0&&(i.nodes=h)}return i.object=n,i;function s(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const i=t.children[e];this.add(i.clone())}return this}}ni.DefaultUp=new ee(0,1,0),ni.DefaultMatrixAutoUpdate=!0;const ri=new ee,si=new ee,ai=new ee,oi=new ee,li=new ee,ci=new ee,hi=new ee,ui=new ee,di=new ee,pi=new ee;class fi{constructor(t=new ee,e=new ee,i=new ee){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,n){n.subVectors(i,e),ri.subVectors(t,e),n.cross(ri);const r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(t,e,i,n,r){ri.subVectors(n,e),si.subVectors(i,e),ai.subVectors(t,e);const s=ri.dot(ri),a=ri.dot(si),o=ri.dot(ai),l=si.dot(si),c=si.dot(ai),h=s*l-a*a;if(0===h)return r.set(-2,-1,-1);const u=1/h,d=(l*o-a*c)*u,p=(s*c-a*o)*u;return r.set(1-d-p,p,d)}static containsPoint(t,e,i,n){return this.getBarycoord(t,e,i,n,oi),oi.x>=0&&oi.y>=0&&oi.x+oi.y<=1}static getUV(t,e,i,n,r,s,a,o){return this.getBarycoord(t,e,i,n,oi),o.set(0,0),o.addScaledVector(r,oi.x),o.addScaledVector(s,oi.y),o.addScaledVector(a,oi.z),o}static isFrontFacing(t,e,i,n){return ri.subVectors(i,e),si.subVectors(t,e),ri.cross(si).dot(n)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,n){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[n]),this}setFromAttributeAndIndices(t,e,i,n){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return ri.subVectors(this.c,this.b),si.subVectors(this.a,this.b),.5*ri.cross(si).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return fi.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return fi.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,i,n,r){return fi.getUV(t,this.a,this.b,this.c,e,i,n,r)}containsPoint(t){return fi.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return fi.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,n=this.b,r=this.c;let s,a;li.subVectors(n,i),ci.subVectors(r,i),ui.subVectors(t,i);const o=li.dot(ui),l=ci.dot(ui);if(o<=0&&l<=0)return e.copy(i);di.subVectors(t,n);const c=li.dot(di),h=ci.dot(di);if(c>=0&&h<=c)return e.copy(n);const u=o*h-c*l;if(u<=0&&o>=0&&c<=0)return s=o/(o-c),e.copy(i).addScaledVector(li,s);pi.subVectors(t,r);const d=li.dot(pi),p=ci.dot(pi);if(p>=0&&d<=p)return e.copy(r);const f=d*l-o*p;if(f<=0&&l>=0&&p<=0)return a=l/(l-p),e.copy(i).addScaledVector(ci,a);const m=c*p-d*h;if(m<=0&&h-c>=0&&d-p>=0)return hi.subVectors(r,n),a=(h-c)/(h-c+(d-p)),e.copy(n).addScaledVector(hi,a);const g=1/(m+f+u);return s=f*g,a=u*g,e.copy(i).addScaledVector(li,s).addScaledVector(ci,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let mi=0;class gi extends ft{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:mi++}),this.uuid=xt(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=i,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ht,this.stencilZFail=ht,this.stencilZPass=ht,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const i=t[e];if(void 0===i){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if("shading"===e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===i;continue}const n=this[e];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]=i:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(i.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(i.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),0!==this.side&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),e){const e=n(t.textures),r=n(t.images);e.length>0&&(i.textures=e),r.length>0&&(i.images=r)}return i}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(null!==e){const t=e.length;i=new Array(t);for(let n=0;n!==t;++n)i[n]=e[n].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}class _i extends gi{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Vt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const vi=new ee,xi=new At;class yi{constructor(t,e,i){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===i,this.usage=ut,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[t+n]=e.array[i+n];return this}copyArray(t){return this.array.set(t),this}copyColorsArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),r=new Vt),e[i++]=r.r,e[i++]=r.g,e[i++]=r.b}return this}copyVector2sArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),r=new At),e[i++]=r.x,e[i++]=r.y}return this}copyVector3sArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),r=new ee),e[i++]=r.x,e[i++]=r.y,e[i++]=r.z}return this}copyVector4sArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),r=new Jt),e[i++]=r.x,e[i++]=r.y,e[i++]=r.z,e[i++]=r.w}return this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,i=this.count;e<i;e++)xi.fromBufferAttribute(this,e),xi.applyMatrix3(t),this.setXY(e,xi.x,xi.y);else if(3===this.itemSize)for(let e=0,i=this.count;e<i;e++)vi.fromBufferAttribute(this,e),vi.applyMatrix3(t),this.setXYZ(e,vi.x,vi.y,vi.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)vi.fromBufferAttribute(this,e),vi.applyMatrix4(t),this.setXYZ(e,vi.x,vi.y,vi.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)vi.fromBufferAttribute(this,e),vi.applyNormalMatrix(t),this.setXYZ(e,vi.x,vi.y,vi.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)vi.fromBufferAttribute(this,e),vi.transformDirection(t),this.setXYZ(e,vi.x,vi.y,vi.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){return this.array[t*this.itemSize]}setX(t,e){return this.array[t*this.itemSize]=e,this}getY(t){return this.array[t*this.itemSize+1]}setY(t,e){return this.array[t*this.itemSize+1]=e,this}getZ(t){return this.array[t*this.itemSize+2]}setZ(t,e){return this.array[t*this.itemSize+2]=e,this}getW(t){return this.array[t*this.itemSize+3]}setW(t,e){return this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this}setXYZW(t,e,i,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==ut&&(t.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(t.updateRange=this.updateRange),t}}class Mi extends yi{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class bi extends yi{constructor(t,e,i){super(new Uint32Array(t),e,i)}}class Si extends yi{constructor(t,e,i){super(new Float32Array(t),e,i)}}let wi=0;const Ti=new Ie,Ei=new ni,Ai=new ee,Ri=new re,Ci=new re,Li=new ee;class Pi extends ft{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:wi++}),this.uuid=xt(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Ct(t)?bi:Mi)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const e=(new Rt).getNormalMatrix(t);i.applyNormalMatrix(e),i.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(t),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return Ti.makeRotationFromQuaternion(t),this.applyMatrix4(Ti),this}rotateX(t){return Ti.makeRotationX(t),this.applyMatrix4(Ti),this}rotateY(t){return Ti.makeRotationY(t),this.applyMatrix4(Ti),this}rotateZ(t){return Ti.makeRotationZ(t),this.applyMatrix4(Ti),this}translate(t,e,i){return Ti.makeTranslation(t,e,i),this.applyMatrix4(Ti),this}scale(t,e,i){return Ti.makeScale(t,e,i),this.applyMatrix4(Ti),this}lookAt(t){return Ei.lookAt(t),Ei.updateMatrix(),this.applyMatrix4(Ei.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ai).negate(),this.translate(Ai.x,Ai.y,Ai.z),this}setFromPoints(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i];e.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new Si(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new re);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new ee(-1/0,-1/0,-1/0),new ee(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];Ri.setFromBufferAttribute(i),this.morphTargetsRelative?(Li.addVectors(this.boundingBox.min,Ri.min),this.boundingBox.expandByPoint(Li),Li.addVectors(this.boundingBox.max,Ri.max),this.boundingBox.expandByPoint(Li)):(this.boundingBox.expandByPoint(Ri.min),this.boundingBox.expandByPoint(Ri.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Se);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new ee,1/0);if(t){const i=this.boundingSphere.center;if(Ri.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];Ci.setFromBufferAttribute(i),this.morphTargetsRelative?(Li.addVectors(Ri.min,Ci.min),Ri.expandByPoint(Li),Li.addVectors(Ri.max,Ci.max),Ri.expandByPoint(Li)):(Ri.expandByPoint(Ci.min),Ri.expandByPoint(Ci.max))}Ri.getCenter(i);let n=0;for(let e=0,r=t.count;e<r;e++)Li.fromBufferAttribute(t,e),n=Math.max(n,i.distanceToSquared(Li));if(e)for(let r=0,s=e.length;r<s;r++){const s=e[r],a=this.morphTargetsRelative;for(let e=0,r=s.count;e<r;e++)Li.fromBufferAttribute(s,e),a&&(Ai.fromBufferAttribute(t,e),Li.add(Ai)),n=Math.max(n,i.distanceToSquared(Li))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=t.array,n=e.position.array,r=e.normal.array,s=e.uv.array,a=n.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new yi(new Float32Array(4*a),4));const o=this.getAttribute("tangent").array,l=[],c=[];for(let t=0;t<a;t++)l[t]=new ee,c[t]=new ee;const h=new ee,u=new ee,d=new ee,p=new At,f=new At,m=new At,g=new ee,_=new ee;function v(t,e,i){h.fromArray(n,3*t),u.fromArray(n,3*e),d.fromArray(n,3*i),p.fromArray(s,2*t),f.fromArray(s,2*e),m.fromArray(s,2*i),u.sub(h),d.sub(h),f.sub(p),m.sub(p);const r=1/(f.x*m.y-m.x*f.y);isFinite(r)&&(g.copy(u).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(r),_.copy(d).multiplyScalar(f.x).addScaledVector(u,-m.x).multiplyScalar(r),l[t].add(g),l[e].add(g),l[i].add(g),c[t].add(_),c[e].add(_),c[i].add(_))}let x=this.groups;0===x.length&&(x=[{start:0,count:i.length}]);for(let t=0,e=x.length;t<e;++t){const e=x[t],n=e.start;for(let t=n,r=n+e.count;t<r;t+=3)v(i[t+0],i[t+1],i[t+2])}const y=new ee,M=new ee,b=new ee,S=new ee;function w(t){b.fromArray(r,3*t),S.copy(b);const e=l[t];y.copy(e),y.sub(b.multiplyScalar(b.dot(e))).normalize(),M.crossVectors(S,e);const i=M.dot(c[t])<0?-1:1;o[4*t]=y.x,o[4*t+1]=y.y,o[4*t+2]=y.z,o[4*t+3]=i}for(let t=0,e=x.length;t<e;++t){const e=x[t],n=e.start;for(let t=n,r=n+e.count;t<r;t+=3)w(i[t+0]),w(i[t+1]),w(i[t+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let i=this.getAttribute("normal");if(void 0===i)i=new yi(new Float32Array(3*e.count),3),this.setAttribute("normal",i);else for(let t=0,e=i.count;t<e;t++)i.setXYZ(t,0,0,0);const n=new ee,r=new ee,s=new ee,a=new ee,o=new ee,l=new ee,c=new ee,h=new ee;if(t)for(let u=0,d=t.count;u<d;u+=3){const d=t.getX(u+0),p=t.getX(u+1),f=t.getX(u+2);n.fromBufferAttribute(e,d),r.fromBufferAttribute(e,p),s.fromBufferAttribute(e,f),c.subVectors(s,r),h.subVectors(n,r),c.cross(h),a.fromBufferAttribute(i,d),o.fromBufferAttribute(i,p),l.fromBufferAttribute(i,f),a.add(c),o.add(c),l.add(c),i.setXYZ(d,a.x,a.y,a.z),i.setXYZ(p,o.x,o.y,o.z),i.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,a=e.count;t<a;t+=3)n.fromBufferAttribute(e,t+0),r.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),c.subVectors(s,r),h.subVectors(n,r),c.cross(h),i.setXYZ(t+0,c.x,c.y,c.z),i.setXYZ(t+1,c.x,c.y,c.z),i.setXYZ(t+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const n in i){if(void 0===t.attributes[n])continue;const r=i[n].array,s=t.attributes[n],a=s.array,o=s.itemSize*e,l=Math.min(a.length,r.length-o);for(let t=0,e=o;t<l;t++,e++)r[e]=a[t]}return this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)Li.fromBufferAttribute(t,e),Li.normalize(),t.setXYZ(e,Li.x,Li.y,Li.z)}toNonIndexed(){function t(t,e){const i=t.array,n=t.itemSize,r=t.normalized,s=new i.constructor(e.length*n);let a=0,o=0;for(let r=0,l=e.length;r<l;r++){a=t.isInterleavedBufferAttribute?e[r]*t.data.stride+t.offset:e[r]*n;for(let t=0;t<n;t++)s[o++]=i[a++]}return new yi(s,n,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Pi,i=this.index.array,n=this.attributes;for(const r in n){const s=t(n[r],i);e.setAttribute(r,s)}const r=this.morphAttributes;for(const n in r){const s=[],a=r[n];for(let e=0,n=a.length;e<n;e++){const n=t(a[e],i);s.push(n)}e.morphAttributes[n]=s}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let t=0,i=s.length;t<i;t++){const i=s[t];e.addGroup(i.start,i.count,i.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const i in e)void 0!==e[i]&&(t[i]=e[i]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const e in i){const n=i[e];t.data.attributes[e]=n.toJSON(t.data)}const n={};let r=!1;for(const e in this.morphAttributes){const i=this.morphAttributes[e],s=[];for(let e=0,n=i.length;e<n;e++){const n=i[e];s.push(n.toJSON(t.data))}s.length>0&&(n[e]=s,r=!0)}r&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const a=this.boundingSphere;return null!==a&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;null!==i&&this.setIndex(i.clone(e));const n=t.attributes;for(const t in n){const i=n[t];this.setAttribute(t,i.clone(e))}const r=t.morphAttributes;for(const t in r){const i=[],n=r[t];for(let t=0,r=n.length;t<r;t++)i.push(n[t].clone(e));this.morphAttributes[t]=i}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,e=s.length;t<e;t++){const e=s[t];this.addGroup(e.start,e.count,e.materialIndex)}const a=t.boundingBox;null!==a&&(this.boundingBox=a.clone());const o=t.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,void 0!==t.parameters&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const Ii=new Ie,Di=new Pe,Ni=new Se,Oi=new ee,Fi=new ee,Ui=new ee,Bi=new ee,zi=new ee,Gi=new ee,ki=new ee,Hi=new ee,Vi=new ee,Wi=new At,Xi=new At,ji=new At,qi=new ee,Yi=new ee;class Zi extends ni{constructor(t=new Pi,e=new _i){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const i=t[e[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=i.length;t<e;t++){const e=i[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}raycast(t,e){const i=this.geometry,n=this.material,r=this.matrixWorld;if(void 0===n)return;if(null===i.boundingSphere&&i.computeBoundingSphere(),Ni.copy(i.boundingSphere),Ni.applyMatrix4(r),!1===t.ray.intersectsSphere(Ni))return;if(Ii.copy(r).invert(),Di.copy(t.ray).applyMatrix4(Ii),null!==i.boundingBox&&!1===Di.intersectsBox(i.boundingBox))return;let s;const a=i.index,o=i.attributes.position,l=i.morphAttributes.position,c=i.morphTargetsRelative,h=i.attributes.uv,u=i.attributes.uv2,d=i.groups,p=i.drawRange;if(null!==a)if(Array.isArray(n))for(let i=0,r=d.length;i<r;i++){const r=d[i],f=n[r.materialIndex];for(let i=Math.max(r.start,p.start),n=Math.min(a.count,Math.min(r.start+r.count,p.start+p.count));i<n;i+=3){const n=a.getX(i),d=a.getX(i+1),p=a.getX(i+2);s=Ji(this,f,t,Di,o,l,c,h,u,n,d,p),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=r.materialIndex,e.push(s))}}else{for(let i=Math.max(0,p.start),r=Math.min(a.count,p.start+p.count);i<r;i+=3){const r=a.getX(i),d=a.getX(i+1),p=a.getX(i+2);s=Ji(this,n,t,Di,o,l,c,h,u,r,d,p),s&&(s.faceIndex=Math.floor(i/3),e.push(s))}}else if(void 0!==o)if(Array.isArray(n))for(let i=0,r=d.length;i<r;i++){const r=d[i],a=n[r.materialIndex];for(let i=Math.max(r.start,p.start),n=Math.min(o.count,Math.min(r.start+r.count,p.start+p.count));i<n;i+=3){s=Ji(this,a,t,Di,o,l,c,h,u,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=r.materialIndex,e.push(s))}}else{for(let i=Math.max(0,p.start),r=Math.min(o.count,p.start+p.count);i<r;i+=3){s=Ji(this,n,t,Di,o,l,c,h,u,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),e.push(s))}}}}function Ji(t,e,i,n,r,s,a,o,l,c,h,u){Oi.fromBufferAttribute(r,c),Fi.fromBufferAttribute(r,h),Ui.fromBufferAttribute(r,u);const d=t.morphTargetInfluences;if(s&&d){ki.set(0,0,0),Hi.set(0,0,0),Vi.set(0,0,0);for(let t=0,e=s.length;t<e;t++){const e=d[t],i=s[t];0!==e&&(Bi.fromBufferAttribute(i,c),zi.fromBufferAttribute(i,h),Gi.fromBufferAttribute(i,u),a?(ki.addScaledVector(Bi,e),Hi.addScaledVector(zi,e),Vi.addScaledVector(Gi,e)):(ki.addScaledVector(Bi.sub(Oi),e),Hi.addScaledVector(zi.sub(Fi),e),Vi.addScaledVector(Gi.sub(Ui),e)))}Oi.add(ki),Fi.add(Hi),Ui.add(Vi)}t.isSkinnedMesh&&(t.boneTransform(c,Oi),t.boneTransform(h,Fi),t.boneTransform(u,Ui));const p=function(t,e,i,n,r,s,a,o){let l;if(l=1===e.side?n.intersectTriangle(a,s,r,!0,o):n.intersectTriangle(r,s,a,2!==e.side,o),null===l)return null;Yi.copy(o),Yi.applyMatrix4(t.matrixWorld);const c=i.ray.origin.distanceTo(Yi);return c<i.near||c>i.far?null:{distance:c,point:Yi.clone(),object:t}}(t,e,i,n,Oi,Fi,Ui,qi);if(p){o&&(Wi.fromBufferAttribute(o,c),Xi.fromBufferAttribute(o,h),ji.fromBufferAttribute(o,u),p.uv=fi.getUV(qi,Oi,Fi,Ui,Wi,Xi,ji,new At)),l&&(Wi.fromBufferAttribute(l,c),Xi.fromBufferAttribute(l,h),ji.fromBufferAttribute(l,u),p.uv2=fi.getUV(qi,Oi,Fi,Ui,Wi,Xi,ji,new At));const t={a:c,b:h,c:u,normal:new ee,materialIndex:0};fi.getNormal(Oi,Fi,Ui,t.normal),p.face=t}return p}class Ki extends Pi{constructor(t=1,e=1,i=1,n=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:r,depthSegments:s};const a=this;n=Math.floor(n),r=Math.floor(r),s=Math.floor(s);const o=[],l=[],c=[],h=[];let u=0,d=0;function p(t,e,i,n,r,s,p,f,m,g,_){const v=s/m,x=p/g,y=s/2,M=p/2,b=f/2,S=m+1,w=g+1;let T=0,E=0;const A=new ee;for(let s=0;s<w;s++){const a=s*x-M;for(let o=0;o<S;o++){const u=o*v-y;A[t]=u*n,A[e]=a*r,A[i]=b,l.push(A.x,A.y,A.z),A[t]=0,A[e]=0,A[i]=f>0?1:-1,c.push(A.x,A.y,A.z),h.push(o/m),h.push(1-s/g),T+=1}}for(let t=0;t<g;t++)for(let e=0;e<m;e++){const i=u+e+S*t,n=u+e+S*(t+1),r=u+(e+1)+S*(t+1),s=u+(e+1)+S*t;o.push(i,n,s),o.push(n,r,s),E+=6}a.addGroup(d,E,_),d+=E,u+=T}p("z","y","x",-1,-1,i,e,t,s,r,0),p("z","y","x",1,-1,i,e,-t,s,r,1),p("x","z","y",1,1,t,i,e,n,s,2),p("x","z","y",1,-1,t,i,-e,n,s,3),p("x","y","z",1,-1,t,e,i,n,r,4),p("x","y","z",-1,-1,t,e,-i,n,r,5),this.setIndex(o),this.setAttribute("position",new Si(l,3)),this.setAttribute("normal",new Si(c,3)),this.setAttribute("uv",new Si(h,2))}static fromJSON(t){return new Ki(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function Qi(t){const e={};for(const i in t){e[i]={};for(const n in t[i]){const r=t[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?e[i][n]=r.clone():Array.isArray(r)?e[i][n]=r.slice():e[i][n]=r}}return e}function $i(t){const e={};for(let i=0;i<t.length;i++){const n=Qi(t[i]);for(const t in n)e[t]=n[t]}return e}const tn={clone:Qi,merge:$i};class en extends gi{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Qi(t.uniforms),this.uniformsGroups=function(t){const e=[];for(let i=0;i<t.length;i++)e.push(t[i].clone());return e}(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?e.uniforms[i]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[i]={type:"m4",value:n.toArray()}:e.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const i={};for(const t in this.extensions)!0===this.extensions[t]&&(i[t]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}}class nn extends ni{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ie,this.projectionMatrix=new Ie,this.projectionMatrixInverse=new Ie}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class rn extends nn{constructor(t=50,e=1,i=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*vt*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*_t*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*vt*Math.atan(Math.tan(.5*_t*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,n,r,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*_t*this.fov)/this.zoom,i=2*e,n=this.aspect*i,r=-.5*n;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,a=s.fullHeight;r+=s.offsetX*n/t,e-=s.offsetY*i/a,n*=s.width/t,i*=s.height/a}const a=this.filmOffset;0!==a&&(r+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,e,e-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const sn=90;class an extends ni{constructor(t,e,i){if(super(),this.type="CubeCamera",!0!==i.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=i;const n=new rn(sn,1,t,e);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new ee(1,0,0)),this.add(n);const r=new rn(sn,1,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new ee(-1,0,0)),this.add(r);const s=new rn(sn,1,t,e);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new ee(0,1,0)),this.add(s);const a=new rn(sn,1,t,e);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new ee(0,-1,0)),this.add(a);const o=new rn(sn,1,t,e);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new ee(0,0,1)),this.add(o);const l=new rn(sn,1,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new ee(0,0,-1)),this.add(l)}update(t,e){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget,[n,r,s,a,o,l]=this.children,c=t.getRenderTarget(),h=t.toneMapping,u=t.xr.enabled;t.toneMapping=0,t.xr.enabled=!1;const d=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(e,n),t.setRenderTarget(i,1),t.render(e,r),t.setRenderTarget(i,2),t.render(e,s),t.setRenderTarget(i,3),t.render(e,a),t.setRenderTarget(i,4),t.render(e,o),i.texture.generateMipmaps=d,t.setRenderTarget(i,5),t.render(e,l),t.setRenderTarget(c),t.toneMapping=h,t.xr.enabled=u,i.texture.needsPMREMUpdate=!0}}class on extends Zt{constructor(t,e,i,n,s,a,o,l,c,h){super(t=void 0!==t?t:[],e=void 0!==e?e:r,i,n,s,a,o,l,c,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class ln extends Kt{constructor(t,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const i={width:t,height:t,depth:1},n=[i,i,i,i,i,i];this.texture=new on(n,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:m}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},n=new Ki(5,5,5),r=new en({name:"CubemapFromEquirect",uniforms:Qi(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:1,blending:0});r.uniforms.tEquirect.value=e;const s=new Zi(n,r),a=e.minFilter;e.minFilter===_&&(e.minFilter=m);return new an(1,10,this).update(t,s),e.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(t,e,i,n){const r=t.getRenderTarget();for(let r=0;r<6;r++)t.setRenderTarget(this,r),t.clear(e,i,n);t.setRenderTarget(r)}}const cn=new ee,hn=new ee,un=new Rt;class dn{constructor(t=new ee(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){const n=cn.subVectors(i,e).cross(hn.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){const i=t.delta(cn),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:e.copy(i).multiplyScalar(r).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const i=e||un.getNormalMatrix(t),n=this.coplanarPoint(cn).applyMatrix4(t),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const pn=new Se,fn=new ee;class mn{constructor(t=new dn,e=new dn,i=new dn,n=new dn,r=new dn,s=new dn){this.planes=[t,e,i,n,r,s]}set(t,e,i,n,r,s){const a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(i),a[3].copy(n),a[4].copy(r),a[5].copy(s),this}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t){const e=this.planes,i=t.elements,n=i[0],r=i[1],s=i[2],a=i[3],o=i[4],l=i[5],c=i[6],h=i[7],u=i[8],d=i[9],p=i[10],f=i[11],m=i[12],g=i[13],_=i[14],v=i[15];return e[0].setComponents(a-n,h-o,f-u,v-m).normalize(),e[1].setComponents(a+n,h+o,f+u,v+m).normalize(),e[2].setComponents(a+r,h+l,f+d,v+g).normalize(),e[3].setComponents(a-r,h-l,f-d,v-g).normalize(),e[4].setComponents(a-s,h-c,f-p,v-_).normalize(),e[5].setComponents(a+s,h+c,f+p,v+_).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),pn.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(pn)}intersectsSprite(t){return pn.center.set(0,0,0),pn.radius=.7071067811865476,pn.applyMatrix4(t.matrixWorld),this.intersectsSphere(pn)}intersectsSphere(t){const e=this.planes,i=t.center,n=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(i)<n)return!1}return!0}intersectsBox(t){const e=this.planes;for(let i=0;i<6;i++){const n=e[i];if(fn.x=n.normal.x>0?t.max.x:t.min.x,fn.y=n.normal.y>0?t.max.y:t.min.y,fn.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(fn)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function gn(){let t=null,e=!1,i=null,n=null;function r(e,s){i(e,s),n=t.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==i&&(n=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(t){i=t},setContext:function(e){t=e}}}function _n(t,e){const i=e.isWebGL2,n=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),n.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const i=n.get(e);i&&(t.deleteBuffer(i.buffer),n.delete(e))},update:function(e,r){if(e.isGLBufferAttribute){const t=n.get(e);return void((!t||t.version<e.version)&&n.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const s=n.get(e);void 0===s?n.set(e,function(e,n){const r=e.array,s=e.usage,a=t.createBuffer();let o;if(t.bindBuffer(n,a),t.bufferData(n,r,s),e.onUploadCallback(),r instanceof Float32Array)o=t.FLOAT;else if(r instanceof Uint16Array)if(e.isFloat16BufferAttribute){if(!i)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");o=t.HALF_FLOAT}else o=t.UNSIGNED_SHORT;else if(r instanceof Int16Array)o=t.SHORT;else if(r instanceof Uint32Array)o=t.UNSIGNED_INT;else if(r instanceof Int32Array)o=t.INT;else if(r instanceof Int8Array)o=t.BYTE;else if(r instanceof Uint8Array)o=t.UNSIGNED_BYTE;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);o=t.UNSIGNED_BYTE}return{buffer:a,type:o,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}(e,r)):s.version<e.version&&(!function(e,n,r){const s=n.array,a=n.updateRange;t.bindBuffer(r,e),-1===a.count?t.bufferSubData(r,0,s):(i?t.bufferSubData(r,a.offset*s.BYTES_PER_ELEMENT,s,a.offset,a.count):t.bufferSubData(r,a.offset*s.BYTES_PER_ELEMENT,s.subarray(a.offset,a.offset+a.count)),a.count=-1)}(s.buffer,e,r),s.version=e.version)}}}class vn extends Pi{constructor(t=1,e=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n};const r=t/2,s=e/2,a=Math.floor(i),o=Math.floor(n),l=a+1,c=o+1,h=t/a,u=e/o,d=[],p=[],f=[],m=[];for(let t=0;t<c;t++){const e=t*u-s;for(let i=0;i<l;i++){const n=i*h-r;p.push(n,-e,0),f.push(0,0,1),m.push(i/a),m.push(1-t/o)}}for(let t=0;t<o;t++)for(let e=0;e<a;e++){const i=e+l*t,n=e+l*(t+1),r=e+1+l*(t+1),s=e+1+l*t;d.push(i,n,s),d.push(n,r,s)}this.setIndex(d),this.setAttribute("position",new Si(p,3)),this.setAttribute("normal",new Si(f,3)),this.setAttribute("uv",new Si(m,2))}static fromJSON(t){return new vn(t.width,t.height,t.widthSegments,t.heightSegments)}}const xn={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n\t\tfloat x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n\t\tfloat x2 = x * x;\n\t\tfloat x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n\t\treturn ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#ifdef USE_IRIDESCENCE\n\tvec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,\t0.0556434,\n\t\t-1.5371385,\t1.8760108, -0.2040259,\n\t\t-0.4985314,\t0.0415560,\t1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(\t\t0, 1,\t\t0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(\t1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,\t1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,\t1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tgl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );\n\t#endif\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},yn={common:{diffuse:{value:new Vt(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Rt},uv2Transform:{value:new Rt},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new At(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Vt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Vt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Rt}},sprite:{diffuse:{value:new Vt(16777215)},opacity:{value:1},center:{value:new At(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Rt}}},Mn={basic:{uniforms:$i([yn.common,yn.specularmap,yn.envmap,yn.aomap,yn.lightmap,yn.fog]),vertexShader:xn.meshbasic_vert,fragmentShader:xn.meshbasic_frag},lambert:{uniforms:$i([yn.common,yn.specularmap,yn.envmap,yn.aomap,yn.lightmap,yn.emissivemap,yn.fog,yn.lights,{emissive:{value:new Vt(0)}}]),vertexShader:xn.meshlambert_vert,fragmentShader:xn.meshlambert_frag},phong:{uniforms:$i([yn.common,yn.specularmap,yn.envmap,yn.aomap,yn.lightmap,yn.emissivemap,yn.bumpmap,yn.normalmap,yn.displacementmap,yn.fog,yn.lights,{emissive:{value:new Vt(0)},specular:{value:new Vt(1118481)},shininess:{value:30}}]),vertexShader:xn.meshphong_vert,fragmentShader:xn.meshphong_frag},standard:{uniforms:$i([yn.common,yn.envmap,yn.aomap,yn.lightmap,yn.emissivemap,yn.bumpmap,yn.normalmap,yn.displacementmap,yn.roughnessmap,yn.metalnessmap,yn.fog,yn.lights,{emissive:{value:new Vt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:xn.meshphysical_vert,fragmentShader:xn.meshphysical_frag},toon:{uniforms:$i([yn.common,yn.aomap,yn.lightmap,yn.emissivemap,yn.bumpmap,yn.normalmap,yn.displacementmap,yn.gradientmap,yn.fog,yn.lights,{emissive:{value:new Vt(0)}}]),vertexShader:xn.meshtoon_vert,fragmentShader:xn.meshtoon_frag},matcap:{uniforms:$i([yn.common,yn.bumpmap,yn.normalmap,yn.displacementmap,yn.fog,{matcap:{value:null}}]),vertexShader:xn.meshmatcap_vert,fragmentShader:xn.meshmatcap_frag},points:{uniforms:$i([yn.points,yn.fog]),vertexShader:xn.points_vert,fragmentShader:xn.points_frag},dashed:{uniforms:$i([yn.common,yn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:xn.linedashed_vert,fragmentShader:xn.linedashed_frag},depth:{uniforms:$i([yn.common,yn.displacementmap]),vertexShader:xn.depth_vert,fragmentShader:xn.depth_frag},normal:{uniforms:$i([yn.common,yn.bumpmap,yn.normalmap,yn.displacementmap,{opacity:{value:1}}]),vertexShader:xn.meshnormal_vert,fragmentShader:xn.meshnormal_frag},sprite:{uniforms:$i([yn.sprite,yn.fog]),vertexShader:xn.sprite_vert,fragmentShader:xn.sprite_frag},background:{uniforms:{uvTransform:{value:new Rt},t2D:{value:null}},vertexShader:xn.background_vert,fragmentShader:xn.background_frag},cube:{uniforms:$i([yn.envmap,{opacity:{value:1}}]),vertexShader:xn.cube_vert,fragmentShader:xn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:xn.equirect_vert,fragmentShader:xn.equirect_frag},distanceRGBA:{uniforms:$i([yn.common,yn.displacementmap,{referencePosition:{value:new ee},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:xn.distanceRGBA_vert,fragmentShader:xn.distanceRGBA_frag},shadow:{uniforms:$i([yn.lights,yn.fog,{color:{value:new Vt(0)},opacity:{value:1}}]),vertexShader:xn.shadow_vert,fragmentShader:xn.shadow_frag}};function bn(t,e,i,n,r,s){const a=new Vt(0);let o,c,h=!0===r?0:1,u=null,d=0,p=null;function f(t,e){i.buffers.color.setClear(t.r,t.g,t.b,e,s)}return{getClearColor:function(){return a},setClearColor:function(t,e=1){a.set(t),h=e,f(a,h)},getClearAlpha:function(){return h},setClearAlpha:function(t){h=t,f(a,h)},render:function(i,r){let s=!1,m=!0===r.isScene?r.background:null;m&&m.isTexture&&(m=e.get(m));const g=t.xr,_=g.getSession&&g.getSession();_&&"additive"===_.environmentBlendMode&&(m=null),null===m?f(a,h):m&&m.isColor&&(f(m,1),s=!0),(t.autoClear||s)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),m&&(m.isCubeTexture||m.mapping===l)?(void 0===c&&(c=new Zi(new Ki(1,1,1),new en({name:"BackgroundCubeMaterial",uniforms:Qi(Mn.cube.uniforms),vertexShader:Mn.cube.vertexShader,fragmentShader:Mn.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(t,e,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(c)),c.material.uniforms.envMap.value=m,c.material.uniforms.flipEnvMap.value=m.isCubeTexture&&!1===m.isRenderTargetTexture?-1:1,u===m&&d===m.version&&p===t.toneMapping||(c.material.needsUpdate=!0,u=m,d=m.version,p=t.toneMapping),c.layers.enableAll(),i.unshift(c,c.geometry,c.material,0,0,null)):m&&m.isTexture&&(void 0===o&&(o=new Zi(new vn(2,2),new en({name:"BackgroundMaterial",uniforms:Qi(Mn.background.uniforms),vertexShader:Mn.background.vertexShader,fragmentShader:Mn.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(o)),o.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),o.material.uniforms.uvTransform.value.copy(m.matrix),u===m&&d===m.version&&p===t.toneMapping||(o.material.needsUpdate=!0,u=m,d=m.version,p=t.toneMapping),o.layers.enableAll(),i.unshift(o,o.geometry,o.material,0,0,null))}}}function Sn(t,e,i,n){const r=t.getParameter(t.MAX_VERTEX_ATTRIBS),s=n.isWebGL2?null:e.get("OES_vertex_array_object"),a=n.isWebGL2||null!==s,o={},l=p(null);let c=l,h=!1;function u(e){return n.isWebGL2?t.bindVertexArray(e):s.bindVertexArrayOES(e)}function d(e){return n.isWebGL2?t.deleteVertexArray(e):s.deleteVertexArrayOES(e)}function p(t){const e=[],i=[],n=[];for(let t=0;t<r;t++)e[t]=0,i[t]=0,n[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:i,attributeDivisors:n,object:t,attributes:{},index:null}}function f(){const t=c.newAttributes;for(let e=0,i=t.length;e<i;e++)t[e]=0}function m(t){g(t,0)}function g(i,r){const s=c.newAttributes,a=c.enabledAttributes,o=c.attributeDivisors;if(s[i]=1,0===a[i]&&(t.enableVertexAttribArray(i),a[i]=1),o[i]!==r){(n.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,r),o[i]=r}}function _(){const e=c.newAttributes,i=c.enabledAttributes;for(let n=0,r=i.length;n<r;n++)i[n]!==e[n]&&(t.disableVertexAttribArray(n),i[n]=0)}function v(e,i,r,s,a,o){!0!==n.isWebGL2||r!==t.INT&&r!==t.UNSIGNED_INT?t.vertexAttribPointer(e,i,r,s,a,o):t.vertexAttribIPointer(e,i,r,a,o)}function x(){y(),h=!0,c!==l&&(c=l,u(c.object))}function y(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,d,x,y){let M=!1;if(a){const e=function(e,i,r){const a=!0===r.wireframe;let l=o[e.id];void 0===l&&(l={},o[e.id]=l);let c=l[i.id];void 0===c&&(c={},l[i.id]=c);let h=c[a];void 0===h&&(h=p(n.isWebGL2?t.createVertexArray():s.createVertexArrayOES()),c[a]=h);return h}(x,d,l);c!==e&&(c=e,u(c.object)),M=function(t,e,i,n){const r=c.attributes,s=e.attributes;let a=0;const o=i.getAttributes();for(const e in o){if(o[e].location>=0){const i=r[e];let n=s[e];if(void 0===n&&("instanceMatrix"===e&&t.instanceMatrix&&(n=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(n=t.instanceColor)),void 0===i)return!0;if(i.attribute!==n)return!0;if(n&&i.data!==n.data)return!0;a++}}return c.attributesNum!==a||c.index!==n}(r,x,d,y),M&&function(t,e,i,n){const r={},s=e.attributes;let a=0;const o=i.getAttributes();for(const e in o){if(o[e].location>=0){let i=s[e];void 0===i&&("instanceMatrix"===e&&t.instanceMatrix&&(i=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(i=t.instanceColor));const n={};n.attribute=i,i&&i.data&&(n.data=i.data),r[e]=n,a++}}c.attributes=r,c.attributesNum=a,c.index=n}(r,x,d,y)}else{const t=!0===l.wireframe;c.geometry===x.id&&c.program===d.id&&c.wireframe===t||(c.geometry=x.id,c.program=d.id,c.wireframe=t,M=!0)}null!==y&&i.update(y,t.ELEMENT_ARRAY_BUFFER),(M||h)&&(h=!1,function(r,s,a,o){if(!1===n.isWebGL2&&(r.isInstancedMesh||o.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;f();const l=o.attributes,c=a.getAttributes(),h=s.defaultAttributeValues;for(const e in c){const n=c[e];if(n.location>=0){let s=l[e];if(void 0===s&&("instanceMatrix"===e&&r.instanceMatrix&&(s=r.instanceMatrix),"instanceColor"===e&&r.instanceColor&&(s=r.instanceColor)),void 0!==s){const e=s.normalized,a=s.itemSize,l=i.get(s);if(void 0===l)continue;const c=l.buffer,h=l.type,u=l.bytesPerElement;if(s.isInterleavedBufferAttribute){const i=s.data,l=i.stride,d=s.offset;if(i.isInstancedInterleavedBuffer){for(let t=0;t<n.locationSize;t++)g(n.location+t,i.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let t=0;t<n.locationSize;t++)m(n.location+t);t.bindBuffer(t.ARRAY_BUFFER,c);for(let t=0;t<n.locationSize;t++)v(n.location+t,a/n.locationSize,h,e,l*u,(d+a/n.locationSize*t)*u)}else{if(s.isInstancedBufferAttribute){for(let t=0;t<n.locationSize;t++)g(n.location+t,s.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let t=0;t<n.locationSize;t++)m(n.location+t);t.bindBuffer(t.ARRAY_BUFFER,c);for(let t=0;t<n.locationSize;t++)v(n.location+t,a/n.locationSize,h,e,a*u,a/n.locationSize*t*u)}}else if(void 0!==h){const i=h[e];if(void 0!==i)switch(i.length){case 2:t.vertexAttrib2fv(n.location,i);break;case 3:t.vertexAttrib3fv(n.location,i);break;case 4:t.vertexAttrib4fv(n.location,i);break;default:t.vertexAttrib1fv(n.location,i)}}}}_()}(r,l,d,x),null!==y&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i.get(y).buffer))},reset:x,resetDefaultState:y,dispose:function(){x();for(const t in o){const e=o[t];for(const t in e){const i=e[t];for(const t in i)d(i[t].object),delete i[t];delete e[t]}delete o[t]}},releaseStatesOfGeometry:function(t){if(void 0===o[t.id])return;const e=o[t.id];for(const t in e){const i=e[t];for(const t in i)d(i[t].object),delete i[t];delete e[t]}delete o[t.id]},releaseStatesOfProgram:function(t){for(const e in o){const i=o[e];if(void 0===i[t.id])continue;const n=i[t.id];for(const t in n)d(n[t].object),delete n[t];delete i[t.id]}},initAttributes:f,enableAttribute:m,disableUnusedAttributes:_}}function wn(t,e,i,n){const r=n.isWebGL2;let s;this.setMode=function(t){s=t},this.render=function(e,n){t.drawArrays(s,e,n),i.update(n,s,1)},this.renderInstances=function(n,a,o){if(0===o)return;let l,c;if(r)l=t,c="drawArraysInstanced";else if(l=e.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](s,n,a,o),i.update(a,s,o)}}function Tn(t,e,i){let n;function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let a=void 0!==i.precision?i.precision:"highp";const o=r(a);o!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",o,"instead."),a=o);const l=s||e.has("WEBGL_draw_buffers"),c=!0===i.logarithmicDepthBuffer,h=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),u=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),d=t.getParameter(t.MAX_TEXTURE_SIZE),p=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),f=t.getParameter(t.MAX_VERTEX_ATTRIBS),m=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),g=t.getParameter(t.MAX_VARYING_VECTORS),_=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),v=u>0,x=s||e.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===e.has("EXT_texture_filter_anisotropic")){const i=e.get("EXT_texture_filter_anisotropic");n=t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:r,precision:a,logarithmicDepthBuffer:c,maxTextures:h,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:_,vertexTextures:v,floatFragmentTextures:x,floatVertexTextures:v&&x,maxSamples:s?t.getParameter(t.MAX_SAMPLES):0}}function En(t){const e=this;let i=null,n=0,r=!1,s=!1;const a=new dn,o=new Rt,l={value:null,needsUpdate:!1};function c(){l.value!==i&&(l.value=i,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function h(t,i,n,r){const s=null!==t?t.length:0;let c=null;if(0!==s){if(c=l.value,!0!==r||null===c){const e=n+4*s,r=i.matrixWorldInverse;o.getNormalMatrix(r),(null===c||c.length<e)&&(c=new Float32Array(e));for(let e=0,i=n;e!==s;++e,i+=4)a.copy(t[e]).applyMatrix4(r,o),a.normal.toArray(c,i),c[i+3]=a.constant}l.value=c,l.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,s){const a=0!==t.length||e||0!==n||r;return r=e,i=h(t,s,0),n=t.length,a},this.beginShadows=function(){s=!0,h(null)},this.endShadows=function(){s=!1,c()},this.setState=function(e,a,o){const u=e.clippingPlanes,d=e.clipIntersection,p=e.clipShadows,f=t.get(e);if(!r||null===u||0===u.length||s&&!p)s?h(null):c();else{const t=s?0:n,e=4*t;let r=f.clippingState||null;l.value=r,r=h(u,a,e,o);for(let t=0;t!==e;++t)r[t]=i[t];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function An(t){let e=new WeakMap;function i(t,e){return e===a?t.mapping=r:e===o&&(t.mapping=s),t}function n(t){const i=t.target;i.removeEventListener("dispose",n);const r=e.get(i);void 0!==r&&(e.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){const s=r.mapping;if(s===a||s===o){if(e.has(r)){return i(e.get(r).texture,r.mapping)}{const s=r.image;if(s&&s.height>0){const a=new ln(s.height/2);return a.fromEquirectangularTexture(t,r),e.set(r,a),r.addEventListener("dispose",n),i(a.texture,r.mapping)}return null}}}return r},dispose:function(){e=new WeakMap}}}Mn.physical={uniforms:$i([Mn.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new At(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Vt(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new At},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Vt(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Vt(1,1,1)},specularColorMap:{value:null}}]),vertexShader:xn.meshphysical_vert,fragmentShader:xn.meshphysical_frag};class Rn extends nn{constructor(t=-1,e=1,i=1,n=-1,r=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=n,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,i,n,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let r=i-t,s=i+t,a=n+e,o=n-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=t*this.view.offsetX,s=r+t*this.view.width,a-=e*this.view.offsetY,o=a-e*this.view.height}this.projectionMatrix.makeOrthographic(r,s,a,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}const Cn=[.125,.215,.35,.446,.526,.582],Ln=20,Pn=new Rn,In=new Vt;let Dn=null;const Nn=(1+Math.sqrt(5))/2,On=1/Nn,Fn=[new ee(1,1,1),new ee(-1,1,1),new ee(1,1,-1),new ee(-1,1,-1),new ee(0,Nn,On),new ee(0,Nn,-On),new ee(On,0,Nn),new ee(-On,0,Nn),new ee(Nn,On,0),new ee(-Nn,On,0)];class Un{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,n=100){Dn=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(t,i,n,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=kn(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Gn(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Dn),t.scissorTest=!1,zn(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===r||t.mapping===s?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),Dn=this._renderer.getRenderTarget();const i=e||this._allocateTargets();return this._textureToCubeUV(t,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,i={magFilter:m,minFilter:m,generateMipmaps:!1,type:b,format:w,encoding:at,depthBuffer:!1},n=Bn(t,e,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Bn(t,e,i);const{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(t){const e=[],i=[],n=[];let r=t;const s=t-4+1+Cn.length;for(let a=0;a<s;a++){const s=Math.pow(2,r);i.push(s);let o=1/s;a>t-4?o=Cn[a-t+4-1]:0===a&&(o=0),n.push(o);const l=1/(s-2),c=-l,h=1+l,u=[c,c,h,c,h,h,c,c,h,h,c,h],d=6,p=6,f=3,m=2,g=1,_=new Float32Array(f*p*d),v=new Float32Array(m*p*d),x=new Float32Array(g*p*d);for(let t=0;t<d;t++){const e=t%3*2/3-1,i=t>2?0:-1,n=[e,i,0,e+2/3,i,0,e+2/3,i+1,0,e,i,0,e+2/3,i+1,0,e,i+1,0];_.set(n,f*p*t),v.set(u,m*p*t);const r=[t,t,t,t,t,t];x.set(r,g*p*t)}const y=new Pi;y.setAttribute("position",new yi(_,f)),y.setAttribute("uv",new yi(v,m)),y.setAttribute("faceIndex",new yi(x,g)),e.push(y),r>4&&r--}return{lodPlanes:e,sizeLods:i,sigmas:n}}(n)),this._blurMaterial=function(t,e,i){const n=new Float32Array(Ln),r=new ee(0,1,0);return new en({name:"SphericalGaussianBlur",defines:{n:Ln,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:Hn(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(n,t,e)}return n}_compileMaterial(t){const e=new Zi(this._lodPlanes[0],t);this._renderer.compile(e,Pn)}_sceneToCubeUV(t,e,i,n){const r=new rn(90,1,e,i),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,c=o.toneMapping;o.getClearColor(In),o.toneMapping=0,o.autoClear=!1;const h=new _i({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),u=new Zi(new Ki,h);let d=!1;const p=t.background;p?p.isColor&&(h.color.copy(p),t.background=null,d=!0):(h.color.copy(In),d=!0);for(let e=0;e<6;e++){const i=e%3;0===i?(r.up.set(0,s[e],0),r.lookAt(a[e],0,0)):1===i?(r.up.set(0,0,s[e]),r.lookAt(0,a[e],0)):(r.up.set(0,s[e],0),r.lookAt(0,0,a[e]));const l=this._cubeSize;zn(n,i*l,e>2?l:0,l,l),o.setRenderTarget(n),d&&o.render(u,r),o.render(t,r)}u.geometry.dispose(),u.material.dispose(),o.toneMapping=c,o.autoClear=l,t.background=p}_textureToCubeUV(t,e){const i=this._renderer,n=t.mapping===r||t.mapping===s;n?(null===this._cubemapMaterial&&(this._cubemapMaterial=kn()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Gn());const a=n?this._cubemapMaterial:this._equirectMaterial,o=new Zi(this._lodPlanes[0],a);a.uniforms.envMap.value=t;const l=this._cubeSize;zn(e,0,0,3*l,2*l),i.setRenderTarget(e),i.render(o,Pn)}_applyPMREM(t){const e=this._renderer,i=e.autoClear;e.autoClear=!1;for(let e=1;e<this._lodPlanes.length;e++){const i=Math.sqrt(this._sigmas[e]*this._sigmas[e]-this._sigmas[e-1]*this._sigmas[e-1]),n=Fn[(e-1)%Fn.length];this._blur(t,e-1,e,i,n)}e.autoClear=i}_blur(t,e,i,n,r){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,i,n,"latitudinal",r),this._halfBlur(s,t,i,i,n,"longitudinal",r)}_halfBlur(t,e,i,n,r,s,a){const o=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new Zi(this._lodPlanes[n],l),h=l.uniforms,u=this._sizeLods[i]-1,d=isFinite(r)?Math.PI/(2*u):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):Ln;f>Ln&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let t=0;t<Ln;++t){const e=t/p,i=Math.exp(-e*e/2);m.push(i),0===t?g+=i:t<f&&(g+=2*i)}for(let t=0;t<m.length;t++)m[t]=m[t]/g;h.envMap.value=t.texture,h.samples.value=f,h.weights.value=m,h.latitudinal.value="latitudinal"===s,a&&(h.poleAxis.value=a);const{_lodMax:_}=this;h.dTheta.value=d,h.mipInt.value=_-i;const v=this._sizeLods[n];zn(e,3*v*(n>_-4?n-_+4:0),4*(this._cubeSize-v),3*v,2*v),o.setRenderTarget(e),o.render(c,Pn)}}function Bn(t,e,i){const n=new Kt(t,e,i);return n.texture.mapping=l,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function zn(t,e,i,n,r){t.viewport.set(e,i,n,r),t.scissor.set(e,i,n,r)}function Gn(){return new en({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Hn(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function kn(){return new en({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Hn(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Hn(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function Vn(t){let e=new WeakMap,i=null;function n(t){const i=t.target;i.removeEventListener("dispose",n);const r=e.get(i);void 0!==r&&(e.delete(i),r.dispose())}return{get:function(l){if(l&&l.isTexture){const c=l.mapping,h=c===a||c===o,u=c===r||c===s;if(h||u){if(l.isRenderTargetTexture&&!0===l.needsPMREMUpdate){l.needsPMREMUpdate=!1;let n=e.get(l);return null===i&&(i=new Un(t)),n=h?i.fromEquirectangular(l,n):i.fromCubemap(l,n),e.set(l,n),n.texture}if(e.has(l))return e.get(l).texture;{const r=l.image;if(h&&r&&r.height>0||u&&r&&function(t){let e=0;const i=6;for(let n=0;n<i;n++)void 0!==t[n]&&e++;return e===i}(r)){null===i&&(i=new Un(t));const r=h?i.fromEquirectangular(l):i.fromCubemap(l);return e.set(l,r),l.addEventListener("dispose",n),r.texture}return null}}}return l},dispose:function(){e=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function Wn(t){const e={};function i(i){if(void 0!==e[i])return e[i];let n;switch(i){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(i)}return e[i]=n,n}return{has:function(t){return null!==i(t)},init:function(t){t.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(t){const e=i(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function Xn(t,e,i,n){const r={},s=new WeakMap;function a(t){const o=t.target;null!==o.index&&e.remove(o.index);for(const t in o.attributes)e.remove(o.attributes[t]);o.removeEventListener("dispose",a),delete r[o.id];const l=s.get(o);l&&(e.remove(l),s.delete(o)),n.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,i.memory.geometries--}function o(t){const i=[],n=t.index,r=t.attributes.position;let a=0;if(null!==n){const t=n.array;a=n.version;for(let e=0,n=t.length;e<n;e+=3){const n=t[e+0],r=t[e+1],s=t[e+2];i.push(n,r,r,s,s,n)}}else{const t=r.array;a=r.version;for(let e=0,n=t.length/3-1;e<n;e+=3){const t=e+0,n=e+1,r=e+2;i.push(t,n,n,r,r,t)}}const o=new(Ct(i)?bi:Mi)(i,1);o.version=a;const l=s.get(t);l&&e.remove(l),s.set(t,o)}return{get:function(t,e){return!0===r[e.id]||(e.addEventListener("dispose",a),r[e.id]=!0,i.memory.geometries++),e},update:function(i){const n=i.attributes;for(const i in n)e.update(n[i],t.ARRAY_BUFFER);const r=i.morphAttributes;for(const i in r){const n=r[i];for(let i=0,r=n.length;i<r;i++)e.update(n[i],t.ARRAY_BUFFER)}},getWireframeAttribute:function(t){const e=s.get(t);if(e){const i=t.index;null!==i&&e.version<i.version&&o(t)}else o(t);return s.get(t)}}}function jn(t,e,i,n){const r=n.isWebGL2;let s,a,o;this.setMode=function(t){s=t},this.setIndex=function(t){a=t.type,o=t.bytesPerElement},this.render=function(e,n){t.drawElements(s,n,a,e*o),i.update(n,s,1)},this.renderInstances=function(n,l,c){if(0===c)return;let h,u;if(r)h=t,u="drawElementsInstanced";else if(h=e.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",null===h)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[u](s,l,a,n*o,c),i.update(l,s,c)}}function qn(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(i,n,r){switch(e.calls++,n){case t.TRIANGLES:e.triangles+=r*(i/3);break;case t.LINES:e.lines+=r*(i/2);break;case t.LINE_STRIP:e.lines+=r*(i-1);break;case t.LINE_LOOP:e.lines+=r*i;break;case t.POINTS:e.points+=r*i;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function Yn(t,e){return t[0]-e[0]}function Zn(t,e){return Math.abs(e[1])-Math.abs(t[1])}function Jn(t,e){let i=1;const n=e.isInterleavedBufferAttribute?e.data.array:e.array;n instanceof Int8Array?i=127:n instanceof Uint8Array?i=255:n instanceof Uint16Array?i=65535:n instanceof Int16Array?i=32767:n instanceof Int32Array?i=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",n),t.divideScalar(i)}function Kn(t,e,i){const n={},r=new Float32Array(8),s=new WeakMap,a=new Jt,o=[];for(let t=0;t<8;t++)o[t]=[t,0];return{update:function(l,c,h,u){const d=l.morphTargetInfluences;if(!0===e.isWebGL2){const n=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,r=void 0!==n?n.length:0;let o=s.get(c);if(void 0===o||o.count!==r){void 0!==o&&o.texture.dispose();const t=void 0!==c.morphAttributes.position,i=void 0!==c.morphAttributes.normal,n=void 0!==c.morphAttributes.color,l=c.morphAttributes.position||[],h=c.morphAttributes.normal||[],u=c.morphAttributes.color||[];let d=0;!0===t&&(d=1),!0===i&&(d=2),!0===n&&(d=3);let p=c.attributes.position.count*d,f=1;p>e.maxTextureSize&&(f=Math.ceil(p/e.maxTextureSize),p=e.maxTextureSize);const m=new Float32Array(p*f*4*r),g=new Qt(m,p,f,r);g.type=M,g.needsUpdate=!0;const _=4*d;for(let e=0;e<r;e++){const r=l[e],s=h[e],o=u[e],c=p*f*4*e;for(let e=0;e<r.count;e++){const l=e*_;!0===t&&(a.fromBufferAttribute(r,e),!0===r.normalized&&Jn(a,r),m[c+l+0]=a.x,m[c+l+1]=a.y,m[c+l+2]=a.z,m[c+l+3]=0),!0===i&&(a.fromBufferAttribute(s,e),!0===s.normalized&&Jn(a,s),m[c+l+4]=a.x,m[c+l+5]=a.y,m[c+l+6]=a.z,m[c+l+7]=0),!0===n&&(a.fromBufferAttribute(o,e),!0===o.normalized&&Jn(a,o),m[c+l+8]=a.x,m[c+l+9]=a.y,m[c+l+10]=a.z,m[c+l+11]=4===o.itemSize?a.w:1)}}function v(){g.dispose(),s.delete(c),c.removeEventListener("dispose",v)}o={count:r,texture:g,size:new At(p,f)},s.set(c,o),c.addEventListener("dispose",v)}let l=0;for(let t=0;t<d.length;t++)l+=d[t];const h=c.morphTargetsRelative?1:1-l;u.getUniforms().setValue(t,"morphTargetBaseInfluence",h),u.getUniforms().setValue(t,"morphTargetInfluences",d),u.getUniforms().setValue(t,"morphTargetsTexture",o.texture,i),u.getUniforms().setValue(t,"morphTargetsTextureSize",o.size)}else{const e=void 0===d?0:d.length;let i=n[c.id];if(void 0===i||i.length!==e){i=[];for(let t=0;t<e;t++)i[t]=[t,0];n[c.id]=i}for(let t=0;t<e;t++){const e=i[t];e[0]=t,e[1]=d[t]}i.sort(Zn);for(let t=0;t<8;t++)t<e&&i[t][1]?(o[t][0]=i[t][0],o[t][1]=i[t][1]):(o[t][0]=Number.MAX_SAFE_INTEGER,o[t][1]=0);o.sort(Yn);const s=c.morphAttributes.position,a=c.morphAttributes.normal;let l=0;for(let t=0;t<8;t++){const e=o[t],i=e[0],n=e[1];i!==Number.MAX_SAFE_INTEGER&&n?(s&&c.getAttribute("morphTarget"+t)!==s[i]&&c.setAttribute("morphTarget"+t,s[i]),a&&c.getAttribute("morphNormal"+t)!==a[i]&&c.setAttribute("morphNormal"+t,a[i]),r[t]=n,l+=n):(s&&!0===c.hasAttribute("morphTarget"+t)&&c.deleteAttribute("morphTarget"+t),a&&!0===c.hasAttribute("morphNormal"+t)&&c.deleteAttribute("morphNormal"+t),r[t]=0)}const h=c.morphTargetsRelative?1:1-l;u.getUniforms().setValue(t,"morphTargetBaseInfluence",h),u.getUniforms().setValue(t,"morphTargetInfluences",r)}}}}function Qn(t,e,i,n){let r=new WeakMap;function s(t){const e=t.target;e.removeEventListener("dispose",s),i.remove(e.instanceMatrix),null!==e.instanceColor&&i.remove(e.instanceColor)}return{update:function(a){const o=n.render.frame,l=a.geometry,c=e.get(a,l);return r.get(c)!==o&&(e.update(c),r.set(c,o)),a.isInstancedMesh&&(!1===a.hasEventListener("dispose",s)&&a.addEventListener("dispose",s),i.update(a.instanceMatrix,t.ARRAY_BUFFER),null!==a.instanceColor&&i.update(a.instanceColor,t.ARRAY_BUFFER)),c},dispose:function(){r=new WeakMap}}}const $n=new Zt,tr=new Qt,er=new $t,ir=new on,nr=[],rr=[],sr=new Float32Array(16),ar=new Float32Array(9),or=new Float32Array(4);function lr(t,e,i){const n=t[0];if(n<=0||n>0)return t;const r=e*i;let s=nr[r];if(void 0===s&&(s=new Float32Array(r),nr[r]=s),0!==e){n.toArray(s,0);for(let n=1,r=0;n!==e;++n)r+=i,t[n].toArray(s,r)}return s}function cr(t,e){if(t.length!==e.length)return!1;for(let i=0,n=t.length;i<n;i++)if(t[i]!==e[i])return!1;return!0}function hr(t,e){for(let i=0,n=e.length;i<n;i++)t[i]=e[i]}function ur(t,e){let i=rr[e];void 0===i&&(i=new Int32Array(e),rr[e]=i);for(let n=0;n!==e;++n)i[n]=t.allocateTextureUnit();return i}function dr(t,e){const i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function pr(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(cr(i,e))return;t.uniform2fv(this.addr,e),hr(i,e)}}function fr(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(void 0!==e.r)i[0]===e.r&&i[1]===e.g&&i[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(cr(i,e))return;t.uniform3fv(this.addr,e),hr(i,e)}}function mr(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(cr(i,e))return;t.uniform4fv(this.addr,e),hr(i,e)}}function gr(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(cr(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),hr(i,e)}else{if(cr(i,n))return;or.set(n),t.uniformMatrix2fv(this.addr,!1,or),hr(i,n)}}function _r(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(cr(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),hr(i,e)}else{if(cr(i,n))return;ar.set(n),t.uniformMatrix3fv(this.addr,!1,ar),hr(i,n)}}function vr(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(cr(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),hr(i,e)}else{if(cr(i,n))return;sr.set(n),t.uniformMatrix4fv(this.addr,!1,sr),hr(i,n)}}function xr(t,e){const i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function yr(t,e){const i=this.cache;cr(i,e)||(t.uniform2iv(this.addr,e),hr(i,e))}function Mr(t,e){const i=this.cache;cr(i,e)||(t.uniform3iv(this.addr,e),hr(i,e))}function br(t,e){const i=this.cache;cr(i,e)||(t.uniform4iv(this.addr,e),hr(i,e))}function Sr(t,e){const i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function wr(t,e){const i=this.cache;cr(i,e)||(t.uniform2uiv(this.addr,e),hr(i,e))}function Tr(t,e){const i=this.cache;cr(i,e)||(t.uniform3uiv(this.addr,e),hr(i,e))}function Er(t,e){const i=this.cache;cr(i,e)||(t.uniform4uiv(this.addr,e),hr(i,e))}function Ar(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture2D(e||$n,r)}function Rr(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(e||er,r)}function Cr(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTextureCube(e||ir,r)}function Lr(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(e||tr,r)}function Pr(t,e){t.uniform1fv(this.addr,e)}function Ir(t,e){const i=lr(e,this.size,2);t.uniform2fv(this.addr,i)}function Dr(t,e){const i=lr(e,this.size,3);t.uniform3fv(this.addr,i)}function Nr(t,e){const i=lr(e,this.size,4);t.uniform4fv(this.addr,i)}function Or(t,e){const i=lr(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function Fr(t,e){const i=lr(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function Ur(t,e){const i=lr(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function Br(t,e){t.uniform1iv(this.addr,e)}function zr(t,e){t.uniform2iv(this.addr,e)}function Gr(t,e){t.uniform3iv(this.addr,e)}function kr(t,e){t.uniform4iv(this.addr,e)}function Hr(t,e){t.uniform1uiv(this.addr,e)}function Vr(t,e){t.uniform2uiv(this.addr,e)}function Wr(t,e){t.uniform3uiv(this.addr,e)}function Xr(t,e){t.uniform4uiv(this.addr,e)}function jr(t,e,i){const n=e.length,r=ur(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.setTexture2D(e[t]||$n,r[t])}function qr(t,e,i){const n=e.length,r=ur(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.setTexture3D(e[t]||er,r[t])}function Yr(t,e,i){const n=e.length,r=ur(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.setTextureCube(e[t]||ir,r[t])}function Zr(t,e,i){const n=e.length,r=ur(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.setTexture2DArray(e[t]||tr,r[t])}class Jr{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.setValue=function(t){switch(t){case 5126:return dr;case 35664:return pr;case 35665:return fr;case 35666:return mr;case 35674:return gr;case 35675:return _r;case 35676:return vr;case 5124:case 35670:return xr;case 35667:case 35671:return yr;case 35668:case 35672:return Mr;case 35669:case 35673:return br;case 5125:return Sr;case 36294:return wr;case 36295:return Tr;case 36296:return Er;case 35678:case 36198:case 36298:case 36306:case 35682:return Ar;case 35679:case 36299:case 36307:return Rr;case 35680:case 36300:case 36308:case 36293:return Cr;case 36289:case 36303:case 36311:case 36292:return Lr}}(e.type)}}class Kr{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return Pr;case 35664:return Ir;case 35665:return Dr;case 35666:return Nr;case 35674:return Or;case 35675:return Fr;case 35676:return Ur;case 5124:case 35670:return Br;case 35667:case 35671:return zr;case 35668:case 35672:return Gr;case 35669:case 35673:return kr;case 5125:return Hr;case 36294:return Vr;case 36295:return Wr;case 36296:return Xr;case 35678:case 36198:case 36298:case 36306:case 35682:return jr;case 35679:case 36299:case 36307:return qr;case 35680:case 36300:case 36308:case 36293:return Yr;case 36289:case 36303:case 36311:case 36292:return Zr}}(e.type)}}class Qr{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,i){const n=this.seq;for(let r=0,s=n.length;r!==s;++r){const s=n[r];s.setValue(t,e[s.id],i)}}}const $r=/(\w+)(\])?(\[|\.)?/g;function ts(t,e){t.seq.push(e),t.map[e.id]=e}function es(t,e,i){const n=t.name,r=n.length;for($r.lastIndex=0;;){const s=$r.exec(n),a=$r.lastIndex;let o=s[1];const l="]"===s[2],c=s[3];if(l&&(o|=0),void 0===c||"["===c&&a+2===r){ts(i,void 0===c?new Jr(o,t,e):new Kr(o,t,e));break}{let t=i.map[o];void 0===t&&(t=new Qr(o),ts(i,t)),i=t}}}class is{constructor(t,e){this.seq=[],this.map={};const i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let n=0;n<i;++n){const i=t.getActiveUniform(e,n);es(i,t.getUniformLocation(e,i.name),this)}}setValue(t,e,i,n){const r=this.map[e];void 0!==r&&r.setValue(t,i,n)}setOptional(t,e,i){const n=e[i];void 0!==n&&this.setValue(t,i,n)}static upload(t,e,i,n){for(let r=0,s=e.length;r!==s;++r){const s=e[r],a=i[s.id];!1!==a.needsUpdate&&s.setValue(t,a.value,n)}}static seqWithValue(t,e){const i=[];for(let n=0,r=t.length;n!==r;++n){const r=t[n];r.id in e&&i.push(r)}return i}}function ns(t,e,i){const n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),n}let rs=0;function ss(t,e,i){const n=t.getShaderParameter(e,t.COMPILE_STATUS),r=t.getShaderInfoLog(e).trim();if(n&&""===r)return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const n=parseInt(s[1]);return i.toUpperCase()+"\n\n"+r+"\n\n"+function(t,e){const i=t.split("\n"),n=[],r=Math.max(e-6,0),s=Math.min(e+6,i.length);for(let t=r;t<s;t++){const r=t+1;n.push(`${r===e?">":" "} ${r}: ${i[t]}`)}return n.join("\n")}(t.getShaderSource(e),n)}return r}function as(t,e){const i=function(t){switch(t){case at:return["Linear","( value )"];case ot:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function os(t,e){let i;switch(e){case 1:i="Linear";break;case 2:i="Reinhard";break;case 3:i="OptimizedCineon";break;case 4:i="ACESFilmic";break;case 5:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function ls(t){return""!==t}function cs(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function hs(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const us=/^[ \t]*#include +<([\w\d./]+)>/gm;function ds(t){return t.replace(us,ps)}function ps(t,e){const i=xn[e];if(void 0===i)throw new Error("Can not resolve #include <"+e+">");return ds(i)}const fs=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,ms=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function gs(t){return t.replace(ms,vs).replace(fs,_s)}function _s(t,e,i,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),vs(t,e,i,n)}function vs(t,e,i,n){let r="";for(let t=parseInt(e);t<parseInt(i);t++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return r}function xs(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function ys(t,e,i,n){const a=t.getContext(),o=i.defines;let c=i.vertexShader,h=i.fragmentShader;const u=function(t){let e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(i),d=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case r:case s:e="ENVMAP_TYPE_CUBE";break;case l:e="ENVMAP_TYPE_CUBE_UV"}return e}(i),p=function(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case s:e="ENVMAP_MODE_REFRACTION"}return e}(i),f=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(i),m=function(t){const e=t.envMapCubeUVHeight;if(null===e)return null;const i=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:n,maxMip:i}}(i),g=i.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUVHeight||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ls).join("\n")}(i),_=function(t){const e=[];for(const i in t){const n=t[i];!1!==n&&e.push("#define "+i+" "+n)}return e.join("\n")}(o),v=a.createProgram();let x,y,M=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(x=[_].filter(ls).join("\n"),x.length>0&&(x+="\n"),y=[g,_].filter(ls).join("\n"),y.length>0&&(y+="\n")):(x=[xs(i),"#define SHADER_NAME "+i.shaderName,_,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+p:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+u:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ls).join("\n"),y=[g,xs(i),"#define SHADER_NAME "+i.shaderName,_,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+d:"",i.envMap?"#define "+p:"",i.envMap?"#define "+f:"",m?"#define CUBEUV_TEXEL_WIDTH "+m.texelWidth:"",m?"#define CUBEUV_TEXEL_HEIGHT "+m.texelHeight:"",m?"#define CUBEUV_MAX_MIP "+m.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+u:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==i.toneMapping?"#define TONE_MAPPING":"",0!==i.toneMapping?xn.tonemapping_pars_fragment:"",0!==i.toneMapping?os("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",xn.encodings_pars_fragment,as("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(ls).join("\n")),c=ds(c),c=cs(c,i),c=hs(c,i),h=ds(h),h=cs(h,i),h=hs(h,i),c=gs(c),h=gs(h),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(M="#version 300 es\n",x=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+x,y=["#define varying in",i.glslVersion===dt?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===dt?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+y);const b=M+x+c,S=M+y+h,w=ns(a,a.VERTEX_SHADER,b),T=ns(a,a.FRAGMENT_SHADER,S);if(a.attachShader(v,w),a.attachShader(v,T),void 0!==i.index0AttributeName?a.bindAttribLocation(v,0,i.index0AttributeName):!0===i.morphTargets&&a.bindAttribLocation(v,0,"position"),a.linkProgram(v),t.debug.checkShaderErrors){const t=a.getProgramInfoLog(v).trim(),e=a.getShaderInfoLog(w).trim(),i=a.getShaderInfoLog(T).trim();let n=!0,r=!0;if(!1===a.getProgramParameter(v,a.LINK_STATUS)){n=!1;const e=ss(a,w,"vertex"),i=ss(a,T,"fragment");console.error("THREE.WebGLProgram: Shader Error "+a.getError()+" - VALIDATE_STATUS "+a.getProgramParameter(v,a.VALIDATE_STATUS)+"\n\nProgram Info Log: "+t+"\n"+e+"\n"+i)}else""!==t?console.warn("THREE.WebGLProgram: Program Info Log:",t):""!==e&&""!==i||(r=!1);r&&(this.diagnostics={runnable:n,programLog:t,vertexShader:{log:e,prefix:x},fragmentShader:{log:i,prefix:y}})}let E,A;return a.deleteShader(w),a.deleteShader(T),this.getUniforms=function(){return void 0===E&&(E=new is(a,v)),E},this.getAttributes=function(){return void 0===A&&(A=function(t,e){const i={},n=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let r=0;r<n;r++){const n=t.getActiveAttrib(e,r),s=n.name;let a=1;n.type===t.FLOAT_MAT2&&(a=2),n.type===t.FLOAT_MAT3&&(a=3),n.type===t.FLOAT_MAT4&&(a=4),i[s]={type:n.type,location:t.getAttribLocation(e,s),locationSize:a}}return i}(a,v)),A},this.destroy=function(){n.releaseStatesOfProgram(this),a.deleteProgram(v),this.program=void 0},this.name=i.shaderName,this.id=rs++,this.cacheKey=e,this.usedTimes=1,this.program=v,this.vertexShader=w,this.fragmentShader=T,this}let Ms=0;class bs{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,i=t.fragmentShader,n=this._getShaderStage(e),r=this._getShaderStage(i),s=this._getShaderCacheForMaterial(t);return!1===s.has(n)&&(s.add(n),n.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const t of e)t.usedTimes--,0===t.usedTimes&&this.shaderCache.delete(t.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;return!1===e.has(t)&&e.set(t,new Set),e.get(t)}_getShaderStage(t){const e=this.shaderCache;if(!1===e.has(t)){const i=new Ss(t);e.set(t,i)}return e.get(t)}}class Ss{constructor(t){this.id=Ms++,this.code=t,this.usedTimes=0}}function ws(t,e,i,n,r,s,a){const o=new Ve,c=new bs,h=[],u=r.isWebGL2,d=r.logarithmicDepthBuffer,p=r.vertexTextures;let f=r.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(s,o,h,g,_){const v=g.fog,x=_.geometry,y=s.isMeshStandardMaterial?g.environment:null,M=(s.isMeshStandardMaterial?i:e).get(s.envMap||y),b=M&&M.mapping===l?M.image.height:null,S=m[s.type];null!==s.precision&&(f=r.getMaxPrecision(s.precision),f!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",f,"instead."));const w=x.morphAttributes.position||x.morphAttributes.normal||x.morphAttributes.color,T=void 0!==w?w.length:0;let E,A,R,C,L=0;if(void 0!==x.morphAttributes.position&&(L=1),void 0!==x.morphAttributes.normal&&(L=2),void 0!==x.morphAttributes.color&&(L=3),S){const t=Mn[S];E=t.vertexShader,A=t.fragmentShader}else E=s.vertexShader,A=s.fragmentShader,c.update(s),R=c.getVertexShaderID(s),C=c.getFragmentShaderID(s);const P=t.getRenderTarget(),I=s.alphaTest>0,D=s.clearcoat>0,N=s.iridescence>0;return{isWebGL2:u,shaderID:S,shaderName:s.type,vertexShader:E,fragmentShader:A,defines:s.defines,customVertexShaderID:R,customFragmentShaderID:C,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:f,instancing:!0===_.isInstancedMesh,instancingColor:!0===_.isInstancedMesh&&null!==_.instanceColor,supportsVertexTextures:p,outputEncoding:null===P?t.outputEncoding:!0===P.isXRRenderTarget?P.texture.encoding:at,map:!!s.map,matcap:!!s.matcap,envMap:!!M,envMapMode:M&&M.mapping,envMapCubeUVHeight:b,lightMap:!!s.lightMap,aoMap:!!s.aoMap,emissiveMap:!!s.emissiveMap,bumpMap:!!s.bumpMap,normalMap:!!s.normalMap,objectSpaceNormalMap:1===s.normalMapType,tangentSpaceNormalMap:0===s.normalMapType,decodeVideoTexture:!!s.map&&!0===s.map.isVideoTexture&&s.map.encoding===ot,clearcoat:D,clearcoatMap:D&&!!s.clearcoatMap,clearcoatRoughnessMap:D&&!!s.clearcoatRoughnessMap,clearcoatNormalMap:D&&!!s.clearcoatNormalMap,iridescence:N,iridescenceMap:N&&!!s.iridescenceMap,iridescenceThicknessMap:N&&!!s.iridescenceThicknessMap,displacementMap:!!s.displacementMap,roughnessMap:!!s.roughnessMap,metalnessMap:!!s.metalnessMap,specularMap:!!s.specularMap,specularIntensityMap:!!s.specularIntensityMap,specularColorMap:!!s.specularColorMap,opaque:!1===s.transparent&&1===s.blending,alphaMap:!!s.alphaMap,alphaTest:I,gradientMap:!!s.gradientMap,sheen:s.sheen>0,sheenColorMap:!!s.sheenColorMap,sheenRoughnessMap:!!s.sheenRoughnessMap,transmission:s.transmission>0,transmissionMap:!!s.transmissionMap,thicknessMap:!!s.thicknessMap,combine:s.combine,vertexTangents:!!s.normalMap&&!!x.attributes.tangent,vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!x.attributes.color&&4===x.attributes.color.itemSize,vertexUvs:!!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatMap||s.clearcoatRoughnessMap||s.clearcoatNormalMap||s.iridescenceMap||s.iridescenceThicknessMap||s.displacementMap||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularColorMap||s.sheenColorMap||s.sheenRoughnessMap),uvsVertexOnly:!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatNormalMap||s.iridescenceMap||s.iridescenceThicknessMap||s.transmission>0||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularColorMap||s.sheen>0||s.sheenColorMap||s.sheenRoughnessMap||!s.displacementMap),fog:!!v,useFog:!0===s.fog,fogExp2:v&&v.isFogExp2,flatShading:!!s.flatShading,sizeAttenuation:s.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===_.isSkinnedMesh,morphTargets:void 0!==x.morphAttributes.position,morphNormals:void 0!==x.morphAttributes.normal,morphColors:void 0!==x.morphAttributes.color,morphTargetsCount:T,morphTextureStride:L,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:s.dithering,shadowMapEnabled:t.shadowMap.enabled&&h.length>0,shadowMapType:t.shadowMap.type,toneMapping:s.toneMapped?t.toneMapping:0,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:s.premultipliedAlpha,doubleSided:2===s.side,flipSided:1===s.side,useDepthPacking:!!s.depthPacking,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionDerivatives:s.extensions&&s.extensions.derivatives,extensionFragDepth:s.extensions&&s.extensions.fragDepth,extensionDrawBuffers:s.extensions&&s.extensions.drawBuffers,extensionShaderTextureLOD:s.extensions&&s.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||n.has("EXT_shader_texture_lod"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function(e){const i=[];if(e.shaderID?i.push(e.shaderID):(i.push(e.customVertexShaderID),i.push(e.customFragmentShaderID)),void 0!==e.defines)for(const t in e.defines)i.push(t),i.push(e.defines[t]);return!1===e.isRawShaderMaterial&&(!function(t,e){t.push(e.precision),t.push(e.outputEncoding),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.combine),t.push(e.vertexUvs),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection),t.push(e.depthPacking)}(i,e),function(t,e){o.disableAll(),e.isWebGL2&&o.enable(0);e.supportsVertexTextures&&o.enable(1);e.instancing&&o.enable(2);e.instancingColor&&o.enable(3);e.map&&o.enable(4);e.matcap&&o.enable(5);e.envMap&&o.enable(6);e.lightMap&&o.enable(7);e.aoMap&&o.enable(8);e.emissiveMap&&o.enable(9);e.bumpMap&&o.enable(10);e.normalMap&&o.enable(11);e.objectSpaceNormalMap&&o.enable(12);e.tangentSpaceNormalMap&&o.enable(13);e.clearcoat&&o.enable(14);e.clearcoatMap&&o.enable(15);e.clearcoatRoughnessMap&&o.enable(16);e.clearcoatNormalMap&&o.enable(17);e.iridescence&&o.enable(18);e.iridescenceMap&&o.enable(19);e.iridescenceThicknessMap&&o.enable(20);e.displacementMap&&o.enable(21);e.specularMap&&o.enable(22);e.roughnessMap&&o.enable(23);e.metalnessMap&&o.enable(24);e.gradientMap&&o.enable(25);e.alphaMap&&o.enable(26);e.alphaTest&&o.enable(27);e.vertexColors&&o.enable(28);e.vertexAlphas&&o.enable(29);e.vertexUvs&&o.enable(30);e.vertexTangents&&o.enable(31);e.uvsVertexOnly&&o.enable(32);e.fog&&o.enable(33);t.push(o.mask),o.disableAll(),e.useFog&&o.enable(0);e.flatShading&&o.enable(1);e.logarithmicDepthBuffer&&o.enable(2);e.skinning&&o.enable(3);e.morphTargets&&o.enable(4);e.morphNormals&&o.enable(5);e.morphColors&&o.enable(6);e.premultipliedAlpha&&o.enable(7);e.shadowMapEnabled&&o.enable(8);e.physicallyCorrectLights&&o.enable(9);e.doubleSided&&o.enable(10);e.flipSided&&o.enable(11);e.useDepthPacking&&o.enable(12);e.dithering&&o.enable(13);e.specularIntensityMap&&o.enable(14);e.specularColorMap&&o.enable(15);e.transmission&&o.enable(16);e.transmissionMap&&o.enable(17);e.thicknessMap&&o.enable(18);e.sheen&&o.enable(19);e.sheenColorMap&&o.enable(20);e.sheenRoughnessMap&&o.enable(21);e.decodeVideoTexture&&o.enable(22);e.opaque&&o.enable(23);t.push(o.mask)}(i,e),i.push(t.outputEncoding)),i.push(e.customProgramCacheKey),i.join()},getUniforms:function(t){const e=m[t.type];let i;if(e){const t=Mn[e];i=tn.clone(t.uniforms)}else i=t.uniforms;return i},acquireProgram:function(e,i){let n;for(let t=0,e=h.length;t<e;t++){const e=h[t];if(e.cacheKey===i){n=e,++n.usedTimes;break}}return void 0===n&&(n=new ys(t,i,e,s),h.push(n)),n},releaseProgram:function(t){if(0==--t.usedTimes){const e=h.indexOf(t);h[e]=h[h.length-1],h.pop(),t.destroy()}},releaseShaderCache:function(t){c.remove(t)},programs:h,dispose:function(){c.dispose()}}}function Ts(){let t=new WeakMap;return{get:function(e){let i=t.get(e);return void 0===i&&(i={},t.set(e,i)),i},remove:function(e){t.delete(e)},update:function(e,i,n){t.get(e)[i]=n},dispose:function(){t=new WeakMap}}}function Es(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function As(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Rs(){const t=[];let e=0;const i=[],n=[],r=[];function s(i,n,r,s,a,o){let l=t[e];return void 0===l?(l={id:i.id,object:i,geometry:n,material:r,groupOrder:s,renderOrder:i.renderOrder,z:a,group:o},t[e]=l):(l.id=i.id,l.object=i,l.geometry=n,l.material=r,l.groupOrder=s,l.renderOrder=i.renderOrder,l.z=a,l.group=o),e++,l}return{opaque:i,transmissive:n,transparent:r,init:function(){e=0,i.length=0,n.length=0,r.length=0},push:function(t,e,a,o,l,c){const h=s(t,e,a,o,l,c);a.transmission>0?n.push(h):!0===a.transparent?r.push(h):i.push(h)},unshift:function(t,e,a,o,l,c){const h=s(t,e,a,o,l,c);a.transmission>0?n.unshift(h):!0===a.transparent?r.unshift(h):i.unshift(h)},finish:function(){for(let i=e,n=t.length;i<n;i++){const e=t[i];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}},sort:function(t,e){i.length>1&&i.sort(t||Es),n.length>1&&n.sort(e||As),r.length>1&&r.sort(e||As)}}}function Cs(){let t=new WeakMap;return{get:function(e,i){let n;return!1===t.has(e)?(n=new Rs,t.set(e,[n])):i>=t.get(e).length?(n=new Rs,t.get(e).push(n)):n=t.get(e)[i],n},dispose:function(){t=new WeakMap}}}function Ls(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new ee,color:new Vt};break;case"SpotLight":i={position:new ee,direction:new ee,color:new Vt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new ee,color:new Vt,distance:0,decay:0};break;case"HemisphereLight":i={direction:new ee,skyColor:new Vt,groundColor:new Vt};break;case"RectAreaLight":i={color:new Vt,position:new ee,halfWidth:new ee,halfHeight:new ee}}return t[e.id]=i,i}}}let Ps=0;function Is(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function Ds(t,e){const i=new Ls,n=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new At};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new At,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=i,i}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let t=0;t<9;t++)r.probe.push(new ee);const s=new ee,a=new Ie,o=new Ie;return{setup:function(s,a){let o=0,l=0,c=0;for(let t=0;t<9;t++)r.probe[t].set(0,0,0);let h=0,u=0,d=0,p=0,f=0,m=0,g=0,_=0;s.sort(Is);const v=!0!==a?Math.PI:1;for(let t=0,e=s.length;t<e;t++){const e=s[t],a=e.color,x=e.intensity,y=e.distance,M=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)o+=a.r*x*v,l+=a.g*x*v,c+=a.b*x*v;else if(e.isLightProbe)for(let t=0;t<9;t++)r.probe[t].addScaledVector(e.sh.coefficients[t],x);else if(e.isDirectionalLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*v),e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,r.directionalShadow[h]=i,r.directionalShadowMap[h]=M,r.directionalShadowMatrix[h]=e.shadow.matrix,m++}r.directional[h]=t,h++}else if(e.isSpotLight){const t=i.get(e);if(t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(a).multiplyScalar(x*v),t.distance=y,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,r.spotShadow[d]=i,r.spotShadowMap[d]=M,r.spotShadowMatrix[d]=e.shadow.matrix,_++}r.spot[d]=t,d++}else if(e.isRectAreaLight){const t=i.get(e);t.color.copy(a).multiplyScalar(x),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),r.rectArea[p]=t,p++}else if(e.isPointLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*v),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,i.shadowCameraNear=t.camera.near,i.shadowCameraFar=t.camera.far,r.pointShadow[u]=i,r.pointShadowMap[u]=M,r.pointShadowMatrix[u]=e.shadow.matrix,g++}r.point[u]=t,u++}else if(e.isHemisphereLight){const t=i.get(e);t.skyColor.copy(e.color).multiplyScalar(x*v),t.groundColor.copy(e.groundColor).multiplyScalar(x*v),r.hemi[f]=t,f++}}p>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(r.rectAreaLTC1=yn.LTC_FLOAT_1,r.rectAreaLTC2=yn.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=yn.LTC_HALF_1,r.rectAreaLTC2=yn.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=o,r.ambient[1]=l,r.ambient[2]=c;const x=r.hash;x.directionalLength===h&&x.pointLength===u&&x.spotLength===d&&x.rectAreaLength===p&&x.hemiLength===f&&x.numDirectionalShadows===m&&x.numPointShadows===g&&x.numSpotShadows===_||(r.directional.length=h,r.spot.length=d,r.rectArea.length=p,r.point.length=u,r.hemi.length=f,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=_,r.spotShadowMap.length=_,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=g,r.spotShadowMatrix.length=_,x.directionalLength=h,x.pointLength=u,x.spotLength=d,x.rectAreaLength=p,x.hemiLength=f,x.numDirectionalShadows=m,x.numPointShadows=g,x.numSpotShadows=_,r.version=Ps++)},setupView:function(t,e){let i=0,n=0,l=0,c=0,h=0;const u=e.matrixWorldInverse;for(let e=0,d=t.length;e<d;e++){const d=t[e];if(d.isDirectionalLight){const t=r.directional[i];t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(u),i++}else if(d.isSpotLight){const t=r.spot[l];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(u),l++}else if(d.isRectAreaLight){const t=r.rectArea[c];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),o.identity(),a.copy(d.matrixWorld),a.premultiply(u),o.extractRotation(a),t.halfWidth.set(.5*d.width,0,0),t.halfHeight.set(0,.5*d.height,0),t.halfWidth.applyMatrix4(o),t.halfHeight.applyMatrix4(o),c++}else if(d.isPointLight){const t=r.point[n];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),n++}else if(d.isHemisphereLight){const t=r.hemi[h];t.direction.setFromMatrixPosition(d.matrixWorld),t.direction.transformDirection(u),h++}}},state:r}}function Ns(t,e){const i=new Ds(t,e),n=[],r=[];return{init:function(){n.length=0,r.length=0},state:{lightsArray:n,shadowsArray:r,lights:i},setupLights:function(t){i.setup(n,t)},setupLightsView:function(t){i.setupView(n,t)},pushLight:function(t){n.push(t)},pushShadow:function(t){r.push(t)}}}function Os(t,e){let i=new WeakMap;return{get:function(n,r=0){let s;return!1===i.has(n)?(s=new Ns(t,e),i.set(n,[s])):r>=i.get(n).length?(s=new Ns(t,e),i.get(n).push(s)):s=i.get(n)[r],s},dispose:function(){i=new WeakMap}}}class Fs extends gi{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class Us extends gi{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new ee,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}function Bs(t,e,i){let n=new mn;const r=new At,s=new At,a=new Jt,o=new Fs({depthPacking:3201}),l=new Us,c={},h=i.maxTextureSize,u={0:1,1:0,2:2},p=new en({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new At},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),f=p.clone();f.defines.HORIZONTAL_PASS=1;const m=new Pi;m.setAttribute("position",new yi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const g=new Zi(m,p),_=this;function v(i,n){const s=e.update(g);p.defines.VSM_SAMPLES!==i.blurSamples&&(p.defines.VSM_SAMPLES=i.blurSamples,f.defines.VSM_SAMPLES=i.blurSamples,p.needsUpdate=!0,f.needsUpdate=!0),null===i.mapPass&&(i.mapPass=new Kt(r.x,r.y)),p.uniforms.shadow_pass.value=i.map.texture,p.uniforms.resolution.value=i.mapSize,p.uniforms.radius.value=i.radius,t.setRenderTarget(i.mapPass),t.clear(),t.renderBufferDirect(n,null,s,p,g,null),f.uniforms.shadow_pass.value=i.mapPass.texture,f.uniforms.resolution.value=i.mapSize,f.uniforms.radius.value=i.radius,t.setRenderTarget(i.map),t.clear(),t.renderBufferDirect(n,null,s,f,g,null)}function x(e,i,n,r,s,a){let h=null;const d=!0===n.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(h=void 0!==d?d:!0===n.isPointLight?l:o,t.localClippingEnabled&&!0===i.clipShadows&&Array.isArray(i.clippingPlanes)&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&i.alphaTest>0){const t=h.uuid,e=i.uuid;let n=c[t];void 0===n&&(n={},c[t]=n);let r=n[e];void 0===r&&(r=h.clone(),n[e]=r),h=r}return h.visible=i.visible,h.wireframe=i.wireframe,h.side=3===a?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:u[i.side],h.alphaMap=i.alphaMap,h.alphaTest=i.alphaTest,h.clipShadows=i.clipShadows,h.clippingPlanes=i.clippingPlanes,h.clipIntersection=i.clipIntersection,h.displacementMap=i.displacementMap,h.displacementScale=i.displacementScale,h.displacementBias=i.displacementBias,h.wireframeLinewidth=i.wireframeLinewidth,h.linewidth=i.linewidth,!0===n.isPointLight&&!0===h.isMeshDistanceMaterial&&(h.referencePosition.setFromMatrixPosition(n.matrixWorld),h.nearDistance=r,h.farDistance=s),h}function y(i,r,s,a,o){if(!1===i.visible)return;if(i.layers.test(r.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&3===o)&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,i.matrixWorld);const n=e.update(i),r=i.material;if(Array.isArray(r)){const e=n.groups;for(let l=0,c=e.length;l<c;l++){const c=e[l],h=r[c.materialIndex];if(h&&h.visible){const e=x(i,h,a,s.near,s.far,o);t.renderBufferDirect(s,null,n,e,i,c)}}}else if(r.visible){const e=x(i,r,a,s.near,s.far,o);t.renderBufferDirect(s,null,n,e,i,null)}}const l=i.children;for(let t=0,e=l.length;t<e;t++)y(l[t],r,s,a,o)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(e,i,o){if(!1===_.enabled)return;if(!1===_.autoUpdate&&!1===_.needsUpdate)return;if(0===e.length)return;const l=t.getRenderTarget(),c=t.getActiveCubeFace(),u=t.getActiveMipmapLevel(),p=t.state;p.setBlending(0),p.buffers.color.setClear(1,1,1,1),p.buffers.depth.setTest(!0),p.setScissorTest(!1);for(let l=0,c=e.length;l<c;l++){const c=e[l],u=c.shadow;if(void 0===u){console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;r.copy(u.mapSize);const f=u.getFrameExtents();if(r.multiply(f),s.copy(u.mapSize),(r.x>h||r.y>h)&&(r.x>h&&(s.x=Math.floor(h/f.x),r.x=s.x*f.x,u.mapSize.x=s.x),r.y>h&&(s.y=Math.floor(h/f.y),r.y=s.y*f.y,u.mapSize.y=s.y)),null===u.map){const t=3!==this.type?{minFilter:d,magFilter:d}:{};u.map=new Kt(r.x,r.y,t),u.map.texture.name=c.name+".shadowMap",u.camera.updateProjectionMatrix()}t.setRenderTarget(u.map),t.clear();const m=u.getViewportCount();for(let t=0;t<m;t++){const e=u.getViewport(t);a.set(s.x*e.x,s.y*e.y,s.x*e.z,s.y*e.w),p.viewport(a),u.updateMatrices(c,t),n=u.getFrustum(),y(i,o,u.camera,c,this.type)}!0!==u.isPointLightShadow&&3===this.type&&v(u,o),u.needsUpdate=!1}_.needsUpdate=!1,t.setRenderTarget(l,c,u)}}function zs(t,e,n){const r=n.isWebGL2;const s=new function(){let e=!1;const i=new Jt;let n=null;const r=new Jt(0,0,0,0);return{setMask:function(i){n===i||e||(t.colorMask(i,i,i,i),n=i)},setLocked:function(t){e=t},setClear:function(e,n,s,a,o){!0===o&&(e*=a,n*=a,s*=a),i.set(e,n,s,a),!1===r.equals(i)&&(t.clearColor(e,n,s,a),r.copy(i))},reset:function(){e=!1,n=null,r.set(-1,0,0,0)}}},a=new function(){let e=!1,i=null,n=null,r=null;return{setTest:function(e){e?k(t.DEPTH_TEST):H(t.DEPTH_TEST)},setMask:function(n){i===n||e||(t.depthMask(n),i=n)},setFunc:function(e){if(n!==e){if(e)switch(e){case 0:t.depthFunc(t.NEVER);break;case 1:t.depthFunc(t.ALWAYS);break;case 2:t.depthFunc(t.LESS);break;case 3:t.depthFunc(t.LEQUAL);break;case 4:t.depthFunc(t.EQUAL);break;case 5:t.depthFunc(t.GEQUAL);break;case 6:t.depthFunc(t.GREATER);break;case 7:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}else t.depthFunc(t.LEQUAL);n=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,i=null,n=null,r=null}}},o=new function(){let e=!1,i=null,n=null,r=null,s=null,a=null,o=null,l=null,c=null;return{setTest:function(i){e||(i?k(t.STENCIL_TEST):H(t.STENCIL_TEST))},setMask:function(n){i===n||e||(t.stencilMask(n),i=n)},setFunc:function(e,i,a){n===e&&r===i&&s===a||(t.stencilFunc(e,i,a),n=e,r=i,s=a)},setOp:function(e,i,n){a===e&&o===i&&l===n||(t.stencilOp(e,i,n),a=e,o=i,l=n)},setLocked:function(t){e=t},setClear:function(e){c!==e&&(t.clearStencil(e),c=e)},reset:function(){e=!1,i=null,n=null,r=null,s=null,a=null,o=null,l=null,c=null}}},l=new WeakMap,c=new WeakMap;let h={},u={},d=new WeakMap,p=[],f=null,m=!1,g=null,_=null,v=null,x=null,y=null,M=null,b=null,S=!1,w=null,T=null,E=null,A=null,R=null;const C=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let L=!1,P=0;const I=t.getParameter(t.VERSION);-1!==I.indexOf("WebGL")?(P=parseFloat(/^WebGL (\d)/.exec(I)[1]),L=P>=1):-1!==I.indexOf("OpenGL ES")&&(P=parseFloat(/^OpenGL ES (\d)/.exec(I)[1]),L=P>=2);let D=null,N={};const O=t.getParameter(t.SCISSOR_BOX),F=t.getParameter(t.VIEWPORT),U=(new Jt).fromArray(O),B=(new Jt).fromArray(F);function z(e,i,n){const r=new Uint8Array(4),s=t.createTexture();t.bindTexture(e,s),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let e=0;e<n;e++)t.texImage2D(i+e,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,r);return s}const G={};function k(e){!0!==h[e]&&(t.enable(e),h[e]=!0)}function H(e){!1!==h[e]&&(t.disable(e),h[e]=!1)}G[t.TEXTURE_2D]=z(t.TEXTURE_2D,t.TEXTURE_2D,1),G[t.TEXTURE_CUBE_MAP]=z(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),s.setClear(0,0,0,1),a.setClear(1),o.setClear(0),k(t.DEPTH_TEST),a.setFunc(3),j(!1),q(1),k(t.CULL_FACE),X(0);const V={[i]:t.FUNC_ADD,101:t.FUNC_SUBTRACT,102:t.FUNC_REVERSE_SUBTRACT};if(r)V[103]=t.MIN,V[104]=t.MAX;else{const t=e.get("EXT_blend_minmax");null!==t&&(V[103]=t.MIN_EXT,V[104]=t.MAX_EXT)}const W={200:t.ZERO,201:t.ONE,202:t.SRC_COLOR,204:t.SRC_ALPHA,210:t.SRC_ALPHA_SATURATE,208:t.DST_COLOR,206:t.DST_ALPHA,203:t.ONE_MINUS_SRC_COLOR,205:t.ONE_MINUS_SRC_ALPHA,209:t.ONE_MINUS_DST_COLOR,207:t.ONE_MINUS_DST_ALPHA};function X(e,n,r,s,a,o,l,c){if(0!==e){if(!1===m&&(k(t.BLEND),m=!0),5===e)a=a||n,o=o||r,l=l||s,n===_&&a===y||(t.blendEquationSeparate(V[n],V[a]),_=n,y=a),r===v&&s===x&&o===M&&l===b||(t.blendFuncSeparate(W[r],W[s],W[o],W[l]),v=r,x=s,M=o,b=l),g=e,S=null;else if(e!==g||c!==S){if(_===i&&y===i||(t.blendEquation(t.FUNC_ADD),_=i,y=i),c)switch(e){case 1:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.ONE,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}v=null,x=null,M=null,b=null,g=e,S=c}}else!0===m&&(H(t.BLEND),m=!1)}function j(e){w!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),w=e)}function q(e){0!==e?(k(t.CULL_FACE),e!==T&&(1===e?t.cullFace(t.BACK):2===e?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):H(t.CULL_FACE),T=e}function Y(e,i,n){e?(k(t.POLYGON_OFFSET_FILL),A===i&&R===n||(t.polygonOffset(i,n),A=i,R=n)):H(t.POLYGON_OFFSET_FILL)}function Z(e){void 0===e&&(e=t.TEXTURE0+C-1),D!==e&&(t.activeTexture(e),D=e)}return{buffers:{color:s,depth:a,stencil:o},enable:k,disable:H,bindFramebuffer:function(e,i){return u[e]!==i&&(t.bindFramebuffer(e,i),u[e]=i,r&&(e===t.DRAW_FRAMEBUFFER&&(u[t.FRAMEBUFFER]=i),e===t.FRAMEBUFFER&&(u[t.DRAW_FRAMEBUFFER]=i)),!0)},drawBuffers:function(i,r){let s=p,a=!1;if(i)if(s=d.get(r),void 0===s&&(s=[],d.set(r,s)),i.isWebGLMultipleRenderTargets){const e=i.texture;if(s.length!==e.length||s[0]!==t.COLOR_ATTACHMENT0){for(let i=0,n=e.length;i<n;i++)s[i]=t.COLOR_ATTACHMENT0+i;s.length=e.length,a=!0}}else s[0]!==t.COLOR_ATTACHMENT0&&(s[0]=t.COLOR_ATTACHMENT0,a=!0);else s[0]!==t.BACK&&(s[0]=t.BACK,a=!0);a&&(n.isWebGL2?t.drawBuffers(s):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(s))},useProgram:function(e){return f!==e&&(t.useProgram(e),f=e,!0)},setBlending:X,setMaterial:function(e,i){2===e.side?H(t.CULL_FACE):k(t.CULL_FACE);let n=1===e.side;i&&(n=!n),j(n),1===e.blending&&!1===e.transparent?X(0):X(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),a.setFunc(e.depthFunc),a.setTest(e.depthTest),a.setMask(e.depthWrite),s.setMask(e.colorWrite);const r=e.stencilWrite;o.setTest(r),r&&(o.setMask(e.stencilWriteMask),o.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),o.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Y(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?k(t.SAMPLE_ALPHA_TO_COVERAGE):H(t.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:j,setCullFace:q,setLineWidth:function(e){e!==E&&(L&&t.lineWidth(e),E=e)},setPolygonOffset:Y,setScissorTest:function(e){e?k(t.SCISSOR_TEST):H(t.SCISSOR_TEST)},activeTexture:Z,bindTexture:function(e,i){null===D&&Z();let n=N[D];void 0===n&&(n={type:void 0,texture:void 0},N[D]=n),n.type===e&&n.texture===i||(t.bindTexture(e,i||G[e]),n.type=e,n.texture=i)},unbindTexture:function(){const e=N[D];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},updateUBOMapping:function(e,i){let n=c.get(i);void 0===n&&(n=new WeakMap,c.set(i,n));let r=n.get(e);void 0===r&&(r=t.getUniformBlockIndex(i,e.name),n.set(e,r))},uniformBlockBinding:function(e,i){const n=c.get(i).get(e);l.get(e)!==n&&(t.uniformBlockBinding(i,n,e.__bindingPointIndex),l.set(e,n))},texStorage2D:function(){try{t.texStorage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{t.texStorage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{t.texSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{t.texSubImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===U.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),U.copy(e))},viewport:function(e){!1===B.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),B.copy(e))},reset:function(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),!0===r&&(t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),h={},D=null,N={},u={},d=new WeakMap,p=[],f=null,m=!1,g=null,_=null,v=null,x=null,y=null,M=null,b=null,S=!1,w=null,T=null,E=null,A=null,R=null,U.set(0,0,t.canvas.width,t.canvas.height),B.set(0,0,t.canvas.width,t.canvas.height),s.reset(),a.reset(),o.reset()}}}function Gs(t,e,i,n,r,s,a){const o=r.isWebGL2,l=r.maxTextures,A=r.maxCubemapSize,R=r.maxTextureSize,C=r.maxSamples,L=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,P=/OculusBrowser/g.test(navigator.userAgent),I=new WeakMap;let D;const N=new WeakMap;let O=!1;try{O="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function F(t,e){return O?new OffscreenCanvas(t,e):It("canvas")}function U(t,e,i,n){let r=1;if((t.width>n||t.height>n)&&(r=n/Math.max(t.width,t.height)),r<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const n=e?Tt:Math.floor,s=n(r*t.width),a=n(r*t.height);void 0===D&&(D=F(s,a));const o=i?F(s,a):D;o.width=s,o.height=a;return o.getContext("2d").drawImage(t,0,0,s,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+s+"x"+a+")."),o}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function B(t){return St(t.width)&&St(t.height)}function z(t,e){return t.generateMipmaps&&e&&t.minFilter!==d&&t.minFilter!==m}function G(e){t.generateMipmap(e)}function k(i,n,r,s,a=!1){if(!1===o)return n;if(null!==i){if(void 0!==t[i])return t[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let l=n;return n===t.RED&&(r===t.FLOAT&&(l=t.R32F),r===t.HALF_FLOAT&&(l=t.R16F),r===t.UNSIGNED_BYTE&&(l=t.R8)),n===t.RG&&(r===t.FLOAT&&(l=t.RG32F),r===t.HALF_FLOAT&&(l=t.RG16F),r===t.UNSIGNED_BYTE&&(l=t.RG8)),n===t.RGBA&&(r===t.FLOAT&&(l=t.RGBA32F),r===t.HALF_FLOAT&&(l=t.RGBA16F),r===t.UNSIGNED_BYTE&&(l=s===ot&&!1===a?t.SRGB8_ALPHA8:t.RGBA8),r===t.UNSIGNED_SHORT_4_4_4_4&&(l=t.RGBA4),r===t.UNSIGNED_SHORT_5_5_5_1&&(l=t.RGB5_A1)),l!==t.R16F&&l!==t.R32F&&l!==t.RG16F&&l!==t.RG32F&&l!==t.RGBA16F&&l!==t.RGBA32F||e.get("EXT_color_buffer_float"),l}function H(t,e,i){return!0===z(t,i)||t.isFramebufferTexture&&t.minFilter!==d&&t.minFilter!==m?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function V(e){return e===d||e===p||e===f?t.NEAREST:t.LINEAR}function W(t){const e=t.target;e.removeEventListener("dispose",W),function(t){const e=n.get(t);if(void 0===e.__webglInit)return;const i=t.source,r=N.get(i);if(r){const n=r[e.__cacheKey];n.usedTimes--,0===n.usedTimes&&j(t),0===Object.keys(r).length&&N.delete(i)}n.remove(t)}(e),e.isVideoTexture&&I.delete(e)}function X(e){const i=e.target;i.removeEventListener("dispose",X),function(e){const i=e.texture,r=n.get(e),s=n.get(i);void 0!==s.__webglTexture&&(t.deleteTexture(s.__webglTexture),a.memory.textures--);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)t.deleteFramebuffer(r.__webglFramebuffer[e]),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer[e]);else{if(t.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&t.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer)for(let e=0;e<r.__webglColorRenderbuffer.length;e++)r.__webglColorRenderbuffer[e]&&t.deleteRenderbuffer(r.__webglColorRenderbuffer[e]);r.__webglDepthRenderbuffer&&t.deleteRenderbuffer(r.__webglDepthRenderbuffer)}if(e.isWebGLMultipleRenderTargets)for(let e=0,r=i.length;e<r;e++){const r=n.get(i[e]);r.__webglTexture&&(t.deleteTexture(r.__webglTexture),a.memory.textures--),n.remove(i[e])}n.remove(i),n.remove(e)}(i)}function j(e){const i=n.get(e);t.deleteTexture(i.__webglTexture);const r=e.source;delete N.get(r)[i.__cacheKey],a.memory.textures--}let q=0;function Y(e,r){const s=n.get(e);if(e.isVideoTexture&&function(t){const e=a.render.frame;I.get(t)!==e&&(I.set(t,e),t.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&s.__version!==e.version){const t=e.image;if(null===t)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==t.complete)return void $(s,e,r);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.activeTexture(t.TEXTURE0+r),i.bindTexture(t.TEXTURE_2D,s.__webglTexture)}const Z={[c]:t.REPEAT,[h]:t.CLAMP_TO_EDGE,[u]:t.MIRRORED_REPEAT},J={[d]:t.NEAREST,[p]:t.NEAREST_MIPMAP_NEAREST,[f]:t.NEAREST_MIPMAP_LINEAR,[m]:t.LINEAR,[g]:t.LINEAR_MIPMAP_NEAREST,[_]:t.LINEAR_MIPMAP_LINEAR};function K(i,s,a){if(a?(t.texParameteri(i,t.TEXTURE_WRAP_S,Z[s.wrapS]),t.texParameteri(i,t.TEXTURE_WRAP_T,Z[s.wrapT]),i!==t.TEXTURE_3D&&i!==t.TEXTURE_2D_ARRAY||t.texParameteri(i,t.TEXTURE_WRAP_R,Z[s.wrapR]),t.texParameteri(i,t.TEXTURE_MAG_FILTER,J[s.magFilter]),t.texParameteri(i,t.TEXTURE_MIN_FILTER,J[s.minFilter])):(t.texParameteri(i,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(i,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),i!==t.TEXTURE_3D&&i!==t.TEXTURE_2D_ARRAY||t.texParameteri(i,t.TEXTURE_WRAP_R,t.CLAMP_TO_EDGE),s.wrapS===h&&s.wrapT===h||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(i,t.TEXTURE_MAG_FILTER,V(s.magFilter)),t.texParameteri(i,t.TEXTURE_MIN_FILTER,V(s.minFilter)),s.minFilter!==d&&s.minFilter!==m&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){const a=e.get("EXT_texture_filter_anisotropic");if(s.type===M&&!1===e.has("OES_texture_float_linear"))return;if(!1===o&&s.type===b&&!1===e.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||n.get(s).__currentAnisotropy)&&(t.texParameterf(i,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),n.get(s).__currentAnisotropy=s.anisotropy)}}function Q(e,i){let n=!1;void 0===e.__webglInit&&(e.__webglInit=!0,i.addEventListener("dispose",W));const r=i.source;let s=N.get(r);void 0===s&&(s={},N.set(r,s));const o=function(t){const e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.encoding),e.join()}(i);if(o!==e.__cacheKey){void 0===s[o]&&(s[o]={texture:t.createTexture(),usedTimes:0},a.memory.textures++,n=!0),s[o].usedTimes++;const r=s[e.__cacheKey];void 0!==r&&(s[e.__cacheKey].usedTimes--,0===r.usedTimes&&j(i)),e.__cacheKey=o,e.__webglTexture=s[o].texture}return n}function $(e,n,r){let a=t.TEXTURE_2D;n.isDataArrayTexture&&(a=t.TEXTURE_2D_ARRAY),n.isData3DTexture&&(a=t.TEXTURE_3D);const l=Q(e,n),c=n.source;if(i.activeTexture(t.TEXTURE0+r),i.bindTexture(a,e.__webglTexture),c.version!==c.__currentVersion||!0===l){t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,n.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,n.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE);const e=function(t){return!o&&(t.wrapS!==h||t.wrapT!==h||t.minFilter!==d&&t.minFilter!==m)}(n)&&!1===B(n.image);let r=U(n.image,e,!1,R);r=st(n,r);const u=B(r)||o,p=s.convert(n.format,n.encoding);let f,g=s.convert(n.type),_=k(n.internalFormat,p,g,n.encoding,n.isVideoTexture);K(a,n,u);const v=n.mipmaps,b=o&&!0!==n.isVideoTexture,A=void 0===c.__currentVersion||!0===l,C=H(n,r,u);if(n.isDepthTexture)_=t.DEPTH_COMPONENT,o?_=n.type===M?t.DEPTH_COMPONENT32F:n.type===y?t.DEPTH_COMPONENT24:n.type===S?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT16:n.type===M&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),n.format===T&&_===t.DEPTH_COMPONENT&&n.type!==x&&n.type!==y&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=y,g=s.convert(n.type)),n.format===E&&_===t.DEPTH_COMPONENT&&(_=t.DEPTH_STENCIL,n.type!==S&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=S,g=s.convert(n.type))),A&&(b?i.texStorage2D(t.TEXTURE_2D,1,_,r.width,r.height):i.texImage2D(t.TEXTURE_2D,0,_,r.width,r.height,0,p,g,null));else if(n.isDataTexture)if(v.length>0&&u){b&&A&&i.texStorage2D(t.TEXTURE_2D,C,_,v[0].width,v[0].height);for(let e=0,n=v.length;e<n;e++)f=v[e],b?i.texSubImage2D(t.TEXTURE_2D,e,0,0,f.width,f.height,p,g,f.data):i.texImage2D(t.TEXTURE_2D,e,_,f.width,f.height,0,p,g,f.data);n.generateMipmaps=!1}else b?(A&&i.texStorage2D(t.TEXTURE_2D,C,_,r.width,r.height),i.texSubImage2D(t.TEXTURE_2D,0,0,0,r.width,r.height,p,g,r.data)):i.texImage2D(t.TEXTURE_2D,0,_,r.width,r.height,0,p,g,r.data);else if(n.isCompressedTexture){b&&A&&i.texStorage2D(t.TEXTURE_2D,C,_,v[0].width,v[0].height);for(let e=0,r=v.length;e<r;e++)f=v[e],n.format!==w?null!==p?b?i.compressedTexSubImage2D(t.TEXTURE_2D,e,0,0,f.width,f.height,p,f.data):i.compressedTexImage2D(t.TEXTURE_2D,e,_,f.width,f.height,0,f.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):b?i.texSubImage2D(t.TEXTURE_2D,e,0,0,f.width,f.height,p,g,f.data):i.texImage2D(t.TEXTURE_2D,e,_,f.width,f.height,0,p,g,f.data)}else if(n.isDataArrayTexture)b?(A&&i.texStorage3D(t.TEXTURE_2D_ARRAY,C,_,r.width,r.height,r.depth),i.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,r.width,r.height,r.depth,p,g,r.data)):i.texImage3D(t.TEXTURE_2D_ARRAY,0,_,r.width,r.height,r.depth,0,p,g,r.data);else if(n.isData3DTexture)b?(A&&i.texStorage3D(t.TEXTURE_3D,C,_,r.width,r.height,r.depth),i.texSubImage3D(t.TEXTURE_3D,0,0,0,0,r.width,r.height,r.depth,p,g,r.data)):i.texImage3D(t.TEXTURE_3D,0,_,r.width,r.height,r.depth,0,p,g,r.data);else if(n.isFramebufferTexture){if(A)if(b)i.texStorage2D(t.TEXTURE_2D,C,_,r.width,r.height);else{let e=r.width,n=r.height;for(let r=0;r<C;r++)i.texImage2D(t.TEXTURE_2D,r,_,e,n,0,p,g,null),e>>=1,n>>=1}}else if(v.length>0&&u){b&&A&&i.texStorage2D(t.TEXTURE_2D,C,_,v[0].width,v[0].height);for(let e=0,n=v.length;e<n;e++)f=v[e],b?i.texSubImage2D(t.TEXTURE_2D,e,0,0,p,g,f):i.texImage2D(t.TEXTURE_2D,e,_,p,g,f);n.generateMipmaps=!1}else b?(A&&i.texStorage2D(t.TEXTURE_2D,C,_,r.width,r.height),i.texSubImage2D(t.TEXTURE_2D,0,0,0,p,g,r)):i.texImage2D(t.TEXTURE_2D,0,_,p,g,r);z(n,u)&&G(a),c.__currentVersion=c.version,n.onUpdate&&n.onUpdate(n)}e.__version=n.version}function tt(e,r,a,o,l){const c=s.convert(a.format,a.encoding),h=s.convert(a.type),u=k(a.internalFormat,c,h,a.encoding);n.get(r).__hasExternalTextures||(l===t.TEXTURE_3D||l===t.TEXTURE_2D_ARRAY?i.texImage3D(l,0,u,r.width,r.height,r.depth,0,c,h,null):i.texImage2D(l,0,u,r.width,r.height,0,c,h,null)),i.bindFramebuffer(t.FRAMEBUFFER,e),rt(r)?L.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,o,l,n.get(a).__webglTexture,0,nt(r)):t.framebufferTexture2D(t.FRAMEBUFFER,o,l,n.get(a).__webglTexture,0),i.bindFramebuffer(t.FRAMEBUFFER,null)}function et(e,i,n){if(t.bindRenderbuffer(t.RENDERBUFFER,e),i.depthBuffer&&!i.stencilBuffer){let r=t.DEPTH_COMPONENT16;if(n||rt(i)){const e=i.depthTexture;e&&e.isDepthTexture&&(e.type===M?r=t.DEPTH_COMPONENT32F:e.type===y&&(r=t.DEPTH_COMPONENT24));const n=nt(i);rt(i)?L.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,n,r,i.width,i.height):t.renderbufferStorageMultisample(t.RENDERBUFFER,n,r,i.width,i.height)}else t.renderbufferStorage(t.RENDERBUFFER,r,i.width,i.height);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e)}else if(i.depthBuffer&&i.stencilBuffer){const r=nt(i);n&&!1===rt(i)?t.renderbufferStorageMultisample(t.RENDERBUFFER,r,t.DEPTH24_STENCIL8,i.width,i.height):rt(i)?L.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,r,t.DEPTH24_STENCIL8,i.width,i.height):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,i.width,i.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e)}else{const e=!0===i.isWebGLMultipleRenderTargets?i.texture:[i.texture];for(let r=0;r<e.length;r++){const a=e[r],o=s.convert(a.format,a.encoding),l=s.convert(a.type),c=k(a.internalFormat,o,l,a.encoding),h=nt(i);n&&!1===rt(i)?t.renderbufferStorageMultisample(t.RENDERBUFFER,h,c,i.width,i.height):rt(i)?L.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,h,c,i.width,i.height):t.renderbufferStorage(t.RENDERBUFFER,c,i.width,i.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function it(e){const r=n.get(e),s=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(t.FRAMEBUFFER,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),Y(r.depthTexture,0);const s=n.get(r.depthTexture).__webglTexture,a=nt(r);if(r.depthTexture.format===T)rt(r)?L.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,s,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,s,0);else{if(r.depthTexture.format!==E)throw new Error("Unknown depthTexture format");rt(r)?L.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,s,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,s,0)}}(r.__webglFramebuffer,e)}else if(s){r.__webglDepthbuffer=[];for(let n=0;n<6;n++)i.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer[n]),r.__webglDepthbuffer[n]=t.createRenderbuffer(),et(r.__webglDepthbuffer[n],e,!1)}else i.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),et(r.__webglDepthbuffer,e,!1);i.bindFramebuffer(t.FRAMEBUFFER,null)}function nt(t){return Math.min(C,t.samples)}function rt(t){const i=n.get(t);return o&&t.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==i.__useRenderToTexture}function st(t,i){const n=t.encoding,r=t.format,s=t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||t.format===pt||n!==at&&(n===ot?!1===o?!0===e.has("EXT_sRGB")&&r===w?(t.format=pt,t.minFilter=m,t.generateMipmaps=!1):i=Xt.sRGBToLinear(i):r===w&&s===v||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",n)),i}this.allocateTextureUnit=function(){const t=q;return t>=l&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+l),q+=1,t},this.resetTextureUnits=function(){q=0},this.setTexture2D=Y,this.setTexture2DArray=function(e,r){const s=n.get(e);e.version>0&&s.__version!==e.version?$(s,e,r):(i.activeTexture(t.TEXTURE0+r),i.bindTexture(t.TEXTURE_2D_ARRAY,s.__webglTexture))},this.setTexture3D=function(e,r){const s=n.get(e);e.version>0&&s.__version!==e.version?$(s,e,r):(i.activeTexture(t.TEXTURE0+r),i.bindTexture(t.TEXTURE_3D,s.__webglTexture))},this.setTextureCube=function(e,r){const a=n.get(e);e.version>0&&a.__version!==e.version?function(e,n,r){if(6!==n.image.length)return;const a=Q(e,n),l=n.source;if(i.activeTexture(t.TEXTURE0+r),i.bindTexture(t.TEXTURE_CUBE_MAP,e.__webglTexture),l.version!==l.__currentVersion||!0===a){t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,n.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,n.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE);const e=n.isCompressedTexture||n.image[0].isCompressedTexture,r=n.image[0]&&n.image[0].isDataTexture,c=[];for(let t=0;t<6;t++)c[t]=e||r?r?n.image[t].image:n.image[t]:U(n.image[t],!1,!0,A),c[t]=st(n,c[t]);const h=c[0],u=B(h)||o,d=s.convert(n.format,n.encoding),p=s.convert(n.type),f=k(n.internalFormat,d,p,n.encoding),m=o&&!0!==n.isVideoTexture,g=void 0===l.__currentVersion||!0===a;let _,v=H(n,h,u);if(K(t.TEXTURE_CUBE_MAP,n,u),e){m&&g&&i.texStorage2D(t.TEXTURE_CUBE_MAP,v,f,h.width,h.height);for(let e=0;e<6;e++){_=c[e].mipmaps;for(let r=0;r<_.length;r++){const s=_[r];n.format!==w?null!==d?m?i.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,0,0,s.width,s.height,d,s.data):i.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,f,s.width,s.height,0,s.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):m?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,0,0,s.width,s.height,d,p,s.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,f,s.width,s.height,0,d,p,s.data)}}}else{_=n.mipmaps,m&&g&&(_.length>0&&v++,i.texStorage2D(t.TEXTURE_CUBE_MAP,v,f,c[0].width,c[0].height));for(let e=0;e<6;e++)if(r){m?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,c[e].width,c[e].height,d,p,c[e].data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,f,c[e].width,c[e].height,0,d,p,c[e].data);for(let n=0;n<_.length;n++){const r=_[n].image[e].image;m?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,0,0,r.width,r.height,d,p,r.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,f,r.width,r.height,0,d,p,r.data)}}else{m?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,d,p,c[e]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,f,d,p,c[e]);for(let n=0;n<_.length;n++){const r=_[n];m?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,0,0,d,p,r.image[e]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,f,d,p,r.image[e])}}}z(n,u)&&G(t.TEXTURE_CUBE_MAP),l.__currentVersion=l.version,n.onUpdate&&n.onUpdate(n)}e.__version=n.version}(a,e,r):(i.activeTexture(t.TEXTURE0+r),i.bindTexture(t.TEXTURE_CUBE_MAP,a.__webglTexture))},this.rebindTextures=function(e,i,r){const s=n.get(e);void 0!==i&&tt(s.__webglFramebuffer,e,e.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D),void 0!==r&&it(e)},this.setupRenderTarget=function(e){const l=e.texture,c=n.get(e),h=n.get(l);e.addEventListener("dispose",X),!0!==e.isWebGLMultipleRenderTargets&&(void 0===h.__webglTexture&&(h.__webglTexture=t.createTexture()),h.__version=l.version,a.memory.textures++);const u=!0===e.isWebGLCubeRenderTarget,d=!0===e.isWebGLMultipleRenderTargets,p=B(e)||o;if(u){c.__webglFramebuffer=[];for(let e=0;e<6;e++)c.__webglFramebuffer[e]=t.createFramebuffer()}else{if(c.__webglFramebuffer=t.createFramebuffer(),d)if(r.drawBuffers){const i=e.texture;for(let e=0,r=i.length;e<r;e++){const r=n.get(i[e]);void 0===r.__webglTexture&&(r.__webglTexture=t.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&e.samples>0&&!1===rt(e)){const n=d?l:[l];c.__webglMultisampledFramebuffer=t.createFramebuffer(),c.__webglColorRenderbuffer=[],i.bindFramebuffer(t.FRAMEBUFFER,c.__webglMultisampledFramebuffer);for(let i=0;i<n.length;i++){const r=n[i];c.__webglColorRenderbuffer[i]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,c.__webglColorRenderbuffer[i]);const a=s.convert(r.format,r.encoding),o=s.convert(r.type),l=k(r.internalFormat,a,o,r.encoding),h=nt(e);t.renderbufferStorageMultisample(t.RENDERBUFFER,h,l,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+i,t.RENDERBUFFER,c.__webglColorRenderbuffer[i])}t.bindRenderbuffer(t.RENDERBUFFER,null),e.depthBuffer&&(c.__webglDepthRenderbuffer=t.createRenderbuffer(),et(c.__webglDepthRenderbuffer,e,!0)),i.bindFramebuffer(t.FRAMEBUFFER,null)}}if(u){i.bindTexture(t.TEXTURE_CUBE_MAP,h.__webglTexture),K(t.TEXTURE_CUBE_MAP,l,p);for(let i=0;i<6;i++)tt(c.__webglFramebuffer[i],e,l,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+i);z(l,p)&&G(t.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(d){const r=e.texture;for(let s=0,a=r.length;s<a;s++){const a=r[s],o=n.get(a);i.bindTexture(t.TEXTURE_2D,o.__webglTexture),K(t.TEXTURE_2D,a,p),tt(c.__webglFramebuffer,e,a,t.COLOR_ATTACHMENT0+s,t.TEXTURE_2D),z(a,p)&&G(t.TEXTURE_2D)}i.unbindTexture()}else{let n=t.TEXTURE_2D;(e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(o?n=e.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(n,h.__webglTexture),K(n,l,p),tt(c.__webglFramebuffer,e,l,t.COLOR_ATTACHMENT0,n),z(l,p)&&G(n),i.unbindTexture()}e.depthBuffer&&it(e)},this.updateRenderTargetMipmap=function(e){const r=B(e)||o,s=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let a=0,o=s.length;a<o;a++){const o=s[a];if(z(o,r)){const r=e.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,s=n.get(o).__webglTexture;i.bindTexture(r,s),G(r),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(o&&e.samples>0&&!1===rt(e)){const r=e.isWebGLMultipleRenderTargets?e.texture:[e.texture],s=e.width,a=e.height;let o=t.COLOR_BUFFER_BIT;const l=[],c=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,h=n.get(e),u=!0===e.isWebGLMultipleRenderTargets;if(u)for(let e=0;e<r.length;e++)i.bindFramebuffer(t.FRAMEBUFFER,h.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,null),i.bindFramebuffer(t.FRAMEBUFFER,h.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,null,0);i.bindFramebuffer(t.READ_FRAMEBUFFER,h.__webglMultisampledFramebuffer),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,h.__webglFramebuffer);for(let i=0;i<r.length;i++){l.push(t.COLOR_ATTACHMENT0+i),e.depthBuffer&&l.push(c);const d=void 0!==h.__ignoreDepthValues&&h.__ignoreDepthValues;if(!1===d&&(e.depthBuffer&&(o|=t.DEPTH_BUFFER_BIT),e.stencilBuffer&&(o|=t.STENCIL_BUFFER_BIT)),u&&t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,h.__webglColorRenderbuffer[i]),!0===d&&(t.invalidateFramebuffer(t.READ_FRAMEBUFFER,[c]),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[c])),u){const e=n.get(r[i]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)}t.blitFramebuffer(0,0,s,a,0,0,s,a,o,t.NEAREST),P&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,l)}if(i.bindFramebuffer(t.READ_FRAMEBUFFER,null),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),u)for(let e=0;e<r.length;e++){i.bindFramebuffer(t.FRAMEBUFFER,h.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,h.__webglColorRenderbuffer[e]);const s=n.get(r[e]).__webglTexture;i.bindFramebuffer(t.FRAMEBUFFER,h.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,s,0)}i.bindFramebuffer(t.DRAW_FRAMEBUFFER,h.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=it,this.setupFrameBufferTexture=tt,this.useMultisampledRTT=rt}function ks(t,e,i){const n=i.isWebGL2;return{convert:function(i,r=null){let s;if(i===v)return t.UNSIGNED_BYTE;if(1017===i)return t.UNSIGNED_SHORT_4_4_4_4;if(1018===i)return t.UNSIGNED_SHORT_5_5_5_1;if(1010===i)return t.BYTE;if(1011===i)return t.SHORT;if(i===x)return t.UNSIGNED_SHORT;if(1013===i)return t.INT;if(i===y)return t.UNSIGNED_INT;if(i===M)return t.FLOAT;if(i===b)return n?t.HALF_FLOAT:(s=e.get("OES_texture_half_float"),null!==s?s.HALF_FLOAT_OES:null);if(1021===i)return t.ALPHA;if(i===w)return t.RGBA;if(1024===i)return t.LUMINANCE;if(1025===i)return t.LUMINANCE_ALPHA;if(i===T)return t.DEPTH_COMPONENT;if(i===E)return t.DEPTH_STENCIL;if(1028===i)return t.RED;if(1022===i)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),t.RGBA;if(i===pt)return s=e.get("EXT_sRGB"),null!==s?s.SRGB_ALPHA_EXT:null;if(1029===i)return t.RED_INTEGER;if(1030===i)return t.RG;if(1031===i)return t.RG_INTEGER;if(1033===i)return t.RGBA_INTEGER;if(i===A||i===R||i===C||i===L)if(r===ot){if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===s)return null;if(i===A)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===R)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===C)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===L)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(s=e.get("WEBGL_compressed_texture_s3tc"),null===s)return null;if(i===A)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===R)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===C)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===L)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(i===P||i===I||i===D||i===N){if(s=e.get("WEBGL_compressed_texture_pvrtc"),null===s)return null;if(i===P)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===I)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===D)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===N)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===i)return s=e.get("WEBGL_compressed_texture_etc1"),null!==s?s.COMPRESSED_RGB_ETC1_WEBGL:null;if(i===O||i===F){if(s=e.get("WEBGL_compressed_texture_etc"),null===s)return null;if(i===O)return r===ot?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(i===F)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}if(i===U||i===B||i===z||i===G||i===k||i===H||i===V||i===W||i===X||i===j||i===q||i===Y||i===Z||i===J){if(s=e.get("WEBGL_compressed_texture_astc"),null===s)return null;if(i===U)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===B)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===z)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===G)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===k)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===H)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===V)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===W)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===X)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===j)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===q)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===Y)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===Z)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===J)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}if(i===K){if(s=e.get("EXT_texture_compression_bptc"),null===s)return null;if(i===K)return r===ot?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT}return i===S?n?t.UNSIGNED_INT_24_8:(s=e.get("WEBGL_depth_texture"),null!==s?s.UNSIGNED_INT_24_8_WEBGL:null):void 0!==t[i]?t[i]:null}}}class Hs extends rn{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class Vs extends ni{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Ws={type:"move"};class Xs{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Vs,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Vs,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ee,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ee),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Vs,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ee,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ee),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,i){let n=null,r=null,s=null;const a=this._targetRay,o=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState){if(l&&t.hand){s=!0;for(const n of t.hand.values()){const t=e.getJointPose(n,i);if(void 0===l.joints[n.jointName]){const t=new Vs;t.matrixAutoUpdate=!1,t.visible=!1,l.joints[n.jointName]=t,l.add(t)}const r=l.joints[n.jointName];null!==t&&(r.matrix.fromArray(t.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.jointRadius=t.radius),r.visible=null!==t}const n=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],a=n.position.distanceTo(r.position),o=.02,c=.005;l.inputState.pinching&&a>o+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&a<=o-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==o&&t.gripSpace&&(r=e.getPose(t.gripSpace,i),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1));null!==a&&(n=e.getPose(t.targetRaySpace,i),null===n&&null!==r&&(n=r),null!==n&&(a.matrix.fromArray(n.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),n.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(n.linearVelocity)):a.hasLinearVelocity=!1,n.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(n.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Ws)))}return null!==a&&(a.visible=null!==n),null!==o&&(o.visible=null!==r),null!==l&&(l.visible=null!==s),this}}class js extends Zt{constructor(t,e,i,n,r,s,a,o,l,c){if((c=void 0!==c?c:T)!==T&&c!==E)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===T&&(i=y),void 0===i&&c===E&&(i=S),super(null,n,r,s,a,o,c,i,l),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=void 0!==a?a:d,this.minFilter=void 0!==o?o:d,this.flipY=!1,this.generateMipmaps=!1}}class qs extends ft{constructor(t,e){super();const i=this;let n=null,r=1,s=null,a="local-floor",o=null,l=null,c=null,h=null,u=null,d=null;const p=e.getContextAttributes();let f=null,m=null;const g=[],_=[],x=new rn;x.layers.enable(1),x.viewport=new Jt;const M=new rn;M.layers.enable(2),M.viewport=new Jt;const b=[x,M],A=new Hs;A.layers.enable(1),A.layers.enable(2);let R=null,C=null;function L(t){const e=_.indexOf(t.inputSource);if(-1===e)return;const i=g[e];void 0!==i&&i.dispatchEvent({type:t.type,data:t.inputSource})}function P(){n.removeEventListener("select",L),n.removeEventListener("selectstart",L),n.removeEventListener("selectend",L),n.removeEventListener("squeeze",L),n.removeEventListener("squeezestart",L),n.removeEventListener("squeezeend",L),n.removeEventListener("end",P),n.removeEventListener("inputsourceschange",I);for(let t=0;t<g.length;t++){const e=_[t];null!==e&&(_[t]=null,g[t].disconnect(e))}R=null,C=null,t.setRenderTarget(f),u=null,h=null,c=null,n=null,m=null,U.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function I(t){for(let e=0;e<t.removed.length;e++){const i=t.removed[e],n=_.indexOf(i);n>=0&&(_[n]=null,g[n].dispatchEvent({type:"disconnected",data:i}))}for(let e=0;e<t.added.length;e++){const i=t.added[e];let n=_.indexOf(i);if(-1===n){for(let t=0;t<g.length;t++){if(t>=_.length){_.push(i),n=t;break}if(null===_[t]){_[t]=i,n=t;break}}if(-1===n)break}const r=g[n];r&&r.dispatchEvent({type:"connected",data:i})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=g[t];return void 0===e&&(e=new Xs,g[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=g[t];return void 0===e&&(e=new Xs,g[t]=e),e.getGripSpace()},this.getHand=function(t){let e=g[t];return void 0===e&&(e=new Xs,g[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){r=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){a=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o||s},this.setReferenceSpace=function(t){o=t},this.getBaseLayer=function(){return null!==h?h:u},this.getBinding=function(){return c},this.getFrame=function(){return d},this.getSession=function(){return n},this.setSession=async function(l){if(n=l,null!==n){if(f=t.getRenderTarget(),n.addEventListener("select",L),n.addEventListener("selectstart",L),n.addEventListener("selectend",L),n.addEventListener("squeeze",L),n.addEventListener("squeezestart",L),n.addEventListener("squeezeend",L),n.addEventListener("end",P),n.addEventListener("inputsourceschange",I),!0!==p.xrCompatible&&await e.makeXRCompatible(),void 0===n.renderState.layers||!1===t.capabilities.isWebGL2){const i={antialias:void 0!==n.renderState.layers||p.antialias,alpha:p.alpha,depth:p.depth,stencil:p.stencil,framebufferScaleFactor:r};u=new XRWebGLLayer(n,e,i),n.updateRenderState({baseLayer:u}),m=new Kt(u.framebufferWidth,u.framebufferHeight,{format:w,type:v,encoding:t.outputEncoding})}else{let i=null,s=null,a=null;p.depth&&(a=p.stencil?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT24,i=p.stencil?E:T,s=p.stencil?S:y);const o={colorFormat:e.RGBA8,depthFormat:a,scaleFactor:r};c=new XRWebGLBinding(n,e),h=c.createProjectionLayer(o),n.updateRenderState({layers:[h]}),m=new Kt(h.textureWidth,h.textureHeight,{format:w,type:v,depthTexture:new js(h.textureWidth,h.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,i),stencilBuffer:p.stencil,encoding:t.outputEncoding,samples:p.antialias?4:0});t.properties.get(m).__ignoreDepthValues=h.ignoreDepthValues}m.isXRRenderTarget=!0,this.setFoveation(1),o=null,s=await n.requestReferenceSpace(a),U.setContext(n),U.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};const D=new ee,N=new ee;function O(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===n)return;A.near=M.near=x.near=t.near,A.far=M.far=x.far=t.far,R===A.near&&C===A.far||(n.updateRenderState({depthNear:A.near,depthFar:A.far}),R=A.near,C=A.far);const e=t.parent,i=A.cameras;O(A,e);for(let t=0;t<i.length;t++)O(i[t],e);A.matrixWorld.decompose(A.position,A.quaternion,A.scale),t.position.copy(A.position),t.quaternion.copy(A.quaternion),t.scale.copy(A.scale),t.matrix.copy(A.matrix),t.matrixWorld.copy(A.matrixWorld);const r=t.children;for(let t=0,e=r.length;t<e;t++)r[t].updateMatrixWorld(!0);2===i.length?function(t,e,i){D.setFromMatrixPosition(e.matrixWorld),N.setFromMatrixPosition(i.matrixWorld);const n=D.distanceTo(N),r=e.projectionMatrix.elements,s=i.projectionMatrix.elements,a=r[14]/(r[10]-1),o=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],h=(r[8]-1)/r[0],u=(s[8]+1)/s[0],d=a*h,p=a*u,f=n/(-h+u),m=f*-h;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const g=a+f,_=o+f,v=d-m,x=p+(n-m),y=l*o/_*g,M=c*o/_*g;t.projectionMatrix.makePerspective(v,x,y,M,g,_)}(A,x,M):A.projectionMatrix.copy(x.projectionMatrix)},this.getCamera=function(){return A},this.getFoveation=function(){return null!==h?h.fixedFoveation:null!==u?u.fixedFoveation:void 0},this.setFoveation=function(t){null!==h&&(h.fixedFoveation=t),null!==u&&void 0!==u.fixedFoveation&&(u.fixedFoveation=t)};let F=null;const U=new gn;U.setAnimationLoop((function(e,i){if(l=i.getViewerPose(o||s),d=i,null!==l){const e=l.views;null!==u&&(t.setRenderTargetFramebuffer(m,u.framebuffer),t.setRenderTarget(m));let i=!1;e.length!==A.cameras.length&&(A.cameras.length=0,i=!0);for(let n=0;n<e.length;n++){const r=e[n];let s=null;if(null!==u)s=u.getViewport(r);else{const e=c.getViewSubImage(h,r);s=e.viewport,0===n&&(t.setRenderTargetTextures(m,e.colorTexture,h.ignoreDepthValues?void 0:e.depthStencilTexture),t.setRenderTarget(m))}let a=b[n];void 0===a&&(a=new rn,a.layers.enable(n),a.viewport=new Jt,b[n]=a),a.matrix.fromArray(r.transform.matrix),a.projectionMatrix.fromArray(r.projectionMatrix),a.viewport.set(s.x,s.y,s.width,s.height),0===n&&A.matrix.copy(a.matrix),!0===i&&A.cameras.push(a)}}for(let t=0;t<g.length;t++){const e=_[t],n=g[t];null!==e&&void 0!==n&&n.update(e,i,o||s)}F&&F(e,i),d=null})),this.setAnimationLoop=function(t){F=t},this.dispose=function(){}}}function Ys(t,e){function i(i,n){i.opacity.value=n.opacity,n.color&&i.diffuse.value.copy(n.color),n.emissive&&i.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(i.map.value=n.map),n.alphaMap&&(i.alphaMap.value=n.alphaMap),n.bumpMap&&(i.bumpMap.value=n.bumpMap,i.bumpScale.value=n.bumpScale,1===n.side&&(i.bumpScale.value*=-1)),n.displacementMap&&(i.displacementMap.value=n.displacementMap,i.displacementScale.value=n.displacementScale,i.displacementBias.value=n.displacementBias),n.emissiveMap&&(i.emissiveMap.value=n.emissiveMap),n.normalMap&&(i.normalMap.value=n.normalMap,i.normalScale.value.copy(n.normalScale),1===n.side&&i.normalScale.value.negate()),n.specularMap&&(i.specularMap.value=n.specularMap),n.alphaTest>0&&(i.alphaTest.value=n.alphaTest);const r=e.get(n).envMap;if(r&&(i.envMap.value=r,i.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,i.reflectivity.value=n.reflectivity,i.ior.value=n.ior,i.refractionRatio.value=n.refractionRatio),n.lightMap){i.lightMap.value=n.lightMap;const e=!0!==t.physicallyCorrectLights?Math.PI:1;i.lightMapIntensity.value=n.lightMapIntensity*e}let s,a;n.aoMap&&(i.aoMap.value=n.aoMap,i.aoMapIntensity.value=n.aoMapIntensity),n.map?s=n.map:n.specularMap?s=n.specularMap:n.displacementMap?s=n.displacementMap:n.normalMap?s=n.normalMap:n.bumpMap?s=n.bumpMap:n.roughnessMap?s=n.roughnessMap:n.metalnessMap?s=n.metalnessMap:n.alphaMap?s=n.alphaMap:n.emissiveMap?s=n.emissiveMap:n.clearcoatMap?s=n.clearcoatMap:n.clearcoatNormalMap?s=n.clearcoatNormalMap:n.clearcoatRoughnessMap?s=n.clearcoatRoughnessMap:n.iridescenceMap?s=n.iridescenceMap:n.iridescenceThicknessMap?s=n.iridescenceThicknessMap:n.specularIntensityMap?s=n.specularIntensityMap:n.specularColorMap?s=n.specularColorMap:n.transmissionMap?s=n.transmissionMap:n.thicknessMap?s=n.thicknessMap:n.sheenColorMap?s=n.sheenColorMap:n.sheenRoughnessMap&&(s=n.sheenRoughnessMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),i.uvTransform.value.copy(s.matrix)),n.aoMap?a=n.aoMap:n.lightMap&&(a=n.lightMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),i.uv2Transform.value.copy(a.matrix))}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,n,r,s,a){n.isMeshBasicMaterial||n.isMeshLambertMaterial?i(t,n):n.isMeshToonMaterial?(i(t,n),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(t,n)):n.isMeshPhongMaterial?(i(t,n),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4)}(t,n)):n.isMeshStandardMaterial?(i(t,n),function(t,i){t.roughness.value=i.roughness,t.metalness.value=i.metalness,i.roughnessMap&&(t.roughnessMap.value=i.roughnessMap);i.metalnessMap&&(t.metalnessMap.value=i.metalnessMap);e.get(i).envMap&&(t.envMapIntensity.value=i.envMapIntensity)}(t,n),n.isMeshPhysicalMaterial&&function(t,e,i){t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap));e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,1===e.side&&t.clearcoatNormalScale.value.negate()));e.iridescence>0&&(t.iridescence.value=e.iridescence,t.iridescenceIOR.value=e.iridescenceIOR,t.iridescenceThicknessMinimum.value=e.iridescenceThicknessRange[0],t.iridescenceThicknessMaximum.value=e.iridescenceThicknessRange[1],e.iridescenceMap&&(t.iridescenceMap.value=e.iridescenceMap),e.iridescenceThicknessMap&&(t.iridescenceThicknessMap.value=e.iridescenceThicknessMap));e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=i.texture,t.transmissionSamplerSize.value.set(i.width,i.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor));t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap);e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap)}(t,n,a)):n.isMeshMatcapMaterial?(i(t,n),function(t,e){e.matcap&&(t.matcap.value=e.matcap)}(t,n)):n.isMeshDepthMaterial?i(t,n):n.isMeshDistanceMaterial?(i(t,n),function(t,e){t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,n)):n.isMeshNormalMaterial?i(t,n):n.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,n),n.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,n)):n.isPointsMaterial?function(t,e,i,n){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*i,t.scale.value=.5*n,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);e.alphaTest>0&&(t.alphaTest.value=e.alphaTest);let r;e.map?r=e.map:e.alphaMap&&(r=e.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}(t,n,r,s):n.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);e.alphaTest>0&&(t.alphaTest.value=e.alphaTest);let i;e.map?i=e.map:e.alphaMap&&(i=e.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix))}(t,n):n.isShadowMaterial?(t.color.value.copy(n.color),t.opacity.value=n.opacity):n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)}}}function Zs(t,e,i,n){let r={},s={},a=[];const o=i.isWebGL2?t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(t,e,i){const n=t.value;if(void 0===i[e])return i[e]="number"==typeof n?n:n.clone(),!0;if("number"==typeof n){if(i[e]!==n)return i[e]=n,!0}else{const t=i[e];if(!1===t.equals(n))return t.copy(n),!0}return!1}function c(t){const e=t.value,i={boundary:0,storage:0};return"number"==typeof e?(i.boundary=4,i.storage=4):e.isVector2?(i.boundary=8,i.storage=8):e.isVector3||e.isColor?(i.boundary=16,i.storage=12):e.isVector4?(i.boundary=16,i.storage=16):e.isMatrix3?(i.boundary=48,i.storage=48):e.isMatrix4?(i.boundary=64,i.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),i}function h(e){const i=e.target;i.removeEventListener("dispose",h);const n=a.indexOf(i.__bindingPointIndex);a.splice(n,1),t.deleteBuffer(r[i.id]),delete r[i.id],delete s[i.id]}return{bind:function(t,e){const i=e.program;n.uniformBlockBinding(t,i)},update:function(i,u){let d=r[i.id];void 0===d&&(!function(t){const e=t.uniforms;let i=0;const n=16;let r=0;for(let t=0,s=e.length;t<s;t++){const s=e[t],a=c(s);if(s.__data=new Float32Array(a.storage/Float32Array.BYTES_PER_ELEMENT),s.__offset=i,t>0){r=i%n;const t=n-r;0!==r&&t-a.boundary<0&&(i+=n-r,s.__offset=i)}i+=a.storage}r=i%n,r>0&&(i+=n-r);t.__size=i,t.__cache={}}(i),d=function(e){const i=function(){for(let t=0;t<o;t++)if(-1===a.indexOf(t))return a.push(t),t;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();e.__bindingPointIndex=i;const n=t.createBuffer(),r=e.__size,s=e.usage;return t.bindBuffer(t.UNIFORM_BUFFER,n),t.bufferData(t.UNIFORM_BUFFER,r,s),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,i,n),n}(i),r[i.id]=d,i.addEventListener("dispose",h));const p=u.program;n.updateUBOMapping(i,p);const f=e.render.frame;s[i.id]!==f&&(!function(e){const i=r[e.id],n=e.uniforms,s=e.__cache;t.bindBuffer(t.UNIFORM_BUFFER,i);for(let e=0,i=n.length;e<i;e++){const i=n[e];if(!0===l(i,e,s)){const e=i.value,n=i.__offset;"number"==typeof e?(i.__data[0]=e,t.bufferSubData(t.UNIFORM_BUFFER,n,i.__data)):(i.value.isMatrix3?(i.__data[0]=i.value.elements[0],i.__data[1]=i.value.elements[1],i.__data[2]=i.value.elements[2],i.__data[3]=i.value.elements[0],i.__data[4]=i.value.elements[3],i.__data[5]=i.value.elements[4],i.__data[6]=i.value.elements[5],i.__data[7]=i.value.elements[0],i.__data[8]=i.value.elements[6],i.__data[9]=i.value.elements[7],i.__data[10]=i.value.elements[8],i.__data[11]=i.value.elements[0]):e.toArray(i.__data),t.bufferSubData(t.UNIFORM_BUFFER,n,i.__data))}}t.bindBuffer(t.UNIFORM_BUFFER,null)}(i),s[i.id]=f)},dispose:function(){for(const e in r)t.deleteBuffer(r[e]);a=[],r={},s={}}}}function Js(t={}){this.isWebGLRenderer=!0;const e=void 0!==t.canvas?t.canvas:function(){const t=It("canvas");return t.style.display="block",t}(),i=void 0!==t.context?t.context:null,n=void 0===t.depth||t.depth,r=void 0===t.stencil||t.stencil,s=void 0!==t.antialias&&t.antialias,a=void 0===t.premultipliedAlpha||t.premultipliedAlpha,o=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,l=void 0!==t.powerPreference?t.powerPreference:"default",c=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let h;h=null!==i?i.getContextAttributes().alpha:void 0!==t.alpha&&t.alpha;let u=null,d=null;const p=[],f=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=at,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1,Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});const m=this;let g=!1,x=0,y=0,S=null,T=-1,E=null;const A=new Jt,R=new Jt;let C=null,L=e.width,P=e.height,I=1,D=null,N=null;const O=new Jt(0,0,L,P),F=new Jt(0,0,L,P);let U=!1;const B=new mn;let z=!1,G=!1,k=null;const H=new Ie,V=new At,W=new ee,X={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function j(){return null===S?I:1}let q,Y,Z,J,K,Q,$,tt,et,it,nt,rt,st,ot,lt,ct,ht,ut,dt,pt,ft,mt,gt,_t,vt=i;function xt(t,i){for(let n=0;n<t.length;n++){const r=t[n],s=e.getContext(r,i);if(null!==s)return s}return null}try{const t={alpha:!0,depth:n,stencil:r,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:o,powerPreference:l,failIfMajorPerformanceCaveat:c};if("setAttribute"in e&&e.setAttribute("data-engine","three.js r143"),e.addEventListener("webglcontextlost",bt,!1),e.addEventListener("webglcontextrestored",St,!1),e.addEventListener("webglcontextcreationerror",wt,!1),null===vt){const e=["webgl2","webgl","experimental-webgl"];if(!0===m.isWebGL1Renderer&&e.shift(),vt=xt(e,t),null===vt)throw xt(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===vt.getShaderPrecisionFormat&&(vt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function yt(){q=new Wn(vt),Y=new Tn(vt,q,t),q.init(Y),mt=new ks(vt,q,Y),Z=new zs(vt,q,Y),J=new qn(vt),K=new Ts,Q=new Gs(vt,q,Z,K,Y,mt,J),$=new An(m),tt=new Vn(m),et=new _n(vt,Y),gt=new Sn(vt,q,et,Y),it=new Xn(vt,et,J,gt),nt=new Qn(vt,it,et,J),dt=new Kn(vt,Y,Q),ct=new En(K),rt=new ws(m,$,tt,q,Y,gt,ct),st=new Ys(m,K),ot=new Cs,lt=new Os(q,Y),ut=new bn(m,$,Z,nt,h,a),ht=new Bs(m,nt,Y),_t=new Zs(vt,J,Y,Z),pt=new wn(vt,q,J,Y),ft=new jn(vt,q,J,Y),J.programs=rt.programs,m.capabilities=Y,m.extensions=q,m.properties=K,m.renderLists=ot,m.shadowMap=ht,m.state=Z,m.info=J}yt();const Mt=new qs(m,vt);function bt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function St(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;const t=J.autoReset,e=ht.enabled,i=ht.autoUpdate,n=ht.needsUpdate,r=ht.type;yt(),J.autoReset=t,ht.enabled=e,ht.autoUpdate=i,ht.needsUpdate=n,ht.type=r}function wt(t){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",t.statusMessage)}function Et(t){const e=t.target;e.removeEventListener("dispose",Et),function(t){(function(t){const e=K.get(t).programs;void 0!==e&&(e.forEach((function(t){rt.releaseProgram(t)})),t.isShaderMaterial&&rt.releaseShaderCache(t))})(t),K.remove(t)}(e)}this.xr=Mt,this.getContext=function(){return vt},this.getContextAttributes=function(){return vt.getContextAttributes()},this.forceContextLoss=function(){const t=q.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=q.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return I},this.setPixelRatio=function(t){void 0!==t&&(I=t,this.setSize(L,P,!1))},this.getSize=function(t){return t.set(L,P)},this.setSize=function(t,i,n){Mt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(L=t,P=i,e.width=Math.floor(t*I),e.height=Math.floor(i*I),!1!==n&&(e.style.width=t+"px",e.style.height=i+"px"),this.setViewport(0,0,t,i))},this.getDrawingBufferSize=function(t){return t.set(L*I,P*I).floor()},this.setDrawingBufferSize=function(t,i,n){L=t,P=i,I=n,e.width=Math.floor(t*n),e.height=Math.floor(i*n),this.setViewport(0,0,t,i)},this.getCurrentViewport=function(t){return t.copy(A)},this.getViewport=function(t){return t.copy(O)},this.setViewport=function(t,e,i,n){t.isVector4?O.set(t.x,t.y,t.z,t.w):O.set(t,e,i,n),Z.viewport(A.copy(O).multiplyScalar(I).floor())},this.getScissor=function(t){return t.copy(F)},this.setScissor=function(t,e,i,n){t.isVector4?F.set(t.x,t.y,t.z,t.w):F.set(t,e,i,n),Z.scissor(R.copy(F).multiplyScalar(I).floor())},this.getScissorTest=function(){return U},this.setScissorTest=function(t){Z.setScissorTest(U=t)},this.setOpaqueSort=function(t){D=t},this.setTransparentSort=function(t){N=t},this.getClearColor=function(t){return t.copy(ut.getClearColor())},this.setClearColor=function(){ut.setClearColor.apply(ut,arguments)},this.getClearAlpha=function(){return ut.getClearAlpha()},this.setClearAlpha=function(){ut.setClearAlpha.apply(ut,arguments)},this.clear=function(t=!0,e=!0,i=!0){let n=0;t&&(n|=vt.COLOR_BUFFER_BIT),e&&(n|=vt.DEPTH_BUFFER_BIT),i&&(n|=vt.STENCIL_BUFFER_BIT),vt.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",bt,!1),e.removeEventListener("webglcontextrestored",St,!1),e.removeEventListener("webglcontextcreationerror",wt,!1),ot.dispose(),lt.dispose(),K.dispose(),$.dispose(),tt.dispose(),nt.dispose(),gt.dispose(),_t.dispose(),rt.dispose(),Mt.dispose(),Mt.removeEventListener("sessionstart",Ct),Mt.removeEventListener("sessionend",Lt),k&&(k.dispose(),k=null),Pt.stop()},this.renderBufferDirect=function(t,e,i,n,r,s){null===e&&(e=X);const a=r.isMesh&&r.matrixWorld.determinant()<0,o=function(t,e,i,n,r){!0!==e.isScene&&(e=X);Q.resetTextureUnits();const s=e.fog,a=n.isMeshStandardMaterial?e.environment:null,o=null===S?m.outputEncoding:!0===S.isXRRenderTarget?S.texture.encoding:at,l=(n.isMeshStandardMaterial?tt:$).get(n.envMap||a),c=!0===n.vertexColors&&!!i.attributes.color&&4===i.attributes.color.itemSize,h=!!n.normalMap&&!!i.attributes.tangent,u=!!i.morphAttributes.position,p=!!i.morphAttributes.normal,f=!!i.morphAttributes.color,g=n.toneMapped?m.toneMapping:0,_=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,v=void 0!==_?_.length:0,x=K.get(n),y=d.state.lights;if(!0===z&&(!0===G||t!==E)){const e=t===E&&n.id===T;ct.setState(n,t,e)}let M=!1;n.version===x.__version?x.needsLights&&x.lightsStateVersion!==y.state.version||x.outputEncoding!==o||r.isInstancedMesh&&!1===x.instancing?M=!0:r.isInstancedMesh||!0!==x.instancing?r.isSkinnedMesh&&!1===x.skinning?M=!0:r.isSkinnedMesh||!0!==x.skinning?x.envMap!==l||!0===n.fog&&x.fog!==s?M=!0:void 0===x.numClippingPlanes||x.numClippingPlanes===ct.numPlanes&&x.numIntersection===ct.numIntersection?(x.vertexAlphas!==c||x.vertexTangents!==h||x.morphTargets!==u||x.morphNormals!==p||x.morphColors!==f||x.toneMapping!==g||!0===Y.isWebGL2&&x.morphTargetsCount!==v)&&(M=!0):M=!0:M=!0:M=!0:(M=!0,x.__version=n.version);let b=x.currentProgram;!0===M&&(b=Ut(n,e,r));let w=!1,A=!1,R=!1;const C=b.getUniforms(),L=x.uniforms;Z.useProgram(b.program)&&(w=!0,A=!0,R=!0);n.id!==T&&(T=n.id,A=!0);if(w||E!==t){if(C.setValue(vt,"projectionMatrix",t.projectionMatrix),Y.logarithmicDepthBuffer&&C.setValue(vt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),E!==t&&(E=t,A=!0,R=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const e=C.map.cameraPosition;void 0!==e&&e.setValue(vt,W.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&C.setValue(vt,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||r.isSkinnedMesh)&&C.setValue(vt,"viewMatrix",t.matrixWorldInverse)}if(r.isSkinnedMesh){C.setOptional(vt,r,"bindMatrix"),C.setOptional(vt,r,"bindMatrixInverse");const t=r.skeleton;t&&(Y.floatVertexTextures?(null===t.boneTexture&&t.computeBoneTexture(),C.setValue(vt,"boneTexture",t.boneTexture,Q),C.setValue(vt,"boneTextureSize",t.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const D=i.morphAttributes;(void 0!==D.position||void 0!==D.normal||void 0!==D.color&&!0===Y.isWebGL2)&&dt.update(r,i,n,b);(A||x.receiveShadow!==r.receiveShadow)&&(x.receiveShadow=r.receiveShadow,C.setValue(vt,"receiveShadow",r.receiveShadow));A&&(C.setValue(vt,"toneMappingExposure",m.toneMappingExposure),x.needsLights&&(O=R,(N=L).ambientLightColor.needsUpdate=O,N.lightProbe.needsUpdate=O,N.directionalLights.needsUpdate=O,N.directionalLightShadows.needsUpdate=O,N.pointLights.needsUpdate=O,N.pointLightShadows.needsUpdate=O,N.spotLights.needsUpdate=O,N.spotLightShadows.needsUpdate=O,N.rectAreaLights.needsUpdate=O,N.hemisphereLights.needsUpdate=O),s&&!0===n.fog&&st.refreshFogUniforms(L,s),st.refreshMaterialUniforms(L,n,I,P,k),is.upload(vt,x.uniformsList,L,Q));var N,O;n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(is.upload(vt,x.uniformsList,L,Q),n.uniformsNeedUpdate=!1);n.isSpriteMaterial&&C.setValue(vt,"center",r.center);if(C.setValue(vt,"modelViewMatrix",r.modelViewMatrix),C.setValue(vt,"normalMatrix",r.normalMatrix),C.setValue(vt,"modelMatrix",r.matrixWorld),n.isShaderMaterial||n.isRawShaderMaterial){const t=n.uniformsGroups;for(let e=0,i=t.length;e<i;e++)if(Y.isWebGL2){const i=t[e];_t.update(i,b),_t.bind(i,b)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return b}(t,e,i,n,r);Z.setMaterial(n,a);let l=i.index;const c=i.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let h,u=1;!0===n.wireframe&&(l=it.getWireframeAttribute(i),u=2),gt.setup(r,n,o,i,l);let p=pt;null!==l&&(h=et.get(l),p=ft,p.setIndex(h));const f=null!==l?l.count:c.count,g=i.drawRange.start*u,_=i.drawRange.count*u,v=null!==s?s.start*u:0,x=null!==s?s.count*u:1/0,y=Math.max(g,v),M=Math.min(f,g+_,v+x)-1,b=Math.max(0,M-y+1);if(0!==b){if(r.isMesh)!0===n.wireframe?(Z.setLineWidth(n.wireframeLinewidth*j()),p.setMode(vt.LINES)):p.setMode(vt.TRIANGLES);else if(r.isLine){let t=n.linewidth;void 0===t&&(t=1),Z.setLineWidth(t*j()),r.isLineSegments?p.setMode(vt.LINES):r.isLineLoop?p.setMode(vt.LINE_LOOP):p.setMode(vt.LINE_STRIP)}else r.isPoints?p.setMode(vt.POINTS):r.isSprite&&p.setMode(vt.TRIANGLES);if(r.isInstancedMesh)p.renderInstances(y,b,r.count);else if(i.isInstancedBufferGeometry){const t=Math.min(i.instanceCount,i._maxInstanceCount);p.renderInstances(y,b,t)}else p.render(y,b)}},this.compile=function(t,e){d=lt.get(t),d.init(),f.push(d),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(d.pushLight(t),t.castShadow&&d.pushShadow(t))})),d.setupLights(m.physicallyCorrectLights),t.traverse((function(e){const i=e.material;if(i)if(Array.isArray(i))for(let n=0;n<i.length;n++){Ut(i[n],t,e)}else Ut(i,t,e)})),f.pop(),d=null};let Rt=null;function Ct(){Pt.stop()}function Lt(){Pt.start()}const Pt=new gn;function Dt(t,e,i,n){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)i=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)d.pushLight(t),t.castShadow&&d.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||B.intersectsSprite(t)){n&&W.setFromMatrixPosition(t.matrixWorld).applyMatrix4(H);const e=nt.update(t),r=t.material;r.visible&&u.push(t,e,r,i,W.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==J.render.frame&&(t.skeleton.update(),t.skeleton.frame=J.render.frame),!t.frustumCulled||B.intersectsObject(t))){n&&W.setFromMatrixPosition(t.matrixWorld).applyMatrix4(H);const e=nt.update(t),r=t.material;if(Array.isArray(r)){const n=e.groups;for(let s=0,a=n.length;s<a;s++){const a=n[s],o=r[a.materialIndex];o&&o.visible&&u.push(t,e,o,i,W.z,a)}}else r.visible&&u.push(t,e,r,i,W.z,null)}const r=t.children;for(let t=0,s=r.length;t<s;t++)Dt(r[t],e,i,n)}function Nt(t,e,i,n){const r=t.opaque,a=t.transmissive,o=t.transparent;d.setupLightsView(i),a.length>0&&function(t,e,i){const n=Y.isWebGL2;null===k&&(k=new Kt(1,1,{generateMipmaps:!0,type:q.has("EXT_color_buffer_half_float")?b:v,minFilter:_,samples:n&&!0===s?4:0}));m.getDrawingBufferSize(V),n?k.setSize(V.x,V.y):k.setSize(Tt(V.x),Tt(V.y));const r=m.getRenderTarget();m.setRenderTarget(k),m.clear();const a=m.toneMapping;m.toneMapping=0,Ot(t,e,i),m.toneMapping=a,Q.updateMultisampleRenderTarget(k),Q.updateRenderTargetMipmap(k),m.setRenderTarget(r)}(r,e,i),n&&Z.viewport(A.copy(n)),r.length>0&&Ot(r,e,i),a.length>0&&Ot(a,e,i),o.length>0&&Ot(o,e,i),Z.buffers.depth.setTest(!0),Z.buffers.depth.setMask(!0),Z.buffers.color.setMask(!0),Z.setPolygonOffset(!1)}function Ot(t,e,i){const n=!0===e.isScene?e.overrideMaterial:null;for(let r=0,s=t.length;r<s;r++){const s=t[r],a=s.object,o=s.geometry,l=null===n?s.material:n,c=s.group;a.layers.test(i.layers)&&Ft(a,e,i,o,l,c)}}function Ft(t,e,i,n,r,s){t.onBeforeRender(m,e,i,n,r,s),t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),r.onBeforeRender(m,e,i,n,t,s),!0===r.transparent&&2===r.side?(r.side=1,r.needsUpdate=!0,m.renderBufferDirect(i,e,n,r,t,s),r.side=0,r.needsUpdate=!0,m.renderBufferDirect(i,e,n,r,t,s),r.side=2):m.renderBufferDirect(i,e,n,r,t,s),t.onAfterRender(m,e,i,n,r,s)}function Ut(t,e,i){!0!==e.isScene&&(e=X);const n=K.get(t),r=d.state.lights,s=d.state.shadowsArray,a=r.state.version,o=rt.getParameters(t,r.state,s,e,i),l=rt.getProgramCacheKey(o);let c=n.programs;n.environment=t.isMeshStandardMaterial?e.environment:null,n.fog=e.fog,n.envMap=(t.isMeshStandardMaterial?tt:$).get(t.envMap||n.environment),void 0===c&&(t.addEventListener("dispose",Et),c=new Map,n.programs=c);let h=c.get(l);if(void 0!==h){if(n.currentProgram===h&&n.lightsStateVersion===a)return Bt(t,o),h}else o.uniforms=rt.getUniforms(t),t.onBuild(i,o,m),t.onBeforeCompile(o,m),h=rt.acquireProgram(o,l),c.set(l,h),n.uniforms=o.uniforms;const u=n.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(u.clippingPlanes=ct.uniform),Bt(t,o),n.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),n.lightsStateVersion=a,n.needsLights&&(u.ambientLightColor.value=r.state.ambient,u.lightProbe.value=r.state.probe,u.directionalLights.value=r.state.directional,u.directionalLightShadows.value=r.state.directionalShadow,u.spotLights.value=r.state.spot,u.spotLightShadows.value=r.state.spotShadow,u.rectAreaLights.value=r.state.rectArea,u.ltc_1.value=r.state.rectAreaLTC1,u.ltc_2.value=r.state.rectAreaLTC2,u.pointLights.value=r.state.point,u.pointLightShadows.value=r.state.pointShadow,u.hemisphereLights.value=r.state.hemi,u.directionalShadowMap.value=r.state.directionalShadowMap,u.directionalShadowMatrix.value=r.state.directionalShadowMatrix,u.spotShadowMap.value=r.state.spotShadowMap,u.spotShadowMatrix.value=r.state.spotShadowMatrix,u.pointShadowMap.value=r.state.pointShadowMap,u.pointShadowMatrix.value=r.state.pointShadowMatrix);const p=h.getUniforms(),f=is.seqWithValue(p.seq,u);return n.currentProgram=h,n.uniformsList=f,h}function Bt(t,e){const i=K.get(t);i.outputEncoding=e.outputEncoding,i.instancing=e.instancing,i.skinning=e.skinning,i.morphTargets=e.morphTargets,i.morphNormals=e.morphNormals,i.morphColors=e.morphColors,i.morphTargetsCount=e.morphTargetsCount,i.numClippingPlanes=e.numClippingPlanes,i.numIntersection=e.numClipIntersection,i.vertexAlphas=e.vertexAlphas,i.vertexTangents=e.vertexTangents,i.toneMapping=e.toneMapping}Pt.setAnimationLoop((function(t){Rt&&Rt(t)})),"undefined"!=typeof self&&Pt.setContext(self),this.setAnimationLoop=function(t){Rt=t,Mt.setAnimationLoop(t),null===t?Pt.stop():Pt.start()},Mt.addEventListener("sessionstart",Ct),Mt.addEventListener("sessionend",Lt),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===g)return;!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===Mt.enabled&&!0===Mt.isPresenting&&(!0===Mt.cameraAutoUpdate&&Mt.updateCamera(e),e=Mt.getCamera()),!0===t.isScene&&t.onBeforeRender(m,t,e,S),d=lt.get(t,f.length),d.init(),f.push(d),H.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),B.setFromProjectionMatrix(H),G=this.localClippingEnabled,z=ct.init(this.clippingPlanes,G,e),u=ot.get(t,p.length),u.init(),p.push(u),Dt(t,e,0,m.sortObjects),u.finish(),!0===m.sortObjects&&u.sort(D,N),!0===z&&ct.beginShadows();const i=d.state.shadowsArray;if(ht.render(i,t,e),!0===z&&ct.endShadows(),!0===this.info.autoReset&&this.info.reset(),ut.render(u,t),d.setupLights(m.physicallyCorrectLights),e.isArrayCamera){const i=e.cameras;for(let e=0,n=i.length;e<n;e++){const n=i[e];Nt(u,t,n,n.viewport)}}else Nt(u,t,e);null!==S&&(Q.updateMultisampleRenderTarget(S),Q.updateRenderTargetMipmap(S)),!0===t.isScene&&t.onAfterRender(m,t,e),gt.resetDefaultState(),T=-1,E=null,f.pop(),d=f.length>0?f[f.length-1]:null,p.pop(),u=p.length>0?p[p.length-1]:null},this.getActiveCubeFace=function(){return x},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return S},this.setRenderTargetTextures=function(t,e,i){K.get(t.texture).__webglTexture=e,K.get(t.depthTexture).__webglTexture=i;const n=K.get(t);n.__hasExternalTextures=!0,n.__hasExternalTextures&&(n.__autoAllocateDepthBuffer=void 0===i,n.__autoAllocateDepthBuffer||!0===q.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),n.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(t,e){const i=K.get(t);i.__webglFramebuffer=e,i.__useDefaultFramebuffer=void 0===e},this.setRenderTarget=function(t,e=0,i=0){S=t,x=e,y=i;let n=!0;if(t){const e=K.get(t);void 0!==e.__useDefaultFramebuffer?(Z.bindFramebuffer(vt.FRAMEBUFFER,null),n=!1):void 0===e.__webglFramebuffer?Q.setupRenderTarget(t):e.__hasExternalTextures&&Q.rebindTextures(t,K.get(t.texture).__webglTexture,K.get(t.depthTexture).__webglTexture)}let r=null,s=!1,a=!1;if(t){const i=t.texture;(i.isData3DTexture||i.isDataArrayTexture)&&(a=!0);const n=K.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=n[e],s=!0):r=Y.isWebGL2&&t.samples>0&&!1===Q.useMultisampledRTT(t)?K.get(t).__webglMultisampledFramebuffer:n,A.copy(t.viewport),R.copy(t.scissor),C=t.scissorTest}else A.copy(O).multiplyScalar(I).floor(),R.copy(F).multiplyScalar(I).floor(),C=U;if(Z.bindFramebuffer(vt.FRAMEBUFFER,r)&&Y.drawBuffers&&n&&Z.drawBuffers(t,r),Z.viewport(A),Z.scissor(R),Z.setScissorTest(C),s){const n=K.get(t.texture);vt.framebufferTexture2D(vt.FRAMEBUFFER,vt.COLOR_ATTACHMENT0,vt.TEXTURE_CUBE_MAP_POSITIVE_X+e,n.__webglTexture,i)}else if(a){const n=K.get(t.texture),r=e||0;vt.framebufferTextureLayer(vt.FRAMEBUFFER,vt.COLOR_ATTACHMENT0,n.__webglTexture,i||0,r)}T=-1},this.readRenderTargetPixels=function(t,e,i,n,r,s,a){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=K.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){Z.bindFramebuffer(vt.FRAMEBUFFER,o);try{const a=t.texture,o=a.format,l=a.type;if(o!==w&&mt.convert(o)!==vt.getParameter(vt.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===b&&(q.has("EXT_color_buffer_half_float")||Y.isWebGL2&&q.has("EXT_color_buffer_float"));if(!(l===v||mt.convert(l)===vt.getParameter(vt.IMPLEMENTATION_COLOR_READ_TYPE)||l===M&&(Y.isWebGL2||q.has("OES_texture_float")||q.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");e>=0&&e<=t.width-n&&i>=0&&i<=t.height-r&&vt.readPixels(e,i,n,r,mt.convert(o),mt.convert(l),s)}finally{const t=null!==S?K.get(S).__webglFramebuffer:null;Z.bindFramebuffer(vt.FRAMEBUFFER,t)}}},this.copyFramebufferToTexture=function(t,e,i=0){const n=Math.pow(2,-i),r=Math.floor(e.image.width*n),s=Math.floor(e.image.height*n);Q.setTexture2D(e,0),vt.copyTexSubImage2D(vt.TEXTURE_2D,i,0,0,t.x,t.y,r,s),Z.unbindTexture()},this.copyTextureToTexture=function(t,e,i,n=0){const r=e.image.width,s=e.image.height,a=mt.convert(i.format),o=mt.convert(i.type);Q.setTexture2D(i,0),vt.pixelStorei(vt.UNPACK_FLIP_Y_WEBGL,i.flipY),vt.pixelStorei(vt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),vt.pixelStorei(vt.UNPACK_ALIGNMENT,i.unpackAlignment),e.isDataTexture?vt.texSubImage2D(vt.TEXTURE_2D,n,t.x,t.y,r,s,a,o,e.image.data):e.isCompressedTexture?vt.compressedTexSubImage2D(vt.TEXTURE_2D,n,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,a,e.mipmaps[0].data):vt.texSubImage2D(vt.TEXTURE_2D,n,t.x,t.y,a,o,e.image),0===n&&i.generateMipmaps&&vt.generateMipmap(vt.TEXTURE_2D),Z.unbindTexture()},this.copyTextureToTexture3D=function(t,e,i,n,r=0){if(m.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const s=t.max.x-t.min.x+1,a=t.max.y-t.min.y+1,o=t.max.z-t.min.z+1,l=mt.convert(n.format),c=mt.convert(n.type);let h;if(n.isData3DTexture)Q.setTexture3D(n,0),h=vt.TEXTURE_3D;else{if(!n.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Q.setTexture2DArray(n,0),h=vt.TEXTURE_2D_ARRAY}vt.pixelStorei(vt.UNPACK_FLIP_Y_WEBGL,n.flipY),vt.pixelStorei(vt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),vt.pixelStorei(vt.UNPACK_ALIGNMENT,n.unpackAlignment);const u=vt.getParameter(vt.UNPACK_ROW_LENGTH),d=vt.getParameter(vt.UNPACK_IMAGE_HEIGHT),p=vt.getParameter(vt.UNPACK_SKIP_PIXELS),f=vt.getParameter(vt.UNPACK_SKIP_ROWS),g=vt.getParameter(vt.UNPACK_SKIP_IMAGES),_=i.isCompressedTexture?i.mipmaps[0]:i.image;vt.pixelStorei(vt.UNPACK_ROW_LENGTH,_.width),vt.pixelStorei(vt.UNPACK_IMAGE_HEIGHT,_.height),vt.pixelStorei(vt.UNPACK_SKIP_PIXELS,t.min.x),vt.pixelStorei(vt.UNPACK_SKIP_ROWS,t.min.y),vt.pixelStorei(vt.UNPACK_SKIP_IMAGES,t.min.z),i.isDataTexture||i.isData3DTexture?vt.texSubImage3D(h,r,e.x,e.y,e.z,s,a,o,l,c,_.data):i.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),vt.compressedTexSubImage3D(h,r,e.x,e.y,e.z,s,a,o,l,_.data)):vt.texSubImage3D(h,r,e.x,e.y,e.z,s,a,o,l,c,_),vt.pixelStorei(vt.UNPACK_ROW_LENGTH,u),vt.pixelStorei(vt.UNPACK_IMAGE_HEIGHT,d),vt.pixelStorei(vt.UNPACK_SKIP_PIXELS,p),vt.pixelStorei(vt.UNPACK_SKIP_ROWS,f),vt.pixelStorei(vt.UNPACK_SKIP_IMAGES,g),0===r&&n.generateMipmaps&&vt.generateMipmap(h),Z.unbindTexture()},this.initTexture=function(t){t.isCubeTexture?Q.setTextureCube(t,0):t.isData3DTexture?Q.setTexture3D(t,0):t.isDataArrayTexture?Q.setTexture2DArray(t,0):Q.setTexture2D(t,0),Z.unbindTexture()},this.resetState=function(){x=0,y=0,S=null,Z.reset(),gt.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class Ks extends Js{}Ks.prototype.isWebGL1Renderer=!0;class Qs{constructor(t,e=25e-5){this.isFogExp2=!0,this.name="",this.color=new Vt(t),this.density=e}clone(){return new Qs(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class $s{constructor(t,e=1,i=1e3){this.isFog=!0,this.name="",this.color=new Vt(t),this.near=e,this.far=i}clone(){return new $s(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class ta extends ni{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}class ea{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=ut,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=xt()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let n=0,r=this.stride;n<r;n++)this.array[t+n]=e.array[i+n];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=xt()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=xt()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const ia=new ee;class na{constructor(t,e,i,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=!0===n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)ia.fromBufferAttribute(this,e),ia.applyMatrix4(t),this.setXYZ(e,ia.x,ia.y,ia.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)ia.fromBufferAttribute(this,e),ia.applyNormalMatrix(t),this.setXYZ(e,ia.x,ia.y,ia.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)ia.fromBufferAttribute(this,e),ia.transformDirection(t),this.setXYZ(e,ia.x,ia.y,ia.z);return this}setX(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){return this.data.array[t*this.data.stride+this.offset]}getY(t){return this.data.array[t*this.data.stride+this.offset+1]}getZ(t){return this.data.array[t*this.data.stride+this.offset+2]}getW(t){return this.data.array[t*this.data.stride+this.offset+3]}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this}setXYZW(t,e,i,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this.data.array[t+3]=r,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return new yi(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new na(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class ra extends gi{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Vt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let sa;const aa=new ee,oa=new ee,la=new ee,ca=new At,ha=new At,ua=new Ie,da=new ee,pa=new ee,fa=new ee,ma=new At,ga=new At,_a=new At;class va extends ni{constructor(t){if(super(),this.isSprite=!0,this.type="Sprite",void 0===sa){sa=new Pi;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new ea(t,5);sa.setIndex([0,1,2,0,2,3]),sa.setAttribute("position",new na(e,3,0,!1)),sa.setAttribute("uv",new na(e,2,3,!1))}this.geometry=sa,this.material=void 0!==t?t:new ra,this.center=new At(.5,.5)}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),oa.setFromMatrixScale(this.matrixWorld),ua.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),la.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&oa.multiplyScalar(-la.z);const i=this.material.rotation;let n,r;0!==i&&(r=Math.cos(i),n=Math.sin(i));const s=this.center;xa(da.set(-.5,-.5,0),la,s,oa,n,r),xa(pa.set(.5,-.5,0),la,s,oa,n,r),xa(fa.set(.5,.5,0),la,s,oa,n,r),ma.set(0,0),ga.set(1,0),_a.set(1,1);let a=t.ray.intersectTriangle(da,pa,fa,!1,aa);if(null===a&&(xa(pa.set(-.5,.5,0),la,s,oa,n,r),ga.set(0,1),a=t.ray.intersectTriangle(da,fa,pa,!1,aa),null===a))return;const o=t.ray.origin.distanceTo(aa);o<t.near||o>t.far||e.push({distance:o,point:aa.clone(),uv:fi.getUV(aa,da,pa,fa,ma,ga,_a,new At),face:null,object:this})}copy(t,e){return super.copy(t,e),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}function xa(t,e,i,n,r,s){ca.subVectors(t,i).addScalar(.5).multiply(n),void 0!==r?(ha.x=s*ca.x-r*ca.y,ha.y=r*ca.x+s*ca.y):ha.copy(ca),t.copy(e),t.x+=ha.x,t.y+=ha.y,t.applyMatrix4(ua)}const ya=new ee,Ma=new ee;class ba extends ni{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const e=t.levels;for(let t=0,i=e.length;t<i;t++){const i=e[t];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,e=0){e=Math.abs(e);const i=this.levels;let n;for(n=0;n<i.length&&!(e<i[n].distance);n++);return i.splice(n,0,{distance:e,object:t}),this.add(t),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const e=this.levels;if(e.length>0){let i,n;for(i=1,n=e.length;i<n&&!(t<e[i].distance);i++);return e[i-1].object}return null}raycast(t,e){if(this.levels.length>0){ya.setFromMatrixPosition(this.matrixWorld);const i=t.ray.origin.distanceTo(ya);this.getObjectForDistance(i).raycast(t,e)}}update(t){const e=this.levels;if(e.length>1){ya.setFromMatrixPosition(t.matrixWorld),Ma.setFromMatrixPosition(this.matrixWorld);const i=ya.distanceTo(Ma)/t.zoom;let n,r;for(e[0].object.visible=!0,n=1,r=e.length;n<r&&i>=e[n].distance;n++)e[n-1].object.visible=!1,e[n].object.visible=!0;for(this._currentLevel=n-1;n<r;n++)e[n].object.visible=!1}}toJSON(t){const e=super.toJSON(t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const i=this.levels;for(let t=0,n=i.length;t<n;t++){const n=i[t];e.object.levels.push({object:n.object.uuid,distance:n.distance})}return e}}const Sa=new ee,wa=new Jt,Ta=new Jt,Ea=new ee,Aa=new Ie;class Ra extends Zi{constructor(t,e){super(t,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Ie,this.bindMatrixInverse=new Ie}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Jt,e=this.geometry.attributes.skinWeight;for(let i=0,n=e.count;i<n;i++){t.fromBufferAttribute(e,i);const n=1/t.manhattanLength();n!==1/0?t.multiplyScalar(n):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(t,e){const i=this.skeleton,n=this.geometry;wa.fromBufferAttribute(n.attributes.skinIndex,t),Ta.fromBufferAttribute(n.attributes.skinWeight,t),Sa.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const n=Ta.getComponent(t);if(0!==n){const r=wa.getComponent(t);Aa.multiplyMatrices(i.bones[r].matrixWorld,i.boneInverses[r]),e.addScaledVector(Ea.copy(Sa).applyMatrix4(Aa),n)}}return e.applyMatrix4(this.bindMatrixInverse)}}class Ca extends ni{constructor(){super(),this.isBone=!0,this.type="Bone"}}class La extends Zt{constructor(t=null,e=1,i=1,n,r,s,a,o,l=1003,c=1003,h,u){super(null,s,a,o,l,c,n,r,h,u),this.isDataTexture=!0,this.image={data:t,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Pa=new Ie,Ia=new Ie;class Da{constructor(t=[],e=[]){this.uuid=xt(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new Ie)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new Ie;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let n=0,r=t.length;n<r;n++){const r=t[n]?t[n].matrixWorld:Ia;Pa.multiplyMatrices(r,e[n]),Pa.toArray(i,16*n)}null!==n&&(n.needsUpdate=!0)}clone(){return new Da(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=wt(t),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const i=new La(e,t,t,w,M);return i.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=i,this.boneTextureSize=t,this}getBoneByName(t){for(let e=0,i=this.bones.length;e<i;e++){const i=this.bones[e];if(i.name===t)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let i=0,n=t.bones.length;i<n;i++){const n=t.bones[i];let r=e[n];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),r=new Ca),this.bones.push(r),this.boneInverses.push((new Ie).fromArray(t.boneInverses[i]))}return this.init(),this}toJSON(){const t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,i=this.boneInverses;for(let n=0,r=e.length;n<r;n++){const r=e[n];t.bones.push(r.uuid);const s=i[n];t.boneInverses.push(s.toArray())}return t}}class Na extends yi{constructor(t,e,i,n=1){"number"==typeof i&&(n=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(t,e,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const Oa=new Ie,Fa=new Ie,Ua=[],Ba=new Zi;class za extends Zi{constructor(t,e,i){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new Na(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}raycast(t,e){const i=this.matrixWorld,n=this.count;if(Ba.geometry=this.geometry,Ba.material=this.material,void 0!==Ba.material)for(let r=0;r<n;r++){this.getMatrixAt(r,Oa),Fa.multiplyMatrices(i,Oa),Ba.matrixWorld=Fa,Ba.raycast(t,Ua);for(let t=0,i=Ua.length;t<i;t++){const i=Ua[t];i.instanceId=r,i.object=this,e.push(i)}Ua.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new Na(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class Ga extends gi{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Vt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const ka=new ee,Ha=new ee,Va=new Ie,Wa=new Pe,Xa=new Se;class ja extends ni{constructor(t=new Pi,e=new Ga){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,i=[0];for(let t=1,n=e.count;t<n;t++)ka.fromBufferAttribute(e,t-1),Ha.fromBufferAttribute(e,t),i[t]=i[t-1],i[t]+=ka.distanceTo(Ha);t.setAttribute("lineDistance",new Si(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,r=t.params.Line.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Xa.copy(i.boundingSphere),Xa.applyMatrix4(n),Xa.radius+=r,!1===t.ray.intersectsSphere(Xa))return;Va.copy(n).invert(),Wa.copy(t.ray).applyMatrix4(Va);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new ee,c=new ee,h=new ee,u=new ee,d=this.isLineSegments?2:1,p=i.index,f=i.attributes.position;if(null!==p){for(let i=Math.max(0,s.start),n=Math.min(p.count,s.start+s.count)-1;i<n;i+=d){const n=p.getX(i),r=p.getX(i+1);l.fromBufferAttribute(f,n),c.fromBufferAttribute(f,r);if(Wa.distanceSqToSegment(l,c,u,h)>o)continue;u.applyMatrix4(this.matrixWorld);const s=t.ray.origin.distanceTo(u);s<t.near||s>t.far||e.push({distance:s,point:h.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else{for(let i=Math.max(0,s.start),n=Math.min(f.count,s.start+s.count)-1;i<n;i+=d){l.fromBufferAttribute(f,i),c.fromBufferAttribute(f,i+1);if(Wa.distanceSqToSegment(l,c,u,h)>o)continue;u.applyMatrix4(this.matrixWorld);const n=t.ray.origin.distanceTo(u);n<t.near||n>t.far||e.push({distance:n,point:h.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const i=t[e[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=i.length;t<e;t++){const e=i[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}const qa=new ee,Ya=new ee;class Za extends ja{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,i=[];for(let t=0,n=e.count;t<n;t+=2)qa.fromBufferAttribute(e,t),Ya.fromBufferAttribute(e,t+1),i[t]=0===t?0:i[t-1],i[t+1]=i[t]+qa.distanceTo(Ya);t.setAttribute("lineDistance",new Si(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Ja extends ja{constructor(t,e){super(t,e),this.isLineLoop=!0,this.type="LineLoop"}}class Ka extends gi{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Vt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const Qa=new Ie,$a=new Pe,to=new Se,eo=new ee;class io extends ni{constructor(t=new Pi,e=new Ka){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,r=t.params.Points.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),to.copy(i.boundingSphere),to.applyMatrix4(n),to.radius+=r,!1===t.ray.intersectsSphere(to))return;Qa.copy(n).invert(),$a.copy(t.ray).applyMatrix4(Qa);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=i.index,c=i.attributes.position;if(null!==l){for(let i=Math.max(0,s.start),r=Math.min(l.count,s.start+s.count);i<r;i++){const r=l.getX(i);eo.fromBufferAttribute(c,r),no(eo,r,o,n,t,e,this)}}else{for(let i=Math.max(0,s.start),r=Math.min(c.count,s.start+s.count);i<r;i++)eo.fromBufferAttribute(c,i),no(eo,i,o,n,t,e,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const i=t[e[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=i.length;t<e;t++){const e=i[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}function no(t,e,i,n,r,s,a){const o=$a.distanceSqToPoint(t);if(o<i){const i=new ee;$a.closestPointToPoint(t,i),i.applyMatrix4(n);const l=r.ray.origin.distanceTo(i);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(o),point:i,index:e,face:null,object:a})}}class ro extends Zt{constructor(t,e,i,n,r,s,a,o,l,c,h,u){super(null,s,a,o,l,c,n,r,h,u),this.isCompressedTexture=!0,this.image={width:e,height:i},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}class so{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const i=this.getUtoTmapping(t);return this.getPoint(i,e)}getPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return e}getSpacedPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let i,n=this.getPoint(0),r=0;e.push(0);for(let s=1;s<=t;s++)i=this.getPoint(s/t),r+=i.distanceTo(n),e.push(r),n=i;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const i=this.getLengths();let n=0;const r=i.length;let s;s=e||t*i[r-1];let a,o=0,l=r-1;for(;o<=l;)if(n=Math.floor(o+(l-o)/2),a=i[n]-s,a<0)o=n+1;else{if(!(a>0)){l=n;break}l=n-1}if(n=l,i[n]===s)return n/(r-1);const c=i[n];return(n+(s-c)/(i[n+1]-c))/(r-1)}getTangent(t,e){const i=1e-4;let n=t-i,r=t+i;n<0&&(n=0),r>1&&(r=1);const s=this.getPoint(n),a=this.getPoint(r),o=e||(s.isVector2?new At:new ee);return o.copy(a).sub(s).normalize(),o}getTangentAt(t,e){const i=this.getUtoTmapping(t);return this.getTangent(i,e)}computeFrenetFrames(t,e){const i=new ee,n=[],r=[],s=[],a=new ee,o=new Ie;for(let e=0;e<=t;e++){const i=e/t;n[e]=this.getTangentAt(i,new ee)}r[0]=new ee,s[0]=new ee;let l=Number.MAX_VALUE;const c=Math.abs(n[0].x),h=Math.abs(n[0].y),u=Math.abs(n[0].z);c<=l&&(l=c,i.set(1,0,0)),h<=l&&(l=h,i.set(0,1,0)),u<=l&&i.set(0,0,1),a.crossVectors(n[0],i).normalize(),r[0].crossVectors(n[0],a),s[0].crossVectors(n[0],r[0]);for(let e=1;e<=t;e++){if(r[e]=r[e-1].clone(),s[e]=s[e-1].clone(),a.crossVectors(n[e-1],n[e]),a.length()>Number.EPSILON){a.normalize();const t=Math.acos(yt(n[e-1].dot(n[e]),-1,1));r[e].applyMatrix4(o.makeRotationAxis(a,t))}s[e].crossVectors(n[e],r[e])}if(!0===e){let e=Math.acos(yt(r[0].dot(r[t]),-1,1));e/=t,n[0].dot(a.crossVectors(r[0],r[t]))>0&&(e=-e);for(let i=1;i<=t;i++)r[i].applyMatrix4(o.makeRotationAxis(n[i],e*i)),s[i].crossVectors(n[i],r[i])}return{tangents:n,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class ao extends so{constructor(t=0,e=0,i=1,n=1,r=0,s=2*Math.PI,a=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(t,e){const i=e||new At,n=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=s?0:n),!0!==this.aClockwise||s||(r===n?r=-n:r-=n);const a=this.aStartAngle+t*r;let o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),i=o-this.aX,n=l-this.aY;o=i*t-n*e+this.aX,l=i*e+n*t+this.aY}return i.set(o,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class oo extends ao{constructor(t,e,i,n,r,s){super(t,e,i,i,n,r,s),this.isArcCurve=!0,this.type="ArcCurve"}}function lo(){let t=0,e=0,i=0,n=0;function r(r,s,a,o){t=r,e=a,i=-3*r+3*s-2*a-o,n=2*r-2*s+a+o}return{initCatmullRom:function(t,e,i,n,s){r(e,i,s*(i-t),s*(n-e))},initNonuniformCatmullRom:function(t,e,i,n,s,a,o){let l=(e-t)/s-(i-t)/(s+a)+(i-e)/a,c=(i-e)/a-(n-e)/(a+o)+(n-i)/o;l*=a,c*=a,r(e,i,l,c)},calc:function(r){const s=r*r;return t+e*r+i*s+n*(s*r)}}}const co=new ee,ho=new lo,uo=new lo,po=new lo;class fo extends so{constructor(t=[],e=!1,i="centripetal",n=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=i,this.tension=n}getPoint(t,e=new ee){const i=e,n=this.points,r=n.length,s=(r-(this.closed?0:1))*t;let a,o,l=Math.floor(s),c=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===c&&l===r-1&&(l=r-2,c=1),this.closed||l>0?a=n[(l-1)%r]:(co.subVectors(n[0],n[1]).add(n[0]),a=co);const h=n[l%r],u=n[(l+1)%r];if(this.closed||l+2<r?o=n[(l+2)%r]:(co.subVectors(n[r-1],n[r-2]).add(n[r-1]),o=co),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(a.distanceToSquared(h),t),i=Math.pow(h.distanceToSquared(u),t),n=Math.pow(u.distanceToSquared(o),t);i<1e-4&&(i=1),e<1e-4&&(e=i),n<1e-4&&(n=i),ho.initNonuniformCatmullRom(a.x,h.x,u.x,o.x,e,i,n),uo.initNonuniformCatmullRom(a.y,h.y,u.y,o.y,e,i,n),po.initNonuniformCatmullRom(a.z,h.z,u.z,o.z,e,i,n)}else"catmullrom"===this.curveType&&(ho.initCatmullRom(a.x,h.x,u.x,o.x,this.tension),uo.initCatmullRom(a.y,h.y,u.y,o.y,this.tension),po.initCatmullRom(a.z,h.z,u.z,o.z,this.tension));return i.set(ho.calc(c),uo.calc(c),po.calc(c)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new ee).fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function mo(t,e,i,n,r){const s=.5*(n-e),a=.5*(r-i),o=t*t;return(2*i-2*n+s+a)*(t*o)+(-3*i+3*n-2*s-a)*o+s*t+i}function go(t,e,i,n){return function(t,e){const i=1-t;return i*i*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,i)+function(t,e){return t*t*e}(t,n)}function _o(t,e,i,n,r){return function(t,e){const i=1-t;return i*i*i*e}(t,e)+function(t,e){const i=1-t;return 3*i*i*t*e}(t,i)+function(t,e){return 3*(1-t)*t*t*e}(t,n)+function(t,e){return t*t*t*e}(t,r)}class vo extends so{constructor(t=new At,e=new At,i=new At,n=new At){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new At){const i=e,n=this.v0,r=this.v1,s=this.v2,a=this.v3;return i.set(_o(t,n.x,r.x,s.x,a.x),_o(t,n.y,r.y,s.y,a.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class xo extends so{constructor(t=new ee,e=new ee,i=new ee,n=new ee){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new ee){const i=e,n=this.v0,r=this.v1,s=this.v2,a=this.v3;return i.set(_o(t,n.x,r.x,s.x,a.x),_o(t,n.y,r.y,s.y,a.y),_o(t,n.z,r.z,s.z,a.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class yo extends so{constructor(t=new At,e=new At){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new At){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){const i=e||new At;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Mo extends so{constructor(t=new ee,e=new ee){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new ee){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class bo extends so{constructor(t=new At,e=new At,i=new At){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new At){const i=e,n=this.v0,r=this.v1,s=this.v2;return i.set(go(t,n.x,r.x,s.x),go(t,n.y,r.y,s.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class So extends so{constructor(t=new ee,e=new ee,i=new ee){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new ee){const i=e,n=this.v0,r=this.v1,s=this.v2;return i.set(go(t,n.x,r.x,s.x),go(t,n.y,r.y,s.y),go(t,n.z,r.z,s.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class wo extends so{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new At){const i=e,n=this.points,r=(n.length-1)*t,s=Math.floor(r),a=r-s,o=n[0===s?s:s-1],l=n[s],c=n[s>n.length-2?n.length-1:s+1],h=n[s>n.length-3?n.length-1:s+2];return i.set(mo(a,o.x,l.x,c.x,h.x),mo(a,o.y,l.y,c.y,h.y)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new At).fromArray(i))}return this}}var To=Object.freeze({__proto__:null,ArcCurve:oo,CatmullRomCurve3:fo,CubicBezierCurve:vo,CubicBezierCurve3:xo,EllipseCurve:ao,LineCurve:yo,LineCurve3:Mo,QuadraticBezierCurve:bo,QuadraticBezierCurve3:So,SplineCurve:wo});class Eo extends so{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new yo(e,t))}getPoint(t,e){const i=t*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=i){const t=n[r]-i,s=this.curves[r],a=s.getLength(),o=0===a?0:1-t/a;return s.getPointAt(o,e)}r++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let i=0,n=this.curves.length;i<n;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let i;for(let n=0,r=this.curves;n<r.length;n++){const s=r[n],a=s.isEllipseCurve?2*t:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?t*s.points.length:t,o=s.getPoints(a);for(let t=0;t<o.length;t++){const n=o[t];i&&i.equals(n)||(e.push(n),i=n)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,i=this.curves.length;e<i;e++){const i=this.curves[e];t.curves.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push((new To[i.type]).fromJSON(i))}return this}}class Ao extends Eo{constructor(t){super(),this.type="Path",this.currentPoint=new At,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const i=new yo(this.currentPoint.clone(),new At(t,e));return this.curves.push(i),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,i,n){const r=new bo(this.currentPoint.clone(),new At(t,e),new At(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this}bezierCurveTo(t,e,i,n,r,s){const a=new vo(this.currentPoint.clone(),new At(t,e),new At(i,n),new At(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),i=new wo(e);return this.curves.push(i),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,i,n,r,s){const a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(t+a,e+o,i,n,r,s),this}absarc(t,e,i,n,r,s){return this.absellipse(t,e,i,i,n,r,s),this}ellipse(t,e,i,n,r,s,a,o){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+l,e+c,i,n,r,s,a,o),this}absellipse(t,e,i,n,r,s,a,o){const l=new ao(t,e,i,n,r,s,a,o);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class Ro extends Pi{constructor(t=[new At(0,-.5),new At(.5,0),new At(0,.5)],e=12,i=0,n=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:i,phiLength:n},e=Math.floor(e),n=yt(n,0,2*Math.PI);const r=[],s=[],a=[],o=[],l=[],c=1/e,h=new ee,u=new At,d=new ee,p=new ee,f=new ee;let m=0,g=0;for(let e=0;e<=t.length-1;e++)switch(e){case 0:m=t[e+1].x-t[e].x,g=t[e+1].y-t[e].y,d.x=1*g,d.y=-m,d.z=0*g,f.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case t.length-1:o.push(f.x,f.y,f.z);break;default:m=t[e+1].x-t[e].x,g=t[e+1].y-t[e].y,d.x=1*g,d.y=-m,d.z=0*g,p.copy(d),d.x+=f.x,d.y+=f.y,d.z+=f.z,d.normalize(),o.push(d.x,d.y,d.z),f.copy(p)}for(let r=0;r<=e;r++){const d=i+r*c*n,p=Math.sin(d),f=Math.cos(d);for(let i=0;i<=t.length-1;i++){h.x=t[i].x*p,h.y=t[i].y,h.z=t[i].x*f,s.push(h.x,h.y,h.z),u.x=r/e,u.y=i/(t.length-1),a.push(u.x,u.y);const n=o[3*i+0]*p,c=o[3*i+1],d=o[3*i+0]*f;l.push(n,c,d)}}for(let i=0;i<e;i++)for(let e=0;e<t.length-1;e++){const n=e+i*t.length,s=n,a=n+t.length,o=n+t.length+1,l=n+1;r.push(s,a,l),r.push(o,l,a)}this.setIndex(r),this.setAttribute("position",new Si(s,3)),this.setAttribute("uv",new Si(a,2)),this.setAttribute("normal",new Si(l,3))}static fromJSON(t){return new Ro(t.points,t.segments,t.phiStart,t.phiLength)}}class Co extends Ro{constructor(t=1,e=1,i=4,n=8){const r=new Ao;r.absarc(0,-e/2,t,1.5*Math.PI,0),r.absarc(0,e/2,t,0,.5*Math.PI),super(r.getPoints(i),n),this.type="CapsuleGeometry",this.parameters={radius:t,height:e,capSegments:i,radialSegments:n}}static fromJSON(t){return new Co(t.radius,t.length,t.capSegments,t.radialSegments)}}class Lo extends Pi{constructor(t=1,e=8,i=0,n=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:i,thetaLength:n},e=Math.max(3,e);const r=[],s=[],a=[],o=[],l=new ee,c=new At;s.push(0,0,0),a.push(0,0,1),o.push(.5,.5);for(let r=0,h=3;r<=e;r++,h+=3){const u=i+r/e*n;l.x=t*Math.cos(u),l.y=t*Math.sin(u),s.push(l.x,l.y,l.z),a.push(0,0,1),c.x=(s[h]/t+1)/2,c.y=(s[h+1]/t+1)/2,o.push(c.x,c.y)}for(let t=1;t<=e;t++)r.push(t,t+1,0);this.setIndex(r),this.setAttribute("position",new Si(s,3)),this.setAttribute("normal",new Si(a,3)),this.setAttribute("uv",new Si(o,2))}static fromJSON(t){return new Lo(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class Po extends Pi{constructor(t=1,e=1,i=1,n=8,r=1,s=!1,a=0,o=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:o};const l=this;n=Math.floor(n),r=Math.floor(r);const c=[],h=[],u=[],d=[];let p=0;const f=[],m=i/2;let g=0;function _(i){const r=p,s=new At,f=new ee;let _=0;const v=!0===i?t:e,x=!0===i?1:-1;for(let t=1;t<=n;t++)h.push(0,m*x,0),u.push(0,x,0),d.push(.5,.5),p++;const y=p;for(let t=0;t<=n;t++){const e=t/n*o+a,i=Math.cos(e),r=Math.sin(e);f.x=v*r,f.y=m*x,f.z=v*i,h.push(f.x,f.y,f.z),u.push(0,x,0),s.x=.5*i+.5,s.y=.5*r*x+.5,d.push(s.x,s.y),p++}for(let t=0;t<n;t++){const e=r+t,n=y+t;!0===i?c.push(n,n+1,e):c.push(n+1,n,e),_+=3}l.addGroup(g,_,!0===i?1:2),g+=_}!function(){const s=new ee,_=new ee;let v=0;const x=(e-t)/i;for(let l=0;l<=r;l++){const c=[],g=l/r,v=g*(e-t)+t;for(let t=0;t<=n;t++){const e=t/n,r=e*o+a,l=Math.sin(r),f=Math.cos(r);_.x=v*l,_.y=-g*i+m,_.z=v*f,h.push(_.x,_.y,_.z),s.set(l,x,f).normalize(),u.push(s.x,s.y,s.z),d.push(e,1-g),c.push(p++)}f.push(c)}for(let t=0;t<n;t++)for(let e=0;e<r;e++){const i=f[e][t],n=f[e+1][t],r=f[e+1][t+1],s=f[e][t+1];c.push(i,n,s),c.push(n,r,s),v+=6}l.addGroup(g,v,0),g+=v}(),!1===s&&(t>0&&_(!0),e>0&&_(!1)),this.setIndex(c),this.setAttribute("position",new Si(h,3)),this.setAttribute("normal",new Si(u,3)),this.setAttribute("uv",new Si(d,2))}static fromJSON(t){return new Po(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class Io extends Po{constructor(t=1,e=1,i=8,n=1,r=!1,s=0,a=2*Math.PI){super(0,t,e,i,n,r,s,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:s,thetaLength:a}}static fromJSON(t){return new Io(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class Do extends Pi{constructor(t=[],e=[],i=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:n};const r=[],s=[];function a(t,e,i,n){const r=n+1,s=[];for(let n=0;n<=r;n++){s[n]=[];const a=t.clone().lerp(i,n/r),o=e.clone().lerp(i,n/r),l=r-n;for(let t=0;t<=l;t++)s[n][t]=0===t&&n===r?a:a.clone().lerp(o,t/l)}for(let t=0;t<r;t++)for(let e=0;e<2*(r-t)-1;e++){const i=Math.floor(e/2);e%2==0?(o(s[t][i+1]),o(s[t+1][i]),o(s[t][i])):(o(s[t][i+1]),o(s[t+1][i+1]),o(s[t+1][i]))}}function o(t){r.push(t.x,t.y,t.z)}function l(e,i){const n=3*e;i.x=t[n+0],i.y=t[n+1],i.z=t[n+2]}function c(t,e,i,n){n<0&&1===t.x&&(s[e]=t.x-1),0===i.x&&0===i.z&&(s[e]=n/2/Math.PI+.5)}function h(t){return Math.atan2(t.z,-t.x)}!function(t){const i=new ee,n=new ee,r=new ee;for(let s=0;s<e.length;s+=3)l(e[s+0],i),l(e[s+1],n),l(e[s+2],r),a(i,n,r,t)}(n),function(t){const e=new ee;for(let i=0;i<r.length;i+=3)e.x=r[i+0],e.y=r[i+1],e.z=r[i+2],e.normalize().multiplyScalar(t),r[i+0]=e.x,r[i+1]=e.y,r[i+2]=e.z}(i),function(){const t=new ee;for(let i=0;i<r.length;i+=3){t.x=r[i+0],t.y=r[i+1],t.z=r[i+2];const n=h(t)/2/Math.PI+.5,a=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);s.push(n,1-a)}var e;(function(){const t=new ee,e=new ee,i=new ee,n=new ee,a=new At,o=new At,l=new At;for(let u=0,d=0;u<r.length;u+=9,d+=6){t.set(r[u+0],r[u+1],r[u+2]),e.set(r[u+3],r[u+4],r[u+5]),i.set(r[u+6],r[u+7],r[u+8]),a.set(s[d+0],s[d+1]),o.set(s[d+2],s[d+3]),l.set(s[d+4],s[d+5]),n.copy(t).add(e).add(i).divideScalar(3);const p=h(n);c(a,d+0,t,p),c(o,d+2,e,p),c(l,d+4,i,p)}})(),function(){for(let t=0;t<s.length;t+=6){const e=s[t+0],i=s[t+2],n=s[t+4],r=Math.max(e,i,n),a=Math.min(e,i,n);r>.9&&a<.1&&(e<.2&&(s[t+0]+=1),i<.2&&(s[t+2]+=1),n<.2&&(s[t+4]+=1))}}()}(),this.setAttribute("position",new Si(r,3)),this.setAttribute("normal",new Si(r.slice(),3)),this.setAttribute("uv",new Si(s,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(t){return new Do(t.vertices,t.indices,t.radius,t.details)}}class No extends Do{constructor(t=1,e=0){const i=(1+Math.sqrt(5))/2,n=1/i;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new No(t.radius,t.detail)}}const Oo=new ee,Fo=new ee,Uo=new ee,Bo=new fi;class zo extends Pi{constructor(t=null,e=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:e},null!==t){const i=4,n=Math.pow(10,i),r=Math.cos(_t*e),s=t.getIndex(),a=t.getAttribute("position"),o=s?s.count:a.count,l=[0,0,0],c=["a","b","c"],h=new Array(3),u={},d=[];for(let t=0;t<o;t+=3){s?(l[0]=s.getX(t),l[1]=s.getX(t+1),l[2]=s.getX(t+2)):(l[0]=t,l[1]=t+1,l[2]=t+2);const{a:e,b:i,c:o}=Bo;if(e.fromBufferAttribute(a,l[0]),i.fromBufferAttribute(a,l[1]),o.fromBufferAttribute(a,l[2]),Bo.getNormal(Uo),h[0]=`${Math.round(e.x*n)},${Math.round(e.y*n)},${Math.round(e.z*n)}`,h[1]=`${Math.round(i.x*n)},${Math.round(i.y*n)},${Math.round(i.z*n)}`,h[2]=`${Math.round(o.x*n)},${Math.round(o.y*n)},${Math.round(o.z*n)}`,h[0]!==h[1]&&h[1]!==h[2]&&h[2]!==h[0])for(let t=0;t<3;t++){const e=(t+1)%3,i=h[t],n=h[e],s=Bo[c[t]],a=Bo[c[e]],o=`${i}_${n}`,p=`${n}_${i}`;p in u&&u[p]?(Uo.dot(u[p].normal)<=r&&(d.push(s.x,s.y,s.z),d.push(a.x,a.y,a.z)),u[p]=null):o in u||(u[o]={index0:l[t],index1:l[e],normal:Uo.clone()})}}for(const t in u)if(u[t]){const{index0:e,index1:i}=u[t];Oo.fromBufferAttribute(a,e),Fo.fromBufferAttribute(a,i),d.push(Oo.x,Oo.y,Oo.z),d.push(Fo.x,Fo.y,Fo.z)}this.setAttribute("position",new Si(d,3))}}}class Go extends Ao{constructor(t){super(t),this.uuid=xt(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let i=0,n=this.holes.length;i<n;i++)e[i]=this.holes[i].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,i=this.holes.length;e<i;e++){const i=this.holes[e];t.holes.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push((new Ao).fromJSON(i))}return this}}const ko=function(t,e,i=2){const n=e&&e.length,r=n?e[0]*i:t.length;let s=Ho(t,0,r,i,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,c,h,u,d,p;if(n&&(s=function(t,e,i,n){const r=[];let s,a,o,l,c;for(s=0,a=e.length;s<a;s++)o=e[s]*n,l=s<a-1?e[s+1]*n:t.length,c=Ho(t,o,l,n,!1),c===c.next&&(c.steiner=!0),r.push($o(c));for(r.sort(Zo),s=0;s<r.length;s++)Jo(r[s],i),i=Vo(i,i.next);return i}(t,e,s,i)),t.length>80*i){o=c=t[0],l=h=t[1];for(let e=i;e<r;e+=i)u=t[e],d=t[e+1],u<o&&(o=u),d<l&&(l=d),u>c&&(c=u),d>h&&(h=d);p=Math.max(c-o,h-l),p=0!==p?1/p:0}return Wo(s,a,i,o,l,p),a};function Ho(t,e,i,n,r){let s,a;if(r===function(t,e,i,n){let r=0;for(let s=e,a=i-n;s<i;s+=n)r+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return r}(t,e,i,n)>0)for(s=e;s<i;s+=n)a=cl(s,t[s],t[s+1],a);else for(s=i-n;s>=e;s-=n)a=cl(s,t[s],t[s+1],a);return a&&nl(a,a.next)&&(hl(a),a=a.next),a}function Vo(t,e){if(!t)return t;e||(e=t);let i,n=t;do{if(i=!1,n.steiner||!nl(n,n.next)&&0!==il(n.prev,n,n.next))n=n.next;else{if(hl(n),n=e=n.prev,n===n.next)break;i=!0}}while(i||n!==e);return e}function Wo(t,e,i,n,r,s,a){if(!t)return;!a&&s&&function(t,e,i,n){let r=t;do{null===r.z&&(r.z=Qo(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){let e,i,n,r,s,a,o,l,c=1;do{for(i=t,t=null,s=null,a=0;i;){for(a++,n=i,o=0,e=0;e<c&&(o++,n=n.nextZ,n);e++);for(l=c;o>0||l>0&&n;)0!==o&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,o--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=n}s.nextZ=null,c*=2}while(a>1)}(r)}(t,n,r,s);let o,l,c=t;for(;t.prev!==t.next;)if(o=t.prev,l=t.next,s?jo(t,n,r,s):Xo(t))e.push(o.i/i),e.push(t.i/i),e.push(l.i/i),hl(t),t=l.next,c=l.next;else if((t=l)===c){a?1===a?Wo(t=qo(Vo(t),e,i),e,i,n,r,s,2):2===a&&Yo(t,e,i,n,r,s):Wo(Vo(t),e,i,n,r,s,1);break}}function Xo(t){const e=t.prev,i=t,n=t.next;if(il(e,i,n)>=0)return!1;let r=t.next.next;for(;r!==t.prev;){if(tl(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&il(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function jo(t,e,i,n){const r=t.prev,s=t,a=t.next;if(il(r,s,a)>=0)return!1;const o=r.x<s.x?r.x<a.x?r.x:a.x:s.x<a.x?s.x:a.x,l=r.y<s.y?r.y<a.y?r.y:a.y:s.y<a.y?s.y:a.y,c=r.x>s.x?r.x>a.x?r.x:a.x:s.x>a.x?s.x:a.x,h=r.y>s.y?r.y>a.y?r.y:a.y:s.y>a.y?s.y:a.y,u=Qo(o,l,e,i,n),d=Qo(c,h,e,i,n);let p=t.prevZ,f=t.nextZ;for(;p&&p.z>=u&&f&&f.z<=d;){if(p!==t.prev&&p!==t.next&&tl(r.x,r.y,s.x,s.y,a.x,a.y,p.x,p.y)&&il(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==t.prev&&f!==t.next&&tl(r.x,r.y,s.x,s.y,a.x,a.y,f.x,f.y)&&il(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=u;){if(p!==t.prev&&p!==t.next&&tl(r.x,r.y,s.x,s.y,a.x,a.y,p.x,p.y)&&il(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==t.prev&&f!==t.next&&tl(r.x,r.y,s.x,s.y,a.x,a.y,f.x,f.y)&&il(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function qo(t,e,i){let n=t;do{const r=n.prev,s=n.next.next;!nl(r,s)&&rl(r,n,n.next,s)&&ol(r,s)&&ol(s,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(s.i/i),hl(n),hl(n.next),n=t=s),n=n.next}while(n!==t);return Vo(n)}function Yo(t,e,i,n,r,s){let a=t;do{let t=a.next.next;for(;t!==a.prev;){if(a.i!==t.i&&el(a,t)){let o=ll(a,t);return a=Vo(a,a.next),o=Vo(o,o.next),Wo(a,e,i,n,r,s),void Wo(o,e,i,n,r,s)}t=t.next}a=a.next}while(a!==t)}function Zo(t,e){return t.x-e.x}function Jo(t,e){if(e=function(t,e){let i=e;const n=t.x,r=t.y;let s,a=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const t=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=n&&t>a){if(a=t,t===n){if(r===i.y)return i;if(r===i.next.y)return i.next}s=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!s)return null;if(n===a)return s;const o=s,l=s.x,c=s.y;let h,u=1/0;i=s;do{n>=i.x&&i.x>=l&&n!==i.x&&tl(r<c?n:a,r,l,c,r<c?a:n,r,i.x,i.y)&&(h=Math.abs(r-i.y)/(n-i.x),ol(i,t)&&(h<u||h===u&&(i.x>s.x||i.x===s.x&&Ko(s,i)))&&(s=i,u=h)),i=i.next}while(i!==o);return s}(t,e)){const i=ll(e,t);Vo(e,e.next),Vo(i,i.next)}}function Ko(t,e){return il(t.prev,t,e.prev)<0&&il(e.next,t,t.next)<0}function Qo(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function $o(t){let e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function tl(t,e,i,n,r,s,a,o){return(r-a)*(e-o)-(t-a)*(s-o)>=0&&(t-a)*(n-o)-(i-a)*(e-o)>=0&&(i-a)*(s-o)-(r-a)*(n-o)>=0}function el(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&rl(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(ol(t,e)&&ol(e,t)&&function(t,e){let i=t,n=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(il(t.prev,t,e.prev)||il(t,e.prev,e))||nl(t,e)&&il(t.prev,t,t.next)>0&&il(e.prev,e,e.next)>0)}function il(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function nl(t,e){return t.x===e.x&&t.y===e.y}function rl(t,e,i,n){const r=al(il(t,e,i)),s=al(il(t,e,n)),a=al(il(i,n,t)),o=al(il(i,n,e));return r!==s&&a!==o||(!(0!==r||!sl(t,i,e))||(!(0!==s||!sl(t,n,e))||(!(0!==a||!sl(i,t,n))||!(0!==o||!sl(i,e,n)))))}function sl(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function al(t){return t>0?1:t<0?-1:0}function ol(t,e){return il(t.prev,t,t.next)<0?il(t,e,t.next)>=0&&il(t,t.prev,e)>=0:il(t,e,t.prev)<0||il(t,t.next,e)<0}function ll(t,e){const i=new ul(t.i,t.x,t.y),n=new ul(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function cl(t,e,i,n){const r=new ul(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function hl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function ul(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class dl{static area(t){const e=t.length;let i=0;for(let n=e-1,r=0;r<e;n=r++)i+=t[n].x*t[r].y-t[r].x*t[n].y;return.5*i}static isClockWise(t){return dl.area(t)<0}static triangulateShape(t,e){const i=[],n=[],r=[];pl(t),fl(i,t);let s=t.length;e.forEach(pl);for(let t=0;t<e.length;t++)n.push(s),s+=e[t].length,fl(i,e[t]);const a=ko(i,n);for(let t=0;t<a.length;t+=3)r.push(a.slice(t,t+3));return r}}function pl(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function fl(t,e){for(let i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}class ml extends Pi{constructor(t=new Go([new At(.5,.5),new At(-.5,.5),new At(-.5,-.5),new At(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const i=this,n=[],r=[];for(let e=0,i=t.length;e<i;e++){s(t[e])}function s(t){const s=[],a=void 0!==e.curveSegments?e.curveSegments:12,o=void 0!==e.steps?e.steps:1,l=void 0!==e.depth?e.depth:1;let c=void 0===e.bevelEnabled||e.bevelEnabled,h=void 0!==e.bevelThickness?e.bevelThickness:.2,u=void 0!==e.bevelSize?e.bevelSize:h-.1,d=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3;const f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:gl;let g,_,v,x,y,M=!1;f&&(g=f.getSpacedPoints(o),M=!0,c=!1,_=f.computeFrenetFrames(o,!1),v=new ee,x=new ee,y=new ee),c||(p=0,h=0,u=0,d=0);const b=t.extractPoints(a);let S=b.shape;const w=b.holes;if(!dl.isClockWise(S)){S=S.reverse();for(let t=0,e=w.length;t<e;t++){const e=w[t];dl.isClockWise(e)&&(w[t]=e.reverse())}}const T=dl.triangulateShape(S,w),E=S;for(let t=0,e=w.length;t<e;t++){const e=w[t];S=S.concat(e)}function A(t,e,i){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(i).add(t)}const R=S.length,C=T.length;function L(t,e,i){let n,r,s;const a=t.x-e.x,o=t.y-e.y,l=i.x-t.x,c=i.y-t.y,h=a*a+o*o,u=a*c-o*l;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(h),d=Math.sqrt(l*l+c*c),p=e.x-o/u,f=e.y+a/u,m=((i.x-c/d-p)*c-(i.y+l/d-f)*l)/(a*c-o*l);n=p+a*m-t.x,r=f+o*m-t.y;const g=n*n+r*r;if(g<=2)return new At(n,r);s=Math.sqrt(g/2)}else{let t=!1;a>Number.EPSILON?l>Number.EPSILON&&(t=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(o)===Math.sign(c)&&(t=!0),t?(n=-o,r=a,s=Math.sqrt(h)):(n=a,r=o,s=Math.sqrt(h/2))}return new At(n/s,r/s)}const P=[];for(let t=0,e=E.length,i=e-1,n=t+1;t<e;t++,i++,n++)i===e&&(i=0),n===e&&(n=0),P[t]=L(E[t],E[i],E[n]);const I=[];let D,N=P.concat();for(let t=0,e=w.length;t<e;t++){const e=w[t];D=[];for(let t=0,i=e.length,n=i-1,r=t+1;t<i;t++,n++,r++)n===i&&(n=0),r===i&&(r=0),D[t]=L(e[t],e[n],e[r]);I.push(D),N=N.concat(D)}for(let t=0;t<p;t++){const e=t/p,i=h*Math.cos(e*Math.PI/2),n=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=E.length;t<e;t++){const e=A(E[t],P[t],n);U(e.x,e.y,-i)}for(let t=0,e=w.length;t<e;t++){const e=w[t];D=I[t];for(let t=0,r=e.length;t<r;t++){const r=A(e[t],D[t],n);U(r.x,r.y,-i)}}}const O=u+d;for(let t=0;t<R;t++){const e=c?A(S[t],N[t],O):S[t];M?(x.copy(_.normals[0]).multiplyScalar(e.x),v.copy(_.binormals[0]).multiplyScalar(e.y),y.copy(g[0]).add(x).add(v),U(y.x,y.y,y.z)):U(e.x,e.y,0)}for(let t=1;t<=o;t++)for(let e=0;e<R;e++){const i=c?A(S[e],N[e],O):S[e];M?(x.copy(_.normals[t]).multiplyScalar(i.x),v.copy(_.binormals[t]).multiplyScalar(i.y),y.copy(g[t]).add(x).add(v),U(y.x,y.y,y.z)):U(i.x,i.y,l/o*t)}for(let t=p-1;t>=0;t--){const e=t/p,i=h*Math.cos(e*Math.PI/2),n=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=E.length;t<e;t++){const e=A(E[t],P[t],n);U(e.x,e.y,l+i)}for(let t=0,e=w.length;t<e;t++){const e=w[t];D=I[t];for(let t=0,r=e.length;t<r;t++){const r=A(e[t],D[t],n);M?U(r.x,r.y+g[o-1].y,g[o-1].x+i):U(r.x,r.y,l+i)}}}function F(t,e){let i=t.length;for(;--i>=0;){const n=i;let r=i-1;r<0&&(r=t.length-1);for(let t=0,i=o+2*p;t<i;t++){const i=R*t,s=R*(t+1);z(e+n+i,e+r+i,e+r+s,e+n+s)}}}function U(t,e,i){s.push(t),s.push(e),s.push(i)}function B(t,e,r){G(t),G(e),G(r);const s=n.length/3,a=m.generateTopUV(i,n,s-3,s-2,s-1);k(a[0]),k(a[1]),k(a[2])}function z(t,e,r,s){G(t),G(e),G(s),G(e),G(r),G(s);const a=n.length/3,o=m.generateSideWallUV(i,n,a-6,a-3,a-2,a-1);k(o[0]),k(o[1]),k(o[3]),k(o[1]),k(o[2]),k(o[3])}function G(t){n.push(s[3*t+0]),n.push(s[3*t+1]),n.push(s[3*t+2])}function k(t){r.push(t.x),r.push(t.y)}!function(){const t=n.length/3;if(c){let t=0,e=R*t;for(let t=0;t<C;t++){const i=T[t];B(i[2]+e,i[1]+e,i[0]+e)}t=o+2*p,e=R*t;for(let t=0;t<C;t++){const i=T[t];B(i[0]+e,i[1]+e,i[2]+e)}}else{for(let t=0;t<C;t++){const e=T[t];B(e[2],e[1],e[0])}for(let t=0;t<C;t++){const e=T[t];B(e[0]+R*o,e[1]+R*o,e[2]+R*o)}}i.addGroup(t,n.length/3-t,0)}(),function(){const t=n.length/3;let e=0;F(E,e),e+=E.length;for(let t=0,i=w.length;t<i;t++){const i=w[t];F(i,e),e+=i.length}i.addGroup(t,n.length/3-t,1)}()}this.setAttribute("position",new Si(n,3)),this.setAttribute("uv",new Si(r,2)),this.computeVertexNormals()}toJSON(){const t=super.toJSON();return function(t,e,i){if(i.shapes=[],Array.isArray(t))for(let e=0,n=t.length;e<n;e++){const n=t[e];i.shapes.push(n.uuid)}else i.shapes.push(t.uuid);i.options=Object.assign({},e),void 0!==e.extrudePath&&(i.options.extrudePath=e.extrudePath.toJSON());return i}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const i=[];for(let n=0,r=t.shapes.length;n<r;n++){const r=e[t.shapes[n]];i.push(r)}const n=t.options.extrudePath;return void 0!==n&&(t.options.extrudePath=(new To[n.type]).fromJSON(n)),new ml(i,t.options)}}const gl={generateTopUV:function(t,e,i,n,r){const s=e[3*i],a=e[3*i+1],o=e[3*n],l=e[3*n+1],c=e[3*r],h=e[3*r+1];return[new At(s,a),new At(o,l),new At(c,h)]},generateSideWallUV:function(t,e,i,n,r,s){const a=e[3*i],o=e[3*i+1],l=e[3*i+2],c=e[3*n],h=e[3*n+1],u=e[3*n+2],d=e[3*r],p=e[3*r+1],f=e[3*r+2],m=e[3*s],g=e[3*s+1],_=e[3*s+2];return Math.abs(o-h)<Math.abs(a-c)?[new At(a,1-l),new At(c,1-u),new At(d,1-f),new At(m,1-_)]:[new At(o,1-l),new At(h,1-u),new At(p,1-f),new At(g,1-_)]}};class _l extends Do{constructor(t=1,e=0){const i=(1+Math.sqrt(5))/2;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new _l(t.radius,t.detail)}}class vl extends Do{constructor(t=1,e=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new vl(t.radius,t.detail)}}class xl extends Pi{constructor(t=.5,e=1,i=8,n=1,r=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:s},i=Math.max(3,i);const a=[],o=[],l=[],c=[];let h=t;const u=(e-t)/(n=Math.max(1,n)),d=new ee,p=new At;for(let t=0;t<=n;t++){for(let t=0;t<=i;t++){const n=r+t/i*s;d.x=h*Math.cos(n),d.y=h*Math.sin(n),o.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/e+1)/2,p.y=(d.y/e+1)/2,c.push(p.x,p.y)}h+=u}for(let t=0;t<n;t++){const e=t*(i+1);for(let t=0;t<i;t++){const n=t+e,r=n,s=n+i+1,o=n+i+2,l=n+1;a.push(r,s,l),a.push(s,o,l)}}this.setIndex(a),this.setAttribute("position",new Si(o,3)),this.setAttribute("normal",new Si(l,3)),this.setAttribute("uv",new Si(c,2))}static fromJSON(t){return new xl(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class yl extends Pi{constructor(t=new Go([new At(0,.5),new At(-.5,-.5),new At(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const i=[],n=[],r=[],s=[];let a=0,o=0;if(!1===Array.isArray(t))l(t);else for(let e=0;e<t.length;e++)l(t[e]),this.addGroup(a,o,e),a+=o,o=0;function l(t){const a=n.length/3,l=t.extractPoints(e);let c=l.shape;const h=l.holes;!1===dl.isClockWise(c)&&(c=c.reverse());for(let t=0,e=h.length;t<e;t++){const e=h[t];!0===dl.isClockWise(e)&&(h[t]=e.reverse())}const u=dl.triangulateShape(c,h);for(let t=0,e=h.length;t<e;t++){const e=h[t];c=c.concat(e)}for(let t=0,e=c.length;t<e;t++){const e=c[t];n.push(e.x,e.y,0),r.push(0,0,1),s.push(e.x,e.y)}for(let t=0,e=u.length;t<e;t++){const e=u[t],n=e[0]+a,r=e[1]+a,s=e[2]+a;i.push(n,r,s),o+=3}}this.setIndex(i),this.setAttribute("position",new Si(n,3)),this.setAttribute("normal",new Si(r,3)),this.setAttribute("uv",new Si(s,2))}toJSON(){const t=super.toJSON();return function(t,e){if(e.shapes=[],Array.isArray(t))for(let i=0,n=t.length;i<n;i++){const n=t[i];e.shapes.push(n.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}static fromJSON(t,e){const i=[];for(let n=0,r=t.shapes.length;n<r;n++){const r=e[t.shapes[n]];i.push(r)}return new yl(i,t.curveSegments)}}class Ml extends Pi{constructor(t=1,e=32,i=16,n=0,r=2*Math.PI,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:n,phiLength:r,thetaStart:s,thetaLength:a},e=Math.max(3,Math.floor(e)),i=Math.max(2,Math.floor(i));const o=Math.min(s+a,Math.PI);let l=0;const c=[],h=new ee,u=new ee,d=[],p=[],f=[],m=[];for(let d=0;d<=i;d++){const g=[],_=d/i;let v=0;0==d&&0==s?v=.5/e:d==i&&o==Math.PI&&(v=-.5/e);for(let i=0;i<=e;i++){const o=i/e;h.x=-t*Math.cos(n+o*r)*Math.sin(s+_*a),h.y=t*Math.cos(s+_*a),h.z=t*Math.sin(n+o*r)*Math.sin(s+_*a),p.push(h.x,h.y,h.z),u.copy(h).normalize(),f.push(u.x,u.y,u.z),m.push(o+v,1-_),g.push(l++)}c.push(g)}for(let t=0;t<i;t++)for(let n=0;n<e;n++){const e=c[t][n+1],r=c[t][n],a=c[t+1][n],l=c[t+1][n+1];(0!==t||s>0)&&d.push(e,r,l),(t!==i-1||o<Math.PI)&&d.push(r,a,l)}this.setIndex(d),this.setAttribute("position",new Si(p,3)),this.setAttribute("normal",new Si(f,3)),this.setAttribute("uv",new Si(m,2))}static fromJSON(t){return new Ml(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class bl extends Do{constructor(t=1,e=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new bl(t.radius,t.detail)}}class Sl extends Pi{constructor(t=1,e=.4,i=8,n=6,r=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:n,arc:r},i=Math.floor(i),n=Math.floor(n);const s=[],a=[],o=[],l=[],c=new ee,h=new ee,u=new ee;for(let s=0;s<=i;s++)for(let d=0;d<=n;d++){const p=d/n*r,f=s/i*Math.PI*2;h.x=(t+e*Math.cos(f))*Math.cos(p),h.y=(t+e*Math.cos(f))*Math.sin(p),h.z=e*Math.sin(f),a.push(h.x,h.y,h.z),c.x=t*Math.cos(p),c.y=t*Math.sin(p),u.subVectors(h,c).normalize(),o.push(u.x,u.y,u.z),l.push(d/n),l.push(s/i)}for(let t=1;t<=i;t++)for(let e=1;e<=n;e++){const i=(n+1)*t+e-1,r=(n+1)*(t-1)+e-1,a=(n+1)*(t-1)+e,o=(n+1)*t+e;s.push(i,r,o),s.push(r,a,o)}this.setIndex(s),this.setAttribute("position",new Si(a,3)),this.setAttribute("normal",new Si(o,3)),this.setAttribute("uv",new Si(l,2))}static fromJSON(t){return new Sl(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class wl extends Pi{constructor(t=1,e=.4,i=64,n=8,r=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:n,p:r,q:s},i=Math.floor(i),n=Math.floor(n);const a=[],o=[],l=[],c=[],h=new ee,u=new ee,d=new ee,p=new ee,f=new ee,m=new ee,g=new ee;for(let a=0;a<=i;++a){const v=a/i*r*Math.PI*2;_(v,r,s,t,d),_(v+.01,r,s,t,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let t=0;t<=n;++t){const r=t/n*Math.PI*2,s=-e*Math.cos(r),p=e*Math.sin(r);h.x=d.x+(s*g.x+p*f.x),h.y=d.y+(s*g.y+p*f.y),h.z=d.z+(s*g.z+p*f.z),o.push(h.x,h.y,h.z),u.subVectors(h,d).normalize(),l.push(u.x,u.y,u.z),c.push(a/i),c.push(t/n)}}for(let t=1;t<=i;t++)for(let e=1;e<=n;e++){const i=(n+1)*(t-1)+(e-1),r=(n+1)*t+(e-1),s=(n+1)*t+e,o=(n+1)*(t-1)+e;a.push(i,r,o),a.push(r,s,o)}function _(t,e,i,n,r){const s=Math.cos(t),a=Math.sin(t),o=i/e*t,l=Math.cos(o);r.x=n*(2+l)*.5*s,r.y=n*(2+l)*a*.5,r.z=n*Math.sin(o)*.5}this.setIndex(a),this.setAttribute("position",new Si(o,3)),this.setAttribute("normal",new Si(l,3)),this.setAttribute("uv",new Si(c,2))}static fromJSON(t){return new wl(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class Tl extends Pi{constructor(t=new So(new ee(-1,-1,0),new ee(-1,1,0),new ee(1,1,0)),e=64,i=1,n=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:i,radialSegments:n,closed:r};const s=t.computeFrenetFrames(e,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const a=new ee,o=new ee,l=new At;let c=new ee;const h=[],u=[],d=[],p=[];function f(r){c=t.getPointAt(r/e,c);const l=s.normals[r],d=s.binormals[r];for(let t=0;t<=n;t++){const e=t/n*Math.PI*2,r=Math.sin(e),s=-Math.cos(e);o.x=s*l.x+r*d.x,o.y=s*l.y+r*d.y,o.z=s*l.z+r*d.z,o.normalize(),u.push(o.x,o.y,o.z),a.x=c.x+i*o.x,a.y=c.y+i*o.y,a.z=c.z+i*o.z,h.push(a.x,a.y,a.z)}}!function(){for(let t=0;t<e;t++)f(t);f(!1===r?e:0),function(){for(let t=0;t<=e;t++)for(let i=0;i<=n;i++)l.x=t/e,l.y=i/n,d.push(l.x,l.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=n;e++){const i=(n+1)*(t-1)+(e-1),r=(n+1)*t+(e-1),s=(n+1)*t+e,a=(n+1)*(t-1)+e;p.push(i,r,a),p.push(r,s,a)}}()}(),this.setIndex(p),this.setAttribute("position",new Si(h,3)),this.setAttribute("normal",new Si(u,3)),this.setAttribute("uv",new Si(d,2))}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new Tl((new To[t.path.type]).fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class El extends Pi{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},null!==t){const e=[],i=new Set,n=new ee,r=new ee;if(null!==t.index){const s=t.attributes.position,a=t.index;let o=t.groups;0===o.length&&(o=[{start:0,count:a.count,materialIndex:0}]);for(let t=0,l=o.length;t<l;++t){const l=o[t],c=l.start;for(let t=c,o=c+l.count;t<o;t+=3)for(let o=0;o<3;o++){const l=a.getX(t+o),c=a.getX(t+(o+1)%3);n.fromBufferAttribute(s,l),r.fromBufferAttribute(s,c),!0===Al(n,r,i)&&(e.push(n.x,n.y,n.z),e.push(r.x,r.y,r.z))}}}else{const s=t.attributes.position;for(let t=0,a=s.count/3;t<a;t++)for(let a=0;a<3;a++){const o=3*t+a,l=3*t+(a+1)%3;n.fromBufferAttribute(s,o),r.fromBufferAttribute(s,l),!0===Al(n,r,i)&&(e.push(n.x,n.y,n.z),e.push(r.x,r.y,r.z))}}this.setAttribute("position",new Si(e,3))}}}function Al(t,e,i){const n=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`;return!0!==i.has(n)&&!0!==i.has(r)&&(i.add(n),i.add(r),!0)}var Rl=Object.freeze({__proto__:null,BoxGeometry:Ki,BoxBufferGeometry:Ki,CapsuleGeometry:Co,CapsuleBufferGeometry:Co,CircleGeometry:Lo,CircleBufferGeometry:Lo,ConeGeometry:Io,ConeBufferGeometry:Io,CylinderGeometry:Po,CylinderBufferGeometry:Po,DodecahedronGeometry:No,DodecahedronBufferGeometry:No,EdgesGeometry:zo,ExtrudeGeometry:ml,ExtrudeBufferGeometry:ml,IcosahedronGeometry:_l,IcosahedronBufferGeometry:_l,LatheGeometry:Ro,LatheBufferGeometry:Ro,OctahedronGeometry:vl,OctahedronBufferGeometry:vl,PlaneGeometry:vn,PlaneBufferGeometry:vn,PolyhedronGeometry:Do,PolyhedronBufferGeometry:Do,RingGeometry:xl,RingBufferGeometry:xl,ShapeGeometry:yl,ShapeBufferGeometry:yl,SphereGeometry:Ml,SphereBufferGeometry:Ml,TetrahedronGeometry:bl,TetrahedronBufferGeometry:bl,TorusGeometry:Sl,TorusBufferGeometry:Sl,TorusKnotGeometry:wl,TorusKnotBufferGeometry:wl,TubeGeometry:Tl,TubeBufferGeometry:Tl,WireframeGeometry:El});class Cl extends gi{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Vt(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class Ll extends en{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Pl extends gi{constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Vt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Vt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new At(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Il extends Pl{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new At(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return yt(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Vt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Vt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Vt(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class Dl extends gi{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Vt(16777215),this.specular=new Vt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Vt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new At(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Nl extends gi{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Vt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Vt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new At(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class Ol extends gi{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new At(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class Fl extends gi{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Vt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Vt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class Ul extends gi{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Vt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new At(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Bl extends Ga{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}function zl(t,e,i){return kl(t)?new t.constructor(t.subarray(e,void 0!==i?i:t.length)):t.slice(e,i)}function Gl(t,e,i){return!t||!i&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)}function kl(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Hl(t){const e=t.length,i=new Array(e);for(let t=0;t!==e;++t)i[t]=t;return i.sort((function(e,i){return t[e]-t[i]})),i}function Vl(t,e,i){const n=t.length,r=new t.constructor(n);for(let s=0,a=0;a!==n;++s){const n=i[s]*e;for(let i=0;i!==e;++i)r[a++]=t[n+i]}return r}function Wl(t,e,i,n){let r=1,s=t[0];for(;void 0!==s&&void 0===s[n];)s=t[r++];if(void 0===s)return;let a=s[n];if(void 0!==a)if(Array.isArray(a))do{a=s[n],void 0!==a&&(e.push(s.time),i.push.apply(i,a)),s=t[r++]}while(void 0!==s);else if(void 0!==a.toArray)do{a=s[n],void 0!==a&&(e.push(s.time),a.toArray(i,i.length)),s=t[r++]}while(void 0!==s);else do{a=s[n],void 0!==a&&(e.push(s.time),i.push(a)),s=t[r++]}while(void 0!==s)}var Xl=Object.freeze({__proto__:null,arraySlice:zl,convertArray:Gl,isTypedArray:kl,getKeyframeOrder:Hl,sortedArray:Vl,flattenJSON:Wl,subclip:function(t,e,i,n,r=30){const s=t.clone();s.name=e;const a=[];for(let t=0;t<s.tracks.length;++t){const e=s.tracks[t],o=e.getValueSize(),l=[],c=[];for(let t=0;t<e.times.length;++t){const s=e.times[t]*r;if(!(s<i||s>=n)){l.push(e.times[t]);for(let i=0;i<o;++i)c.push(e.values[t*o+i])}}0!==l.length&&(e.times=Gl(l,e.times.constructor),e.values=Gl(c,e.values.constructor),a.push(e))}s.tracks=a;let o=1/0;for(let t=0;t<s.tracks.length;++t)o>s.tracks[t].times[0]&&(o=s.tracks[t].times[0]);for(let t=0;t<s.tracks.length;++t)s.tracks[t].shift(-1*o);return s.resetDuration(),s},makeClipAdditive:function(t,e=0,i=t,n=30){n<=0&&(n=30);const r=i.tracks.length,s=e/n;for(let e=0;e<r;++e){const n=i.tracks[e],r=n.ValueTypeName;if("bool"===r||"string"===r)continue;const a=t.tracks.find((function(t){return t.name===n.name&&t.ValueTypeName===r}));if(void 0===a)continue;let o=0;const l=n.getValueSize();n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(o=l/3);let c=0;const h=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=h/3);const u=n.times.length-1;let d;if(s<=n.times[0]){const t=o,e=l-o;d=zl(n.values,t,e)}else if(s>=n.times[u]){const t=u*l+o,e=t+l-o;d=zl(n.values,t,e)}else{const t=n.createInterpolant(),e=o,i=l-o;t.evaluate(s),d=zl(t.resultBuffer,e,i)}if("quaternion"===r){(new te).fromArray(d).normalize().conjugate().toArray(d)}const p=a.times.length;for(let t=0;t<p;++t){const e=t*h+c;if("quaternion"===r)te.multiplyQuaternionsFlat(a.values,e,d,0,a.values,e);else{const t=h-2*c;for(let i=0;i<t;++i)a.values[e+i]-=d[i]}}}return t.blendMode=st,t}});class jl{constructor(t,e,i,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let i=this._cachedIndex,n=e[i],r=e[i-1];t:{e:{let s;i:{n:if(!(t<n)){for(let s=i+2;;){if(void 0===n){if(t<r)break n;return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===s)break;if(r=n,n=e[++i],t<n)break e}s=e.length;break i}if(t>=r)break t;{const a=e[1];t<a&&(i=2,r=a);for(let s=i-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(i===s)break;if(n=r,r=e[--i-1],t>=r)break e}s=i,i=0}}for(;i<s;){const n=i+s>>>1;t<e[n]?s=n:i=n+1}if(n=e[i],r=e[i-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===n)return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,t,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=t*n;for(let t=0;t!==n;++t)e[t]=i[r+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class ql extends jl{constructor(t,e,i,n){super(t,e,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:et,endingEnd:et}}intervalChanged_(t,e,i){const n=this.parameterPositions;let r=t-2,s=t+1,a=n[r],o=n[s];if(void 0===a)switch(this.getSettings_().endingStart){case it:r=t,a=2*e-i;break;case nt:r=n.length-2,a=e+n[r]-n[r+1];break;default:r=t,a=i}if(void 0===o)switch(this.getSettings_().endingEnd){case it:s=t,o=2*i-e;break;case nt:s=1,o=i+n[1]-n[0];break;default:s=t-1,o=e}const l=.5*(i-e),c=this.valueSize;this._weightPrev=l/(e-a),this._weightNext=l/(o-i),this._offsetPrev=r*c,this._offsetNext=s*c}interpolate_(t,e,i,n){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,c=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(i-e)/(n-e),f=p*p,m=f*p,g=-u*m+2*u*f-u*p,_=(1+u)*m+(-1.5-2*u)*f+(-.5+u)*p+1,v=(-1-d)*m+(1.5+d)*f+.5*p,x=d*m-d*f;for(let t=0;t!==a;++t)r[t]=g*s[c+t]+_*s[l+t]+v*s[o+t]+x*s[h+t];return r}}class Yl extends jl{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,c=(i-e)/(n-e),h=1-c;for(let t=0;t!==a;++t)r[t]=s[l+t]*h+s[o+t]*c;return r}}class Zl extends jl{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t){return this.copySampleValue_(t-1)}}class Jl{constructor(t,e,i,n){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Gl(e,this.TimeBufferType),this.values=Gl(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:Gl(t.times,Array),values:Gl(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(i.interpolation=e)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new Zl(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Yl(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new ql(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case Q:e=this.InterpolantFactoryMethodDiscrete;break;case $:e=this.InterpolantFactoryMethodLinear;break;case tt:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Q;case this.InterpolantFactoryMethodLinear:return $;case this.InterpolantFactoryMethodSmooth:return tt}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]*=t}return this}trim(t,e){const i=this.times,n=i.length;let r=0,s=n-1;for(;r!==n&&i[r]<t;)++r;for(;-1!==s&&i[s]>e;)--s;if(++s,0!==r||s!==n){r>=s&&(s=Math.max(s,1),r=s-1);const t=this.getValueSize();this.times=zl(i,r,s),this.values=zl(this.values,r*t,s*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const i=this.times,n=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let e=0;e!==r;e++){const n=i[e];if("number"==typeof n&&isNaN(n)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,n),t=!1;break}if(null!==s&&s>n){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,n,s),t=!1;break}s=n}if(void 0!==n&&kl(n))for(let e=0,i=n.length;e!==i;++e){const i=n[e];if(isNaN(i)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,i),t=!1;break}}return t}optimize(){const t=zl(this.times),e=zl(this.values),i=this.getValueSize(),n=this.getInterpolation()===tt,r=t.length-1;let s=1;for(let a=1;a<r;++a){let r=!1;const o=t[a];if(o!==t[a+1]&&(1!==a||o!==t[0]))if(n)r=!0;else{const t=a*i,n=t-i,s=t+i;for(let a=0;a!==i;++a){const i=e[t+a];if(i!==e[n+a]||i!==e[s+a]){r=!0;break}}}if(r){if(a!==s){t[s]=t[a];const n=a*i,r=s*i;for(let t=0;t!==i;++t)e[r+t]=e[n+t]}++s}}if(r>0){t[s]=t[r];for(let t=r*i,n=s*i,a=0;a!==i;++a)e[n+a]=e[t+a];++s}return s!==t.length?(this.times=zl(t,0,s),this.values=zl(e,0,s*i)):(this.times=t,this.values=e),this}clone(){const t=zl(this.times,0),e=zl(this.values,0),i=new(0,this.constructor)(this.name,t,e);return i.createInterpolant=this.createInterpolant,i}}Jl.prototype.TimeBufferType=Float32Array,Jl.prototype.ValueBufferType=Float32Array,Jl.prototype.DefaultInterpolation=$;class Kl extends Jl{}Kl.prototype.ValueTypeName="bool",Kl.prototype.ValueBufferType=Array,Kl.prototype.DefaultInterpolation=Q,Kl.prototype.InterpolantFactoryMethodLinear=void 0,Kl.prototype.InterpolantFactoryMethodSmooth=void 0;class Ql extends Jl{}Ql.prototype.ValueTypeName="color";class $l extends Jl{}$l.prototype.ValueTypeName="number";class tc extends jl{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(i-e)/(n-e);let l=t*a;for(let t=l+a;l!==t;l+=4)te.slerpFlat(r,0,s,l-a,s,l,o);return r}}class ec extends Jl{InterpolantFactoryMethodLinear(t){return new tc(this.times,this.values,this.getValueSize(),t)}}ec.prototype.ValueTypeName="quaternion",ec.prototype.DefaultInterpolation=$,ec.prototype.InterpolantFactoryMethodSmooth=void 0;class ic extends Jl{}ic.prototype.ValueTypeName="string",ic.prototype.ValueBufferType=Array,ic.prototype.DefaultInterpolation=Q,ic.prototype.InterpolantFactoryMethodLinear=void 0,ic.prototype.InterpolantFactoryMethodSmooth=void 0;class nc extends Jl{}nc.prototype.ValueTypeName="vector";class rc{constructor(t,e=-1,i,n=2500){this.name=t,this.tracks=i,this.duration=e,this.blendMode=n,this.uuid=xt(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],i=t.tracks,n=1/(t.fps||1);for(let t=0,r=i.length;t!==r;++t)e.push(sc(i[t]).scale(n));const r=new this(t.name,t.duration,e,t.blendMode);return r.uuid=t.uuid,r}static toJSON(t){const e=[],i=t.tracks,n={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,n=i.length;t!==n;++t)e.push(Jl.toJSON(i[t]));return n}static CreateFromMorphTargetSequence(t,e,i,n){const r=e.length,s=[];for(let t=0;t<r;t++){let a=[],o=[];a.push((t+r-1)%r,t,(t+1)%r),o.push(0,1,0);const l=Hl(a);a=Vl(a,1,l),o=Vl(o,1,l),n||0!==a[0]||(a.push(r),o.push(o[0])),s.push(new $l(".morphTargetInfluences["+e[t].name+"]",a,o).scale(1/i))}return new this(t,-1,s)}static findByName(t,e){let i=t;if(!Array.isArray(t)){const e=t;i=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<i.length;t++)if(i[t].name===e)return i[t];return null}static CreateClipsFromMorphTargetSequences(t,e,i){const n={},r=/^([\w-]*?)([\d]+)$/;for(let e=0,i=t.length;e<i;e++){const i=t[e],s=i.name.match(r);if(s&&s.length>1){const t=s[1];let e=n[t];e||(n[t]=e=[]),e.push(i)}}const s=[];for(const t in n)s.push(this.CreateFromMorphTargetSequence(t,n[t],e,i));return s}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(t,e,i,n,r){if(0!==i.length){const s=[],a=[];Wl(i,s,a,n),0!==s.length&&r.push(new t(e,s,a))}},n=[],r=t.name||"default",s=t.fps||30,a=t.blendMode;let o=t.length||-1;const l=t.hierarchy||[];for(let t=0;t<l.length;t++){const r=l[t].keys;if(r&&0!==r.length)if(r[0].morphTargets){const t={};let e;for(e=0;e<r.length;e++)if(r[e].morphTargets)for(let i=0;i<r[e].morphTargets.length;i++)t[r[e].morphTargets[i]]=-1;for(const i in t){const t=[],s=[];for(let n=0;n!==r[e].morphTargets.length;++n){const n=r[e];t.push(n.time),s.push(n.morphTarget===i?1:0)}n.push(new $l(".morphTargetInfluence["+i+"]",t,s))}o=t.length*s}else{const s=".bones["+e[t].name+"]";i(nc,s+".position",r,"pos",n),i(ec,s+".quaternion",r,"rot",n),i(nc,s+".scale",r,"scl",n)}}if(0===n.length)return null;return new this(r,o,n,a)}resetDuration(){let t=0;for(let e=0,i=this.tracks.length;e!==i;++e){const i=this.tracks[e];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function sc(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return $l;case"vector":case"vector2":case"vector3":case"vector4":return nc;case"color":return Ql;case"quaternion":return ec;case"bool":case"boolean":return Kl;case"string":return ic}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],i=[];Wl(t.keys,e,i,"value"),t.times=e,t.values=i}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const ac={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class oc{constructor(t,e,i){const n=this;let r,s=!1,a=0,o=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(t){o++,!1===s&&void 0!==n.onStart&&n.onStart(t,a,o),s=!0},this.itemEnd=function(t){a++,void 0!==n.onProgress&&n.onProgress(t,a,o),a===o&&(s=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)},this.resolveURL=function(t){return r?r(t):t},this.setURLModifier=function(t){return r=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,i=l.length;e<i;e+=2){const i=l[e],n=l[e+1];if(i.global&&(i.lastIndex=0),i.test(t))return n}return null}}}const lc=new oc;class cc{constructor(t){this.manager=void 0!==t?t:lc,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const i=this;return new Promise((function(n,r){i.load(t,n,e,r)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const hc={};class uc extends Error{constructor(t,e){super(t),this.response=e}}class dc extends cc{constructor(t){super(t)}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=ac.get(t);if(void 0!==r)return this.manager.itemStart(t),setTimeout((()=>{e&&e(r),this.manager.itemEnd(t)}),0),r;if(void 0!==hc[t])return void hc[t].push({onLoad:e,onProgress:i,onError:n});hc[t]=[],hc[t].push({onLoad:e,onProgress:i,onError:n});const s=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(s).then((e=>{if(200===e.status||0===e.status){if(0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;const i=hc[t],n=e.body.getReader(),r=e.headers.get("Content-Length"),s=r?parseInt(r):0,a=0!==s;let o=0;const l=new ReadableStream({start(t){!function e(){n.read().then((({done:n,value:r})=>{if(n)t.close();else{o+=r.byteLength;const n=new ProgressEvent("progress",{lengthComputable:a,loaded:o,total:s});for(let t=0,e=i.length;t<e;t++){const e=i[t];e.onProgress&&e.onProgress(n)}t.enqueue(r),e()}}))}()}});return new Response(l)}throw new uc(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`,e)})).then((t=>{switch(o){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((t=>(new DOMParser).parseFromString(t,a)));case"json":return t.json();default:if(void 0===a)return t.text();{const e=/charset="?([^;"\s]*)"?/i.exec(a),i=e&&e[1]?e[1].toLowerCase():void 0,n=new TextDecoder(i);return t.arrayBuffer().then((t=>n.decode(t)))}}})).then((e=>{ac.add(t,e);const i=hc[t];delete hc[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onLoad&&n.onLoad(e)}})).catch((e=>{const i=hc[t];if(void 0===i)throw this.manager.itemError(t),e;delete hc[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onError&&n.onError(e)}this.manager.itemError(t)})).finally((()=>{this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class pc extends cc{constructor(t){super(t)}load(t,e,i,n){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=ac.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;const a=It("img");function o(){c(),ac.add(t,this),e&&e(this),r.manager.itemEnd(t)}function l(e){c(),n&&n(e),r.manager.itemError(t),r.manager.itemEnd(t)}function c(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(t),a.src=t,a}}class fc extends ni{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new Vt(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}class mc extends fc{constructor(t,e,i){super(t,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(ni.DefaultUp),this.updateMatrix(),this.groundColor=new Vt(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}}const gc=new Ie,_c=new ee,vc=new ee;class xc{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new At(512,512),this.map=null,this.mapPass=null,this.matrix=new Ie,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new mn,this._frameExtents=new At(1,1),this._viewportCount=1,this._viewports=[new Jt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,i=this.matrix;_c.setFromMatrixPosition(t.matrixWorld),e.position.copy(_c),vc.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(vc),e.updateMatrixWorld(),gc.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(gc),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(e.projectionMatrix),i.multiply(e.matrixWorldInverse)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class yc extends xc{constructor(){super(new rn(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const e=this.camera,i=2*vt*t.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;i===e.fov&&n===e.aspect&&r===e.far||(e.fov=i,e.aspect=n,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class Mc extends fc{constructor(t,e,i=0,n=Math.PI/3,r=0,s=1){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(ni.DefaultUp),this.updateMatrix(),this.target=new ni,this.distance=i,this.angle=n,this.penumbra=r,this.decay=s,this.shadow=new yc}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const bc=new Ie,Sc=new ee,wc=new ee;class Tc extends xc{constructor(){super(new rn(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new At(4,2),this._viewportCount=6,this._viewports=[new Jt(2,1,1,1),new Jt(0,1,1,1),new Jt(3,1,1,1),new Jt(1,1,1,1),new Jt(3,0,1,1),new Jt(1,0,1,1)],this._cubeDirections=[new ee(1,0,0),new ee(-1,0,0),new ee(0,0,1),new ee(0,0,-1),new ee(0,1,0),new ee(0,-1,0)],this._cubeUps=[new ee(0,1,0),new ee(0,1,0),new ee(0,1,0),new ee(0,1,0),new ee(0,0,1),new ee(0,0,-1)]}updateMatrices(t,e=0){const i=this.camera,n=this.matrix,r=t.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),Sc.setFromMatrixPosition(t.matrixWorld),i.position.copy(Sc),wc.copy(i.position),wc.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(wc),i.updateMatrixWorld(),n.makeTranslation(-Sc.x,-Sc.y,-Sc.z),bc.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(bc)}}class Ec extends fc{constructor(t,e,i=0,n=1){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new Tc}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class Ac extends xc{constructor(){super(new Rn(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Rc extends fc{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(ni.DefaultUp),this.updateMatrix(),this.target=new ni,this.shadow=new Ac}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class Cc extends fc{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class Lc extends fc{constructor(t,e,i=10,n=10){super(t,e),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}class Pc{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new ee)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const i=t.x,n=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.282095),e.addScaledVector(s[1],.488603*n),e.addScaledVector(s[2],.488603*r),e.addScaledVector(s[3],.488603*i),e.addScaledVector(s[4],i*n*1.092548),e.addScaledVector(s[5],n*r*1.092548),e.addScaledVector(s[6],.315392*(3*r*r-1)),e.addScaledVector(s[7],i*r*1.092548),e.addScaledVector(s[8],.546274*(i*i-n*n)),e}getIrradianceAt(t,e){const i=t.x,n=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.886227),e.addScaledVector(s[1],1.023328*n),e.addScaledVector(s[2],1.023328*r),e.addScaledVector(s[3],1.023328*i),e.addScaledVector(s[4],.858086*i*n),e.addScaledVector(s[5],.858086*n*r),e.addScaledVector(s[6],.743125*r*r-.247708),e.addScaledVector(s[7],.858086*i*r),e.addScaledVector(s[8],.429043*(i*i-n*n)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(t.coefficients[i],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let i=0;i<9;i++)this.coefficients[i].lerp(t.coefficients[i],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].fromArray(t,e+3*n);return this}toArray(t=[],e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].toArray(t,e+3*n);return t}static getBasisAt(t,e){const i=t.x,n=t.y,r=t.z;e[0]=.282095,e[1]=.488603*n,e[2]=.488603*r,e[3]=.488603*i,e[4]=1.092548*i*n,e[5]=1.092548*n*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*i*r,e[8]=.546274*(i*i-n*n)}}class Ic extends fc{constructor(t=new Pc,e=1){super(void 0,e),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}class Dc extends cc{constructor(t){super(t),this.textures={}}load(t,e,i,n){const r=this,s=new dc(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,(function(i){try{e(r.parse(JSON.parse(i)))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}}),i,n)}parse(t){const e=this.textures;function i(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}const n=Dc.createMaterialFromType(t.type);if(void 0!==t.uuid&&(n.uuid=t.uuid),void 0!==t.name&&(n.name=t.name),void 0!==t.color&&void 0!==n.color&&n.color.setHex(t.color),void 0!==t.roughness&&(n.roughness=t.roughness),void 0!==t.metalness&&(n.metalness=t.metalness),void 0!==t.sheen&&(n.sheen=t.sheen),void 0!==t.sheenColor&&(n.sheenColor=(new Vt).setHex(t.sheenColor)),void 0!==t.sheenRoughness&&(n.sheenRoughness=t.sheenRoughness),void 0!==t.emissive&&void 0!==n.emissive&&n.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==n.specular&&n.specular.setHex(t.specular),void 0!==t.specularIntensity&&(n.specularIntensity=t.specularIntensity),void 0!==t.specularColor&&void 0!==n.specularColor&&n.specularColor.setHex(t.specularColor),void 0!==t.shininess&&(n.shininess=t.shininess),void 0!==t.clearcoat&&(n.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(n.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.iridescence&&(n.iridescence=t.iridescence),void 0!==t.iridescenceIOR&&(n.iridescenceIOR=t.iridescenceIOR),void 0!==t.iridescenceThicknessRange&&(n.iridescenceThicknessRange=t.iridescenceThicknessRange),void 0!==t.transmission&&(n.transmission=t.transmission),void 0!==t.thickness&&(n.thickness=t.thickness),void 0!==t.attenuationDistance&&(n.attenuationDistance=t.attenuationDistance),void 0!==t.attenuationColor&&void 0!==n.attenuationColor&&n.attenuationColor.setHex(t.attenuationColor),void 0!==t.fog&&(n.fog=t.fog),void 0!==t.flatShading&&(n.flatShading=t.flatShading),void 0!==t.blending&&(n.blending=t.blending),void 0!==t.combine&&(n.combine=t.combine),void 0!==t.side&&(n.side=t.side),void 0!==t.shadowSide&&(n.shadowSide=t.shadowSide),void 0!==t.opacity&&(n.opacity=t.opacity),void 0!==t.transparent&&(n.transparent=t.transparent),void 0!==t.alphaTest&&(n.alphaTest=t.alphaTest),void 0!==t.depthTest&&(n.depthTest=t.depthTest),void 0!==t.depthWrite&&(n.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(n.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(n.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(n.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(n.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(n.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(n.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(n.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(n.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(n.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(n.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(n.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(n.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(n.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(n.rotation=t.rotation),1!==t.linewidth&&(n.linewidth=t.linewidth),void 0!==t.dashSize&&(n.dashSize=t.dashSize),void 0!==t.gapSize&&(n.gapSize=t.gapSize),void 0!==t.scale&&(n.scale=t.scale),void 0!==t.polygonOffset&&(n.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(n.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(n.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.dithering&&(n.dithering=t.dithering),void 0!==t.alphaToCoverage&&(n.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(n.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.toneMapped&&(n.toneMapped=t.toneMapped),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?n.vertexColors=t.vertexColors>0:n.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const e in t.uniforms){const r=t.uniforms[e];switch(n.uniforms[e]={},r.type){case"t":n.uniforms[e].value=i(r.value);break;case"c":n.uniforms[e].value=(new Vt).setHex(r.value);break;case"v2":n.uniforms[e].value=(new At).fromArray(r.value);break;case"v3":n.uniforms[e].value=(new ee).fromArray(r.value);break;case"v4":n.uniforms[e].value=(new Jt).fromArray(r.value);break;case"m3":n.uniforms[e].value=(new Rt).fromArray(r.value);break;case"m4":n.uniforms[e].value=(new Ie).fromArray(r.value);break;default:n.uniforms[e].value=r.value}}if(void 0!==t.defines&&(n.defines=t.defines),void 0!==t.vertexShader&&(n.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(n.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(const e in t.extensions)n.extensions[e]=t.extensions[e];if(void 0!==t.shading&&(n.flatShading=1===t.shading),void 0!==t.size&&(n.size=t.size),void 0!==t.sizeAttenuation&&(n.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(n.map=i(t.map)),void 0!==t.matcap&&(n.matcap=i(t.matcap)),void 0!==t.alphaMap&&(n.alphaMap=i(t.alphaMap)),void 0!==t.bumpMap&&(n.bumpMap=i(t.bumpMap)),void 0!==t.bumpScale&&(n.bumpScale=t.bumpScale),void 0!==t.normalMap&&(n.normalMap=i(t.normalMap)),void 0!==t.normalMapType&&(n.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),n.normalScale=(new At).fromArray(e)}return void 0!==t.displacementMap&&(n.displacementMap=i(t.displacementMap)),void 0!==t.displacementScale&&(n.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(n.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(n.roughnessMap=i(t.roughnessMap)),void 0!==t.metalnessMap&&(n.metalnessMap=i(t.metalnessMap)),void 0!==t.emissiveMap&&(n.emissiveMap=i(t.emissiveMap)),void 0!==t.emissiveIntensity&&(n.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(n.specularMap=i(t.specularMap)),void 0!==t.specularIntensityMap&&(n.specularIntensityMap=i(t.specularIntensityMap)),void 0!==t.specularColorMap&&(n.specularColorMap=i(t.specularColorMap)),void 0!==t.envMap&&(n.envMap=i(t.envMap)),void 0!==t.envMapIntensity&&(n.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(n.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(n.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(n.lightMap=i(t.lightMap)),void 0!==t.lightMapIntensity&&(n.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(n.aoMap=i(t.aoMap)),void 0!==t.aoMapIntensity&&(n.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(n.gradientMap=i(t.gradientMap)),void 0!==t.clearcoatMap&&(n.clearcoatMap=i(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(n.clearcoatRoughnessMap=i(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(n.clearcoatNormalMap=i(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(n.clearcoatNormalScale=(new At).fromArray(t.clearcoatNormalScale)),void 0!==t.iridescenceMap&&(n.iridescenceMap=i(t.iridescenceMap)),void 0!==t.iridescenceThicknessMap&&(n.iridescenceThicknessMap=i(t.iridescenceThicknessMap)),void 0!==t.transmissionMap&&(n.transmissionMap=i(t.transmissionMap)),void 0!==t.thicknessMap&&(n.thicknessMap=i(t.thicknessMap)),void 0!==t.sheenColorMap&&(n.sheenColorMap=i(t.sheenColorMap)),void 0!==t.sheenRoughnessMap&&(n.sheenRoughnessMap=i(t.sheenRoughnessMap)),n}setTextures(t){return this.textures=t,this}static createMaterialFromType(t){return new{ShadowMaterial:Cl,SpriteMaterial:ra,RawShaderMaterial:Ll,ShaderMaterial:en,PointsMaterial:Ka,MeshPhysicalMaterial:Il,MeshStandardMaterial:Pl,MeshPhongMaterial:Dl,MeshToonMaterial:Nl,MeshNormalMaterial:Ol,MeshLambertMaterial:Fl,MeshDepthMaterial:Fs,MeshDistanceMaterial:Us,MeshBasicMaterial:_i,MeshMatcapMaterial:Ul,LineDashedMaterial:Bl,LineBasicMaterial:Ga,Material:gi}[t]}}class Nc{static decodeText(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let i=0,n=t.length;i<n;i++)e+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(e))}catch(t){return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.slice(0,e+1)}static resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class Oc extends Pi{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const t=super.toJSON(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}class Fc extends cc{constructor(t){super(t)}load(t,e,i,n){const r=this,s=new dc(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,(function(i){try{e(r.parse(JSON.parse(i)))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}}),i,n)}parse(t){const e={},i={};function n(t,n){if(void 0!==e[n])return e[n];const r=t.interleavedBuffers[n],s=function(t,e){if(void 0!==i[e])return i[e];const n=t.arrayBuffers[e],r=new Uint32Array(n).buffer;return i[e]=r,r}(t,r.buffer),a=Pt(r.type,s),o=new ea(a,r.stride);return o.uuid=r.uuid,e[n]=o,o}const r=t.isInstancedBufferGeometry?new Oc:new Pi,s=t.data.index;if(void 0!==s){const t=Pt(s.type,s.array);r.setIndex(new yi(t,1))}const a=t.data.attributes;for(const e in a){const i=a[e];let s;if(i.isInterleavedBufferAttribute){const e=n(t.data,i.data);s=new na(e,i.itemSize,i.offset,i.normalized)}else{const t=Pt(i.type,i.array);s=new(i.isInstancedBufferAttribute?Na:yi)(t,i.itemSize,i.normalized)}void 0!==i.name&&(s.name=i.name),void 0!==i.usage&&s.setUsage(i.usage),void 0!==i.updateRange&&(s.updateRange.offset=i.updateRange.offset,s.updateRange.count=i.updateRange.count),r.setAttribute(e,s)}const o=t.data.morphAttributes;if(o)for(const e in o){const i=o[e],s=[];for(let e=0,r=i.length;e<r;e++){const r=i[e];let a;if(r.isInterleavedBufferAttribute){const e=n(t.data,r.data);a=new na(e,r.itemSize,r.offset,r.normalized)}else{const t=Pt(r.type,r.array);a=new yi(t,r.itemSize,r.normalized)}void 0!==r.name&&(a.name=r.name),s.push(a)}r.morphAttributes[e]=s}t.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const l=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==l)for(let t=0,e=l.length;t!==e;++t){const e=l[t];r.addGroup(e.start,e.count,e.materialIndex)}const c=t.data.boundingSphere;if(void 0!==c){const t=new ee;void 0!==c.center&&t.fromArray(c.center),r.boundingSphere=new Se(t,c.radius)}return t.name&&(r.name=t.name),t.userData&&(r.userData=t.userData),r}}const Uc={UVMapping:n,CubeReflectionMapping:r,CubeRefractionMapping:s,EquirectangularReflectionMapping:a,EquirectangularRefractionMapping:o,CubeUVReflectionMapping:l},Bc={RepeatWrapping:c,ClampToEdgeWrapping:h,MirroredRepeatWrapping:u},zc={NearestFilter:d,NearestMipmapNearestFilter:p,NearestMipmapLinearFilter:f,LinearFilter:m,LinearMipmapNearestFilter:g,LinearMipmapLinearFilter:_};let Gc;const kc={getContext:function(){return void 0===Gc&&(Gc=new(window.AudioContext||window.webkitAudioContext)),Gc},setContext:function(t){Gc=t}};const Hc=new Ie,Vc=new Ie,Wc=new Ie;class Xc{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=jc(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=jc();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function jc(){return("undefined"==typeof performance?Date:performance).now()}const qc=new ee,Yc=new te,Zc=new ee,Jc=new ee;class Kc extends ni{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const Qc=new ee,$c=new te,th=new ee,eh=new ee;class ih{constructor(t,e,i){let n,r,s;switch(this.binding=t,this.valueSize=i,e){case"quaternion":n=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const i=this.buffer,n=this.valueSize,r=t*n+n;let s=this.cumulativeWeight;if(0===s){for(let t=0;t!==n;++t)i[r+t]=i[t];s=e}else{s+=e;const t=e/s;this._mixBufferRegion(i,r,0,t,n)}this.cumulativeWeight=s}accumulateAdditive(t){const e=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,n,0,t,i),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,i=this.buffer,n=t*e+e,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const t=e*this._origIndex;this._mixBufferRegion(i,n,t,1-r,e)}s>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*e,1,e);for(let t=e,r=e+e;t!==r;++t)if(i[t]!==i[t+e]){a.setValue(i,n);break}}saveOriginalState(){const t=this.binding,e=this.buffer,i=this.valueSize,n=i*this._origIndex;t.getValue(e,n);for(let t=i,r=n;t!==r;++t)e[t]=e[n+t%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let i=t;i<e;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[e+i]=this.buffer[t+i]}_select(t,e,i,n,r){if(n>=.5)for(let n=0;n!==r;++n)t[e+n]=t[i+n]}_slerp(t,e,i,n){te.slerpFlat(t,e,t,e,t,i,n)}_slerpAdditive(t,e,i,n,r){const s=this._workIndex*r;te.multiplyQuaternionsFlat(t,s,t,e,t,i),te.slerpFlat(t,e,t,e,t,s,n)}_lerp(t,e,i,n,r){const s=1-n;for(let a=0;a!==r;++a){const r=e+a;t[r]=t[r]*s+t[i+a]*n}}_lerpAdditive(t,e,i,n,r){for(let s=0;s!==r;++s){const r=e+s;t[r]=t[r]+t[i+s]*n}}}const nh="\\[\\]\\.:\\/",rh=new RegExp("[\\[\\]\\.:\\/]","g"),sh="[^\\[\\]\\.:\\/]",ah="[^"+nh.replace("\\.","")+"]",oh=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",sh)+/(WCOD+)?/.source.replace("WCOD",ah)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",sh)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",sh)+"$"),lh=["material","materials","bones"];class ch{constructor(t,e,i){this.path=e,this.parsedPath=i||ch.parseTrackName(e),this.node=ch.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,i){return t&&t.isAnimationObjectGroup?new ch.Composite(t,e,i):new ch(t,e,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(rh,"")}static parseTrackName(t){const e=oh.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){const t=i.nodeName.substring(n+1);-1!==lh.indexOf(t)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=t)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const i=t.skeleton.getBoneByName(e);if(void 0!==i)return i}if(t.children){const i=function(t){for(let n=0;n<t.length;n++){const r=t[n];if(r.name===e||r.uuid===e)return r;const s=i(r.children);if(s)return s}return null},n=i(t.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)t[e++]=i[n]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,i=e.objectName,n=e.propertyName;let r=e.propertyIndex;if(t||(t=ch.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let n=e.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===n){n=e;break}break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==n){if(void 0===t[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[n]}}const s=t[n];if(void 0===s){const i=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+n+" but it wasn't found.",t)}let a=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}ch.Composite=class{constructor(t,e,i){const n=i||ch.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}getValue(t,e){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(t,e)}setValue(t,e){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}},ch.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},ch.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},ch.prototype.GetterByBindingType=[ch.prototype._getValue_direct,ch.prototype._getValue_array,ch.prototype._getValue_arrayElement,ch.prototype._getValue_toArray],ch.prototype.SetterByBindingTypeAndVersioning=[[ch.prototype._setValue_direct,ch.prototype._setValue_direct_setNeedsUpdate,ch.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ch.prototype._setValue_array,ch.prototype._setValue_array_setNeedsUpdate,ch.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ch.prototype._setValue_arrayElement,ch.prototype._setValue_arrayElement_setNeedsUpdate,ch.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ch.prototype._setValue_fromArray,ch.prototype._setValue_fromArray_setNeedsUpdate,ch.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class hh{constructor(t,e,i=null,n=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=i,this.blendMode=n;const r=e.tracks,s=r.length,a=new Array(s),o={endingStart:et,endingEnd:et};for(let t=0;t!==s;++t){const e=r[t].createInterpolant(null);a[t]=e,e.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){const i=this._clip.duration,n=t._clip.duration,r=n/i,s=i/n;t.warp(1,r,e),this.warp(s,1,e)}return this}crossFadeTo(t,e,i){return t.crossFadeFrom(this,e,i)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,i){const n=this._mixer,r=n.time,s=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=n._lendControlInterpolant(),this._timeScaleInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=r,o[1]=r+i,l[0]=t/s,l[1]=e/s,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,i,n){if(!this.enabled)return void this._updateWeight(t);const r=this._startTime;if(null!==r){const n=(t-r)*i;if(n<0||0===i)return;this._startTime=null,e=i*n}e*=this._updateTimeScale(t);const s=this._updateTime(e),a=this._updateWeight(t);if(a>0){const t=this._interpolants,e=this._propertyBindings;switch(this.blendMode){case st:for(let i=0,n=t.length;i!==n;++i)t[i].evaluate(s),e[i].accumulateAdditive(a);break;case rt:default:for(let i=0,r=t.length;i!==r;++i)t[i].evaluate(s),e[i].accumulate(n,a)}}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const i=this._weightInterpolant;if(null!==i){const n=i.evaluate(t)[0];e*=n,t>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const i=this._timeScaleInterpolant;if(null!==i){e*=i.evaluate(t)[0],t>i.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,i=this.loop;let n=this.time+t,r=this._loopCount;const s=2202===i;if(0===t)return-1===r?n:s&&1==(1&r)?e-n:n;if(2200===i){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(n>=e)n=e;else{if(!(n<0)){this.time=n;break t}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),n>=e||n<0){const i=Math.floor(n/e);n-=e*i,r+=Math.abs(i);const a=this.repetitions-r;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=t>0?e:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===a){const e=t<0;this._setEndings(e,!e,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=n;if(s&&1==(1&r))return e-n}return n}_setEndings(t,e,i){const n=this._interpolantSettings;i?(n.endingStart=it,n.endingEnd=it):(n.endingStart=t?this.zeroSlopeAtStart?it:et:nt,n.endingEnd=e?this.zeroSlopeAtEnd?it:et:nt)}_scheduleFading(t,e,i){const n=this._mixer,r=n.time;let s=this._weightInterpolant;null===s&&(s=n._lendControlInterpolant(),this._weightInterpolant=s);const a=s.parameterPositions,o=s.sampleValues;return a[0]=r,o[0]=e,a[1]=r+t,o[1]=i,this}}const uh=new Float32Array(1);class dh{constructor(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}clone(){return new dh(void 0===this.value.clone?this.value:this.value.clone())}}let ph=0;function fh(t,e){return t.distance-e.distance}function mh(t,e,i,n){if(t.layers.test(e.layers)&&t.raycast(e,i),!0===n){const n=t.children;for(let t=0,r=n.length;t<r;t++)mh(n[t],e,i,!0)}}const gh=new At;const _h=new ee,vh=new ee;const xh=new ee;const yh=new ee,Mh=new Ie,bh=new Ie;function Sh(t){const e=[];!0===t.isBone&&e.push(t);for(let i=0;i<t.children.length;i++)e.push.apply(e,Sh(t.children[i]));return e}const wh=new ee,Th=new Vt,Eh=new Vt;const Ah=new ee,Rh=new ee,Ch=new ee;const Lh=new ee,Ph=new nn;function Ih(t,e,i,n,r,s,a){Lh.set(r,s,a).unproject(n);const o=e[t];if(void 0!==o){const t=i.getAttribute("position");for(let e=0,i=o.length;e<i;e++)t.setXYZ(o[e],Lh.x,Lh.y,Lh.z)}}const Dh=new re;const Nh=new ee;let Oh,Fh;const Uh=Bh();function Bh(){const t=new ArrayBuffer(4),e=new Float32Array(t),i=new Uint32Array(t),n=new Uint32Array(512),r=new Uint32Array(512);for(let t=0;t<256;++t){const e=t-127;e<-27?(n[t]=0,n[256|t]=32768,r[t]=24,r[256|t]=24):e<-14?(n[t]=1024>>-e-14,n[256|t]=1024>>-e-14|32768,r[t]=-e-1,r[256|t]=-e-1):e<=15?(n[t]=e+15<<10,n[256|t]=e+15<<10|32768,r[t]=13,r[256|t]=13):e<128?(n[t]=31744,n[256|t]=64512,r[t]=24,r[256|t]=24):(n[t]=31744,n[256|t]=64512,r[t]=13,r[256|t]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let t=1;t<1024;++t){let e=t<<13,i=0;for(;0==(8388608&e);)e<<=1,i-=8388608;e&=-8388609,i+=947912704,s[t]=e|i}for(let t=1024;t<2048;++t)s[t]=939524096+(t-1024<<13);for(let t=1;t<31;++t)a[t]=t<<23;a[31]=1199570944,a[32]=2147483648;for(let t=33;t<63;++t)a[t]=2147483648+(t-32<<23);a[63]=3347054592;for(let t=1;t<64;++t)32!==t&&(o[t]=1024);return{floatView:e,uint32View:i,baseTable:n,shiftTable:r,mantissaTable:s,exponentTable:a,offsetTable:o}}var zh=Object.freeze({__proto__:null,toHalfFloat:function(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=yt(t,-65504,65504),Uh.floatView[0]=t;const e=Uh.uint32View[0],i=e>>23&511;return Uh.baseTable[i]+((8388607&e)>>Uh.shiftTable[i])},fromHalfFloat:function(t){const e=t>>10;return Uh.uint32View[0]=Uh.mantissaTable[Uh.offsetTable[e]+(1023&t)]+Uh.exponentTable[e],Uh.floatView[0]}});"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:e}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=e),t.ACESFilmicToneMapping=4,t.AddEquation=i,t.AddOperation=2,t.AdditiveAnimationBlendMode=st,t.AdditiveBlending=2,t.AlphaFormat=1021,t.AlwaysDepth=1,t.AlwaysStencilFunc=519,t.AmbientLight=Cc,t.AmbientLightProbe=class extends Ic{constructor(t,e=1){super(void 0,e),this.isAmbientLightProbe=!0;const i=(new Vt).set(t);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}},t.AnimationClip=rc,t.AnimationLoader=class extends cc{constructor(t){super(t)}load(t,e,i,n){const r=this,s=new dc(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(i){try{e(r.parse(JSON.parse(i)))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}}),i,n)}parse(t){const e=[];for(let i=0;i<t.length;i++){const n=rc.parse(t[i]);e.push(n)}return e}},t.AnimationMixer=class extends ft{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const i=t._localRoot||this._root,n=t._clip.tracks,r=n.length,s=t._propertyBindings,a=t._interpolants,o=i.uuid,l=this._bindingsByRootAndName;let c=l[o];void 0===c&&(c={},l[o]=c);for(let t=0;t!==r;++t){const r=n[t],l=r.name;let h=c[l];if(void 0!==h)++h.referenceCount,s[t]=h;else{if(h=s[t],void 0!==h){null===h._cacheIndex&&(++h.referenceCount,this._addInactiveBinding(h,o,l));continue}const n=e&&e._propertyBindings[t].binding.parsedPath;h=new ih(ch.create(i,l,n),r.ValueTypeName,r.getValueSize()),++h.referenceCount,this._addInactiveBinding(h,o,l),s[t]=h}a[t].resultBuffer=h.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,i=t._clip.uuid,n=this._actionsByClip[i];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,i,e)}const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,i){const n=this._actions,r=this._actionsByClip;let s=r[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=s;else{const e=s.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=n.length,n.push(t),s.actionByRoot[i]=t}_removeInactiveAction(t){const e=this._actions,i=e[e.length-1],n=t._cacheIndex;i._cacheIndex=n,e[n]=i,e.pop(),t._cacheIndex=null;const r=t._clip.uuid,s=this._actionsByClip,a=s[r],o=a.knownActions,l=o[o.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,o[c]=l,o.pop(),t._byClipCacheIndex=null;delete a.actionByRoot[(t._localRoot||this._root).uuid],0===o.length&&delete s[r],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.referenceCount&&this._removeInactiveBinding(i)}}_lendAction(t){const e=this._actions,i=t._cacheIndex,n=this._nActiveActions++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_takeBackAction(t){const e=this._actions,i=t._cacheIndex,n=--this._nActiveActions,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_addInactiveBinding(t,e,i){const n=this._bindingsByRootAndName,r=this._bindings;let s=n[e];void 0===s&&(s={},n[e]=s),s[i]=t,t._cacheIndex=r.length,r.push(t)}_removeInactiveBinding(t){const e=this._bindings,i=t.binding,n=i.rootNode.uuid,r=i.path,s=this._bindingsByRootAndName,a=s[n],o=e[e.length-1],l=t._cacheIndex;o._cacheIndex=l,e[l]=o,e.pop(),delete a[r],0===Object.keys(a).length&&delete s[n]}_lendBinding(t){const e=this._bindings,i=t._cacheIndex,n=this._nActiveBindings++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_takeBackBinding(t){const e=this._bindings,i=t._cacheIndex,n=--this._nActiveBindings,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let i=t[e];return void 0===i&&(i=new Yl(new Float32Array(2),new Float32Array(2),1,uh),i.__cacheIndex=e,t[e]=i),i}_takeBackControlInterpolant(t){const e=this._controlInterpolants,i=t.__cacheIndex,n=--this._nActiveControlInterpolants,r=e[n];t.__cacheIndex=n,e[n]=t,r.__cacheIndex=i,e[i]=r}clipAction(t,e,i){const n=e||this._root,r=n.uuid;let s="string"==typeof t?rc.findByName(n,t):t;const a=null!==s?s.uuid:t,o=this._actionsByClip[a];let l=null;if(void 0===i&&(i=null!==s?s.blendMode:rt),void 0!==o){const t=o.actionByRoot[r];if(void 0!==t&&t.blendMode===i)return t;l=o.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const c=new hh(this,s,e,i);return this._bindAction(c,l),this._addInactiveAction(c,a,r),c}existingAction(t,e){const i=e||this._root,n=i.uuid,r="string"==typeof t?rc.findByName(i,t):t,s=r?r.uuid:t,a=this._actionsByClip[s];return void 0!==a&&a.actionByRoot[n]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,i=this._nActiveActions,n=this.time+=t,r=Math.sign(t),s=this._accuIndex^=1;for(let a=0;a!==i;++a){e[a]._update(n,t,r,s)}const a=this._bindings,o=this._nActiveBindings;for(let t=0;t!==o;++t)a[t].apply(s);return this}setTime(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,i=t.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){const t=r.knownActions;for(let i=0,n=t.length;i!==n;++i){const n=t[i];this._deactivateAction(n);const r=n._cacheIndex,s=e[e.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,s._cacheIndex=r,e[r]=s,e.pop(),this._removeInactiveBindingsForAction(n)}delete n[i]}}uncacheRoot(t){const e=t.uuid,i=this._actionsByClip;for(const t in i){const n=i[t].actionByRoot[e];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}const n=this._bindingsByRootAndName[e];if(void 0!==n)for(const t in n){const e=n[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(t,e){const i=this.existingAction(t,e);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}},t.AnimationObjectGroup=class{constructor(){this.isAnimationObjectGroup=!0,this.uuid=xt(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let e=0,i=arguments.length;e!==i;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const t=this._objects,e=this._indicesByUUID,i=this._paths,n=this._parsedPaths,r=this._bindings,s=r.length;let a,o=t.length,l=this.nCachedObjects_;for(let c=0,h=arguments.length;c!==h;++c){const h=arguments[c],u=h.uuid;let d=e[u];if(void 0===d){d=o++,e[u]=d,t.push(h);for(let t=0,e=s;t!==e;++t)r[t].push(new ch(h,i[t],n[t]))}else if(d<l){a=t[d];const o=--l,c=t[o];e[c.uuid]=d,t[d]=c,e[u]=o,t[o]=h;for(let t=0,e=s;t!==e;++t){const e=r[t],s=e[o];let a=e[d];e[d]=s,void 0===a&&(a=new ch(h,i[t],n[t])),e[o]=a}}else t[d]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const t=this._objects,e=this._indicesByUUID,i=this._bindings,n=i.length;let r=this.nCachedObjects_;for(let s=0,a=arguments.length;s!==a;++s){const a=arguments[s],o=a.uuid,l=e[o];if(void 0!==l&&l>=r){const s=r++,c=t[s];e[c.uuid]=l,t[l]=c,e[o]=s,t[s]=a;for(let t=0,e=n;t!==e;++t){const e=i[t],n=e[s],r=e[l];e[l]=n,e[s]=r}}}this.nCachedObjects_=r}uncache(){const t=this._objects,e=this._indicesByUUID,i=this._bindings,n=i.length;let r=this.nCachedObjects_,s=t.length;for(let a=0,o=arguments.length;a!==o;++a){const o=arguments[a].uuid,l=e[o];if(void 0!==l)if(delete e[o],l<r){const a=--r,o=t[a],c=--s,h=t[c];e[o.uuid]=l,t[l]=o,e[h.uuid]=a,t[a]=h,t.pop();for(let t=0,e=n;t!==e;++t){const e=i[t],n=e[a],r=e[c];e[l]=n,e[a]=r,e.pop()}}else{const r=--s,a=t[r];r>0&&(e[a.uuid]=l),t[l]=a,t.pop();for(let t=0,e=n;t!==e;++t){const e=i[t];e[l]=e[r],e.pop()}}}this.nCachedObjects_=r}subscribe_(t,e){const i=this._bindingsIndicesByPath;let n=i[t];const r=this._bindings;if(void 0!==n)return r[n];const s=this._paths,a=this._parsedPaths,o=this._objects,l=o.length,c=this.nCachedObjects_,h=new Array(l);n=r.length,i[t]=n,s.push(t),a.push(e),r.push(h);for(let i=c,n=o.length;i!==n;++i){const n=o[i];h[i]=new ch(n,t,e)}return h}unsubscribe_(t){const e=this._bindingsIndicesByPath,i=e[t];if(void 0!==i){const n=this._paths,r=this._parsedPaths,s=this._bindings,a=s.length-1,o=s[a];e[t[a]]=i,s[i]=o,s.pop(),r[i]=r[a],r.pop(),n[i]=n[a],n.pop()}}},t.AnimationUtils=Xl,t.ArcCurve=oo,t.ArrayCamera=Hs,t.ArrowHelper=class extends ni{constructor(t=new ee(0,0,1),e=new ee(0,0,0),i=1,n=16776960,r=.2*i,s=.2*r){super(),this.type="ArrowHelper",void 0===Oh&&(Oh=new Pi,Oh.setAttribute("position",new Si([0,0,0,0,1,0],3)),Fh=new Po(0,.5,1,5,1),Fh.translate(0,-.5,0)),this.position.copy(e),this.line=new ja(Oh,new Ga({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Zi(Fh,new _i({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(i,r,s)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{Nh.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(Nh,e)}}setLength(t,e=.2*t,i=.2*e){this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(i,e,i),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}},t.Audio=Kc,t.AudioAnalyser=class{constructor(t,e=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let i=0;i<e.length;i++)t+=e[i];return t/e.length}},t.AudioContext=kc,t.AudioListener=class extends ni{constructor(){super(),this.type="AudioListener",this.context=kc.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Xc}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(qc,Yc,Zc),Jc.set(0,0,-1).applyQuaternion(Yc),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(qc.x,t),e.positionY.linearRampToValueAtTime(qc.y,t),e.positionZ.linearRampToValueAtTime(qc.z,t),e.forwardX.linearRampToValueAtTime(Jc.x,t),e.forwardY.linearRampToValueAtTime(Jc.y,t),e.forwardZ.linearRampToValueAtTime(Jc.z,t),e.upX.linearRampToValueAtTime(i.x,t),e.upY.linearRampToValueAtTime(i.y,t),e.upZ.linearRampToValueAtTime(i.z,t)}else e.setPosition(qc.x,qc.y,qc.z),e.setOrientation(Jc.x,Jc.y,Jc.z,i.x,i.y,i.z)}},t.AudioLoader=class extends cc{constructor(t){super(t)}load(t,e,i,n){const r=this,s=new dc(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(i){try{const t=i.slice(0);kc.getContext().decodeAudioData(t,(function(t){e(t)}))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}}),i,n)}},t.AxesHelper=class extends Za{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=new Pi;i.setAttribute("position",new Si(e,3)),i.setAttribute("color",new Si([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(i,new Ga({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(t,e,i){const n=new Vt,r=this.geometry.attributes.color.array;return n.set(t),n.toArray(r,0),n.toArray(r,3),n.set(e),n.toArray(r,6),n.toArray(r,9),n.set(i),n.toArray(r,12),n.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},t.BackSide=1,t.BasicDepthPacking=3200,t.BasicShadowMap=0,t.Bone=Ca,t.BooleanKeyframeTrack=Kl,t.Box2=class{constructor(t=new At(1/0,1/0),e=new At(-1/0,-1/0)){this.isBox2=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=gh.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return gh.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}},t.Box3=re,t.Box3Helper=class extends Za{constructor(t,e=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Pi;n.setIndex(new yi(i,1)),n.setAttribute("position",new Si([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(n,new Ga({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}},t.BoxBufferGeometry=Ki,t.BoxGeometry=Ki,t.BoxHelper=class extends Za{constructor(t,e=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),r=new Pi;r.setIndex(new yi(i,1)),r.setAttribute("position",new yi(n,3)),super(r,new Ga({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Dh.setFromObject(this.object),Dh.isEmpty())return;const e=Dh.min,i=Dh.max,n=this.geometry.attributes.position,r=n.array;r[0]=i.x,r[1]=i.y,r[2]=i.z,r[3]=e.x,r[4]=i.y,r[5]=i.z,r[6]=e.x,r[7]=e.y,r[8]=i.z,r[9]=i.x,r[10]=e.y,r[11]=i.z,r[12]=i.x,r[13]=i.y,r[14]=e.z,r[15]=e.x,r[16]=i.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=i.x,r[22]=e.y,r[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t,e){return super.copy(t,e),this.object=t.object,this}},t.BufferAttribute=yi,t.BufferGeometry=Pi,t.BufferGeometryLoader=Fc,t.ByteType=1010,t.Cache=ac,t.Camera=nn,t.CameraHelper=class extends Za{constructor(t){const e=new Pi,i=new Ga({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],r=[],s={};function a(t,e){o(t),o(e)}function o(t){n.push(0,0,0),r.push(0,0,0),void 0===s[t]&&(s[t]=[]),s[t].push(n.length/3-1)}a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4"),e.setAttribute("position",new Si(n,3)),e.setAttribute("color",new Si(r,3)),super(e,i),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();const l=new Vt(16755200),c=new Vt(16711680),h=new Vt(43775),u=new Vt(16777215),d=new Vt(3355443);this.setColors(l,c,h,u,d)}setColors(t,e,i,n,r){const s=this.geometry.getAttribute("color");s.setXYZ(0,t.r,t.g,t.b),s.setXYZ(1,t.r,t.g,t.b),s.setXYZ(2,t.r,t.g,t.b),s.setXYZ(3,t.r,t.g,t.b),s.setXYZ(4,t.r,t.g,t.b),s.setXYZ(5,t.r,t.g,t.b),s.setXYZ(6,t.r,t.g,t.b),s.setXYZ(7,t.r,t.g,t.b),s.setXYZ(8,t.r,t.g,t.b),s.setXYZ(9,t.r,t.g,t.b),s.setXYZ(10,t.r,t.g,t.b),s.setXYZ(11,t.r,t.g,t.b),s.setXYZ(12,t.r,t.g,t.b),s.setXYZ(13,t.r,t.g,t.b),s.setXYZ(14,t.r,t.g,t.b),s.setXYZ(15,t.r,t.g,t.b),s.setXYZ(16,t.r,t.g,t.b),s.setXYZ(17,t.r,t.g,t.b),s.setXYZ(18,t.r,t.g,t.b),s.setXYZ(19,t.r,t.g,t.b),s.setXYZ(20,t.r,t.g,t.b),s.setXYZ(21,t.r,t.g,t.b),s.setXYZ(22,t.r,t.g,t.b),s.setXYZ(23,t.r,t.g,t.b),s.setXYZ(24,e.r,e.g,e.b),s.setXYZ(25,e.r,e.g,e.b),s.setXYZ(26,e.r,e.g,e.b),s.setXYZ(27,e.r,e.g,e.b),s.setXYZ(28,e.r,e.g,e.b),s.setXYZ(29,e.r,e.g,e.b),s.setXYZ(30,e.r,e.g,e.b),s.setXYZ(31,e.r,e.g,e.b),s.setXYZ(32,i.r,i.g,i.b),s.setXYZ(33,i.r,i.g,i.b),s.setXYZ(34,i.r,i.g,i.b),s.setXYZ(35,i.r,i.g,i.b),s.setXYZ(36,i.r,i.g,i.b),s.setXYZ(37,i.r,i.g,i.b),s.setXYZ(38,n.r,n.g,n.b),s.setXYZ(39,n.r,n.g,n.b),s.setXYZ(40,r.r,r.g,r.b),s.setXYZ(41,r.r,r.g,r.b),s.setXYZ(42,r.r,r.g,r.b),s.setXYZ(43,r.r,r.g,r.b),s.setXYZ(44,r.r,r.g,r.b),s.setXYZ(45,r.r,r.g,r.b),s.setXYZ(46,r.r,r.g,r.b),s.setXYZ(47,r.r,r.g,r.b),s.setXYZ(48,r.r,r.g,r.b),s.setXYZ(49,r.r,r.g,r.b),s.needsUpdate=!0}update(){const t=this.geometry,e=this.pointMap;Ph.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Ih("c",e,t,Ph,0,0,-1),Ih("t",e,t,Ph,0,0,1),Ih("n1",e,t,Ph,-1,-1,-1),Ih("n2",e,t,Ph,1,-1,-1),Ih("n3",e,t,Ph,-1,1,-1),Ih("n4",e,t,Ph,1,1,-1),Ih("f1",e,t,Ph,-1,-1,1),Ih("f2",e,t,Ph,1,-1,1),Ih("f3",e,t,Ph,-1,1,1),Ih("f4",e,t,Ph,1,1,1),Ih("u1",e,t,Ph,.7,1.1,-1),Ih("u2",e,t,Ph,-.7,1.1,-1),Ih("u3",e,t,Ph,0,2,-1),Ih("cf1",e,t,Ph,-1,0,1),Ih("cf2",e,t,Ph,1,0,1),Ih("cf3",e,t,Ph,0,-1,1),Ih("cf4",e,t,Ph,0,1,1),Ih("cn1",e,t,Ph,-1,0,-1),Ih("cn2",e,t,Ph,1,0,-1),Ih("cn3",e,t,Ph,0,-1,-1),Ih("cn4",e,t,Ph,0,1,-1),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}},t.CanvasTexture=class extends Zt{constructor(t,e,i,n,r,s,a,o,l){super(t,e,i,n,r,s,a,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}},t.CapsuleBufferGeometry=Co,t.CapsuleGeometry=Co,t.CatmullRomCurve3=fo,t.CineonToneMapping=3,t.CircleBufferGeometry=Lo,t.CircleGeometry=Lo,t.ClampToEdgeWrapping=h,t.Clock=Xc,t.Color=Vt,t.ColorKeyframeTrack=Ql,t.ColorManagement=Ft,t.CompressedTexture=ro,t.CompressedTextureLoader=class extends cc{constructor(t){super(t)}load(t,e,i,n){const r=this,s=[],a=new ro,o=new dc(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(r.withCredentials);let l=0;function c(c){o.load(t[c],(function(t){const i=r.parse(t,!0);s[c]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},l+=1,6===l&&(1===i.mipmapCount&&(a.minFilter=m),a.image=s,a.format=i.format,a.needsUpdate=!0,e&&e(a))}),i,n)}if(Array.isArray(t))for(let e=0,i=t.length;e<i;++e)c(e);else o.load(t,(function(t){const i=r.parse(t,!0);if(i.isCubemap){const t=i.mipmaps.length/i.mipmapCount;for(let e=0;e<t;e++){s[e]={mipmaps:[]};for(let t=0;t<i.mipmapCount;t++)s[e].mipmaps.push(i.mipmaps[e*i.mipmapCount+t]),s[e].format=i.format,s[e].width=i.width,s[e].height=i.height}a.image=s}else a.image.width=i.width,a.image.height=i.height,a.mipmaps=i.mipmaps;1===i.mipmapCount&&(a.minFilter=m),a.format=i.format,a.needsUpdate=!0,e&&e(a)}),i,n);return a}},t.ConeBufferGeometry=Io,t.ConeGeometry=Io,t.CubeCamera=an,t.CubeReflectionMapping=r,t.CubeRefractionMapping=s,t.CubeTexture=on,t.CubeTextureLoader=class extends cc{constructor(t){super(t)}load(t,e,i,n){const r=new on,s=new pc(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let a=0;function o(i){s.load(t[i],(function(t){r.images[i]=t,a++,6===a&&(r.needsUpdate=!0,e&&e(r))}),void 0,n)}for(let e=0;e<t.length;++e)o(e);return r}},t.CubeUVReflectionMapping=l,t.CubicBezierCurve=vo,t.CubicBezierCurve3=xo,t.CubicInterpolant=ql,t.CullFaceBack=1,t.CullFaceFront=2,t.CullFaceFrontBack=3,t.CullFaceNone=0,t.Curve=so,t.CurvePath=Eo,t.CustomBlending=5,t.CustomToneMapping=5,t.CylinderBufferGeometry=Po,t.CylinderGeometry=Po,t.Cylindrical=class{constructor(t=1,e=0,i=0){return this.radius=t,this.theta=e,this.y=i,this}set(t,e,i){return this.radius=t,this.theta=e,this.y=i,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+i*i),this.theta=Math.atan2(t,i),this.y=e,this}clone(){return(new this.constructor).copy(this)}},t.Data3DTexture=$t,t.DataArrayTexture=Qt,t.DataTexture=La,t.DataTexture2DArray=class extends Qt{constructor(t,e,i,n){console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),super(t,e,i,n)}},t.DataTexture3D=class extends $t{constructor(t,e,i,n){console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),super(t,e,i,n)}},t.DataTextureLoader=class extends cc{constructor(t){super(t)}load(t,e,i,n){const r=this,s=new La,a=new dc(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(r.withCredentials),a.load(t,(function(t){const i=r.parse(t);i&&(void 0!==i.image?s.image=i.image:void 0!==i.data&&(s.image.width=i.width,s.image.height=i.height,s.image.data=i.data),s.wrapS=void 0!==i.wrapS?i.wrapS:h,s.wrapT=void 0!==i.wrapT?i.wrapT:h,s.magFilter=void 0!==i.magFilter?i.magFilter:m,s.minFilter=void 0!==i.minFilter?i.minFilter:m,s.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.encoding&&(s.encoding=i.encoding),void 0!==i.flipY&&(s.flipY=i.flipY),void 0!==i.format&&(s.format=i.format),void 0!==i.type&&(s.type=i.type),void 0!==i.mipmaps&&(s.mipmaps=i.mipmaps,s.minFilter=_),1===i.mipmapCount&&(s.minFilter=m),void 0!==i.generateMipmaps&&(s.generateMipmaps=i.generateMipmaps),s.needsUpdate=!0,e&&e(s,i))}),i,n),s}},t.DataUtils=zh,t.DecrementStencilOp=7683,t.DecrementWrapStencilOp=34056,t.DefaultLoadingManager=lc,t.DepthFormat=T,t.DepthStencilFormat=E,t.DepthTexture=js,t.DirectionalLight=Rc,t.DirectionalLightHelper=class extends ni{constructor(t,e,i){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,void 0===e&&(e=1);let n=new Pi;n.setAttribute("position",new Si([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const r=new Ga({fog:!1,toneMapped:!1});this.lightPlane=new ja(n,r),this.add(this.lightPlane),n=new Pi,n.setAttribute("position",new Si([0,0,0,0,0,1],3)),this.targetLine=new ja(n,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){Ah.setFromMatrixPosition(this.light.matrixWorld),Rh.setFromMatrixPosition(this.light.target.matrixWorld),Ch.subVectors(Rh,Ah),this.lightPlane.lookAt(Rh),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Rh),this.targetLine.scale.z=Ch.length()}},t.DiscreteInterpolant=Zl,t.DodecahedronBufferGeometry=No,t.DodecahedronGeometry=No,t.DoubleSide=2,t.DstAlphaFactor=206,t.DstColorFactor=208,t.DynamicCopyUsage=35050,t.DynamicDrawUsage=35048,t.DynamicReadUsage=35049,t.EdgesGeometry=zo,t.EllipseCurve=ao,t.EqualDepth=4,t.EqualStencilFunc=514,t.EquirectangularReflectionMapping=a,t.EquirectangularRefractionMapping=o,t.Euler=He,t.EventDispatcher=ft,t.ExtrudeBufferGeometry=ml,t.ExtrudeGeometry=ml,t.FileLoader=dc,t.FlatShading=1,t.Float16BufferAttribute=class extends yi{constructor(t,e,i){super(new Uint16Array(t),e,i),this.isFloat16BufferAttribute=!0}},t.Float32BufferAttribute=Si,t.Float64BufferAttribute=class extends yi{constructor(t,e,i){super(new Float64Array(t),e,i)}},t.FloatType=M,t.Fog=$s,t.FogExp2=Qs,t.Font=function(){console.error("THREE.Font has been moved to /examples/jsm/loaders/FontLoader.js")},t.FontLoader=function(){console.error("THREE.FontLoader has been moved to /examples/jsm/loaders/FontLoader.js")},t.FramebufferTexture=class extends Zt{constructor(t,e,i){super({width:t,height:e}),this.isFramebufferTexture=!0,this.format=i,this.magFilter=d,this.minFilter=d,this.generateMipmaps=!1,this.needsUpdate=!0}},t.FrontSide=0,t.Frustum=mn,t.GLBufferAttribute=class{constructor(t,e,i,n,r){this.isGLBufferAttribute=!0,this.buffer=t,this.type=e,this.itemSize=i,this.elementSize=n,this.count=r,this.version=0}set needsUpdate(t){!0===t&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,e){return this.type=t,this.elementSize=e,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}},t.GLSL1="100",t.GLSL3=dt,t.GreaterDepth=6,t.GreaterEqualDepth=5,t.GreaterEqualStencilFunc=518,t.GreaterStencilFunc=516,t.GridHelper=class extends Za{constructor(t=10,e=10,i=4473924,n=8947848){i=new Vt(i),n=new Vt(n);const r=e/2,s=t/e,a=t/2,o=[],l=[];for(let t=0,c=0,h=-a;t<=e;t++,h+=s){o.push(-a,0,h,a,0,h),o.push(h,0,-a,h,0,a);const e=t===r?i:n;e.toArray(l,c),c+=3,e.toArray(l,c),c+=3,e.toArray(l,c),c+=3,e.toArray(l,c),c+=3}const c=new Pi;c.setAttribute("position",new Si(o,3)),c.setAttribute("color",new Si(l,3));super(c,new Ga({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}},t.Group=Vs,t.HalfFloatType=b,t.HemisphereLight=mc,t.HemisphereLightHelper=class extends ni{constructor(t,e,i){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;const n=new vl(e);n.rotateY(.5*Math.PI),this.material=new _i({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const r=n.getAttribute("position"),s=new Float32Array(3*r.count);n.setAttribute("color",new yi(s,3)),this.add(new Zi(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");Th.copy(this.light.color),Eh.copy(this.light.groundColor);for(let t=0,i=e.count;t<i;t++){const n=t<i/2?Th:Eh;e.setXYZ(t,n.r,n.g,n.b)}e.needsUpdate=!0}t.lookAt(wh.setFromMatrixPosition(this.light.matrixWorld).negate())}},t.HemisphereLightProbe=class extends Ic{constructor(t,e,i=1){super(void 0,i),this.isHemisphereLightProbe=!0;const n=(new Vt).set(t),r=(new Vt).set(e),s=new ee(n.r,n.g,n.b),a=new ee(r.r,r.g,r.b),o=Math.sqrt(Math.PI),l=o*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(a).multiplyScalar(o),this.sh.coefficients[1].copy(s).sub(a).multiplyScalar(l)}},t.IcosahedronBufferGeometry=_l,t.IcosahedronGeometry=_l,t.ImageBitmapLoader=class extends cc{constructor(t){super(t),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=ac.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(t,a).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(i){ac.add(t,i),e&&e(i),r.manager.itemEnd(t)})).catch((function(e){n&&n(e),r.manager.itemError(t),r.manager.itemEnd(t)})),r.manager.itemStart(t)}},t.ImageLoader=pc,t.ImageUtils=Xt,t.ImmediateRenderObject=function(){console.error("THREE.ImmediateRenderObject has been removed.")},t.IncrementStencilOp=7682,t.IncrementWrapStencilOp=34055,t.InstancedBufferAttribute=Na,t.InstancedBufferGeometry=Oc,t.InstancedInterleavedBuffer=class extends ea{constructor(t,e,i=1){super(t,e),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}},t.InstancedMesh=za,t.Int16BufferAttribute=class extends yi{constructor(t,e,i){super(new Int16Array(t),e,i)}},t.Int32BufferAttribute=class extends yi{constructor(t,e,i){super(new Int32Array(t),e,i)}},t.Int8BufferAttribute=class extends yi{constructor(t,e,i){super(new Int8Array(t),e,i)}},t.IntType=1013,t.InterleavedBuffer=ea,t.InterleavedBufferAttribute=na,t.Interpolant=jl,t.InterpolateDiscrete=Q,t.InterpolateLinear=$,t.InterpolateSmooth=tt,t.InvertStencilOp=5386,t.KeepStencilOp=ht,t.KeyframeTrack=Jl,t.LOD=ba,t.LatheBufferGeometry=Ro,t.LatheGeometry=Ro,t.Layers=Ve,t.LessDepth=2,t.LessEqualDepth=3,t.LessEqualStencilFunc=515,t.LessStencilFunc=513,t.Light=fc,t.LightProbe=Ic,t.Line=ja,t.Line3=class{constructor(t=new ee,e=new ee){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){_h.subVectors(t,this.start),vh.subVectors(this.end,this.start);const i=vh.dot(vh);let n=vh.dot(_h)/i;return e&&(n=yt(n,0,1)),n}closestPointToPoint(t,e,i){const n=this.closestPointToPointParameter(t,e);return this.delta(i).multiplyScalar(n).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}},t.LineBasicMaterial=Ga,t.LineCurve=yo,t.LineCurve3=Mo,t.LineDashedMaterial=Bl,t.LineLoop=Ja,t.LineSegments=Za,t.LinearEncoding=at,t.LinearFilter=m,t.LinearInterpolant=Yl,t.LinearMipMapLinearFilter=1008,t.LinearMipMapNearestFilter=1007,t.LinearMipmapLinearFilter=_,t.LinearMipmapNearestFilter=g,t.LinearSRGBColorSpace=ct,t.LinearToneMapping=1,t.Loader=cc,t.LoaderUtils=Nc,t.LoadingManager=oc,t.LoopOnce=2200,t.LoopPingPong=2202,t.LoopRepeat=2201,t.LuminanceAlphaFormat=1025,t.LuminanceFormat=1024,t.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},t.Material=gi,t.MaterialLoader=Dc,t.MathUtils=Et,t.Matrix3=Rt,t.Matrix4=Ie,t.MaxEquation=104,t.Mesh=Zi,t.MeshBasicMaterial=_i,t.MeshDepthMaterial=Fs,t.MeshDistanceMaterial=Us,t.MeshLambertMaterial=Fl,t.MeshMatcapMaterial=Ul,t.MeshNormalMaterial=Ol,t.MeshPhongMaterial=Dl,t.MeshPhysicalMaterial=Il,t.MeshStandardMaterial=Pl,t.MeshToonMaterial=Nl,t.MinEquation=103,t.MirroredRepeatWrapping=u,t.MixOperation=1,t.MultiplyBlending=4,t.MultiplyOperation=0,t.NearestFilter=d,t.NearestMipMapLinearFilter=1005,t.NearestMipMapNearestFilter=1004,t.NearestMipmapLinearFilter=f,t.NearestMipmapNearestFilter=p,t.NeverDepth=0,t.NeverStencilFunc=512,t.NoBlending=0,t.NoColorSpace="",t.NoToneMapping=0,t.NormalAnimationBlendMode=rt,t.NormalBlending=1,t.NotEqualDepth=7,t.NotEqualStencilFunc=517,t.NumberKeyframeTrack=$l,t.Object3D=ni,t.ObjectLoader=class extends cc{constructor(t){super(t)}load(t,e,i,n){const r=this,s=""===this.path?Nc.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||s;const a=new dc(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,(function(i){let s=null;try{s=JSON.parse(i)}catch(e){return void 0!==n&&n(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}const a=s.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?r.parse(s,e):console.error("THREE.ObjectLoader: Can't load "+t)}),i,n)}async loadAsync(t,e){const i=""===this.path?Nc.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||i;const n=new dc(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials);const r=await n.loadAsync(t,e),s=JSON.parse(r),a=s.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+t);return await this.parseAsync(s)}parse(t,e){const i=this.parseAnimations(t.animations),n=this.parseShapes(t.shapes),r=this.parseGeometries(t.geometries,n),s=this.parseImages(t.images,(function(){void 0!==e&&e(l)})),a=this.parseTextures(t.textures,s),o=this.parseMaterials(t.materials,a),l=this.parseObject(t.object,r,o,a,i),c=this.parseSkeletons(t.skeletons,l);if(this.bindSkeletons(l,c),void 0!==e){let t=!1;for(const e in s)if(s[e].data instanceof HTMLImageElement){t=!0;break}!1===t&&e(l)}return l}async parseAsync(t){const e=this.parseAnimations(t.animations),i=this.parseShapes(t.shapes),n=this.parseGeometries(t.geometries,i),r=await this.parseImagesAsync(t.images),s=this.parseTextures(t.textures,r),a=this.parseMaterials(t.materials,s),o=this.parseObject(t.object,n,a,s,e),l=this.parseSkeletons(t.skeletons,o);return this.bindSkeletons(o,l),o}parseShapes(t){const e={};if(void 0!==t)for(let i=0,n=t.length;i<n;i++){const n=(new Go).fromJSON(t[i]);e[n.uuid]=n}return e}parseSkeletons(t,e){const i={},n={};if(e.traverse((function(t){t.isBone&&(n[t.uuid]=t)})),void 0!==t)for(let e=0,r=t.length;e<r;e++){const r=(new Da).fromJSON(t[e],n);i[r.uuid]=r}return i}parseGeometries(t,e){const i={};if(void 0!==t){const n=new Fc;for(let r=0,s=t.length;r<s;r++){let s;const a=t[r];switch(a.type){case"BufferGeometry":case"InstancedBufferGeometry":s=n.parse(a);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:a.type in Rl?s=Rl[a.type].fromJSON(a,e):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${a.type}"`)}s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),!0===s.isBufferGeometry&&void 0!==a.userData&&(s.userData=a.userData),i[a.uuid]=s}}return i}parseMaterials(t,e){const i={},n={};if(void 0!==t){const r=new Dc;r.setTextures(e);for(let e=0,s=t.length;e<s;e++){const s=t[e];if("MultiMaterial"===s.type){const t=[];for(let e=0;e<s.materials.length;e++){const n=s.materials[e];void 0===i[n.uuid]&&(i[n.uuid]=r.parse(n)),t.push(i[n.uuid])}n[s.uuid]=t}else void 0===i[s.uuid]&&(i[s.uuid]=r.parse(s)),n[s.uuid]=i[s.uuid]}}return n}parseAnimations(t){const e={};if(void 0!==t)for(let i=0;i<t.length;i++){const n=t[i],r=rc.parse(n);e[r.uuid]=r}return e}parseImages(t,e){const i=this,n={};let r;function s(t){if("string"==typeof t){const e=t;return function(t){return i.manager.itemStart(t),r.load(t,(function(){i.manager.itemEnd(t)}),void 0,(function(){i.manager.itemError(t),i.manager.itemEnd(t)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:i.resourcePath+e)}return t.data?{data:Pt(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){const i=new oc(e);r=new pc(i),r.setCrossOrigin(this.crossOrigin);for(let e=0,i=t.length;e<i;e++){const i=t[e],r=i.url;if(Array.isArray(r)){const t=[];for(let e=0,i=r.length;e<i;e++){const i=s(r[e]);null!==i&&(i instanceof HTMLImageElement?t.push(i):t.push(new La(i.data,i.width,i.height)))}n[i.uuid]=new jt(t)}else{const t=s(i.url);n[i.uuid]=new jt(t)}}}return n}async parseImagesAsync(t){const e=this,i={};let n;async function r(t){if("string"==typeof t){const i=t,r=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(i)?i:e.resourcePath+i;return await n.loadAsync(r)}return t.data?{data:Pt(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){n=new pc(this.manager),n.setCrossOrigin(this.crossOrigin);for(let e=0,n=t.length;e<n;e++){const n=t[e],s=n.url;if(Array.isArray(s)){const t=[];for(let e=0,i=s.length;e<i;e++){const i=s[e],n=await r(i);null!==n&&(n instanceof HTMLImageElement?t.push(n):t.push(new La(n.data,n.width,n.height)))}i[n.uuid]=new jt(t)}else{const t=await r(n.url);i[n.uuid]=new jt(t)}}}return i}parseTextures(t,e){function i(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}const n={};if(void 0!==t)for(let r=0,s=t.length;r<s;r++){const s=t[r];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===e[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);const a=e[s.image],o=a.data;let l;Array.isArray(o)?(l=new on,6===o.length&&(l.needsUpdate=!0)):(l=o&&o.data?new La:new Zt,o&&(l.needsUpdate=!0)),l.source=a,l.uuid=s.uuid,void 0!==s.name&&(l.name=s.name),void 0!==s.mapping&&(l.mapping=i(s.mapping,Uc)),void 0!==s.offset&&l.offset.fromArray(s.offset),void 0!==s.repeat&&l.repeat.fromArray(s.repeat),void 0!==s.center&&l.center.fromArray(s.center),void 0!==s.rotation&&(l.rotation=s.rotation),void 0!==s.wrap&&(l.wrapS=i(s.wrap[0],Bc),l.wrapT=i(s.wrap[1],Bc)),void 0!==s.format&&(l.format=s.format),void 0!==s.type&&(l.type=s.type),void 0!==s.encoding&&(l.encoding=s.encoding),void 0!==s.minFilter&&(l.minFilter=i(s.minFilter,zc)),void 0!==s.magFilter&&(l.magFilter=i(s.magFilter,zc)),void 0!==s.anisotropy&&(l.anisotropy=s.anisotropy),void 0!==s.flipY&&(l.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(l.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(l.unpackAlignment=s.unpackAlignment),void 0!==s.userData&&(l.userData=s.userData),n[s.uuid]=l}return n}parseObject(t,e,i,n,r){let s,a,o;function l(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function c(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];void 0===i[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),e.push(i[r])}return e}return void 0===i[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),i[t]}}function h(t){return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined texture",t),n[t]}switch(t.type){case"Scene":s=new ta,void 0!==t.background&&(Number.isInteger(t.background)?s.background=new Vt(t.background):s.background=h(t.background)),void 0!==t.environment&&(s.environment=h(t.environment)),void 0!==t.fog&&("Fog"===t.fog.type?s.fog=new $s(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(s.fog=new Qs(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":s=new rn(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(s.focus=t.focus),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.filmGauge&&(s.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(s.filmOffset=t.filmOffset),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"OrthographicCamera":s=new Rn(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"AmbientLight":s=new Cc(t.color,t.intensity);break;case"DirectionalLight":s=new Rc(t.color,t.intensity);break;case"PointLight":s=new Ec(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":s=new Lc(t.color,t.intensity,t.width,t.height);break;case"SpotLight":s=new Mc(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":s=new mc(t.color,t.groundColor,t.intensity);break;case"LightProbe":s=(new Ic).fromJSON(t);break;case"SkinnedMesh":a=l(t.geometry),o=c(t.material),s=new Ra(a,o),void 0!==t.bindMode&&(s.bindMode=t.bindMode),void 0!==t.bindMatrix&&s.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(s.skeleton=t.skeleton);break;case"Mesh":a=l(t.geometry),o=c(t.material),s=new Zi(a,o);break;case"InstancedMesh":a=l(t.geometry),o=c(t.material);const e=t.count,i=t.instanceMatrix,n=t.instanceColor;s=new za(a,o,e),s.instanceMatrix=new Na(new Float32Array(i.array),16),void 0!==n&&(s.instanceColor=new Na(new Float32Array(n.array),n.itemSize));break;case"LOD":s=new ba;break;case"Line":s=new ja(l(t.geometry),c(t.material));break;case"LineLoop":s=new Ja(l(t.geometry),c(t.material));break;case"LineSegments":s=new Za(l(t.geometry),c(t.material));break;case"PointCloud":case"Points":s=new io(l(t.geometry),c(t.material));break;case"Sprite":s=new va(c(t.material));break;case"Group":s=new Vs;break;case"Bone":s=new Ca;break;default:s=new ni}if(s.uuid=t.uuid,void 0!==t.name&&(s.name=t.name),void 0!==t.matrix?(s.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(s.matrixAutoUpdate=t.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(void 0!==t.position&&s.position.fromArray(t.position),void 0!==t.rotation&&s.rotation.fromArray(t.rotation),void 0!==t.quaternion&&s.quaternion.fromArray(t.quaternion),void 0!==t.scale&&s.scale.fromArray(t.scale)),void 0!==t.castShadow&&(s.castShadow=t.castShadow),void 0!==t.receiveShadow&&(s.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(s.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(s.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(s.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&s.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(s.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(s.visible=t.visible),void 0!==t.frustumCulled&&(s.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(s.renderOrder=t.renderOrder),void 0!==t.userData&&(s.userData=t.userData),void 0!==t.layers&&(s.layers.mask=t.layers),void 0!==t.children){const a=t.children;for(let t=0;t<a.length;t++)s.add(this.parseObject(a[t],e,i,n,r))}if(void 0!==t.animations){const e=t.animations;for(let t=0;t<e.length;t++){const i=e[t];s.animations.push(r[i])}}if("LOD"===t.type){void 0!==t.autoUpdate&&(s.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const i=e[t],n=s.getObjectByProperty("uuid",i.object);void 0!==n&&s.addLevel(n,i.distance)}}return s}bindSkeletons(t,e){0!==Object.keys(e).length&&t.traverse((function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeleton){const i=e[t.skeleton];void 0===i?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",t.skeleton):t.bind(i,t.bindMatrix)}}))}},t.ObjectSpaceNormalMap=1,t.OctahedronBufferGeometry=vl,t.OctahedronGeometry=vl,t.OneFactor=201,t.OneMinusDstAlphaFactor=207,t.OneMinusDstColorFactor=209,t.OneMinusSrcAlphaFactor=205,t.OneMinusSrcColorFactor=203,t.OrthographicCamera=Rn,t.PCFShadowMap=1,t.PCFSoftShadowMap=2,t.PMREMGenerator=Un,t.ParametricGeometry=class extends Pi{constructor(){console.error("THREE.ParametricGeometry has been moved to /examples/jsm/geometries/ParametricGeometry.js"),super()}},t.Path=Ao,t.PerspectiveCamera=rn,t.Plane=dn,t.PlaneBufferGeometry=vn,t.PlaneGeometry=vn,t.PlaneHelper=class extends ja{constructor(t,e=1,i=16776960){const n=i,r=new Pi;r.setAttribute("position",new Si([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),r.computeBoundingSphere(),super(r,new Ga({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=e;const s=new Pi;s.setAttribute("position",new Si([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),s.computeBoundingSphere(),this.add(new Zi(s,new _i({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(t)}},t.PointLight=Ec,t.PointLightHelper=class extends Zi{constructor(t,e,i){super(new Ml(e,4,2),new _i({wireframe:!0,fog:!1,toneMapped:!1})),this.light=t,this.light.updateMatrixWorld(),this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},t.Points=io,t.PointsMaterial=Ka,t.PolarGridHelper=class extends Za{constructor(t=10,e=16,i=8,n=64,r=4473924,s=8947848){r=new Vt(r),s=new Vt(s);const a=[],o=[];for(let i=0;i<=e;i++){const n=i/e*(2*Math.PI),l=Math.sin(n)*t,c=Math.cos(n)*t;a.push(0,0,0),a.push(l,0,c);const h=1&i?r:s;o.push(h.r,h.g,h.b),o.push(h.r,h.g,h.b)}for(let e=0;e<=i;e++){const l=1&e?r:s,c=t-t/i*e;for(let t=0;t<n;t++){let e=t/n*(2*Math.PI),i=Math.sin(e)*c,r=Math.cos(e)*c;a.push(i,0,r),o.push(l.r,l.g,l.b),e=(t+1)/n*(2*Math.PI),i=Math.sin(e)*c,r=Math.cos(e)*c,a.push(i,0,r),o.push(l.r,l.g,l.b)}}const l=new Pi;l.setAttribute("position",new Si(a,3)),l.setAttribute("color",new Si(o,3));super(l,new Ga({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}},t.PolyhedronBufferGeometry=Do,t.PolyhedronGeometry=Do,t.PositionalAudio=class extends Kc{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,i){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=i,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(Qc,$c,th),eh.set(0,0,1).applyQuaternion($c);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(Qc.x,t),e.positionY.linearRampToValueAtTime(Qc.y,t),e.positionZ.linearRampToValueAtTime(Qc.z,t),e.orientationX.linearRampToValueAtTime(eh.x,t),e.orientationY.linearRampToValueAtTime(eh.y,t),e.orientationZ.linearRampToValueAtTime(eh.z,t)}else e.setPosition(Qc.x,Qc.y,Qc.z),e.setOrientation(eh.x,eh.y,eh.z)}},t.PropertyBinding=ch,t.PropertyMixer=ih,t.QuadraticBezierCurve=bo,t.QuadraticBezierCurve3=So,t.Quaternion=te,t.QuaternionKeyframeTrack=ec,t.QuaternionLinearInterpolant=tc,t.REVISION=e,t.RGBADepthPacking=3201,t.RGBAFormat=w,t.RGBAIntegerFormat=1033,t.RGBA_ASTC_10x10_Format=Y,t.RGBA_ASTC_10x5_Format=X,t.RGBA_ASTC_10x6_Format=j,t.RGBA_ASTC_10x8_Format=q,t.RGBA_ASTC_12x10_Format=Z,t.RGBA_ASTC_12x12_Format=J,t.RGBA_ASTC_4x4_Format=U,t.RGBA_ASTC_5x4_Format=B,t.RGBA_ASTC_5x5_Format=z,t.RGBA_ASTC_6x5_Format=G,t.RGBA_ASTC_6x6_Format=k,t.RGBA_ASTC_8x5_Format=H,t.RGBA_ASTC_8x6_Format=V,t.RGBA_ASTC_8x8_Format=W,t.RGBA_BPTC_Format=K,t.RGBA_ETC2_EAC_Format=F,t.RGBA_PVRTC_2BPPV1_Format=N,t.RGBA_PVRTC_4BPPV1_Format=D,t.RGBA_S3TC_DXT1_Format=R,t.RGBA_S3TC_DXT3_Format=C,t.RGBA_S3TC_DXT5_Format=L,t.RGBFormat=1022,t.RGB_ETC1_Format=36196,t.RGB_ETC2_Format=O,t.RGB_PVRTC_2BPPV1_Format=I,t.RGB_PVRTC_4BPPV1_Format=P,t.RGB_S3TC_DXT1_Format=A,t.RGFormat=1030,t.RGIntegerFormat=1031,t.RawShaderMaterial=Ll,t.Ray=Pe,t.Raycaster=class{constructor(t,e,i=0,n=1/0){this.ray=new Pe(t,e),this.near=i,this.far=n,this.camera=null,this.layers=new Ve,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t,e=!0,i=[]){return mh(t,this,i,e),i.sort(fh),i}intersectObjects(t,e=!0,i=[]){for(let n=0,r=t.length;n<r;n++)mh(t[n],this,i,e);return i.sort(fh),i}},t.RectAreaLight=Lc,t.RedFormat=1028,t.RedIntegerFormat=1029,t.ReinhardToneMapping=2,t.RepeatWrapping=c,t.ReplaceStencilOp=7681,t.ReverseSubtractEquation=102,t.RingBufferGeometry=xl,t.RingGeometry=xl,t.SRGBColorSpace=lt,t.Scene=ta,t.ShaderChunk=xn,t.ShaderLib=Mn,t.ShaderMaterial=en,t.ShadowMaterial=Cl,t.Shape=Go,t.ShapeBufferGeometry=yl,t.ShapeGeometry=yl,t.ShapePath=class{constructor(){this.type="ShapePath",this.color=new Vt,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new Ao,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,i,n){return this.currentPath.quadraticCurveTo(t,e,i,n),this}bezierCurveTo(t,e,i,n,r,s){return this.currentPath.bezierCurveTo(t,e,i,n,r,s),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t,e){function i(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i],r=new Go;r.curves=n.curves,e.push(r)}return e}function n(t,e){const i=e.length;let n=!1;for(let r=i-1,s=0;s<i;r=s++){let i=e[r],a=e[s],o=a.x-i.x,l=a.y-i.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(i=e[s],o=-o,a=e[r],l=-l),t.y<i.y||t.y>a.y)continue;if(t.y===i.y){if(t.x===i.x)return!0}else{const e=l*(t.x-i.x)-o*(t.y-i.y);if(0===e)return!0;if(e<0)continue;n=!n}}else{if(t.y!==i.y)continue;if(a.x<=t.x&&t.x<=i.x||i.x<=t.x&&t.x<=a.x)return!0}}return n}const r=dl.isClockWise,s=this.subPaths;if(0===s.length)return[];if(!0===e)return i(s);let a,o,l;const c=[];if(1===s.length)return o=s[0],l=new Go,l.curves=o.curves,c.push(l),c;let h=!r(s[0].getPoints());h=t?!h:h;const u=[],d=[];let p,f,m=[],g=0;d[g]=void 0,m[g]=[];for(let e=0,i=s.length;e<i;e++)o=s[e],p=o.getPoints(),a=r(p),a=t?!a:a,a?(!h&&d[g]&&g++,d[g]={s:new Go,p:p},d[g].s.curves=o.curves,h&&g++,m[g]=[]):m[g].push({h:o,p:p[0]});if(!d[0])return i(s);if(d.length>1){let t=!1,e=0;for(let t=0,e=d.length;t<e;t++)u[t]=[];for(let i=0,r=d.length;i<r;i++){const r=m[i];for(let s=0;s<r.length;s++){const a=r[s];let o=!0;for(let r=0;r<d.length;r++)n(a.p,d[r].p)&&(i!==r&&e++,o?(o=!1,u[r].push(a)):t=!0);o&&u[i].push(a)}}e>0&&!1===t&&(m=u)}for(let t=0,e=d.length;t<e;t++){l=d[t].s,c.push(l),f=m[t];for(let t=0,e=f.length;t<e;t++)l.holes.push(f[t].h)}return c}},t.ShapeUtils=dl,t.ShortType=1011,t.Skeleton=Da,t.SkeletonHelper=class extends Za{constructor(t){const e=Sh(t),i=new Pi,n=[],r=[],s=new Vt(0,0,1),a=new Vt(0,1,0);for(let t=0;t<e.length;t++){const i=e[t];i.parent&&i.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),r.push(s.r,s.g,s.b),r.push(a.r,a.g,a.b))}i.setAttribute("position",new Si(n,3)),i.setAttribute("color",new Si(r,3));super(i,new Ga({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,i=this.geometry,n=i.getAttribute("position");bh.copy(this.root.matrixWorld).invert();for(let t=0,i=0;t<e.length;t++){const r=e[t];r.parent&&r.parent.isBone&&(Mh.multiplyMatrices(bh,r.matrixWorld),yh.setFromMatrixPosition(Mh),n.setXYZ(i,yh.x,yh.y,yh.z),Mh.multiplyMatrices(bh,r.parent.matrixWorld),yh.setFromMatrixPosition(Mh),n.setXYZ(i+1,yh.x,yh.y,yh.z),i+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}},t.SkinnedMesh=Ra,t.SmoothShading=2,t.Source=jt,t.Sphere=Se,t.SphereBufferGeometry=Ml,t.SphereGeometry=Ml,t.Spherical=class{constructor(t=1,e=0,i=0){return this.radius=t,this.phi=e,this.theta=i,this}set(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+e*e+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos(yt(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}},t.SphericalHarmonics3=Pc,t.SplineCurve=wo,t.SpotLight=Mc,t.SpotLightHelper=class extends ni{constructor(t,e){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;const i=new Pi,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,e=1,i=32;t<i;t++,e++){const r=t/i*Math.PI*2,s=e/i*Math.PI*2;n.push(Math.cos(r),Math.sin(r),1,Math.cos(s),Math.sin(s),1)}i.setAttribute("position",new Si(n,3));const r=new Ga({fog:!1,toneMapped:!1});this.cone=new Za(i,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),xh.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(xh),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},t.Sprite=va,t.SpriteMaterial=ra,t.SrcAlphaFactor=204,t.SrcAlphaSaturateFactor=210,t.SrcColorFactor=202,t.StaticCopyUsage=35046,t.StaticDrawUsage=ut,t.StaticReadUsage=35045,t.StereoCamera=class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new rn,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new rn,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep,Wc.copy(t.projectionMatrix);const i=e.eyeSep/2,n=i*e.near/e.focus,r=e.near*Math.tan(_t*e.fov*.5)/e.zoom;let s,a;Vc.elements[12]=-i,Hc.elements[12]=i,s=-r*e.aspect+n,a=r*e.aspect+n,Wc.elements[0]=2*e.near/(a-s),Wc.elements[8]=(a+s)/(a-s),this.cameraL.projectionMatrix.copy(Wc),s=-r*e.aspect-n,a=r*e.aspect-n,Wc.elements[0]=2*e.near/(a-s),Wc.elements[8]=(a+s)/(a-s),this.cameraR.projectionMatrix.copy(Wc)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(Vc),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(Hc)}},t.StreamCopyUsage=35042,t.StreamDrawUsage=35040,t.StreamReadUsage=35041,t.StringKeyframeTrack=ic,t.SubtractEquation=101,t.SubtractiveBlending=3,t.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},t.TangentSpaceNormalMap=0,t.TetrahedronBufferGeometry=bl,t.TetrahedronGeometry=bl,t.TextGeometry=class extends Pi{constructor(){console.error("THREE.TextGeometry has been moved to /examples/jsm/geometries/TextGeometry.js"),super()}},t.Texture=Zt,t.TextureLoader=class extends cc{constructor(t){super(t)}load(t,e,i,n){const r=new Zt,s=new pc(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(t){r.image=t,r.needsUpdate=!0,void 0!==e&&e(r)}),i,n),r}},t.TorusBufferGeometry=Sl,t.TorusGeometry=Sl,t.TorusKnotBufferGeometry=wl,t.TorusKnotGeometry=wl,t.Triangle=fi,t.TriangleFanDrawMode=2,t.TriangleStripDrawMode=1,t.TrianglesDrawMode=0,t.TubeBufferGeometry=Tl,t.TubeGeometry=Tl,t.UVMapping=n,t.Uint16BufferAttribute=Mi,t.Uint32BufferAttribute=bi,t.Uint8BufferAttribute=class extends yi{constructor(t,e,i){super(new Uint8Array(t),e,i)}},t.Uint8ClampedBufferAttribute=class extends yi{constructor(t,e,i){super(new Uint8ClampedArray(t),e,i)}},t.Uniform=dh,t.UniformsGroup=class extends ft{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:ph++}),this.name="",this.usage=ut,this.uniforms=[]}add(t){return this.uniforms.push(t),this}remove(t){const e=this.uniforms.indexOf(t);return-1!==e&&this.uniforms.splice(e,1),this}setName(t){return this.name=t,this}setUsage(t){return this.usage=t,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(t){this.name=t.name,this.usage=t.usage;const e=t.uniforms;this.uniforms.length=0;for(let t=0,i=e.length;t<i;t++)this.uniforms.push(e[t].clone());return this}clone(){return(new this.constructor).copy(this)}},t.UniformsLib=yn,t.UniformsUtils=tn,t.UnsignedByteType=v,t.UnsignedInt248Type=S,t.UnsignedIntType=y,t.UnsignedShort4444Type=1017,t.UnsignedShort5551Type=1018,t.UnsignedShortType=x,t.VSMShadowMap=3,t.Vector2=At,t.Vector3=ee,t.Vector4=Jt,t.VectorKeyframeTrack=nc,t.VideoTexture=class extends Zt{constructor(t,e,i,n,r,s,a,o,l){super(t,e,i,n,r,s,a,o,l),this.isVideoTexture=!0,this.minFilter=void 0!==s?s:m,this.magFilter=void 0!==r?r:m,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){c.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;!1==="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},t.WebGL1Renderer=Ks,t.WebGL3DRenderTarget=class extends Kt{constructor(t,e,i){super(t,e),this.isWebGL3DRenderTarget=!0,this.depth=i,this.texture=new $t(null,t,e,i),this.texture.isRenderTargetTexture=!0}},t.WebGLArrayRenderTarget=class extends Kt{constructor(t,e,i){super(t,e),this.isWebGLArrayRenderTarget=!0,this.depth=i,this.texture=new Qt(null,t,e,i),this.texture.isRenderTargetTexture=!0}},t.WebGLCubeRenderTarget=ln,t.WebGLMultipleRenderTargets=class extends Kt{constructor(t,e,i,n={}){super(t,e,n),this.isWebGLMultipleRenderTargets=!0;const r=this.texture;this.texture=[];for(let t=0;t<i;t++)this.texture[t]=r.clone(),this.texture[t].isRenderTargetTexture=!0}setSize(t,e,i=1){if(this.width!==t||this.height!==e||this.depth!==i){this.width=t,this.height=e,this.depth=i;for(let n=0,r=this.texture.length;n<r;n++)this.texture[n].image.width=t,this.texture[n].image.height=e,this.texture[n].image.depth=i;this.dispose()}return this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.texture.length=0;for(let e=0,i=t.texture.length;e<i;e++)this.texture[e]=t.texture[e].clone(),this.texture[e].isRenderTargetTexture=!0;return this}},t.WebGLMultisampleRenderTarget=class extends Kt{constructor(t,e,i){console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.'),super(t,e,i),this.samples=4}},t.WebGLRenderTarget=Kt,t.WebGLRenderer=Js,t.WebGLUtils=ks,t.WireframeGeometry=El,t.WrapAroundEnding=nt,t.ZeroCurvatureEnding=et,t.ZeroFactor=200,t.ZeroSlopeEnding=it,t.ZeroStencilOp=0,t._SRGBAFormat=pt,t.sRGBEncoding=ot,Object.defineProperty(t,"__esModule",{value:!0})}));;
THREE.HorizontalBlurShader={uniforms:{tDiffuse:{type:"t",value:null},h:{type:"f",value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float h;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},THREE.VerticalBlurShader={uniforms:{tDiffuse:{type:"t",value:null},v:{type:"f",value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float v;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},THREE.ShaderPass=function(e,v){this.textureID=void 0!==v?v:"tDiffuse",e instanceof THREE.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=THREE.UniformsUtils.clone(e.uniforms),this.material=new THREE.ShaderMaterial({defines:e.defines||{},uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.renderToScreen=!1,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.scene.add(this.quad)},THREE.ShaderPass.prototype={render:function(e,v,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=t),this.quad.material=this.material,this.renderToScreen?e.render(this.scene,this.camera):e.render(this.scene,this.camera,v,this.clear)}},THREE.ImageUtils.crossOrigin="anonymous";;
!function(){if("performance"in window==0&&(window.performance={}),"now"in window.performance==0){var e=Date.now();performance.timing&&performance.timing.navigationStart&&(e=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-e}}}(),THREE.WebGLRenderer.prototype.paramThreeToGL=function(e){var t,n=this.extensions,r=this.getContext();if(e===THREE.RepeatWrapping)return r.REPEAT;if(e===THREE.ClampToEdgeWrapping)return r.CLAMP_TO_EDGE;if(e===THREE.MirroredRepeatWrapping)return r.MIRRORED_REPEAT;if(e===THREE.NearestFilter)return r.NEAREST;if(e===THREE.NearestMipMapNearestFilter)return r.NEAREST_MIPMAP_NEAREST;if(e===THREE.NearestMipMapLinearFilter)return r.NEAREST_MIPMAP_LINEAR;if(e===THREE.LinearFilter)return r.LINEAR;if(e===THREE.LinearMipMapNearestFilter)return r.LINEAR_MIPMAP_NEAREST;if(e===THREE.LinearMipMapLinearFilter)return r.LINEAR_MIPMAP_LINEAR;if(e===THREE.UnsignedByteType)return r.UNSIGNED_BYTE;if(e===THREE.UnsignedShort4444Type)return r.UNSIGNED_SHORT_4_4_4_4;if(e===THREE.UnsignedShort5551Type)return r.UNSIGNED_SHORT_5_5_5_1;if(e===THREE.UnsignedShort565Type)return r.UNSIGNED_SHORT_5_6_5;if(e===THREE.ByteType)return r.BYTE;if(e===THREE.ShortType)return r.SHORT;if(e===THREE.UnsignedShortType)return r.UNSIGNED_SHORT;if(e===THREE.IntType)return r.INT;if(e===THREE.UnsignedIntType)return r.UNSIGNED_INT;if(e===THREE.FloatType)return r.FLOAT;if(e===THREE.HalfFloatType&&null!==n.get("OES_texture_half_float"))return t.HALF_FLOAT_OES;if(e===THREE.AlphaFormat)return r.ALPHA;if(e===THREE.RGBFormat)return r.RGB;if(e===THREE.RGBAFormat)return r.RGBA;if(e===THREE.LuminanceFormat)return r.LUMINANCE;if(e===THREE.LuminanceAlphaFormat)return r.LUMINANCE_ALPHA;if(e===THREE.AddEquation)return r.FUNC_ADD;if(e===THREE.SubtractEquation)return r.FUNC_SUBTRACT;if(e===THREE.ReverseSubtractEquation)return r.FUNC_REVERSE_SUBTRACT;if(e===THREE.ZeroFactor)return r.ZERO;if(e===THREE.OneFactor)return r.ONE;if(e===THREE.SrcColorFactor)return r.SRC_COLOR;if(e===THREE.OneMinusSrcColorFactor)return r.ONE_MINUS_SRC_COLOR;if(e===THREE.SrcAlphaFactor)return r.SRC_ALPHA;if(e===THREE.OneMinusSrcAlphaFactor)return r.ONE_MINUS_SRC_ALPHA;if(e===THREE.DstAlphaFactor)return r.DST_ALPHA;if(e===THREE.OneMinusDstAlphaFactor)return r.ONE_MINUS_DST_ALPHA;if(e===THREE.DstColorFactor)return r.DST_COLOR;if(e===THREE.OneMinusDstColorFactor)return r.ONE_MINUS_DST_COLOR;if(e===THREE.SrcAlphaSaturateFactor)return r.SRC_ALPHA_SATURATE;if(null!==(t=n.get("WEBGL_compressed_texture_s3tc"))){if(e===THREE.RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===THREE.RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(null!==(t=n.get("WEBGL_compressed_texture_pvrtc"))){if(e===THREE.RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===THREE.RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===THREE.RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===THREE.RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(null!==(t=n.get("WEBGL_compressed_texture_etc1"))&&e===THREE.RGB_ETC1_Format)return t.COMPRESSED_RGB_ETC1_WEBGL;if(null!==(t=n.get("EXT_blend_minmax"))){if(e===THREE.MinEquation)return t.MIN_EXT;if(e===THREE.MaxEquation)return t.MAX_EXT}return 0},THREE.WebGLState=function(e,t,n){var r=this,E=new THREE.Vector4,i=e.getParameter(e.MAX_VERTEX_ATTRIBS),a=new Uint8Array(i),u=new Uint8Array(i),l=new Uint8Array(i),_={},T=null,R=null,o=null,s=null,c=null,S=null,A=null,f=null,p=!1,h=null,C=null,N=null,H=null,D=null,d=null,F=null,L=null,O=null,P=null,b=null,M=null,U=null,B=null,G=null,I=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),m=void 0,g={},y=new THREE.Vector4,v=null,x=null,V=new THREE.Vector4,w=new THREE.Vector4;this.init=function(){this.clearColor(0,0,0,1),this.clearDepth(1),this.clearStencil(0),this.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.frontFace(e.CCW),e.cullFace(e.BACK),this.enable(e.CULL_FACE),this.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)},this.initAttributes=function(){for(var e=0,t=a.length;e<t;e++)a[e]=0},this.enableAttribute=function(n){(a[n]=1,0===u[n]&&(e.enableVertexAttribArray(n),u[n]=1),0!==l[n])&&(t.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(n,0),l[n]=0)},this.enableAttributeAndDivisor=function(t,n,r){a[t]=1,0===u[t]&&(e.enableVertexAttribArray(t),u[t]=1),l[t]!==n&&(r.vertexAttribDivisorANGLE(t,n),l[t]=n)},this.disableUnusedAttributes=function(){for(var t=0,n=u.length;t<n;t++)u[t]!==a[t]&&(e.disableVertexAttribArray(t),u[t]=0)},this.enable=function(t){!0!==_[t]&&(e.enable(t),_[t]=!0)},this.disable=function(t){!1!==_[t]&&(e.disable(t),_[t]=!1)},this.getCompressedTextureFormats=function(){if(null===T&&(T=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")||t.get("WEBGL_compressed_texture_etc1")))for(var n=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS),r=0;r<n.length;r++)T.push(n[r]);return T},this.setBlending=function(t,r,E,i,a,u,l,_){t===THREE.NoBlending?this.disable(e.BLEND):this.enable(e.BLEND),t===R&&_===p||(t===THREE.AdditiveBlending?_?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE,e.ONE,e.ONE)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE)):t===THREE.SubtractiveBlending?_?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ZERO,e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ONE_MINUS_SRC_ALPHA)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR)):t===THREE.MultiplyBlending?_?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ZERO,e.ZERO,e.SRC_COLOR,e.SRC_ALPHA)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.SRC_COLOR)):_?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)):(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)),R=t,p=_),t===THREE.CustomBlending?(a=a||r,u=u||E,l=l||i,r===o&&a===S||(e.blendEquationSeparate(n(r),n(a)),o=r,S=a),E===s&&i===c&&u===A&&l===f||(e.blendFuncSeparate(n(E),n(i),n(u),n(l)),s=E,c=i,A=u,f=l)):(o=null,s=null,c=null,S=null,A=null,f=null)},this.setDepthFunc=function(t){if(h!==t){if(t)switch(t){case THREE.NeverDepth:e.depthFunc(e.NEVER);break;case THREE.AlwaysDepth:e.depthFunc(e.ALWAYS);break;case THREE.LessDepth:e.depthFunc(e.LESS);break;case THREE.LessEqualDepth:e.depthFunc(e.LEQUAL);break;case THREE.EqualDepth:e.depthFunc(e.EQUAL);break;case THREE.GreaterEqualDepth:e.depthFunc(e.GEQUAL);break;case THREE.GreaterDepth:e.depthFunc(e.GREATER);break;case THREE.NotEqualDepth:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}else e.depthFunc(e.LEQUAL);h=t}},this.setDepthTest=function(t){t?this.enable(e.DEPTH_TEST):this.disable(e.DEPTH_TEST)},this.setDepthWrite=function(t){C!==t&&(e.depthMask(t),C=t)},this.setColorWrite=function(t){N!==t&&(e.colorMask(t,t,t,t),N=t)},this.setStencilFunc=function(t,n,r){D===t&&d===n&&F===r||(e.stencilFunc(t,n,r),D=t,d=n,F=r)},this.setStencilOp=function(t,n,r){L===t&&O===n&&P===r||(e.stencilOp(t,n,r),L=t,O=n,P=r)},this.setStencilTest=function(t){t?this.enable(e.STENCIL_TEST):this.disable(e.STENCIL_TEST)},this.setStencilWrite=function(t){H!==t&&(e.stencilMask(t),H=t)},this.setFlipSided=function(t){b!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),b=t)},this.setLineWidth=function(t){t!==M&&(e.lineWidth(t),M=t)},this.setPolygonOffset=function(t,n,r){t?this.enable(e.POLYGON_OFFSET_FILL):this.disable(e.POLYGON_OFFSET_FILL),!t||U===n&&B===r||(e.polygonOffset(n,r),U=n,B=r)},this.getScissorTest=function(){return G},this.setScissorTest=function(t){G=t,t?this.enable(e.SCISSOR_TEST):this.disable(e.SCISSOR_TEST)},this.activeTexture=function(t){void 0===t&&(t=e.TEXTURE0+I-1),m!==t&&(e.activeTexture(t),m=t)},this.bindTexture=function(t,n){void 0===m&&r.activeTexture();var E=g[m];void 0===E&&(E={type:void 0,texture:void 0},g[m]=E),E.type===t&&E.texture===n||(e.bindTexture(t,n),E.type=t,E.texture=n)},this.compressedTexImage2D=function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error(e)}},this.texImage2D=function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error(e)}},this.clearColor=function(t,n,r,i){E.set(t,n,r,i),!1===y.equals(E)&&(e.clearColor(t,n,r,i),y.copy(E))},this.clearDepth=function(t){v!==t&&(e.clearDepth(t),v=t)},this.clearStencil=function(t){x!==t&&(e.clearStencil(t),x=t)},this.scissor=function(t){!1===V.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),V.copy(t))},this.viewport=function(t){!1===w.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),w.copy(t))},this.reset=function(){for(var t=0;t<u.length;t++)1===u[t]&&(e.disableVertexAttribArray(t),u[t]=0);_={},T=null,m=void 0,g={},R=null,N=null,C=null,H=null,b=null}};;
!function(){const t={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor.a *= opacity;\n\n\n\t\t}"};THREE.CopyShader=t}();;
!function(){const t={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float h;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 sum = vec4( 0.0 );\n\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;\n\n\t\t\tgl_FragColor = sum;\n\n\t\t}"};THREE.HorizontalBlurShader=t}();;
!function(){const t={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float v;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 sum = vec4( 0.0 );\n\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;\n\n\t\t\tgl_FragColor = sum;\n\n\t\t}"};THREE.VerticalBlurShader=t}();;
!function(){const e=new THREE.OrthographicCamera(-1,1,1,-1,0,1),t=new THREE.BufferGeometry;t.setAttribute("position",new THREE.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),t.setAttribute("uv",new THREE.Float32BufferAttribute([0,2,0,0,2,0],2));THREE.EffectComposer=class{constructor(e,t){if(this.renderer=e,void 0===t){const s=e.getSize(new THREE.Vector2);this._pixelRatio=e.getPixelRatio(),this._width=s.width,this._height=s.height,(t=new THREE.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===THREE.CopyShader&&console.error("THREE.EffectComposer relies on THREE.CopyShader"),void 0===THREE.ShaderPass&&console.error("THREE.EffectComposer relies on THREE.ShaderPass"),this.copyPass=new THREE.ShaderPass(THREE.CopyShader),this.clock=new THREE.Clock}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let s=!1;for(let t=0,i=this.passes.length;t<i;t++){const i=this.passes[t];if(!1!==i.enabled){if(i.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(t),i.render(this.renderer,this.writeBuffer,this.readBuffer,e,s),i.needsSwap){if(s){const t=this.renderer.getContext(),s=this.renderer.state.buffers.stencil;s.setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),s.setFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==THREE.MaskPass&&(i instanceof THREE.MaskPass?s=!0:i instanceof THREE.ClearMaskPass&&(s=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){const t=this.renderer.getSize(new THREE.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const s=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(s,i),this.renderTarget2.setSize(s,i);for(let e=0;e<this.passes.length;e++)this.passes[e].setSize(s,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}},THREE.FullScreenQuad=class{constructor(e){this._mesh=new THREE.Mesh(t,e)}dispose(){this._mesh.geometry.dispose()}render(t){t.render(this._mesh,e)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}},THREE.Pass=class{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}}();;
!function(){class e extends THREE.Pass{constructor(e,s){super(),this.scene=e,this.camera=s,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,s,t){const r=e.getContext(),c=e.state;let f,n;c.buffers.color.setMask(!1),c.buffers.depth.setMask(!1),c.buffers.color.setLocked(!0),c.buffers.depth.setLocked(!0),this.inverse?(f=0,n=1):(f=1,n=0),c.buffers.stencil.setTest(!0),c.buffers.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),c.buffers.stencil.setFunc(r.ALWAYS,f,4294967295),c.buffers.stencil.setClear(n),c.buffers.stencil.setLocked(!0),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(s),this.clear&&e.clear(),e.render(this.scene,this.camera),c.buffers.color.setLocked(!1),c.buffers.depth.setLocked(!1),c.buffers.stencil.setLocked(!1),c.buffers.stencil.setFunc(r.EQUAL,1,4294967295),c.buffers.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),c.buffers.stencil.setLocked(!0)}}class s extends THREE.Pass{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}THREE.ClearMaskPass=s,THREE.MaskPass=e}();;
!function(){class e extends THREE.Pass{constructor(e,r,a,t,l){super(),this.scene=e,this.camera=r,this.overrideMaterial=a,this.clearColor=t,this.clearAlpha=void 0!==l?l:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new THREE.Color}render(e,r,a){const t=e.autoClear;let l,o;e.autoClear=!1,void 0!==this.overrideMaterial&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),l=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:a),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,l),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=o),e.autoClear=t}}THREE.RenderPass=e}();;
!function(){class e extends THREE.Pass{constructor(e,r){super(),this.textureID=void 0!==r?r:"tDiffuse",e instanceof THREE.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=THREE.UniformsUtils.clone(e.uniforms),this.material=new THREE.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new THREE.FullScreenQuad(this.material)}render(e,r,t){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=t.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(r),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}}THREE.ShaderPass=e}();;
!function(){class e extends THREE.Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new o(e)})),this.register((function(e){return new p(e)})),this.register((function(e){return new m(e)})),this.register((function(e){return new c(e)})),this.register((function(e){return new l(e)})),this.register((function(e){return new u(e)})),this.register((function(e){return new h(e)})),this.register((function(e){return new i(e)})),this.register((function(e){return new d(e)})),this.register((function(e){return new a(e)})),this.register((function(e){return new n(e)})),this.register((function(e){return new f(e)}))}load(e,t,s,n){const r=this;let i;i=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(e),this.manager.itemStart(e);const o=function(t){n?n(t):console.error(t),r.manager.itemError(e),r.manager.itemEnd(e)},a=new THREE.FileLoader(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(s){try{r.parse(s,i,(function(s){t(s),r.manager.itemEnd(e)}),o)}catch(e){o(e)}}),s,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i){let o;const a={},c={};if("string"==typeof e)o=e;else{if(THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4))===E){try{a[s.KHR_BINARY_GLTF]=new R(e)}catch(e){return void(i&&i(e))}o=a[s.KHR_BINARY_GLTF].content}else o=THREE.LoaderUtils.decodeText(new Uint8Array(e))}const l=JSON.parse(o);if(void 0===l.asset||l.asset.version[0]<2)return void(i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const u=new J(l,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](u);c[t.name]=t,a[t.name]=!0}if(l.extensionsUsed)for(let e=0;e<l.extensionsUsed.length;++e){const t=l.extensionsUsed[e],n=l.extensionsRequired||[];switch(t){case s.KHR_MATERIALS_UNLIT:a[t]=new r;break;case s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:a[t]=new H;break;case s.KHR_DRACO_MESH_COMPRESSION:a[t]=new x(l,this.dracoLoader);break;case s.KHR_TEXTURE_TRANSFORM:a[t]=new M;break;case s.KHR_MESH_QUANTIZATION:a[t]=new _;break;default:n.indexOf(t)>=0&&void 0===c[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}u.setExtensions(a),u.setPlugins(c),u.parse(n,i)}parseAsync(e,t){const s=this;return new Promise((function(n,r){s.parse(e,t,n,r)}))}}function t(){let e={};return{get:function(t){return e[t]},add:function(t,s){e[t]=s},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const s={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class n{constructor(e){this.parser=e,this.name=s.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let s=0,n=t.length;s<n;s++){const n=t[s];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&e._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(e){const t=this.parser,s="light:"+e;let n=t.cache.get(s);if(n)return n;const r=t.json,i=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let o;const a=new THREE.Color(16777215);void 0!==i.color&&a.fromArray(i.color);const c=void 0!==i.range?i.range:0;switch(i.type){case"directional":o=new THREE.DirectionalLight(a),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new THREE.PointLight(a),o.distance=c;break;case"spot":o=new THREE.SpotLight(a),o.distance=c,i.spot=i.spot||{},i.spot.innerConeAngle=void 0!==i.spot.innerConeAngle?i.spot.innerConeAngle:0,i.spot.outerConeAngle=void 0!==i.spot.outerConeAngle?i.spot.outerConeAngle:Math.PI/4,o.angle=i.spot.outerConeAngle,o.penumbra=1-i.spot.innerConeAngle/i.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+i.type)}return o.position.set(0,0,0),o.decay=2,void 0!==i.intensity&&(o.intensity=i.intensity),o.name=t.createUniqueName(i.name||"light_"+e),n=Promise.resolve(o),t.cache.add(s,n),n}createNodeAttachment(e){const t=this,s=this.parser,n=s.json.nodes[e],r=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then((function(e){return s._getNodeRef(t.cache,r,e)}))}}class r{constructor(){this.name=s.KHR_MATERIALS_UNLIT}getMaterialType(){return THREE.MeshBasicMaterial}extendParams(e,t,s){const n=[];e.color=new THREE.Color(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const t=r.baseColorFactor;e.color.fromArray(t),e.opacity=t[3]}void 0!==r.baseColorTexture&&n.push(s.assignTexture(e,"map",r.baseColorTexture,THREE.sRGBEncoding))}return Promise.all(n)}}class i{constructor(e){this.parser=e,this.name=s.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=s.extensions[this.name].emissiveStrength;return void 0!==n&&(t.emissiveIntensity=n),Promise.resolve()}}class o{constructor(e){this.parser=e,this.name=s.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],i=n.extensions[this.name];if(void 0!==i.clearcoatFactor&&(t.clearcoat=i.clearcoatFactor),void 0!==i.clearcoatTexture&&r.push(s.assignTexture(t,"clearcoatMap",i.clearcoatTexture)),void 0!==i.clearcoatRoughnessFactor&&(t.clearcoatRoughness=i.clearcoatRoughnessFactor),void 0!==i.clearcoatRoughnessTexture&&r.push(s.assignTexture(t,"clearcoatRoughnessMap",i.clearcoatRoughnessTexture)),void 0!==i.clearcoatNormalTexture&&(r.push(s.assignTexture(t,"clearcoatNormalMap",i.clearcoatNormalTexture)),void 0!==i.clearcoatNormalTexture.scale)){const e=i.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new THREE.Vector2(e,e)}return Promise.all(r)}}class a{constructor(e){this.parser=e,this.name=s.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],i=n.extensions[this.name];return void 0!==i.iridescenceFactor&&(t.iridescence=i.iridescenceFactor),void 0!==i.iridescenceTexture&&r.push(s.assignTexture(t,"iridescenceMap",i.iridescenceTexture)),void 0!==i.iridescenceIor&&(t.iridescenceIOR=i.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==i.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=i.iridescenceThicknessMinimum),void 0!==i.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=i.iridescenceThicknessMaximum),void 0!==i.iridescenceThicknessTexture&&r.push(s.assignTexture(t,"iridescenceThicknessMap",i.iridescenceThicknessTexture)),Promise.all(r)}}class c{constructor(e){this.parser=e,this.name=s.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new THREE.Color(0,0,0),t.sheenRoughness=0,t.sheen=1;const i=n.extensions[this.name];return void 0!==i.sheenColorFactor&&t.sheenColor.fromArray(i.sheenColorFactor),void 0!==i.sheenRoughnessFactor&&(t.sheenRoughness=i.sheenRoughnessFactor),void 0!==i.sheenColorTexture&&r.push(s.assignTexture(t,"sheenColorMap",i.sheenColorTexture,THREE.sRGBEncoding)),void 0!==i.sheenRoughnessTexture&&r.push(s.assignTexture(t,"sheenRoughnessMap",i.sheenRoughnessTexture)),Promise.all(r)}}class l{constructor(e){this.parser=e,this.name=s.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],i=n.extensions[this.name];return void 0!==i.transmissionFactor&&(t.transmission=i.transmissionFactor),void 0!==i.transmissionTexture&&r.push(s.assignTexture(t,"transmissionMap",i.transmissionTexture)),Promise.all(r)}}class u{constructor(e){this.parser=e,this.name=s.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],i=n.extensions[this.name];t.thickness=void 0!==i.thicknessFactor?i.thicknessFactor:0,void 0!==i.thicknessTexture&&r.push(s.assignTexture(t,"thicknessMap",i.thicknessTexture)),t.attenuationDistance=i.attenuationDistance||0;const o=i.attenuationColor||[1,1,1];return t.attenuationColor=new THREE.Color(o[0],o[1],o[2]),Promise.all(r)}}class h{constructor(e){this.parser=e,this.name=s.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=s.extensions[this.name];return t.ior=void 0!==n.ior?n.ior:1.5,Promise.resolve()}}class d{constructor(e){this.parser=e,this.name=s.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],i=n.extensions[this.name];t.specularIntensity=void 0!==i.specularFactor?i.specularFactor:1,void 0!==i.specularTexture&&r.push(s.assignTexture(t,"specularIntensityMap",i.specularTexture));const o=i.specularColorFactor||[1,1,1];return t.specularColor=new THREE.Color(o[0],o[1],o[2]),void 0!==i.specularColorTexture&&r.push(s.assignTexture(t,"specularColorMap",i.specularColorTexture,THREE.sRGBEncoding)),Promise.all(r)}}class p{constructor(e){this.parser=e,this.name=s.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,s=t.json,n=s.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const r=n.extensions[this.name],i=t.options.ktx2Loader;if(!i){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,i)}}class m{constructor(e){this.parser=e,this.name=s.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,n=s.json,r=n.textures[e];if(!r.extensions||!r.extensions[t])return null;const i=r.extensions[t],o=n.images[i.source];let a=s.textureLoader;if(o.uri){const e=s.options.manager.getHandler(o.uri);null!==e&&(a=e)}return this.detectSupport().then((function(r){if(r)return s.loadTextureImage(e,i.source,a);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class f{constructor(e){this.name=s.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,s=t.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const e=s.extensions[this.name],n=this.parser.getDependency("buffer",e.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return n.then((function(t){const s=e.byteOffset||0,n=e.byteLength||0,i=e.count,o=e.byteStride,a=new Uint8Array(t,s,n);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(i,o,a,e.mode,e.filter).then((function(e){return e.buffer})):r.ready.then((function(){const t=new ArrayBuffer(i*o);return r.decodeGltfBuffer(new Uint8Array(t),i,o,a,e.mode,e.filter),t}))}))}return null}}const E="glTF",g=1313821514,T=5130562;class R{constructor(e){this.name=s.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==E)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-12,r=new DataView(e,12);let i=0;for(;i<n;){const t=r.getUint32(i,!0);i+=4;const s=r.getUint32(i,!0);if(i+=4,s===g){const s=new Uint8Array(e,12+i,t);this.content=THREE.LoaderUtils.decodeText(s)}else if(s===T){const s=12+i;this.body=e.slice(s,s+t)}i+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class x{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=s.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const s=this.json,n=this.dracoLoader,r=e.extensions[this.name].bufferView,i=e.extensions[this.name].attributes,o={},a={},c={};for(const e in i){const t=D[e]||e.toLowerCase();o[t]=i[e]}for(const t in e.attributes){const n=D[t]||t.toLowerCase();if(void 0!==i[t]){const r=s.accessors[e.attributes[t]],i=N[r.componentType];c[n]=i.name,a[n]=!0===r.normalized}}return t.getDependency("bufferView",r).then((function(e){return new Promise((function(t){n.decodeDracoFile(e,(function(e){for(const t in e.attributes){const s=e.attributes[t],n=a[t];void 0!==n&&(s.normalized=n)}t(e)}),o,c)}))}))}}class M{constructor(){this.name=s.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class v extends THREE.MeshStandardMaterial{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),s=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),n=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),r=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),i=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),o={specular:{value:(new THREE.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=o,this.onBeforeCompile=function(e){for(const t in o)e.uniforms[t]=o[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",n).replace("#include <metalnessmap_fragment>",r).replace("#include <lights_physical_fragment>",i)},Object.defineProperties(this,{specular:{get:function(){return o.specular.value},set:function(e){o.specular.value=e}},specularMap:{get:function(){return o.specularMap.value},set:function(e){o.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return o.glossiness.value},set:function(e){o.glossiness.value=e}},glossinessMap:{get:function(){return o.glossinessMap.value},set:function(e){o.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class H{constructor(){this.name=s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return v}extendParams(e,t,s){const n=t.extensions[this.name];e.color=new THREE.Color(1,1,1),e.opacity=1;const r=[];if(Array.isArray(n.diffuseFactor)){const t=n.diffuseFactor;e.color.fromArray(t),e.opacity=t[3]}if(void 0!==n.diffuseTexture&&r.push(s.assignTexture(e,"map",n.diffuseTexture,THREE.sRGBEncoding)),e.emissive=new THREE.Color(0,0,0),e.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,e.specular=new THREE.Color(1,1,1),Array.isArray(n.specularFactor)&&e.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture){const t=n.specularGlossinessTexture;r.push(s.assignTexture(e,"glossinessMap",t)),r.push(s.assignTexture(e,"specularMap",t,THREE.sRGBEncoding))}return Promise.all(r)}createMaterial(e){const t=new v(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=void 0===e.emissiveIntensity?1:e.emissiveIntensity,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=THREE.TangentSpaceNormalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t}}class _{constructor(){this.name=s.KHR_MESH_QUANTIZATION}}class S extends THREE.Interpolant{constructor(e,t,s,n){super(e,t,s,n)}copySampleValue_(e){const t=this.resultBuffer,s=this.sampleValues,n=this.valueSize,r=e*n*3+n;for(let e=0;e!==n;e++)t[e]=s[r+e];return t}interpolate_(e,t,s,n){const r=this.resultBuffer,i=this.sampleValues,o=this.valueSize,a=2*o,c=3*o,l=n-t,u=(s-t)/l,h=u*u,d=h*u,p=e*c,m=p-c,f=-2*d+3*h,E=d-h,g=1-f,T=E-h+u;for(let e=0;e!==o;e++){const t=i[m+e+o],s=i[m+e+a]*l,n=i[p+e+o],c=i[p+e]*l;r[e]=g*t+T*s+f*n+E*c}return r}}const A=new THREE.Quaternion;class y extends S{interpolate_(e,t,s,n){const r=super.interpolate_(e,t,s,n);return A.fromArray(r).normalize().toArray(r),r}}const L=0,w=1,b=2,I=3,P=4,C=5,O=6,N={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},F={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipmapNearestFilter,9985:THREE.LinearMipmapNearestFilter,9986:THREE.NearestMipmapLinearFilter,9987:THREE.LinearMipmapLinearFilter},U={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},k={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},D={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},G={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},B={CUBICSPLINE:void 0,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},K="OPAQUE",j="MASK",V="BLEND";function X(e,t,s){for(const n in s.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=s.extensions[n])}function q(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function z(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let s=0,n=t.weights.length;s<n;s++)e.morphTargetInfluences[s]=t.weights[s];if(t.extras&&Array.isArray(t.extras.targetNames)){const s=t.extras.targetNames;if(e.morphTargetInfluences.length===s.length){e.morphTargetDictionary={};for(let t=0,n=s.length;t<n;t++)e.morphTargetDictionary[s[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function W(e){const t=e.extensions&&e.extensions[s.KHR_DRACO_MESH_COMPRESSION];let n;return n=t?"draco:"+t.bufferView+":"+t.indices+":"+Q(t.attributes):e.indices+":"+Q(e.attributes)+":"+e.mode,n}function Q(e){let t="";const s=Object.keys(e).sort();for(let n=0,r=s.length;n<r;n++)t+=s[n]+":"+e[s[n]]+";";return t}function Y(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class J{constructor(e={},s={}){this.json=e,this.extensions={},this.plugins={},this.options=s,this.cache=new t,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const n=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),r=navigator.userAgent.indexOf("Firefox")>-1,i=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;"undefined"==typeof createImageBitmap||n||r&&i<98?this.textureLoader=new THREE.TextureLoader(this.options.manager):this.textureLoader=new THREE.ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const s=this,n=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])})).then((function(t){const i={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:s,userData:{}};X(r,i,n),q(i,n),Promise.all(s._invokeAll((function(e){return e.afterRoot&&e.afterRoot(i)}))).then((function(){e(i)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[];for(let s=0,n=t.length;s<n;s++){const n=t[s].joints;for(let t=0,s=n.length;t<s;t++)e[n[t]].isBone=!0}for(let t=0,n=e.length;t<n;t++){const n=e[t];void 0!==n.mesh&&(this._addNodeRef(this.meshCache,n.mesh),void 0!==n.skin&&(s[n.mesh].isSkinnedMesh=!0)),void 0!==n.camera&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,s){if(e.refs[t]<=1)return s;const n=s.clone(),r=(e,t)=>{const s=this.associations.get(e);null!=s&&this.associations.set(t,s);for(const[s,n]of e.children.entries())r(n,t.children[s])};return r(s,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let s=0;s<t.length;s++){const n=e(t[s]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const s=[];for(let n=0;n<t.length;n++){const r=e(t[n]);r&&s.push(r)}return s}getDependency(e,t){const s=e+":"+t;let n=this.cache.get(s);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this.loadNode(t);break;case"mesh":n=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":n=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":n=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(s,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const s=this,n=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(n.map((function(t,n){return s.getDependency(e,n)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[s.KHR_BINARY_GLTF].body);const r=this.options;return new Promise((function(e,s){n.load(THREE.LoaderUtils.resolveURL(t.uri,r.path),e,void 0,(function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const s=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+s)}))}loadAccessor(e){const t=this,s=this.json,n=this.json.accessors[e];if(void 0===n.bufferView&&void 0===n.sparse)return Promise.resolve(null);const r=[];return void 0!==n.bufferView?r.push(this.getDependency("bufferView",n.bufferView)):r.push(null),void 0!==n.sparse&&(r.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(r).then((function(e){const r=e[0],i=k[n.type],o=N[n.componentType],a=o.BYTES_PER_ELEMENT,c=a*i,l=n.byteOffset||0,u=void 0!==n.bufferView?s.bufferViews[n.bufferView].byteStride:void 0,h=!0===n.normalized;let d,p;if(u&&u!==c){const e=Math.floor(l/u),s="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+e+":"+n.count;let c=t.cache.get(s);c||(d=new o(r,e*u,n.count*u/a),c=new THREE.InterleavedBuffer(d,u/a),t.cache.add(s,c)),p=new THREE.InterleavedBufferAttribute(c,i,l%u/a,h)}else d=null===r?new o(n.count*i):new o(r,l,n.count*i),p=new THREE.BufferAttribute(d,i,h);if(void 0!==n.sparse){const t=k.SCALAR,s=N[n.sparse.indices.componentType],a=n.sparse.indices.byteOffset||0,c=n.sparse.values.byteOffset||0,l=new s(e[1],a,n.sparse.count*t),u=new o(e[2],c,n.sparse.count*i);null!==r&&(p=new THREE.BufferAttribute(p.array.slice(),p.itemSize,p.normalized));for(let e=0,t=l.length;e<t;e++){const t=l[e];if(p.setX(t,u[e*i]),i>=2&&p.setY(t,u[e*i+1]),i>=3&&p.setZ(t,u[e*i+2]),i>=4&&p.setW(t,u[e*i+3]),i>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse THREE.BufferAttribute.")}}return p}))}loadTexture(e){const t=this.json,s=this.options,n=t.textures[e].source,r=t.images[n];let i=this.textureLoader;if(r.uri){const e=s.manager.getHandler(r.uri);null!==e&&(i=e)}return this.loadTextureImage(e,n,i)}loadTextureImage(e,t,s){const n=this,r=this.json,i=r.textures[e],o=r.images[t],a=(o.uri||o.bufferView)+":"+i.sampler;if(this.textureCache[a])return this.textureCache[a];const c=this.loadImageSource(t,s).then((function(t){t.flipY=!1,i.name&&(t.name=i.name);const s=(r.samplers||{})[i.sampler]||{};return t.magFilter=F[s.magFilter]||THREE.LinearFilter,t.minFilter=F[s.minFilter]||THREE.LinearMipmapLinearFilter,t.wrapS=U[s.wrapS]||THREE.RepeatWrapping,t.wrapT=U[s.wrapT]||THREE.RepeatWrapping,n.associations.set(t,{textures:e}),t})).catch((function(){return null}));return this.textureCache[a]=c,c}loadImageSource(e,t){const s=this,n=this.json,r=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));const i=n.images[e],o=self.URL||self.webkitURL;let a=i.uri||"",c=!1;if(void 0!==i.bufferView)a=s.getDependency("bufferView",i.bufferView).then((function(e){c=!0;const t=new Blob([e],{type:i.mimeType});return a=o.createObjectURL(t),a}));else if(void 0===i.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const l=Promise.resolve(a).then((function(e){return new Promise((function(s,n){let i=s;!0===t.isImageBitmapLoader&&(i=function(e){const t=new THREE.Texture(e);t.needsUpdate=!0,s(t)}),t.load(THREE.LoaderUtils.resolveURL(e,r.path),i,void 0,n)}))})).then((function(e){var t;return!0===c&&o.revokeObjectURL(a),e.userData.mimeType=i.mimeType||((t=i.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),e}));return this.sourceCache[e]=l,l}assignTexture(e,t,n,r){const i=this;return this.getDependency("texture",n.index).then((function(o){if(void 0===n.texCoord||0==n.texCoord||"aoMap"===t&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),i.extensions[s.KHR_TEXTURE_TRANSFORM]){const e=void 0!==n.extensions?n.extensions[s.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=i.associations.get(o);o=i.extensions[s.KHR_TEXTURE_TRANSFORM].extendTexture(o,e),i.associations.set(o,t)}}return void 0!==r&&(o.encoding=r),e[t]=o,o}))}assignFinalMaterial(e){const t=e.geometry;let s=e.material;const n=void 0===t.attributes.tangent,r=void 0!==t.attributes.color,i=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+s.uuid;let t=this.cache.get(e);t||(t=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(t,s),t.color.copy(s.color),t.map=s.map,t.sizeAttenuation=!1,this.cache.add(e,t)),s=t}else if(e.isLine){const e="LineBasicMaterial:"+s.uuid;let t=this.cache.get(e);t||(t=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(t,s),t.color.copy(s.color),this.cache.add(e,t)),s=t}if(n||r||i){let e="ClonedMaterial:"+s.uuid+":";s.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),n&&(e+="derivative-tangents:"),r&&(e+="vertex-colors:"),i&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=s.clone(),r&&(t.vertexColors=!0),i&&(t.flatShading=!0),n&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(s))),s=t}s.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=s}getMaterialType(){return THREE.MeshStandardMaterial}loadMaterial(e){const t=this,n=this.json,r=this.extensions,i=n.materials[e];let o;const a={},c=i.extensions||{},l=[];if(c[s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const e=r[s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];o=e.getMaterialType(),l.push(e.extendParams(a,i,t))}else if(c[s.KHR_MATERIALS_UNLIT]){const e=r[s.KHR_MATERIALS_UNLIT];o=e.getMaterialType(),l.push(e.extendParams(a,i,t))}else{const s=i.pbrMetallicRoughness||{};if(a.color=new THREE.Color(1,1,1),a.opacity=1,Array.isArray(s.baseColorFactor)){const e=s.baseColorFactor;a.color.fromArray(e),a.opacity=e[3]}void 0!==s.baseColorTexture&&l.push(t.assignTexture(a,"map",s.baseColorTexture,THREE.sRGBEncoding)),a.metalness=void 0!==s.metallicFactor?s.metallicFactor:1,a.roughness=void 0!==s.roughnessFactor?s.roughnessFactor:1,void 0!==s.metallicRoughnessTexture&&(l.push(t.assignTexture(a,"metalnessMap",s.metallicRoughnessTexture)),l.push(t.assignTexture(a,"roughnessMap",s.metallicRoughnessTexture))),o=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),l.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,a)}))))}!0===i.doubleSided&&(a.side=THREE.DoubleSide);const u=i.alphaMode||K;if(u===V?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,u===j&&(a.alphaTest=void 0!==i.alphaCutoff?i.alphaCutoff:.5)),void 0!==i.normalTexture&&o!==THREE.MeshBasicMaterial&&(l.push(t.assignTexture(a,"normalMap",i.normalTexture)),a.normalScale=new THREE.Vector2(1,1),void 0!==i.normalTexture.scale)){const e=i.normalTexture.scale;a.normalScale.set(e,e)}return void 0!==i.occlusionTexture&&o!==THREE.MeshBasicMaterial&&(l.push(t.assignTexture(a,"aoMap",i.occlusionTexture)),void 0!==i.occlusionTexture.strength&&(a.aoMapIntensity=i.occlusionTexture.strength)),void 0!==i.emissiveFactor&&o!==THREE.MeshBasicMaterial&&(a.emissive=(new THREE.Color).fromArray(i.emissiveFactor)),void 0!==i.emissiveTexture&&o!==THREE.MeshBasicMaterial&&l.push(t.assignTexture(a,"emissiveMap",i.emissiveTexture,THREE.sRGBEncoding)),Promise.all(l).then((function(){let n;return n=o===v?r[s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):new o(a),i.name&&(n.name=i.name),q(n,i),t.associations.set(n,{materials:e}),i.extensions&&X(r,n,i),n}))}createUniqueName(e){const t=THREE.PropertyBinding.sanitizeNodeName(e||"");let s=t;for(let e=1;this.nodeNamesUsed[s];++e)s=t+"_"+e;return this.nodeNamesUsed[s]=!0,s}loadGeometries(e){const t=this,n=this.extensions,r=this.primitiveCache;function i(e){return n[s.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(s){return $(s,e,t)}))}const o=[];for(let n=0,a=e.length;n<a;n++){const a=e[n],c=W(a),l=r[c];if(l)o.push(l.promise);else{let e;e=a.extensions&&a.extensions[s.KHR_DRACO_MESH_COMPRESSION]?i(a):$(new THREE.BufferGeometry,a,t),r[c]={primitive:a,promise:e},o.push(e)}}return Promise.all(o)}loadMesh(e){const t=this,s=this.json,n=this.extensions,r=s.meshes[e],i=r.primitives,o=[];for(let e=0,t=i.length;e<t;e++){const t=void 0===i[e].material?(void 0===(a=this.cache).DefaultMaterial&&(a.DefaultMaterial=new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide})),a.DefaultMaterial):this.getDependency("material",i[e].material);o.push(t)}var a;return o.push(t.loadGeometries(i)),Promise.all(o).then((function(s){const o=s.slice(0,s.length-1),a=s[s.length-1],c=[];for(let s=0,l=a.length;s<l;s++){const l=a[s],u=i[s];let h;const d=o[s];if(u.mode===P||u.mode===C||u.mode===O||void 0===u.mode)h=!0===r.isSkinnedMesh?new THREE.SkinnedMesh(l,d):new THREE.Mesh(l,d),!0!==h.isSkinnedMesh||h.geometry.attributes.skinWeight.normalized||h.normalizeSkinWeights(),u.mode===C?h.geometry=ee(h.geometry,THREE.TriangleStripDrawMode):u.mode===O&&(h.geometry=ee(h.geometry,THREE.TriangleFanDrawMode));else if(u.mode===w)h=new THREE.LineSegments(l,d);else if(u.mode===I)h=new THREE.Line(l,d);else if(u.mode===b)h=new THREE.LineLoop(l,d);else{if(u.mode!==L)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+u.mode);h=new THREE.Points(l,d)}Object.keys(h.geometry.morphAttributes).length>0&&z(h,r),h.name=t.createUniqueName(r.name||"mesh_"+e),q(h,r),u.extensions&&X(n,h,u),t.assignFinalMaterial(h),c.push(h)}for(let s=0,n=c.length;s<n;s++)t.associations.set(c[s],{meshes:e,primitives:s});if(1===c.length)return c[0];const l=new THREE.Group;t.associations.set(l,{meshes:e});for(let e=0,t=c.length;e<t;e++)l.add(c[e]);return l}))}loadCamera(e){let t;const s=this.json.cameras[e],n=s[s.type];if(n)return"perspective"===s.type?t=new THREE.PerspectiveCamera(THREE.MathUtils.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===s.type&&(t=new THREE.OrthographicCamera(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),s.name&&(t.name=this.createUniqueName(s.name)),q(t,s),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],s={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(s):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return s.inverseBindMatrices=e,s}))}loadAnimation(e){const t=this.json.animations[e],s=[],n=[],r=[],i=[],o=[];for(let e=0,a=t.channels.length;e<a;e++){const a=t.channels[e],c=t.samplers[a.sampler],l=a.target,u=l.node,h=void 0!==t.parameters?t.parameters[c.input]:c.input,d=void 0!==t.parameters?t.parameters[c.output]:c.output;s.push(this.getDependency("node",u)),n.push(this.getDependency("accessor",h)),r.push(this.getDependency("accessor",d)),i.push(c),o.push(l)}return Promise.all([Promise.all(s),Promise.all(n),Promise.all(r),Promise.all(i),Promise.all(o)]).then((function(s){const n=s[0],r=s[1],i=s[2],o=s[3],a=s[4],c=[];for(let e=0,t=n.length;e<t;e++){const t=n[e],s=r[e],l=i[e],u=o[e],h=a[e];if(void 0===t)continue;let d;switch(t.updateMatrix(),G[h.path]){case G.weights:d=THREE.NumberKeyframeTrack;break;case G.rotation:d=THREE.QuaternionKeyframeTrack;break;case G.position:case G.scale:default:d=THREE.VectorKeyframeTrack}const p=t.name?t.name:t.uuid,m=void 0!==u.interpolation?B[u.interpolation]:THREE.InterpolateLinear,f=[];G[h.path]===G.weights?t.traverse((function(e){e.morphTargetInfluences&&f.push(e.name?e.name:e.uuid)})):f.push(p);let E=l.array;if(l.normalized){const e=Y(E.constructor),t=new Float32Array(E.length);for(let s=0,n=E.length;s<n;s++)t[s]=E[s]*e;E=t}for(let e=0,t=f.length;e<t;e++){const t=new d(f[e]+"."+G[h.path],s.array,E,m);"CUBICSPLINE"===u.interpolation&&(t.createInterpolant=function(e){return new(this instanceof THREE.QuaternionKeyframeTrack?y:S)(this.times,this.values,this.getValueSize()/3,e)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),c.push(t)}}const l=t.name?t.name:"animation_"+e;return new THREE.AnimationClip(l,void 0,c)}))}createNodeMesh(e){const t=this.json,s=this,n=t.nodes[e];return void 0===n.mesh?null:s.getDependency("mesh",n.mesh).then((function(e){const t=s._getNodeRef(s.meshCache,n.mesh,e);return void 0!==n.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,s=n.weights.length;t<s;t++)e.morphTargetInfluences[t]=n.weights[t]})),t}))}loadNode(e){const t=this.json,s=this.extensions,n=this,r=t.nodes[e],i=r.name?n.createUniqueName(r.name):"";return function(){const t=[],s=n._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return s&&t.push(s),void 0!==r.camera&&t.push(n.getDependency("camera",r.camera).then((function(e){return n._getNodeRef(n.cameraCache,r.camera,e)}))),n._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)}().then((function(t){let o;if(o=!0===r.isBone?new THREE.Bone:t.length>1?new THREE.Group:1===t.length?t[0]:new THREE.Object3D,o!==t[0])for(let e=0,s=t.length;e<s;e++)o.add(t[e]);if(r.name&&(o.userData.name=r.name,o.name=i),q(o,r),r.extensions&&X(s,o,r),void 0!==r.matrix){const e=new THREE.Matrix4;e.fromArray(r.matrix),o.applyMatrix4(e)}else void 0!==r.translation&&o.position.fromArray(r.translation),void 0!==r.rotation&&o.quaternion.fromArray(r.rotation),void 0!==r.scale&&o.scale.fromArray(r.scale);return n.associations.has(o)||n.associations.set(o,{}),n.associations.get(o).nodes=e,o}))}loadScene(e){const t=this.json,s=this.extensions,n=this.json.scenes[e],r=this,i=new THREE.Group;n.name&&(i.name=r.createUniqueName(n.name)),q(i,n),n.extensions&&X(s,i,n);const o=n.nodes||[],a=[];for(let e=0,s=o.length;e<s;e++)a.push(Z(o[e],i,t,r));return Promise.all(a).then((function(){return r.associations=(e=>{const t=new Map;for(const[e,s]of r.associations)(e instanceof THREE.Material||e instanceof THREE.Texture)&&t.set(e,s);return e.traverse((e=>{const s=r.associations.get(e);null!=s&&t.set(e,s)})),t})(i),i}))}}function Z(e,t,s,n){const r=s.nodes[e];return n.getDependency("node",e).then((function(e){if(void 0===r.skin)return e;let t;return n.getDependency("skin",r.skin).then((function(e){t=e;const s=[];for(let e=0,r=t.joints.length;e<r;e++)s.push(n.getDependency("node",t.joints[e]));return Promise.all(s)})).then((function(s){return e.traverse((function(e){if(!e.isMesh)return;const n=[],r=[];for(let e=0,i=s.length;e<i;e++){const i=s[e];if(i){n.push(i);const s=new THREE.Matrix4;void 0!==t.inverseBindMatrices&&s.fromArray(t.inverseBindMatrices.array,16*e),r.push(s)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[e])}e.bind(new THREE.Skeleton(n,r),e.matrixWorld)})),e}))})).then((function(e){t.add(e);const i=[];if(r.children){const t=r.children;for(let r=0,o=t.length;r<o;r++){const o=t[r];i.push(Z(o,e,s,n))}}return Promise.all(i)}))}function $(e,t,s){const n=t.attributes,r=[];function i(t,n){return s.getDependency("accessor",t).then((function(t){e.setAttribute(n,t)}))}for(const t in n){const s=D[t]||t.toLowerCase();s in e.attributes||r.push(i(n[t],s))}if(void 0!==t.indices&&!e.index){const n=s.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));r.push(n)}return q(e,t),function(e,t,s){const n=t.attributes,r=new THREE.Box3;if(void 0===n.POSITION)return;{const e=s.json.accessors[n.POSITION],t=e.min,i=e.max;if(void 0===t||void 0===i)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(r.set(new THREE.Vector3(t[0],t[1],t[2]),new THREE.Vector3(i[0],i[1],i[2])),e.normalized){const t=Y(N[e.componentType]);r.min.multiplyScalar(t),r.max.multiplyScalar(t)}}const i=t.targets;if(void 0!==i){const e=new THREE.Vector3,t=new THREE.Vector3;for(let n=0,r=i.length;n<r;n++){const r=i[n];if(void 0!==r.POSITION){const n=s.json.accessors[r.POSITION],i=n.min,o=n.max;if(void 0!==i&&void 0!==o){if(t.setX(Math.max(Math.abs(i[0]),Math.abs(o[0]))),t.setY(Math.max(Math.abs(i[1]),Math.abs(o[1]))),t.setZ(Math.max(Math.abs(i[2]),Math.abs(o[2]))),n.normalized){const e=Y(N[n.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(e)}e.boundingBox=r;const o=new THREE.Sphere;r.getCenter(o.center),o.radius=r.min.distanceTo(r.max)/2,e.boundingSphere=o}(e,t,s),Promise.all(r).then((function(){return void 0!==t.targets?function(e,t,s){let n=!1,r=!1,i=!1;for(let e=0,s=t.length;e<s;e++){const s=t[e];if(void 0!==s.POSITION&&(n=!0),void 0!==s.NORMAL&&(r=!0),void 0!==s.COLOR_0&&(i=!0),n&&r&&i)break}if(!n&&!r&&!i)return Promise.resolve(e);const o=[],a=[],c=[];for(let l=0,u=t.length;l<u;l++){const u=t[l];if(n){const t=void 0!==u.POSITION?s.getDependency("accessor",u.POSITION):e.attributes.position;o.push(t)}if(r){const t=void 0!==u.NORMAL?s.getDependency("accessor",u.NORMAL):e.attributes.normal;a.push(t)}if(i){const t=void 0!==u.COLOR_0?s.getDependency("accessor",u.COLOR_0):e.attributes.color;c.push(t)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(c)]).then((function(t){const s=t[0],o=t[1],a=t[2];return n&&(e.morphAttributes.position=s),r&&(e.morphAttributes.normal=o),i&&(e.morphAttributes.color=a),e.morphTargetsRelative=!0,e}))}(e,t.targets,s):e}))}function ee(e,t){let s=e.getIndex();if(null===s){const t=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<n.count;e++)t.push(e);e.setIndex(t),s=e.getIndex()}const n=s.count-2,r=[];if(t===THREE.TriangleFanDrawMode)for(let e=1;e<=n;e++)r.push(s.getX(0)),r.push(s.getX(e)),r.push(s.getX(e+1));else for(let e=0;e<n;e++)e%2==0?(r.push(s.getX(e)),r.push(s.getX(e+1)),r.push(s.getX(e+2))):(r.push(s.getX(e+2)),r.push(s.getX(e+1)),r.push(s.getX(e)));r.length/3!==n&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=e.clone();return i.setIndex(r),i}THREE.GLTFLoader=e}();;
/*! howler.js v2.2.3 | (c) 2013-2020, James Simpson of GoldFire Studios | MIT License | howlerjs.com */
!function(){"use strict";var e=function(){this.init()};e.prototype={init:function(){var e=this||n;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var o=this||n;if(e=parseFloat(e),o.ctx||_(),void 0!==e&&e>=0&&e<=1){if(o._volume=e,o._muted)return o;o.usingWebAudio&&o.masterGain.gain.setValueAtTime(e,n.ctx.currentTime);for(var t=0;t<o._howls.length;t++)if(!o._howls[t]._webAudio)for(var r=o._howls[t]._getSoundIds(),a=0;a<r.length;a++){var u=o._howls[t]._soundById(r[a]);u&&u._node&&(u._node.volume=u._volume*e)}return o}return o._volume},mute:function(e){var o=this||n;o.ctx||_(),o._muted=e,o.usingWebAudio&&o.masterGain.gain.setValueAtTime(e?0:o._volume,n.ctx.currentTime);for(var t=0;t<o._howls.length;t++)if(!o._howls[t]._webAudio)for(var r=o._howls[t]._getSoundIds(),a=0;a<r.length;a++){var u=o._howls[t]._soundById(r[a]);u&&u._node&&(u._node.muted=!!e||u._muted)}return o},stop:function(){for(var e=this||n,o=0;o<e._howls.length;o++)e._howls[o].stop();return e},unload:function(){for(var e=this||n,o=e._howls.length-1;o>=0;o--)e._howls[o].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,_()),e},codecs:function(e){return(this||n)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||n;if(e.state=e.ctx?e.ctx.state||"suspended":"suspended",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{var o=new Audio;void 0===o.oncanplaythrough&&(e._canPlayEvent="canplay")}catch(n){e.noAudio=!0}else e.noAudio=!0;try{var o=new Audio;o.muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||n,o=null;try{o="undefined"!=typeof Audio?new Audio:null}catch(n){return e}if(!o||"function"!=typeof o.canPlayType)return e;var t=o.canPlayType("audio/mpeg;").replace(/^no$/,""),r=e._navigator?e._navigator.userAgent:"",a=r.match(/OPR\/([0-6].)/g),u=a&&parseInt(a[0].split("/")[1],10)<33,d=-1!==r.indexOf("Safari")&&-1===r.indexOf("Chrome"),i=r.match(/Version\/(.*?) /),_=d&&i&&parseInt(i[1],10)<15;return e._codecs={mp3:!(u||!t&&!o.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!t,opus:!!o.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!o.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!o.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(o.canPlayType('audio/wav; codecs="1"')||o.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!o.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!o.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(o.canPlayType("audio/x-m4a;")||o.canPlayType("audio/m4a;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(o.canPlayType("audio/x-m4b;")||o.canPlayType("audio/m4b;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(o.canPlayType("audio/x-mp4;")||o.canPlayType("audio/mp4;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(_||!o.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(_||!o.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!o.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(o.canPlayType("audio/x-flac;")||o.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||n;if(!e._audioUnlocked&&e.ctx){e._audioUnlocked=!1,e.autoUnlock=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var o=function(n){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var t=new Audio;t._unlocked=!0,e._releaseHtml5Audio(t)}catch(n){e.noAudio=!0;break}for(var r=0;r<e._howls.length;r++)if(!e._howls[r]._webAudio)for(var a=e._howls[r]._getSoundIds(),u=0;u<a.length;u++){var d=e._howls[r]._soundById(a[u]);d&&d._node&&!d._node._unlocked&&(d._node._unlocked=!0,d._node.load())}e._autoResume();var i=e.ctx.createBufferSource();i.buffer=e._scratchBuffer,i.connect(e.ctx.destination),void 0===i.start?i.noteOn(0):i.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),i.onended=function(){i.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",o,!0),document.removeEventListener("touchend",o,!0),document.removeEventListener("click",o,!0),document.removeEventListener("keydown",o,!0);for(var n=0;n<e._howls.length;n++)e._howls[n]._emit("unlock")}};return document.addEventListener("touchstart",o,!0),document.addEventListener("touchend",o,!0),document.addEventListener("click",o,!0),document.addEventListener("keydown",o,!0),e}},_obtainHtml5Audio:function(){var e=this||n;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var o=(new Audio).play();return o&&"undefined"!=typeof Promise&&(o instanceof Promise||"function"==typeof o.then)&&o.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(e){var o=this||n;return e._unlocked&&o._html5AudioPool.push(e),o},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&n.usingWebAudio){for(var o=0;o<e._howls.length;o++)if(e._howls[o]._webAudio)for(var t=0;t<e._howls[o]._sounds.length;t++)if(!e._howls[o]._sounds[t]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout(function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var n=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(n,n)}},3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&n.usingWebAudio)return"running"===e.state&&"interrupted"!==e.ctx.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state||"running"===e.state&&"interrupted"===e.ctx.state?(e.ctx.resume().then(function(){e.state="running";for(var n=0;n<e._howls.length;n++)e._howls[n]._emit("resume")}),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var n=new e,o=function(e){var n=this;if(!e.src||0===e.src.length)return void console.error("An array of source files must be passed with any new Howl.");n.init(e)};o.prototype={init:function(e){var o=this;return n.ctx||_(),o._autoplay=e.autoplay||!1,o._format="string"!=typeof e.format?e.format:[e.format],o._html5=e.html5||!1,o._muted=e.mute||!1,o._loop=e.loop||!1,o._pool=e.pool||5,o._preload="boolean"!=typeof e.preload&&"metadata"!==e.preload||e.preload,o._rate=e.rate||1,o._sprite=e.sprite||{},o._src="string"!=typeof e.src?e.src:[e.src],o._volume=void 0!==e.volume?e.volume:1,o._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},o._duration=0,o._state="unloaded",o._sounds=[],o._endTimers={},o._queue=[],o._playLock=!1,o._onend=e.onend?[{fn:e.onend}]:[],o._onfade=e.onfade?[{fn:e.onfade}]:[],o._onload=e.onload?[{fn:e.onload}]:[],o._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],o._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],o._onpause=e.onpause?[{fn:e.onpause}]:[],o._onplay=e.onplay?[{fn:e.onplay}]:[],o._onstop=e.onstop?[{fn:e.onstop}]:[],o._onmute=e.onmute?[{fn:e.onmute}]:[],o._onvolume=e.onvolume?[{fn:e.onvolume}]:[],o._onrate=e.onrate?[{fn:e.onrate}]:[],o._onseek=e.onseek?[{fn:e.onseek}]:[],o._onunlock=e.onunlock?[{fn:e.onunlock}]:[],o._onresume=[],o._webAudio=n.usingWebAudio&&!o._html5,void 0!==n.ctx&&n.ctx&&n.autoUnlock&&n._unlockAudio(),n._howls.push(o),o._autoplay&&o._queue.push({event:"play",action:function(){o.play()}}),o._preload&&"none"!==o._preload&&o.load(),o},load:function(){var e=this,o=null;if(n.noAudio)return void e._emit("loaderror",null,"No audio support.");"string"==typeof e._src&&(e._src=[e._src]);for(var r=0;r<e._src.length;r++){var u,d;if(e._format&&e._format[r])u=e._format[r];else{if("string"!=typeof(d=e._src[r])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}u=/^data:audio\/([^;,]+);/i.exec(d),u||(u=/\.([^.]+)$/.exec(d.split("?",1)[0])),u&&(u=u[1].toLowerCase())}if(u||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),u&&n.codecs(u)){o=e._src[r];break}}return o?(e._src=o,e._state="loading","https:"===window.location.protocol&&"http:"===o.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new t(e),e._webAudio&&a(e),e):void e._emit("loaderror",null,"No codec support for selected audio sources.")},play:function(e,o){var t=this,r=null;if("number"==typeof e)r=e,e=null;else{if("string"==typeof e&&"loaded"===t._state&&!t._sprite[e])return null;if(void 0===e&&(e="__default",!t._playLock)){for(var a=0,u=0;u<t._sounds.length;u++)t._sounds[u]._paused&&!t._sounds[u]._ended&&(a++,r=t._sounds[u]._id);1===a?e=null:r=null}}var d=r?t._soundById(r):t._inactiveSound();if(!d)return null;if(r&&!e&&(e=d._sprite||"__default"),"loaded"!==t._state){d._sprite=e,d._ended=!1;var i=d._id;return t._queue.push({event:"play",action:function(){t.play(i)}}),i}if(r&&!d._paused)return o||t._loadQueue("play"),d._id;t._webAudio&&n._autoResume();var _=Math.max(0,d._seek>0?d._seek:t._sprite[e][0]/1e3),s=Math.max(0,(t._sprite[e][0]+t._sprite[e][1])/1e3-_),l=1e3*s/Math.abs(d._rate),c=t._sprite[e][0]/1e3,f=(t._sprite[e][0]+t._sprite[e][1])/1e3;d._sprite=e,d._ended=!1;var p=function(){d._paused=!1,d._seek=_,d._start=c,d._stop=f,d._loop=!(!d._loop&&!t._sprite[e][2])};if(_>=f)return void t._ended(d);var m=d._node;if(t._webAudio){var v=function(){t._playLock=!1,p(),t._refreshBuffer(d);var e=d._muted||t._muted?0:d._volume;m.gain.setValueAtTime(e,n.ctx.currentTime),d._playStart=n.ctx.currentTime,void 0===m.bufferSource.start?d._loop?m.bufferSource.noteGrainOn(0,_,86400):m.bufferSource.noteGrainOn(0,_,s):d._loop?m.bufferSource.start(0,_,86400):m.bufferSource.start(0,_,s),l!==1/0&&(t._endTimers[d._id]=setTimeout(t._ended.bind(t,d),l)),o||setTimeout(function(){t._emit("play",d._id),t._loadQueue()},0)};"running"===n.state&&"interrupted"!==n.ctx.state?v():(t._playLock=!0,t.once("resume",v),t._clearTimer(d._id))}else{var h=function(){m.currentTime=_,m.muted=d._muted||t._muted||n._muted||m.muted,m.volume=d._volume*n.volume(),m.playbackRate=d._rate;try{var r=m.play();if(r&&"undefined"!=typeof Promise&&(r instanceof Promise||"function"==typeof r.then)?(t._playLock=!0,p(),r.then(function(){t._playLock=!1,m._unlocked=!0,o?t._loadQueue():t._emit("play",d._id)}).catch(function(){t._playLock=!1,t._emit("playerror",d._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),d._ended=!0,d._paused=!0})):o||(t._playLock=!1,p(),t._emit("play",d._id)),m.playbackRate=d._rate,m.paused)return void t._emit("playerror",d._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==e||d._loop?t._endTimers[d._id]=setTimeout(t._ended.bind(t,d),l):(t._endTimers[d._id]=function(){t._ended(d),m.removeEventListener("ended",t._endTimers[d._id],!1)},m.addEventListener("ended",t._endTimers[d._id],!1))}catch(e){t._emit("playerror",d._id,e)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===m.src&&(m.src=t._src,m.load());var y=window&&window.ejecta||!m.readyState&&n._navigator.isCocoonJS;if(m.readyState>=3||y)h();else{t._playLock=!0,t._state="loading";var g=function(){t._state="loaded",h(),m.removeEventListener(n._canPlayEvent,g,!1)};m.addEventListener(n._canPlayEvent,g,!1),t._clearTimer(d._id)}}return d._id},pause:function(e){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"pause",action:function(){n.pause(e)}}),n;for(var o=n._getSoundIds(e),t=0;t<o.length;t++){n._clearTimer(o[t]);var r=n._soundById(o[t]);if(r&&!r._paused&&(r._seek=n.seek(o[t]),r._rateSeek=0,r._paused=!0,n._stopFade(o[t]),r._node))if(n._webAudio){if(!r._node.bufferSource)continue;void 0===r._node.bufferSource.stop?r._node.bufferSource.noteOff(0):r._node.bufferSource.stop(0),n._cleanBuffer(r._node)}else isNaN(r._node.duration)&&r._node.duration!==1/0||r._node.pause();arguments[1]||n._emit("pause",r?r._id:null)}return n},stop:function(e,n){var o=this;if("loaded"!==o._state||o._playLock)return o._queue.push({event:"stop",action:function(){o.stop(e)}}),o;for(var t=o._getSoundIds(e),r=0;r<t.length;r++){o._clearTimer(t[r]);var a=o._soundById(t[r]);a&&(a._seek=a._start||0,a._rateSeek=0,a._paused=!0,a._ended=!0,o._stopFade(t[r]),a._node&&(o._webAudio?a._node.bufferSource&&(void 0===a._node.bufferSource.stop?a._node.bufferSource.noteOff(0):a._node.bufferSource.stop(0),o._cleanBuffer(a._node)):isNaN(a._node.duration)&&a._node.duration!==1/0||(a._node.currentTime=a._start||0,a._node.pause(),a._node.duration===1/0&&o._clearSound(a._node))),n||o._emit("stop",a._id))}return o},mute:function(e,o){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"mute",action:function(){t.mute(e,o)}}),t;if(void 0===o){if("boolean"!=typeof e)return t._muted;t._muted=e}for(var r=t._getSoundIds(o),a=0;a<r.length;a++){var u=t._soundById(r[a]);u&&(u._muted=e,u._interval&&t._stopFade(u._id),t._webAudio&&u._node?u._node.gain.setValueAtTime(e?0:u._volume,n.ctx.currentTime):u._node&&(u._node.muted=!!n._muted||e),t._emit("mute",u._id))}return t},volume:function(){var e,o,t=this,r=arguments;if(0===r.length)return t._volume;if(1===r.length||2===r.length&&void 0===r[1]){t._getSoundIds().indexOf(r[0])>=0?o=parseInt(r[0],10):e=parseFloat(r[0])}else r.length>=2&&(e=parseFloat(r[0]),o=parseInt(r[1],10));var a;if(!(void 0!==e&&e>=0&&e<=1))return a=o?t._soundById(o):t._sounds[0],a?a._volume:0;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"volume",action:function(){t.volume.apply(t,r)}}),t;void 0===o&&(t._volume=e),o=t._getSoundIds(o);for(var u=0;u<o.length;u++)(a=t._soundById(o[u]))&&(a._volume=e,r[2]||t._stopFade(o[u]),t._webAudio&&a._node&&!a._muted?a._node.gain.setValueAtTime(e,n.ctx.currentTime):a._node&&!a._muted&&(a._node.volume=e*n.volume()),t._emit("volume",a._id));return t},fade:function(e,o,t,r){var a=this;if("loaded"!==a._state||a._playLock)return a._queue.push({event:"fade",action:function(){a.fade(e,o,t,r)}}),a;e=Math.min(Math.max(0,parseFloat(e)),1),o=Math.min(Math.max(0,parseFloat(o)),1),t=parseFloat(t),a.volume(e,r);for(var u=a._getSoundIds(r),d=0;d<u.length;d++){var i=a._soundById(u[d]);if(i){if(r||a._stopFade(u[d]),a._webAudio&&!i._muted){var _=n.ctx.currentTime,s=_+t/1e3;i._volume=e,i._node.gain.setValueAtTime(e,_),i._node.gain.linearRampToValueAtTime(o,s)}a._startFadeInterval(i,e,o,t,u[d],void 0===r)}}return a},_startFadeInterval:function(e,n,o,t,r,a){var u=this,d=n,i=o-n,_=Math.abs(i/.01),s=Math.max(4,_>0?t/_:t),l=Date.now();e._fadeTo=o,e._interval=setInterval(function(){var r=(Date.now()-l)/t;l=Date.now(),d+=i*r,d=Math.round(100*d)/100,d=i<0?Math.max(o,d):Math.min(o,d),u._webAudio?e._volume=d:u.volume(d,e._id,!0),a&&(u._volume=d),(o<n&&d<=o||o>n&&d>=o)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,u.volume(o,e._id),u._emit("fade",e._id))},s)},_stopFade:function(e){var o=this,t=o._soundById(e);return t&&t._interval&&(o._webAudio&&t._node.gain.cancelScheduledValues(n.ctx.currentTime),clearInterval(t._interval),t._interval=null,o.volume(t._fadeTo,e),t._fadeTo=null,o._emit("fade",e)),o},loop:function(){var e,n,o,t=this,r=arguments;if(0===r.length)return t._loop;if(1===r.length){if("boolean"!=typeof r[0])return!!(o=t._soundById(parseInt(r[0],10)))&&o._loop;e=r[0],t._loop=e}else 2===r.length&&(e=r[0],n=parseInt(r[1],10));for(var a=t._getSoundIds(n),u=0;u<a.length;u++)(o=t._soundById(a[u]))&&(o._loop=e,t._webAudio&&o._node&&o._node.bufferSource&&(o._node.bufferSource.loop=e,e&&(o._node.bufferSource.loopStart=o._start||0,o._node.bufferSource.loopEnd=o._stop,t.playing(a[u])&&(t.pause(a[u],!0),t.play(a[u],!0)))));return t},rate:function(){var e,o,t=this,r=arguments;if(0===r.length)o=t._sounds[0]._id;else if(1===r.length){var a=t._getSoundIds(),u=a.indexOf(r[0]);u>=0?o=parseInt(r[0],10):e=parseFloat(r[0])}else 2===r.length&&(e=parseFloat(r[0]),o=parseInt(r[1],10));var d;if("number"!=typeof e)return d=t._soundById(o),d?d._rate:t._rate;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"rate",action:function(){t.rate.apply(t,r)}}),t;void 0===o&&(t._rate=e),o=t._getSoundIds(o);for(var i=0;i<o.length;i++)if(d=t._soundById(o[i])){t.playing(o[i])&&(d._rateSeek=t.seek(o[i]),d._playStart=t._webAudio?n.ctx.currentTime:d._playStart),d._rate=e,t._webAudio&&d._node&&d._node.bufferSource?d._node.bufferSource.playbackRate.setValueAtTime(e,n.ctx.currentTime):d._node&&(d._node.playbackRate=e);var _=t.seek(o[i]),s=(t._sprite[d._sprite][0]+t._sprite[d._sprite][1])/1e3-_,l=1e3*s/Math.abs(d._rate);!t._endTimers[o[i]]&&d._paused||(t._clearTimer(o[i]),t._endTimers[o[i]]=setTimeout(t._ended.bind(t,d),l)),t._emit("rate",d._id)}return t},seek:function(){var e,o,t=this,r=arguments;if(0===r.length)t._sounds.length&&(o=t._sounds[0]._id);else if(1===r.length){var a=t._getSoundIds(),u=a.indexOf(r[0]);u>=0?o=parseInt(r[0],10):t._sounds.length&&(o=t._sounds[0]._id,e=parseFloat(r[0]))}else 2===r.length&&(e=parseFloat(r[0]),o=parseInt(r[1],10));if(void 0===o)return 0;if("number"==typeof e&&("loaded"!==t._state||t._playLock))return t._queue.push({event:"seek",action:function(){t.seek.apply(t,r)}}),t;var d=t._soundById(o);if(d){if(!("number"==typeof e&&e>=0)){if(t._webAudio){var i=t.playing(o)?n.ctx.currentTime-d._playStart:0,_=d._rateSeek?d._rateSeek-d._seek:0;return d._seek+(_+i*Math.abs(d._rate))}return d._node.currentTime}var s=t.playing(o);s&&t.pause(o,!0),d._seek=e,d._ended=!1,t._clearTimer(o),t._webAudio||!d._node||isNaN(d._node.duration)||(d._node.currentTime=e);var l=function(){s&&t.play(o,!0),t._emit("seek",o)};if(s&&!t._webAudio){var c=function(){t._playLock?setTimeout(c,0):l()};setTimeout(c,0)}else l()}return t},playing:function(e){var n=this;if("number"==typeof e){var o=n._soundById(e);return!!o&&!o._paused}for(var t=0;t<n._sounds.length;t++)if(!n._sounds[t]._paused)return!0;return!1},duration:function(e){var n=this,o=n._duration,t=n._soundById(e);return t&&(o=n._sprite[t._sprite][1]/1e3),o},state:function(){return this._state},unload:function(){for(var e=this,o=e._sounds,t=0;t<o.length;t++)o[t]._paused||e.stop(o[t]._id),e._webAudio||(e._clearSound(o[t]._node),o[t]._node.removeEventListener("error",o[t]._errorFn,!1),o[t]._node.removeEventListener(n._canPlayEvent,o[t]._loadFn,!1),o[t]._node.removeEventListener("ended",o[t]._endFn,!1),n._releaseHtml5Audio(o[t]._node)),delete o[t]._node,e._clearTimer(o[t]._id);var a=n._howls.indexOf(e);a>=0&&n._howls.splice(a,1);var u=!0;for(t=0;t<n._howls.length;t++)if(n._howls[t]._src===e._src||e._src.indexOf(n._howls[t]._src)>=0){u=!1;break}return r&&u&&delete r[e._src],n.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,n,o,t){var r=this,a=r["_on"+e];return"function"==typeof n&&a.push(t?{id:o,fn:n,once:t}:{id:o,fn:n}),r},off:function(e,n,o){var t=this,r=t["_on"+e],a=0;if("number"==typeof n&&(o=n,n=null),n||o)for(a=0;a<r.length;a++){var u=o===r[a].id;if(n===r[a].fn&&u||!n&&u){r.splice(a,1);break}}else if(e)t["_on"+e]=[];else{var d=Object.keys(t);for(a=0;a<d.length;a++)0===d[a].indexOf("_on")&&Array.isArray(t[d[a]])&&(t[d[a]]=[])}return t},once:function(e,n,o){var t=this;return t.on(e,n,o,1),t},_emit:function(e,n,o){for(var t=this,r=t["_on"+e],a=r.length-1;a>=0;a--)r[a].id&&r[a].id!==n&&"load"!==e||(setTimeout(function(e){e.call(this,n,o)}.bind(t,r[a].fn),0),r[a].once&&t.off(e,r[a].fn,r[a].id));return t._loadQueue(e),t},_loadQueue:function(e){var n=this;if(n._queue.length>0){var o=n._queue[0];o.event===e&&(n._queue.shift(),n._loadQueue()),e||o.action()}return n},_ended:function(e){var o=this,t=e._sprite;if(!o._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(o._ended.bind(o,e),100),o;var r=!(!e._loop&&!o._sprite[t][2]);if(o._emit("end",e._id),!o._webAudio&&r&&o.stop(e._id,!0).play(e._id),o._webAudio&&r){o._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=n.ctx.currentTime;var a=1e3*(e._stop-e._start)/Math.abs(e._rate);o._endTimers[e._id]=setTimeout(o._ended.bind(o,e),a)}return o._webAudio&&!r&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,o._clearTimer(e._id),o._cleanBuffer(e._node),n._autoSuspend()),o._webAudio||r||o.stop(e._id,!0),o},_clearTimer:function(e){var n=this;if(n._endTimers[e]){if("function"!=typeof n._endTimers[e])clearTimeout(n._endTimers[e]);else{var o=n._soundById(e);o&&o._node&&o._node.removeEventListener("ended",n._endTimers[e],!1)}delete n._endTimers[e]}return n},_soundById:function(e){for(var n=this,o=0;o<n._sounds.length;o++)if(e===n._sounds[o]._id)return n._sounds[o];return null},_inactiveSound:function(){var e=this;e._drain();for(var n=0;n<e._sounds.length;n++)if(e._sounds[n]._ended)return e._sounds[n].reset();return new t(e)},_drain:function(){var e=this,n=e._pool,o=0,t=0;if(!(e._sounds.length<n)){for(t=0;t<e._sounds.length;t++)e._sounds[t]._ended&&o++;for(t=e._sounds.length-1;t>=0;t--){if(o<=n)return;e._sounds[t]._ended&&(e._webAudio&&e._sounds[t]._node&&e._sounds[t]._node.disconnect(0),e._sounds.splice(t,1),o--)}}},_getSoundIds:function(e){var n=this;if(void 0===e){for(var o=[],t=0;t<n._sounds.length;t++)o.push(n._sounds[t]._id);return o}return[e]},_refreshBuffer:function(e){var o=this;return e._node.bufferSource=n.ctx.createBufferSource(),e._node.bufferSource.buffer=r[o._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,n.ctx.currentTime),o},_cleanBuffer:function(e){var o=this,t=n._navigator&&n._navigator.vendor.indexOf("Apple")>=0;if(n._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),t))try{e.bufferSource.buffer=n._scratchBuffer}catch(e){}return e.bufferSource=null,o},_clearSound:function(e){/MSIE |Trident\//.test(n._navigator&&n._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var t=function(e){this._parent=e,this.init()};t.prototype={init:function(){var e=this,o=e._parent;return e._muted=o._muted,e._loop=o._loop,e._volume=o._volume,e._rate=o._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++n._counter,o._sounds.push(e),e.create(),e},create:function(){var e=this,o=e._parent,t=n._muted||e._muted||e._parent._muted?0:e._volume;return o._webAudio?(e._node=void 0===n.ctx.createGain?n.ctx.createGainNode():n.ctx.createGain(),e._node.gain.setValueAtTime(t,n.ctx.currentTime),e._node.paused=!0,e._node.connect(n.masterGain)):n.noAudio||(e._node=n._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(n._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=o._src,e._node.preload=!0===o._preload?"auto":o._preload,e._node.volume=t*n.volume(),e._node.load()),e},reset:function(){var e=this,o=e._parent;return e._muted=o._muted,e._loop=o._loop,e._volume=o._volume,e._rate=o._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++n._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,o=e._parent;o._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(o._sprite).length&&(o._sprite={__default:[0,1e3*o._duration]}),"loaded"!==o._state&&(o._state="loaded",o._emit("load"),o._loadQueue()),e._node.removeEventListener(n._canPlayEvent,e._loadFn,!1)},_endListener:function(){var e=this,n=e._parent;n._duration===1/0&&(n._duration=Math.ceil(10*e._node.duration)/10,n._sprite.__default[1]===1/0&&(n._sprite.__default[1]=1e3*n._duration),n._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}};var r={},a=function(e){var n=e._src;if(r[n])return e._duration=r[n].duration,void i(e);if(/^data:[^;]+;base64,/.test(n)){for(var o=atob(n.split(",")[1]),t=new Uint8Array(o.length),a=0;a<o.length;++a)t[a]=o.charCodeAt(a);d(t.buffer,e)}else{var _=new XMLHttpRequest;_.open(e._xhr.method,n,!0),_.withCredentials=e._xhr.withCredentials,_.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach(function(n){_.setRequestHeader(n,e._xhr.headers[n])}),_.onload=function(){var n=(_.status+"")[0];if("0"!==n&&"2"!==n&&"3"!==n)return void e._emit("loaderror",null,"Failed loading audio file with status: "+_.status+".");d(_.response,e)},_.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete r[n],e.load())},u(_)}},u=function(e){try{e.send()}catch(n){e.onerror()}},d=function(e,o){var t=function(){o._emit("loaderror",null,"Decoding audio data failed.")},a=function(e){e&&o._sounds.length>0?(r[o._src]=e,i(o,e)):t()};"undefined"!=typeof Promise&&1===n.ctx.decodeAudioData.length?n.ctx.decodeAudioData(e).then(a).catch(t):n.ctx.decodeAudioData(e,a,t)},i=function(e,n){n&&!e._duration&&(e._duration=n.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},_=function(){if(n.usingWebAudio){try{"undefined"!=typeof AudioContext?n.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?n.ctx=new webkitAudioContext:n.usingWebAudio=!1}catch(e){n.usingWebAudio=!1}n.ctx||(n.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(n._navigator&&n._navigator.platform),o=n._navigator&&n._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),t=o?parseInt(o[1],10):null;if(e&&t&&t<9){var r=/safari/.test(n._navigator&&n._navigator.userAgent.toLowerCase());n._navigator&&!r&&(n.usingWebAudio=!1)}n.usingWebAudio&&(n.masterGain=void 0===n.ctx.createGain?n.ctx.createGainNode():n.ctx.createGain(),n.masterGain.gain.setValueAtTime(n._muted?0:n._volume,n.ctx.currentTime),n.masterGain.connect(n.ctx.destination)),n._setup()}};"function"==typeof define&&define.amd&&define([],function(){return{Howler:n,Howl:o}}),"undefined"!=typeof exports&&(exports.Howler=n,exports.Howl=o),"undefined"!=typeof global?(global.HowlerGlobal=e,global.Howler=n,global.Howl=o,global.Sound=t):"undefined"!=typeof window&&(window.HowlerGlobal=e,window.Howler=n,window.Howl=o,window.Sound=t)}();
/*! Spatial Plugin */
!function(){"use strict";HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var n=this;if(!n.ctx||!n.ctx.listener)return n;for(var t=n._howls.length-1;t>=0;t--)n._howls[t].stereo(e);return n},HowlerGlobal.prototype.pos=function(e,n,t){var r=this;return r.ctx&&r.ctx.listener?(n="number"!=typeof n?r._pos[1]:n,t="number"!=typeof t?r._pos[2]:t,"number"!=typeof e?r._pos:(r._pos=[e,n,t],void 0!==r.ctx.listener.positionX?(r.ctx.listener.positionX.setTargetAtTime(r._pos[0],Howler.ctx.currentTime,.1),r.ctx.listener.positionY.setTargetAtTime(r._pos[1],Howler.ctx.currentTime,.1),r.ctx.listener.positionZ.setTargetAtTime(r._pos[2],Howler.ctx.currentTime,.1)):r.ctx.listener.setPosition(r._pos[0],r._pos[1],r._pos[2]),r)):r},HowlerGlobal.prototype.orientation=function(e,n,t,r,o,i){var a=this;if(!a.ctx||!a.ctx.listener)return a;var s=a._orientation;return n="number"!=typeof n?s[1]:n,t="number"!=typeof t?s[2]:t,r="number"!=typeof r?s[3]:r,o="number"!=typeof o?s[4]:o,i="number"!=typeof i?s[5]:i,"number"!=typeof e?s:(a._orientation=[e,n,t,r,o,i],void 0!==a.ctx.listener.forwardX?(a.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),a.ctx.listener.forwardY.setTargetAtTime(n,Howler.ctx.currentTime,.1),a.ctx.listener.forwardZ.setTargetAtTime(t,Howler.ctx.currentTime,.1),a.ctx.listener.upX.setTargetAtTime(r,Howler.ctx.currentTime,.1),a.ctx.listener.upY.setTargetAtTime(o,Howler.ctx.currentTime,.1),a.ctx.listener.upZ.setTargetAtTime(i,Howler.ctx.currentTime,.1)):a.ctx.listener.setOrientation(e,n,t,r,o,i),a)},Howl.prototype.init=function(e){return function(n){var t=this;return t._orientation=n.orientation||[1,0,0],t._stereo=n.stereo||null,t._pos=n.pos||null,t._pannerAttr={coneInnerAngle:void 0!==n.coneInnerAngle?n.coneInnerAngle:360,coneOuterAngle:void 0!==n.coneOuterAngle?n.coneOuterAngle:360,coneOuterGain:void 0!==n.coneOuterGain?n.coneOuterGain:0,distanceModel:void 0!==n.distanceModel?n.distanceModel:"inverse",maxDistance:void 0!==n.maxDistance?n.maxDistance:1e4,panningModel:void 0!==n.panningModel?n.panningModel:"HRTF",refDistance:void 0!==n.refDistance?n.refDistance:1,rolloffFactor:void 0!==n.rolloffFactor?n.rolloffFactor:1},t._onstereo=n.onstereo?[{fn:n.onstereo}]:[],t._onpos=n.onpos?[{fn:n.onpos}]:[],t._onorientation=n.onorientation?[{fn:n.onorientation}]:[],e.call(this,n)}}(Howl.prototype.init),Howl.prototype.stereo=function(n,t){var r=this;if(!r._webAudio)return r;if("loaded"!==r._state)return r._queue.push({event:"stereo",action:function(){r.stereo(n,t)}}),r;var o=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===t){if("number"!=typeof n)return r._stereo;r._stereo=n,r._pos=[n,0,0]}for(var i=r._getSoundIds(t),a=0;a<i.length;a++){var s=r._soundById(i[a]);if(s){if("number"!=typeof n)return s._stereo;s._stereo=n,s._pos=[n,0,0],s._node&&(s._pannerAttr.panningModel="equalpower",s._panner&&s._panner.pan||e(s,o),"spatial"===o?void 0!==s._panner.positionX?(s._panner.positionX.setValueAtTime(n,Howler.ctx.currentTime),s._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),s._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):s._panner.setPosition(n,0,0):s._panner.pan.setValueAtTime(n,Howler.ctx.currentTime)),r._emit("stereo",s._id)}}return r},Howl.prototype.pos=function(n,t,r,o){var i=this;if(!i._webAudio)return i;if("loaded"!==i._state)return i._queue.push({event:"pos",action:function(){i.pos(n,t,r,o)}}),i;if(t="number"!=typeof t?0:t,r="number"!=typeof r?-.5:r,void 0===o){if("number"!=typeof n)return i._pos;i._pos=[n,t,r]}for(var a=i._getSoundIds(o),s=0;s<a.length;s++){var p=i._soundById(a[s]);if(p){if("number"!=typeof n)return p._pos;p._pos=[n,t,r],p._node&&(p._panner&&!p._panner.pan||e(p,"spatial"),void 0!==p._panner.positionX?(p._panner.positionX.setValueAtTime(n,Howler.ctx.currentTime),p._panner.positionY.setValueAtTime(t,Howler.ctx.currentTime),p._panner.positionZ.setValueAtTime(r,Howler.ctx.currentTime)):p._panner.setPosition(n,t,r)),i._emit("pos",p._id)}}return i},Howl.prototype.orientation=function(n,t,r,o){var i=this;if(!i._webAudio)return i;if("loaded"!==i._state)return i._queue.push({event:"orientation",action:function(){i.orientation(n,t,r,o)}}),i;if(t="number"!=typeof t?i._orientation[1]:t,r="number"!=typeof r?i._orientation[2]:r,void 0===o){if("number"!=typeof n)return i._orientation;i._orientation=[n,t,r]}for(var a=i._getSoundIds(o),s=0;s<a.length;s++){var p=i._soundById(a[s]);if(p){if("number"!=typeof n)return p._orientation;p._orientation=[n,t,r],p._node&&(p._panner||(p._pos||(p._pos=i._pos||[0,0,-.5]),e(p,"spatial")),void 0!==p._panner.orientationX?(p._panner.orientationX.setValueAtTime(n,Howler.ctx.currentTime),p._panner.orientationY.setValueAtTime(t,Howler.ctx.currentTime),p._panner.orientationZ.setValueAtTime(r,Howler.ctx.currentTime)):p._panner.setOrientation(n,t,r)),i._emit("orientation",p._id)}}return i},Howl.prototype.pannerAttr=function(){var n,t,r,o=this,i=arguments;if(!o._webAudio)return o;if(0===i.length)return o._pannerAttr;if(1===i.length){if("object"!=typeof i[0])return r=o._soundById(parseInt(i[0],10)),r?r._pannerAttr:o._pannerAttr;n=i[0],void 0===t&&(n.pannerAttr||(n.pannerAttr={coneInnerAngle:n.coneInnerAngle,coneOuterAngle:n.coneOuterAngle,coneOuterGain:n.coneOuterGain,distanceModel:n.distanceModel,maxDistance:n.maxDistance,refDistance:n.refDistance,rolloffFactor:n.rolloffFactor,panningModel:n.panningModel}),o._pannerAttr={coneInnerAngle:void 0!==n.pannerAttr.coneInnerAngle?n.pannerAttr.coneInnerAngle:o._coneInnerAngle,coneOuterAngle:void 0!==n.pannerAttr.coneOuterAngle?n.pannerAttr.coneOuterAngle:o._coneOuterAngle,coneOuterGain:void 0!==n.pannerAttr.coneOuterGain?n.pannerAttr.coneOuterGain:o._coneOuterGain,distanceModel:void 0!==n.pannerAttr.distanceModel?n.pannerAttr.distanceModel:o._distanceModel,maxDistance:void 0!==n.pannerAttr.maxDistance?n.pannerAttr.maxDistance:o._maxDistance,refDistance:void 0!==n.pannerAttr.refDistance?n.pannerAttr.refDistance:o._refDistance,rolloffFactor:void 0!==n.pannerAttr.rolloffFactor?n.pannerAttr.rolloffFactor:o._rolloffFactor,panningModel:void 0!==n.pannerAttr.panningModel?n.pannerAttr.panningModel:o._panningModel})}else 2===i.length&&(n=i[0],t=parseInt(i[1],10));for(var a=o._getSoundIds(t),s=0;s<a.length;s++)if(r=o._soundById(a[s])){var p=r._pannerAttr;p={coneInnerAngle:void 0!==n.coneInnerAngle?n.coneInnerAngle:p.coneInnerAngle,coneOuterAngle:void 0!==n.coneOuterAngle?n.coneOuterAngle:p.coneOuterAngle,coneOuterGain:void 0!==n.coneOuterGain?n.coneOuterGain:p.coneOuterGain,distanceModel:void 0!==n.distanceModel?n.distanceModel:p.distanceModel,maxDistance:void 0!==n.maxDistance?n.maxDistance:p.maxDistance,refDistance:void 0!==n.refDistance?n.refDistance:p.refDistance,rolloffFactor:void 0!==n.rolloffFactor?n.rolloffFactor:p.rolloffFactor,panningModel:void 0!==n.panningModel?n.panningModel:p.panningModel};var c=r._panner;c?(c.coneInnerAngle=p.coneInnerAngle,c.coneOuterAngle=p.coneOuterAngle,c.coneOuterGain=p.coneOuterGain,c.distanceModel=p.distanceModel,c.maxDistance=p.maxDistance,c.refDistance=p.refDistance,c.rolloffFactor=p.rolloffFactor,c.panningModel=p.panningModel):(r._pos||(r._pos=o._pos||[0,0,-.5]),e(r,"spatial"))}return o},Sound.prototype.init=function(e){return function(){var n=this,t=n._parent;n._orientation=t._orientation,n._stereo=t._stereo,n._pos=t._pos,n._pannerAttr=t._pannerAttr,e.call(this),n._stereo?t.stereo(n._stereo):n._pos&&t.pos(n._pos[0],n._pos[1],n._pos[2],n._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var n=this,t=n._parent;return n._orientation=t._orientation,n._stereo=t._stereo,n._pos=t._pos,n._pannerAttr=t._pannerAttr,n._stereo?t.stereo(n._stereo):n._pos?t.pos(n._pos[0],n._pos[1],n._pos[2],n._id):n._panner&&(n._panner.disconnect(0),n._panner=void 0,t._refreshBuffer(n)),e.call(this)}}(Sound.prototype.reset);var e=function(e,n){n=n||"spatial","spatial"===n?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,void 0!==e._panner.positionX?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),void 0!==e._panner.orientationX?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}();;
var pn=Object.defineProperty,hn=(e,t,n)=>t in e?pn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,C=(e,t,n)=>(hn(e,"symbol"!=typeof t?t+"":t,n),n),PetiteVue=function(e){"use strict";function t(e){if(a(e)){const n={};for(let s=0;s<e.length;s++){const i=e[s],o=d(i)?r(i):t(i);if(o)for(const e in o)n[e]=o[e]}return n}return d(e)||g(e)?e:void 0}const n=/;(?![^(]*\))/g,s=/:(.+)/;function r(e){const t={};return e.split(n).forEach((e=>{if(e){const n=e.split(s);n.length>1&&(t[n[0].trim()]=n[1].trim())}})),t}function i(e){let t="";if(d(e))t=e;else if(a(e))for(let n=0;n<e.length;n++){const s=i(e[n]);s&&(t+=s+" ")}else if(g(e))for(const n in e)e[n]&&(t+=n+" ");return t.trim()}function o(e,t){if(e===t)return!0;let n=h(e),s=h(t);if(n||s)return!(!n||!s)&&e.getTime()===t.getTime();if(n=a(e),s=a(t),n||s)return!(!n||!s)&&function(e,t){if(e.length!==t.length)return!1;let n=!0;for(let s=0;n&&s<e.length;s++)n=o(e[s],t[s]);return n}(e,t);if(n=g(e),s=g(t),n||s){if(!n||!s)return!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e){const s=e.hasOwnProperty(n),r=t.hasOwnProperty(n);if(s&&!r||!s&&r||!o(e[n],t[n]))return!1}}return String(e)===String(t)}function c(e,t){return e.findIndex((e=>o(e,t)))}const l=Object.assign,f=Object.prototype.hasOwnProperty,u=(e,t)=>f.call(e,t),a=Array.isArray,p=e=>"[object Map]"===y(e),h=e=>e instanceof Date,d=e=>"string"==typeof e,m=e=>"symbol"==typeof e,g=e=>null!==e&&"object"==typeof e,v=Object.prototype.toString,y=e=>v.call(e),b=e=>d(e)&&"NaN"!==e&&"-"!==e[0]&&""+parseInt(e,10)===e,x=e=>{const t=Object.create(null);return n=>t[n]||(t[n]=e(n))},_=/-(\w)/g,w=x((e=>e.replace(_,((e,t)=>t?t.toUpperCase():"")))),$=/\B([A-Z])/g,k=x((e=>e.replace($,"-$1").toLowerCase())),O=e=>{const t=parseFloat(e);return isNaN(t)?e:t};function S(e,t){(t=t||undefined)&&t.active&&t.effects.push(e)}const E=e=>{const t=new Set(e);return t.w=0,t.n=0,t},j=e=>(e.w&N)>0,A=e=>(e.n&N)>0,P=new WeakMap;let R=0,N=1;const T=[];let M;const B=Symbol(""),L=Symbol("");class W{constructor(e,t=null,n){this.fn=e,this.scheduler=t,this.active=!0,this.deps=[],S(this,n)}run(){if(!this.active)return this.fn();if(!T.includes(this))try{return T.push(M=this),F.push(V),V=!0,N=1<<++R,R<=30?(({deps:e})=>{if(e.length)for(let t=0;t<e.length;t++)e[t].w|=N})(this):I(this),this.fn()}finally{R<=30&&(e=>{const{deps:t}=e;if(t.length){let n=0;for(let s=0;s<t.length;s++){const r=t[s];j(r)&&!A(r)?r.delete(e):t[n++]=r,r.w&=~N,r.n&=~N}t.length=n}})(this),N=1<<--R,z(),T.pop();const e=T.length;M=e>0?T[e-1]:void 0}}stop(){this.active&&(I(this),this.onStop&&this.onStop(),this.active=!1)}}function I(e){const{deps:t}=e;if(t.length){for(let n=0;n<t.length;n++)t[n].delete(e);t.length=0}}function K(e){e.effect.stop()}let V=!0;const F=[];function z(){const e=F.pop();V=void 0===e||e}function H(e,t,n){if(!V||void 0===M)return;let s=P.get(e);s||P.set(e,s=new Map);let r=s.get(n);r||s.set(n,r=E()),function(e,t){let n=!1;R<=30?A(e)||(e.n|=N,n=!j(e)):n=!e.has(M),n&&(e.add(M),M.deps.push(e))}(r)}function J(e,t,n,s,r,i){const o=P.get(e);if(!o)return;let c=[];if("clear"===t)c=[...o.values()];else if("length"===n&&a(e))o.forEach(((e,t)=>{("length"===t||t>=s)&&c.push(e)}));else switch(void 0!==n&&c.push(o.get(n)),t){case"add":a(e)?b(n)&&c.push(o.get("length")):(c.push(o.get(B)),p(e)&&c.push(o.get(L)));break;case"delete":a(e)||(c.push(o.get(B)),p(e)&&c.push(o.get(L)));break;case"set":p(e)&&c.push(o.get(B))}if(1===c.length)c[0]&&Z(c[0]);else{const e=[];for(const t of c)t&&e.push(...t);Z(E(e))}}function Z(e,t){for(const n of a(e)?e:[...e])(n!==M||n.allowRecurse)&&(n.scheduler?n.scheduler():n.run())}const q=function(e,t){const n=Object.create(null),s=e.split(",");for(let r=0;r<s.length;r++)n[s[r]]=!0;return t?e=>!!n[e.toLowerCase()]:e=>!!n[e]}("__proto__,__v_isRef,__isVue"),D=new Set(Object.getOwnPropertyNames(Symbol).map((e=>Symbol[e])).filter(m)),G=X(),U=X(!0),Q=function(){const e={};return["includes","indexOf","lastIndexOf"].forEach((t=>{e[t]=function(...e){const n=le(this);for(let t=0,r=this.length;t<r;t++)H(n,0,t+"");const s=n[t](...e);return-1===s||!1===s?n[t](...e.map(le)):s}})),["push","pop","shift","unshift","splice"].forEach((t=>{e[t]=function(...e){F.push(V),V=!1;const n=le(this)[t].apply(this,e);return z(),n}})),e}();function X(e=!1,t=!1){return function(n,s,r){if("__v_isReactive"===s)return!e;if("__v_isReadonly"===s)return e;if("__v_raw"===s&&r===(e?t?re:se:t?ne:te).get(n))return n;const i=a(n);if(!e&&i&&u(Q,s))return Reflect.get(Q,s,r);const o=Reflect.get(n,s,r);return(m(s)?D.has(s):q(s))||(e||H(n,0,s),t)?o:fe(o)?i&&b(s)?o:o.value:g(o)?e?function(e){return ce(e,!0,ee,null,se)}(o):oe(o):o}}const Y={get:G,set:function(e=!1){return function(t,n,s,r){let i=t[n];if(!e&&!function(e){return!(!e||!e.__v_isReadonly)}(s)&&(s=le(s),i=le(i),!a(t)&&fe(i)&&!fe(s)))return i.value=s,!0;const o=a(t)&&b(n)?Number(n)<t.length:u(t,n),c=Reflect.set(t,n,s,r);return t===le(r)&&(o?((e,t)=>!Object.is(e,t))(s,i)&&J(t,"set",n,s):J(t,"add",n,s)),c}}(),deleteProperty:function(e,t){const n=u(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&n&&J(e,"delete",t,void 0),s},has:function(e,t){const n=Reflect.has(e,t);return(!m(t)||!D.has(t))&&H(e,0,t),n},ownKeys:function(e){return H(e,0,a(e)?"length":B),Reflect.ownKeys(e)}},ee={get:U,set:(e,t)=>!0,deleteProperty:(e,t)=>!0},te=new WeakMap,ne=new WeakMap,se=new WeakMap,re=new WeakMap;function ie(e){return e.__v_skip||!Object.isExtensible(e)?0:function(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}((e=>y(e).slice(8,-1))(e))}function oe(e){return e&&e.__v_isReadonly?e:ce(e,!1,Y,null,te)}function ce(e,t,n,s,r){if(!g(e)||e.__v_raw&&(!t||!e.__v_isReactive))return e;const i=r.get(e);if(i)return i;const o=ie(e);if(0===o)return e;const c=new Proxy(e,2===o?s:n);return r.set(e,c),c}function le(e){const t=e&&e.__v_raw;return t?le(t):e}function fe(e){return Boolean(e&&!0===e.__v_isRef)}Promise.resolve();let ue=!1;const ae=[],pe=Promise.resolve(),he=e=>pe.then(e),de=e=>{ae.includes(e)||ae.push(e),ue||(ue=!0,he(me))},me=()=>{for(const e of ae)e();ae.length=0,ue=!1},ge=/^(spellcheck|draggable|form|list|type)$/,ve=({el:e,get:t,effect:n,arg:s,modifiers:r})=>{let i;"class"===s&&(e._class=e.className),n((()=>{let n=t();if(s)(null==r?void 0:r.camel)&&(s=w(s)),ye(e,s,n,i);else{for(const t in n)ye(e,t,n[t],i&&i[t]);for(const t in i)(!n||!(t in n))&&ye(e,t,null)}i=n}))},ye=(e,n,s,r)=>{if("class"===n)e.setAttribute("class",i(e._class?[e._class,s]:s)||"");else if("style"===n){s=t(s);const{style:n}=e;if(s)if(d(s))s!==r&&(n.cssText=s);else{for(const e in s)xe(n,e,s[e]);if(r&&!d(r))for(const e in r)null==s[e]&&xe(n,e,"")}else e.removeAttribute("style")}else e instanceof SVGElement||!(n in e)||ge.test(n)?"true-value"===n?e._trueValue=s:"false-value"===n?e._falseValue=s:null!=s?e.setAttribute(n,s):e.removeAttribute(n):(e[n]=s,"value"===n&&(e._value=s))},be=/\s*!important$/,xe=(e,t,n)=>{a(n)?n.forEach((n=>xe(e,t,n))):t.startsWith("--")?e.setProperty(t,n):be.test(n)?e.setProperty(k(t),n.replace(be,""),"important"):e[t]=n},_e=(e,t)=>{const n=e.getAttribute(t);return null!=n&&e.removeAttribute(t),n},we=(e,t,n,s)=>{e.addEventListener(t,n,s)},$e=/^[A-Za-z_$][\w$]*(?:\.[A-Za-z_$][\w$]*|\['[^']*?']|\["[^"]*?"]|\[\d+]|\[[A-Za-z_$][\w$]*])*$/,ke=["ctrl","shift","alt","meta"],Oe={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&0!==e.button,middle:e=>"button"in e&&1!==e.button,right:e=>"button"in e&&2!==e.button,exact:(e,t)=>ke.some((n=>e[`${n}Key`]&&!t[n]))},Se=({el:e,get:t,exp:n,arg:s,modifiers:r})=>{if(!s)return;let i=$e.test(n)?t(`(e => ${n}(e))`):t(`($event => { ${n} })`);if("vue:mounted"!==s){if("vue:unmounted"===s)return()=>i();if(r){"click"===s&&(r.right&&(s="contextmenu"),r.middle&&(s="mouseup"));const e=i;i=t=>{if(!("key"in t)||k(t.key)in r){for(const e in r){const n=Oe[e];if(n&&n(t,r))return}return e(t)}}}we(e,s,i,r)}else he(i)},Ee=({el:e,get:t,effect:n})=>{n((()=>{e.textContent=Ce(t())}))},Ce=e=>null==e?"":g(e)?JSON.stringify(e,null,2):String(e),je=e=>"_value"in e?e._value:e.value,Ae=(e,t)=>{const n=t?"_trueValue":"_falseValue";return n in e?e[n]:t},Pe=e=>{e.target.composing=!0},Re=e=>{const t=e.target;t.composing&&(t.composing=!1,Ne(t,"input"))},Ne=(e,t)=>{const n=document.createEvent("HTMLEvents");n.initEvent(t,!0,!0),e.dispatchEvent(n)},Te=Object.create(null),Me=(e,t,n)=>Be(e,`return(${t})`,n),Be=(e,t,n)=>{const s=Te[t]||(Te[t]=Le(t));try{return s(e,n)}catch(r){console.error(r)}},Le=e=>{try{return new Function("$data","$el",`with($data){${e}}`)}catch(t){return console.error(`${t.message} in expression: ${e}`),()=>{}}},We={bind:ve,on:Se,show:({el:e,get:t,effect:n})=>{const s=e.style.display;n((()=>{e.style.display=t()?s:"none"}))},text:Ee,html:({el:e,get:t,effect:n})=>{n((()=>{e.innerHTML=t()}))},model:({el:e,exp:t,get:n,effect:s,modifiers:r})=>{const i=e.type,l=n(`(val) => { ${t} = val }`),{trim:f,number:u="number"===i}=r||{};if("SELECT"===e.tagName){const t=e;we(e,"change",(()=>{const e=Array.prototype.filter.call(t.options,(e=>e.selected)).map((e=>u?O(je(e)):je(e)));l(t.multiple?e:e[0])})),s((()=>{const e=n(),s=t.multiple;for(let n=0,r=t.options.length;n<r;n++){const r=t.options[n],i=je(r);if(s)a(e)?r.selected=c(e,i)>-1:r.selected=e.has(i);else if(o(je(r),e))return void(t.selectedIndex!==n&&(t.selectedIndex=n))}!s&&-1!==t.selectedIndex&&(t.selectedIndex=-1)}))}else if("checkbox"===i){let t;we(e,"change",(()=>{const t=n(),s=e.checked;if(a(t)){const n=je(e),r=c(t,n),i=-1!==r;if(s&&!i)l(t.concat(n));else if(!s&&i){const e=[...t];e.splice(r,1),l(e)}}else l(Ae(e,s))})),s((()=>{const s=n();a(s)?e.checked=c(s,je(e))>-1:s!==t&&(e.checked=o(s,Ae(e,!0))),t=s}))}else if("radio"===i){let t;we(e,"change",(()=>{l(je(e))})),s((()=>{const s=n();s!==t&&(e.checked=o(s,je(e)))}))}else{const t=e=>f?e.trim():u?O(e):e;we(e,"compositionstart",Pe),we(e,"compositionend",Re),we(e,(null==r?void 0:r.lazy)?"change":"input",(()=>{e.composing||l(t(e.value))})),f&&we(e,"change",(()=>{e.value=e.value.trim()})),s((()=>{if(e.composing)return;const s=e.value,r=n();document.activeElement===e&&t(s)===r||s!==r&&(e.value=r)}))}},effect:({el:e,ctx:t,exp:n,effect:s})=>{he((()=>s((()=>Be(t.scope,n,e)))))}},Ie=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,Ke=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,Ve=/^\(|\)$/g,Fe=/^[{[]\s*((?:[\w_$]+\s*,?\s*)+)[\]}]$/,ze=(e,t,n)=>{const s=t.match(Ie);if(!s)return;const r=e.nextSibling,i=e.parentElement,o=new Text("");i.insertBefore(o,e),i.removeChild(e);const c=s[2].trim();let l,f,u,p,h=s[1].trim().replace(Ve,"").trim(),d=!1,m="key",v=e.getAttribute(m)||e.getAttribute(m=":key")||e.getAttribute(m="v-bind:key");v&&(e.removeAttribute(m),"key"===m&&(v=JSON.stringify(v))),(p=h.match(Ke))&&(h=h.replace(Ke,"").trim(),f=p[1].trim(),p[2]&&(u=p[2].trim())),(p=h.match(Fe))&&(l=p[1].split(",").map((e=>e.trim())),d="["===h[0]);let y,b,x,_=!1;const w=(e,t,s,r)=>{const i={};l?l.forEach(((e,n)=>i[e]=t[d?n:e])):i[h]=t,r?(f&&(i[f]=r),u&&(i[u]=s)):f&&(i[f]=s);const o=et(n,i),c=v?Me(o.scope,v):s;return e.set(c,s),o.key=c,o},$=(t,n)=>{const s=new nt(e,t);return s.key=t.key,s.insert(i,n),s};return n.effect((()=>{const e=Me(n.scope,c),t=x;if([b,x]=(e=>{const t=new Map,n=[];if(a(e))for(let s=0;s<e.length;s++)n.push(w(t,e[s],s));else if("number"==typeof e)for(let s=0;s<e;s++)n.push(w(t,s+1,s));else if(g(e)){let s=0;for(const r in e)n.push(w(t,e[r],s++,r))}return[n,t]})(e),_){for(let t=0;t<y.length;t++)x.has(y[t].key)||y[t].remove();const e=[];let n,s,r=b.length;for(;r--;){const c=b[r],l=t.get(c.key);let f;null==l?f=$(c,n?n.el:o):(f=y[l],Object.assign(f.ctx.scope,c.scope),l!==r&&(y[l+1]!==n||s===n)&&(s=f,f.insert(i,n?n.el:o))),e.unshift(n=f)}y=e}else y=b.map((e=>$(e,o))),_=!0})),r},He=({el:e,ctx:{scope:{$refs:t}},get:n,effect:s})=>{let r;return s((()=>{const s=n();t[s]=e,r&&s!==r&&delete t[r],r=s})),()=>{r&&delete t[r]}},Je=/^(?:v-|:|@)/,Ze=/\.([\w-]+)/g;let qe=!1;const De=(e,t)=>{const n=e.nodeType;if(1===n){const n=e;if(n.hasAttribute("v-pre"))return;let s;if(_e(n,"v-cloak"),s=_e(n,"v-if"))return((e,t,n)=>{const s=e.parentElement,r=new Comment("v-if");s.insertBefore(r,e);const i=[{exp:t,el:e}];let o,c;for(;(o=e.nextElementSibling)&&(c=null,""===_e(o,"v-else")||(c=_e(o,"v-else-if")));)s.removeChild(o),i.push({exp:c,el:o});const l=e.nextSibling;s.removeChild(e);let f,u=-1;const a=()=>{f&&(s.insertBefore(r,f.el),f.remove(),f=void 0)};return n.effect((()=>{for(let e=0;e<i.length;e++){const{exp:t,el:o}=i[e];if(!t||Me(n.scope,t))return void(e!==u&&(a(),f=new nt(o,n),f.insert(s,r),s.removeChild(r),u=e))}u=-1,a()})),l})(n,s,t);if(s=_e(n,"v-for"))return ze(n,s,t);if((s=_e(n,"v-scope"))||""===s){const e=s?Me(t.scope,s):{};t=et(t,e),e.$template&&Xe(n,e.$template)}const r=null!=_e(n,"v-once");r&&(qe=!0),(s=_e(n,"ref"))&&Qe(n,He,`"${s}"`,t),Ge(n,t);const i=[];for(const{name:e,value:o}of[...n.attributes])Je.test(e)&&"v-cloak"!==e&&("v-model"===e?i.unshift([e,o]):"@"===e[0]||/^v-on\b/.test(e)?i.push([e,o]):Ue(n,e,o,t));for(const[e,o]of i)Ue(n,e,o,t);r&&(qe=!1)}else if(3===n){const n=e.data;if(n.includes(t.delimiters[0])){let s,r=[],i=0;for(;s=t.delimitersRE.exec(n);){const e=n.slice(i,s.index);e&&r.push(JSON.stringify(e)),r.push(`$s(${s[1]})`),i=s.index+s[0].length}i<n.length&&r.push(JSON.stringify(n.slice(i))),Qe(e,Ee,r.join("+"),t)}}else 11===n&&Ge(e,t)},Ge=(e,t)=>{let n=e.firstChild;for(;n;)n=De(n,t)||n.nextSibling},Ue=(e,t,n,s)=>{let r,i,o;if(":"===(t=t.replace(Ze,((e,t)=>((o||(o={}))[t]=!0,""))))[0])r=ve,i=t.slice(1);else if("@"===t[0])r=Se,i=t.slice(1);else{const e=t.indexOf(":"),n=e>0?t.slice(2,e):t.slice(2);r=We[n]||s.dirs[n],i=e>0?t.slice(e+1):void 0}r&&(r===ve&&"ref"===i&&(r=He),Qe(e,r,n,s,i,o),e.removeAttribute(t))},Qe=(e,t,n,s,r,i)=>{const o=t({el:e,get:(t=n)=>Me(s.scope,t,e),effect:s.effect,ctx:s,exp:n,arg:r,modifiers:i});o&&s.cleanups.push(o)},Xe=(e,t)=>{if("#"!==t[0])e.innerHTML=t;else{const n=document.querySelector(t);e.appendChild(n.content.cloneNode(!0))}},Ye=e=>{const t={delimiters:["{{","}}"],delimitersRE:/\{\{([^]+?)\}\}/g,...e,scope:e?e.scope:oe({}),dirs:e?e.dirs:{},effects:[],blocks:[],cleanups:[],effect:e=>{if(qe)return de(e),e;const n=function(e,t){e.effect&&(e=e.effect.fn);const n=new W(e);t&&(l(n,t),t.scope&&S(n,t.scope)),(!t||!t.lazy)&&n.run();const s=n.run.bind(n);return s.effect=n,s}(e,{scheduler:()=>de(n)});return t.effects.push(n),n}};return t},et=(e,t={})=>{const n=e.scope,s=Object.create(n);Object.defineProperties(s,Object.getOwnPropertyDescriptors(t)),s.$refs=Object.create(n.$refs);const r=oe(new Proxy(s,{set:(e,t,s,i)=>i!==r||e.hasOwnProperty(t)?Reflect.set(e,t,s,i):Reflect.set(n,t,s)}));return tt(r),{...e,scope:r}},tt=e=>{for(const t of Object.keys(e))"function"==typeof e[t]&&(e[t]=e[t].bind(e))};class nt{constructor(e,t,n=!1){C(this,"template"),C(this,"ctx"),C(this,"key"),C(this,"parentCtx"),C(this,"isFragment"),C(this,"start"),C(this,"end"),this.isFragment=e instanceof HTMLTemplateElement,n?this.template=e:this.isFragment?this.template=e.content.cloneNode(!0):this.template=e.cloneNode(!0),n?this.ctx=t:(this.parentCtx=t,t.blocks.push(this),this.ctx=Ye(t)),De(this.template,this.ctx)}get el(){return this.start||this.template}insert(e,t=null){if(this.isFragment)if(this.start){let n,s=this.start;for(;s&&(n=s.nextSibling,e.insertBefore(s,t),s!==this.end);)s=n}else this.start=new Text(""),this.end=new Text(""),e.insertBefore(this.end,t),e.insertBefore(this.start,this.end),e.insertBefore(this.template,this.end);else e.insertBefore(this.template,t)}remove(){if(this.parentCtx&&((e,t)=>{const n=e.indexOf(t);n>-1&&e.splice(n,1)})(this.parentCtx.blocks,this),this.start){const e=this.start.parentNode;let t,n=this.start;for(;n&&(t=n.nextSibling,e.removeChild(n),n!==this.end);)n=t}else this.template.parentNode.removeChild(this.template);this.teardown()}teardown(){this.ctx.blocks.forEach((e=>{e.teardown()})),this.ctx.effects.forEach(K),this.ctx.cleanups.forEach((e=>e()))}}const st=e=>e.replace(/[-.*+?^${}()|[\]\/\\]/g,"\\$&"),rt=e=>{const t=Ye();if(e&&(t.scope=oe(e),tt(t.scope),e.$delimiters)){const[n,s]=t.delimiters=e.$delimiters;t.delimitersRE=new RegExp(st(n)+"([^]+?)"+st(s),"g")}let n;return t.scope.$s=Ce,t.scope.$nextTick=he,t.scope.$refs=Object.create(null),{directive(e,n){return n?(t.dirs[e]=n,this):t.dirs[e]},mount(e){if("string"==typeof e&&!(e=document.querySelector(e)))return;let s;return s=(e=e||document.documentElement).hasAttribute("v-scope")?[e]:[...e.querySelectorAll("[v-scope]")].filter((e=>!e.matches("[v-scope] [v-scope]"))),s.length||(s=[e]),n=s.map((e=>new nt(e,t,!0))),this},unmount(){n.forEach((e=>e.teardown()))}}},it=document.currentScript;return it&&it.hasAttribute("init")&&rt().mount(),e.createApp=rt,e.nextTick=he,e.reactive=oe,Object.defineProperty(e,"__esModule",{value:!0}),e[Symbol.toStringTag]="Module",e}({});;
/**
 * @license
 * Video.js 7.20.2 <http://videojs.com/>
 * Copyright Brightcove, Inc. <https://www.brightcove.com/>
 * Available under Apache License Version 2.0
 * <https://github.com/videojs/video.js/blob/main/LICENSE>
 *
 * Includes vtt.js <https://github.com/mozilla/vtt.js>
 * Available under Apache License Version 2.0
 * <https://github.com/mozilla/vtt.js/blob/main/LICENSE>
 */
!(function (e, t) {
    'object' == typeof exports && 'undefined' != typeof module
        ? (module.exports = t())
        : 'function' == typeof define && define.amd
        ? define(t)
        : ((e = 'undefined' != typeof globalThis ? globalThis : e || self).videojs = t())
})(this, function () {
    'use strict'
    for (
        var e,
            u = '7.20.2',
            i = {},
            a = function (e, t) {
                return (i[e] = i[e] || []), t && (i[e] = i[e].concat(t)), i[e]
            },
            n = function (e, t) {
                t = a(e).indexOf(t)
                return !(t <= -1) && ((i[e] = i[e].slice()), i[e].splice(t, 1), !0)
            },
            l = { prefixed: !0 },
            t = [
                ['requestFullscreen', 'exitFullscreen', 'fullscreenElement', 'fullscreenEnabled', 'fullscreenchange', 'fullscreenerror', 'fullscreen'],
                ['webkitRequestFullscreen', 'webkitExitFullscreen', 'webkitFullscreenElement', 'webkitFullscreenEnabled', 'webkitfullscreenchange', 'webkitfullscreenerror', '-webkit-full-screen'],
                ['mozRequestFullScreen', 'mozCancelFullScreen', 'mozFullScreenElement', 'mozFullScreenEnabled', 'mozfullscreenchange', 'mozfullscreenerror', '-moz-full-screen'],
                ['msRequestFullscreen', 'msExitFullscreen', 'msFullscreenElement', 'msFullscreenEnabled', 'MSFullscreenChange', 'MSFullscreenError', '-ms-fullscreen'],
            ],
            r = t[0],
            s = 0;
        s < t.length;
        s++
    )
        if (t[s][1] in document) {
            e = t[s]
            break
        }
    if (e) {
        for (var o = 0; o < e.length; o++) l[r[o]] = e[o]
        l.prefixed = e[0] !== r[0]
    }
    var c = [],
        d = function (a, s) {
            return function (e, t, i) {
                var n,
                    r = s.levels[t],
                    t = new RegExp('^(' + r + ')$')
                'log' !== e && i.unshift(e.toUpperCase() + ':'),
                    i.unshift(a + ':'),
                    c && (c.push([].concat(i)), (n = c.length - 1e3), c.splice(0, 0 < n ? n : 0)),
                    !window.console ||
                        ((n = !(n = window.console[e]) && 'debug' === e ? window.console.info || window.console.log : n) && r && t.test(e) && n[Array.isArray(i) ? 'apply' : 'call'](window.console, i))
            }
        }
    var h = (function t(i) {
            function n() {
                for (var e = arguments.length, t = new Array(e), i = 0; i < e; i++) t[i] = arguments[i]
                a('log', r, t)
            }
            var r = 'info',
                a = d(i, n)
            return (
                (n.createLogger = function (e) {
                    return t(i + ': ' + e)
                }),
                (n.levels = { all: 'debug|log|warn|error', off: '', debug: 'debug|log|warn|error', info: 'log|warn|error', warn: 'warn|error', error: 'error', DEFAULT: r }),
                (n.level = function (e) {
                    if ('string' == typeof e) {
                        if (!n.levels.hasOwnProperty(e)) throw new Error('"' + e + '" in not a valid log level')
                        r = e
                    }
                    return r
                }),
                ((n.history = function () {
                    return c ? [].concat(c) : []
                }).filter = function (t) {
                    return (c || []).filter(function (e) {
                        return new RegExp('.*' + t + '.*').test(e[0])
                    })
                }),
                (n.history.clear = function () {
                    c && (c.length = 0)
                }),
                (n.history.disable = function () {
                    null !== c && ((c.length = 0), (c = null))
                }),
                (n.history.enable = function () {
                    null === c && (c = [])
                }),
                (n.error = function () {
                    for (var e = arguments.length, t = new Array(e), i = 0; i < e; i++) t[i] = arguments[i]
                    return a('error', r, t)
                }),
                (n.warn = function () {
                    for (var e = arguments.length, t = new Array(e), i = 0; i < e; i++) t[i] = arguments[i]
                    return a('warn', r, t)
                }),
                (n.debug = function () {
                    for (var e = arguments.length, t = new Array(e), i = 0; i < e; i++) t[i] = arguments[i]
                    return a('debug', r, t)
                }),
                n
            )
        })('VIDEOJS'),
        p = h.createLogger,
        f = 'undefined' != typeof globalThis ? globalThis : 'undefined' != typeof window ? window : 'undefined' != typeof global ? global : 'undefined' != typeof self ? self : {}
    function m(e, t) {
        return e((t = { exports: {} }), t.exports), t.exports
    }
    var g = m(function (e) {
            function t() {
                return (
                    (e.exports = t =
                        Object.assign ||
                        function (e) {
                            for (var t = 1; t < arguments.length; t++) {
                                var i,
                                    n = arguments[t]
                                for (i in n) Object.prototype.hasOwnProperty.call(n, i) && (e[i] = n[i])
                            }
                            return e
                        }),
                    t.apply(this, arguments)
                )
            }
            e.exports = t
        }),
        y = Object.prototype.toString,
        v = function (e) {
            return T(e) ? Object.keys(e) : []
        }
    function _(t, i) {
        v(t).forEach(function (e) {
            return i(t[e], e)
        })
    }
    function b(i) {
        for (var e = arguments.length, t = new Array(1 < e ? e - 1 : 0), n = 1; n < e; n++) t[n - 1] = arguments[n]
        return Object.assign
            ? g.apply(void 0, [i].concat(t))
            : (t.forEach(function (e) {
                  e &&
                      _(e, function (e, t) {
                          i[t] = e
                      })
              }),
              i)
    }
    function T(e) {
        return !!e && 'object' == typeof e
    }
    function S(e) {
        return T(e) && '[object Object]' === y.call(e) && e.constructor === Object
    }
    function w(e, t) {
        if (!e || !t) return ''
        if ('function' != typeof window.getComputedStyle) return ''
        var i
        try {
            i = window.getComputedStyle(e)
        } catch (e) {
            return ''
        }
        return i ? i.getPropertyValue(t) || i[t] : ''
    }
    var E = (window.navigator && window.navigator.userAgent) || '',
        k = /AppleWebKit\/([\d.]+)/i.exec(E),
        C = k ? parseFloat(k.pop()) : null,
        I = /iPod/i.test(E),
        x = (jt = E.match(/OS (\d+)_/i)) && jt[1] ? jt[1] : null,
        A = /Android/i.test(E),
        P = (function () {
            var e = E.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i)
            if (!e) return null
            var t = e[1] && parseFloat(e[1]),
                i = e[2] && parseFloat(e[2])
            return t && i ? parseFloat(e[1] + '.' + e[2]) : t || null
        })(),
        L = A && P < 5 && C < 537,
        D = /Firefox/i.test(E),
        O = /Edg/i.test(E),
        M = !O && (/Chrome/i.test(E) || /CriOS/i.test(E)),
        R = (zt = E.match(/(Chrome|CriOS)\/(\d+)/)) && zt[2] ? parseFloat(zt[2]) : null,
        N = (Xt = !(Xt = (Xt = /MSIE\s(\d+)\.\d/.exec(E)) && parseFloat(Xt[1])) && /Trident\/7.0/i.test(E) && /rv:11.0/.test(E) ? 11 : Xt),
        U = /Safari/i.test(E) && !M && !A && !O,
        B = /Windows/i.test(E),
        F = Boolean(X() && ('ontouchstart' in window || window.navigator.maxTouchPoints || (window.DocumentTouch && window.document instanceof window.DocumentTouch))),
        j = /iPad/i.test(E) || (U && F && !/iPhone/i.test(E)),
        H = /iPhone/i.test(E) && !j,
        q = H || j || I,
        V = (U || q) && !M,
        W = Object.freeze({
            __proto__: null,
            IS_IPOD: I,
            IOS_VERSION: x,
            IS_ANDROID: A,
            ANDROID_VERSION: P,
            IS_NATIVE_ANDROID: L,
            IS_FIREFOX: D,
            IS_EDGE: O,
            IS_CHROME: M,
            CHROME_VERSION: R,
            IE_VERSION: N,
            IS_SAFARI: U,
            IS_WINDOWS: B,
            TOUCH_ENABLED: F,
            IS_IPAD: j,
            IS_IPHONE: H,
            IS_IOS: q,
            IS_ANY_SAFARI: V,
        })
    function G(e) {
        return 'string' == typeof e && Boolean(e.trim())
    }
    function z(e) {
        if (0 <= e.indexOf(' ')) throw new Error('class has illegal whitespace characters')
    }
    function X() {
        return document === window.document
    }
    function K(e) {
        return T(e) && 1 === e.nodeType
    }
    function Y() {
        try {
            return window.parent !== window.self
        } catch (e) {
            return !0
        }
    }
    function Q(i) {
        return function (e, t) {
            if (!G(e)) return document[i](null)
            t = K((t = G(t) ? document.querySelector(t) : t)) ? t : document
            return t[i] && t[i](e)
        }
    }
    function $(e, i, t, n) {
        void 0 === e && (e = 'div'), void 0 === i && (i = {}), void 0 === t && (t = {})
        var r = document.createElement(e)
        return (
            Object.getOwnPropertyNames(i).forEach(function (e) {
                var t = i[e]
                ;-1 !== e.indexOf('aria-') || 'role' === e || 'type' === e
                    ? (h.warn(
                          'Setting attributes in the second argument of createEl()\nhas been deprecated. Use the third argument instead.\ncreateEl(type, properties, attributes). Attempting to set ' +
                              e +
                              ' to ' +
                              t +
                              '.'
                      ),
                      r.setAttribute(e, t))
                    : 'textContent' === e
                    ? J(r, t)
                    : (r[e] === t && 'tabIndex' !== e) || (r[e] = t)
            }),
            Object.getOwnPropertyNames(t).forEach(function (e) {
                r.setAttribute(e, t[e])
            }),
            n && ye(r, n),
            r
        )
    }
    function J(e, t) {
        return 'undefined' == typeof e.textContent ? (e.innerText = t) : (e.textContent = t), e
    }
    function Z(e, t) {
        t.firstChild ? t.insertBefore(e, t.firstChild) : t.appendChild(e)
    }
    function ee(e, t) {
        return z(t), e.classList ? e.classList.contains(t) : new RegExp('(^|\\s)' + t + '($|\\s)').test(e.className)
    }
    function te(e, t) {
        return e.classList ? e.classList.add(t) : ee(e, t) || (e.className = (e.className + ' ' + t).trim()), e
    }
    function ie(e, t) {
        return e
            ? (e.classList
                  ? e.classList.remove(t)
                  : (z(t),
                    (e.className = e.className
                        .split(/\s+/)
                        .filter(function (e) {
                            return e !== t
                        })
                        .join(' '))),
              e)
            : (h.warn("removeClass was called with an element that doesn't exist"), null)
    }
    function ne(e, t, i) {
        var n = ee(e, t)
        if ((i = 'boolean' != typeof (i = 'function' == typeof i ? i(e, t) : i) ? !n : i) !== n) return (i ? te : ie)(e, t), e
    }
    function re(i, n) {
        Object.getOwnPropertyNames(n).forEach(function (e) {
            var t = n[e]
            null === t || 'undefined' == typeof t || !1 === t ? i.removeAttribute(e) : i.setAttribute(e, !0 === t ? '' : t)
        })
    }
    function ae(e) {
        var t = {},
            i = ',autoplay,controls,playsinline,loop,muted,default,defaultMuted,'
        if (e && e.attributes && 0 < e.attributes.length)
            for (var n = e.attributes, r = n.length - 1; 0 <= r; r--) {
                var a = n[r].name,
                    s = n[r].value
                ;('boolean' != typeof e[a] && -1 === i.indexOf(',' + a + ',')) || (s = null !== s), (t[a] = s)
            }
        return t
    }
    function se(e, t) {
        return e.getAttribute(t)
    }
    function oe(e, t, i) {
        e.setAttribute(t, i)
    }
    function ue(e, t) {
        e.removeAttribute(t)
    }
    function le() {
        document.body.focus(),
            (document.onselectstart = function () {
                return !1
            })
    }
    function ce() {
        document.onselectstart = function () {
            return !0
        }
    }
    function de(e) {
        if (e && e.getBoundingClientRect && e.parentNode) {
            var t = e.getBoundingClientRect(),
                i = {}
            return (
                ['bottom', 'height', 'left', 'right', 'top', 'width'].forEach(function (e) {
                    void 0 !== t[e] && (i[e] = t[e])
                }),
                i.height || (i.height = parseFloat(w(e, 'height'))),
                i.width || (i.width = parseFloat(w(e, 'width'))),
                i
            )
        }
    }
    function he(e) {
        if (!e || (e && !e.offsetParent)) return { left: 0, top: 0, width: 0, height: 0 }
        for (var t = e.offsetWidth, i = e.offsetHeight, n = 0, r = 0; e.offsetParent && e !== document[l.fullscreenElement]; ) (n += e.offsetLeft), (r += e.offsetTop), (e = e.offsetParent)
        return { left: n, top: r, width: t, height: i }
    }
    function pe(e, t) {
        var i = { x: 0, y: 0 }
        if (q)
            for (var n = e; n && 'html' !== n.nodeName.toLowerCase(); ) {
                var r,
                    a = w(n, 'transform')
                ;/^matrix/.test(a)
                    ? ((r = a.slice(7, -1).split(/,\s/).map(Number)), (i.x += r[4]), (i.y += r[5]))
                    : /^matrix3d/.test(a) && ((a = a.slice(9, -1).split(/,\s/).map(Number)), (i.x += a[12]), (i.y += a[13])),
                    (n = n.parentNode)
            }
        var s = {},
            o = he(t.target),
            u = he(e),
            l = u.width,
            c = u.height,
            e = t.offsetY - (u.top - o.top),
            o = t.offsetX - (u.left - o.left)
        return (
            t.changedTouches && ((o = t.changedTouches[0].pageX - u.left), (e = t.changedTouches[0].pageY + u.top), q && ((o -= i.x), (e -= i.y))),
            (s.y = 1 - Math.max(0, Math.min(1, e / c))),
            (s.x = Math.max(0, Math.min(1, o / l))),
            s
        )
    }
    function fe(e) {
        return T(e) && 3 === e.nodeType
    }
    function me(e) {
        for (; e.firstChild; ) e.removeChild(e.firstChild)
        return e
    }
    function ge(e) {
        return (
            'function' == typeof e && (e = e()),
            (Array.isArray(e) ? e : [e])
                .map(function (e) {
                    return K((e = 'function' == typeof e ? e() : e)) || fe(e) ? e : 'string' == typeof e && /\S/.test(e) ? document.createTextNode(e) : void 0
                })
                .filter(function (e) {
                    return e
                })
        )
    }
    function ye(t, e) {
        return (
            ge(e).forEach(function (e) {
                return t.appendChild(e)
            }),
            t
        )
    }
    function ve(e, t) {
        return ye(me(e), t)
    }
    function _e(e) {
        return (
            (void 0 === e.button && void 0 === e.buttons) ||
            (0 === e.button && void 0 === e.buttons) ||
            ('mouseup' === e.type && 0 === e.button && 0 === e.buttons) ||
            (0 === e.button && 1 === e.buttons)
        )
    }
    var be,
        Te = Q('querySelector'),
        Se = Q('querySelectorAll'),
        we = Object.freeze({
            __proto__: null,
            isReal: X,
            isEl: K,
            isInFrame: Y,
            createEl: $,
            textContent: J,
            prependTo: Z,
            hasClass: ee,
            addClass: te,
            removeClass: ie,
            toggleClass: ne,
            setAttributes: re,
            getAttributes: ae,
            getAttribute: se,
            setAttribute: oe,
            removeAttribute: ue,
            blockTextSelection: le,
            unblockTextSelection: ce,
            getBoundingClientRect: de,
            findPosition: he,
            getPointerPosition: pe,
            isTextNode: fe,
            emptyEl: me,
            normalizeContent: ge,
            appendContent: ye,
            insertContent: ve,
            isSingleLeftClick: _e,
            $: Te,
            $$: Se,
        }),
        Ee = !1,
        ke = function () {
            if (!1 !== be.options.autoSetup) {
                var e = Array.prototype.slice.call(document.getElementsByTagName('video')),
                    t = Array.prototype.slice.call(document.getElementsByTagName('audio')),
                    i = Array.prototype.slice.call(document.getElementsByTagName('video-js')),
                    n = e.concat(t, i)
                if (n && 0 < n.length)
                    for (var r = 0, a = n.length; r < a; r++) {
                        var s = n[r]
                        if (!s || !s.getAttribute) {
                            Ce(1)
                            break
                        }
                        void 0 === s.player && null !== s.getAttribute('data-setup') && be(s)
                    }
                else Ee || Ce(1)
            }
        }
    function Ce(e, t) {
        X() && (t && (be = t), window.setTimeout(ke, e))
    }
    function Ie() {
        ;(Ee = !0), window.removeEventListener('load', Ie)
    }
    X() && ('complete' === document.readyState ? Ie() : window.addEventListener('load', Ie))
    function xe(e) {
        var t = document.createElement('style')
        return (t.className = e), t
    }
    function Ae(e, t) {
        e.styleSheet ? (e.styleSheet.cssText = t) : (e.textContent = t)
    }
    var Pe = 3
    window.WeakMap ||
        (ui = (function () {
            function e() {
                ;(this.vdata = 'vdata' + Math.floor((window.performance && window.performance.now()) || Date.now())), (this.data = {})
            }
            var t = e.prototype
            return (
                (t.set = function (e, t) {
                    var i = e[this.vdata] || Pe++
                    return e[this.vdata] || (e[this.vdata] = i), (this.data[i] = t), this
                }),
                (t.get = function (e) {
                    var t = e[this.vdata]
                    if (t) return this.data[t]
                    h('We have no data for this element', e)
                }),
                (t.has = function (e) {
                    return e[this.vdata] in this.data
                }),
                (t.delete = function (e) {
                    var t = e[this.vdata]
                    t && (delete this.data[t], delete e[this.vdata])
                }),
                e
            )
        })())
    var Le,
        De = new (window.WeakMap ? WeakMap : ui)()
    function Oe(e, t) {
        var i
        De.has(e) &&
            (0 === (i = De.get(e)).handlers[t].length &&
                (delete i.handlers[t], e.removeEventListener ? e.removeEventListener(t, i.dispatcher, !1) : e.detachEvent && e.detachEvent('on' + t, i.dispatcher)),
            Object.getOwnPropertyNames(i.handlers).length <= 0 && (delete i.handlers, delete i.dispatcher, delete i.disabled),
            0 === Object.getOwnPropertyNames(i).length && De.delete(e))
    }
    function Me(t, i, e, n) {
        e.forEach(function (e) {
            t(i, e, n)
        })
    }
    function Re(e) {
        if (e.fixed_) return e
        function t() {
            return !0
        }
        function i() {
            return !1
        }
        if (!e || !e.isPropagationStopped || !e.isImmediatePropagationStopped) {
            var n,
                r,
                a,
                s = e || window.event
            for (n in ((e = {}), s))
                'layerX' !== n &&
                    'layerY' !== n &&
                    'keyLocation' !== n &&
                    'webkitMovementX' !== n &&
                    'webkitMovementY' !== n &&
                    'path' !== n &&
                    (('returnValue' === n && s.preventDefault) || (e[n] = s[n]))
            e.target || (e.target = e.srcElement || document),
                e.relatedTarget || (e.relatedTarget = e.fromElement === e.target ? e.toElement : e.fromElement),
                (e.preventDefault = function () {
                    s.preventDefault && s.preventDefault(), (e.returnValue = !1), (s.returnValue = !1), (e.defaultPrevented = !0)
                }),
                (e.defaultPrevented = !1),
                (e.stopPropagation = function () {
                    s.stopPropagation && s.stopPropagation(), (e.cancelBubble = !0), (s.cancelBubble = !0), (e.isPropagationStopped = t)
                }),
                (e.isPropagationStopped = i),
                (e.stopImmediatePropagation = function () {
                    s.stopImmediatePropagation && s.stopImmediatePropagation(), (e.isImmediatePropagationStopped = t), e.stopPropagation()
                }),
                (e.isImmediatePropagationStopped = i),
                null !== e.clientX &&
                    void 0 !== e.clientX &&
                    ((r = document.documentElement),
                    (a = document.body),
                    (e.pageX = e.clientX + ((r && r.scrollLeft) || (a && a.scrollLeft) || 0) - ((r && r.clientLeft) || (a && a.clientLeft) || 0)),
                    (e.pageY = e.clientY + ((r && r.scrollTop) || (a && a.scrollTop) || 0) - ((r && r.clientTop) || (a && a.clientTop) || 0))),
                (e.which = e.charCode || e.keyCode),
                null !== e.button && void 0 !== e.button && (e.button = 1 & e.button ? 0 : 4 & e.button ? 1 : 2 & e.button ? 2 : 0)
        }
        return (e.fixed_ = !0), e
    }
    var Ne = function () {
            if ('boolean' != typeof Le) {
                Le = !1
                try {
                    var e = Object.defineProperty({}, 'passive', {
                        get: function () {
                            Le = !0
                        },
                    })
                    window.addEventListener('test', null, e), window.removeEventListener('test', null, e)
                } catch (e) {}
            }
            return Le
        },
        Ue = ['touchstart', 'touchmove']
    function Be(s, e, t) {
        if (Array.isArray(e)) return Me(Be, s, e, t)
        De.has(s) || De.set(s, {})
        var o = De.get(s)
        o.handlers || (o.handlers = {}),
            o.handlers[e] || (o.handlers[e] = []),
            t.guid || (t.guid = Pe++),
            o.handlers[e].push(t),
            o.dispatcher ||
                ((o.disabled = !1),
                (o.dispatcher = function (e, t) {
                    if (!o.disabled) {
                        e = Re(e)
                        var i = o.handlers[e.type]
                        if (i)
                            for (var n = i.slice(0), r = 0, a = n.length; r < a && !e.isImmediatePropagationStopped(); r++)
                                try {
                                    n[r].call(s, e, t)
                                } catch (e) {
                                    h.error(e)
                                }
                    }
                })),
            1 === o.handlers[e].length &&
                (s.addEventListener ? ((t = !1), Ne() && -1 < Ue.indexOf(e) && (t = { passive: !0 }), s.addEventListener(e, o.dispatcher, t)) : s.attachEvent && s.attachEvent('on' + e, o.dispatcher))
    }
    function Fe(e, t, i) {
        if (De.has(e)) {
            var n = De.get(e)
            if (n.handlers) {
                if (Array.isArray(t)) return Me(Fe, e, t, i)
                var r = function (e, t) {
                    ;(n.handlers[t] = []), Oe(e, t)
                }
                if (void 0 !== t) {
                    var a = n.handlers[t]
                    if (a)
                        if (i) {
                            if (i.guid) for (var s = 0; s < a.length; s++) a[s].guid === i.guid && a.splice(s--, 1)
                            Oe(e, t)
                        } else r(e, t)
                } else for (var o in n.handlers) Object.prototype.hasOwnProperty.call(n.handlers || {}, o) && r(e, o)
            }
        }
    }
    function je(e, t, i) {
        var n = De.has(e) ? De.get(e) : {},
            r = e.parentNode || e.ownerDocument
        return (
            'string' == typeof t ? (t = { type: t, target: e }) : t.target || (t.target = e),
            (t = Re(t)),
            n.dispatcher && n.dispatcher.call(e, t, i),
            r && !t.isPropagationStopped() && !0 === t.bubbles
                ? je.call(null, r, t, i)
                : !r &&
                  !t.defaultPrevented &&
                  t.target &&
                  t.target[t.type] &&
                  (De.has(t.target) || De.set(t.target, {}),
                  (r = De.get(t.target)),
                  t.target[t.type] && ((r.disabled = !0), 'function' == typeof t.target[t.type] && t.target[t.type](), (r.disabled = !1))),
            !t.defaultPrevented
        )
    }
    function He(e, t, i) {
        if (Array.isArray(t)) return Me(He, e, t, i)
        function n() {
            Fe(e, t, n), i.apply(this, arguments)
        }
        ;(n.guid = i.guid = i.guid || Pe++), Be(e, t, n)
    }
    function qe(e, t, i) {
        function n() {
            Fe(e, t, n), i.apply(this, arguments)
        }
        ;(n.guid = i.guid = i.guid || Pe++), Be(e, t, n)
    }
    function Ve(e, t, i) {
        return t.guid || (t.guid = Pe++), ((e = t.bind(e)).guid = i ? i + '_' + t.guid : t.guid), e
    }
    function We(t, i) {
        var n = window.performance.now()
        return function () {
            var e = window.performance.now()
            i <= e - n && (t.apply(void 0, arguments), (n = e))
        }
    }
    function Ge(n, r, a, s) {
        var o
        function e() {
            var e = this,
                t = arguments,
                i = function () {
                    ;(i = o = null), a || n.apply(e, t)
                }
            !o && a && n.apply(e, t), s.clearTimeout(o), (o = s.setTimeout(i, r))
        }
        return (
            void 0 === s && (s = window),
            (e.cancel = function () {
                s.clearTimeout(o), (o = null)
            }),
            e
        )
    }
    function ze() {}
    var Xe,
        Ke = Object.freeze({ __proto__: null, fixEvent: Re, on: Be, off: Fe, trigger: je, one: He, any: qe })
    ;(ze.prototype.allowedEvents_ = {}),
        (ze.prototype.addEventListener = ze.prototype.on =
            function (e, t) {
                var i = this.addEventListener
                ;(this.addEventListener = function () {}), Be(this, e, t), (this.addEventListener = i)
            }),
        (ze.prototype.removeEventListener = ze.prototype.off =
            function (e, t) {
                Fe(this, e, t)
            }),
        (ze.prototype.one = function (e, t) {
            var i = this.addEventListener
            ;(this.addEventListener = function () {}), He(this, e, t), (this.addEventListener = i)
        }),
        (ze.prototype.any = function (e, t) {
            var i = this.addEventListener
            ;(this.addEventListener = function () {}), qe(this, e, t), (this.addEventListener = i)
        }),
        (ze.prototype.dispatchEvent = ze.prototype.trigger =
            function (e) {
                var t = e.type || e
                ;(e = Re((e = 'string' == typeof e ? { type: t } : e))), this.allowedEvents_[t] && this['on' + t] && this['on' + t](e), je(this, e)
            }),
        (ze.prototype.queueTrigger = function (e) {
            var t = this
            Xe = Xe || new Map()
            var i = e.type || e,
                n = Xe.get(this)
            n || ((n = new Map()), Xe.set(this, n))
            var r = n.get(i)
            n.delete(i), window.clearTimeout(r)
            r = window.setTimeout(function () {
                0 === n.size && ((n = null), Xe.delete(t)), t.trigger(e)
            }, 0)
            n.set(i, r)
        })
    function Ye(e) {
        return 'function' == typeof e.name ? e.name() : 'string' == typeof e.name ? e.name : e.name_ || (e.constructor && e.constructor.name ? e.constructor.name : typeof e)
    }
    function Qe(e) {
        return ('string' == typeof e && /\S/.test(e)) || (Array.isArray(e) && !!e.length)
    }
    function $e(e, t, i) {
        if (!e || (!e.nodeName && !it(e))) throw new Error('Invalid target for ' + Ye(t) + '#' + i + '; must be a DOM node or evented object.')
    }
    function Je(e, t, i) {
        if (!Qe(e)) throw new Error('Invalid event type for ' + Ye(t) + '#' + i + '; must be a non-empty string or array.')
    }
    function Ze(e, t, i) {
        if ('function' != typeof e) throw new Error('Invalid listener for ' + Ye(t) + '#' + i + '; must be a function.')
    }
    function et(e, t, i) {
        var n,
            r,
            a = t.length < 3 || t[0] === e || t[0] === e.eventBusEl_,
            t = a ? ((n = e.eventBusEl_), 3 <= t.length && t.shift(), (r = t[0]), t[1]) : ((n = t[0]), (r = t[1]), t[2])
        return $e(n, e, i), Je(r, e, i), Ze(t, e, i), { isTargetingSelf: a, target: n, type: r, listener: (t = Ve(e, t)) }
    }
    function tt(e, t, i, n) {
        $e(e, e, t), e.nodeName ? Ke[t](e, i, n) : e[t](i, n)
    }
    var it = function (t) {
            return (
                t instanceof ze ||
                (!!t.eventBusEl_ &&
                    ['on', 'one', 'off', 'trigger'].every(function (e) {
                        return 'function' == typeof t[e]
                    }))
            )
        },
        nt = {
            on: function () {
                for (var e = this, t = arguments.length, i = new Array(t), n = 0; n < t; n++) i[n] = arguments[n]
                var r,
                    a = et(this, i, 'on'),
                    s = a.isTargetingSelf,
                    o = a.target,
                    u = a.type,
                    l = a.listener
                tt(o, 'on', u, l),
                    s ||
                        (((r = function () {
                            return e.off(o, u, l)
                        }).guid = l.guid),
                        ((s = function () {
                            return e.off('dispose', r)
                        }).guid = l.guid),
                        tt(this, 'on', 'dispose', r),
                        tt(o, 'on', 'dispose', s))
            },
            one: function () {
                for (var r = this, e = arguments.length, t = new Array(e), i = 0; i < e; i++) t[i] = arguments[i]
                var n = et(this, t, 'one'),
                    a = n.isTargetingSelf,
                    s = n.target,
                    o = n.type,
                    u = n.listener
                a
                    ? tt(s, 'one', o, u)
                    : (((a = function e() {
                          r.off(s, o, e)
                          for (var t = arguments.length, i = new Array(t), n = 0; n < t; n++) i[n] = arguments[n]
                          u.apply(null, i)
                      }).guid = u.guid),
                      tt(s, 'one', o, a))
            },
            any: function () {
                for (var r = this, e = arguments.length, t = new Array(e), i = 0; i < e; i++) t[i] = arguments[i]
                var n = et(this, t, 'any'),
                    a = n.isTargetingSelf,
                    s = n.target,
                    o = n.type,
                    u = n.listener
                a
                    ? tt(s, 'any', o, u)
                    : (((a = function e() {
                          r.off(s, o, e)
                          for (var t = arguments.length, i = new Array(t), n = 0; n < t; n++) i[n] = arguments[n]
                          u.apply(null, i)
                      }).guid = u.guid),
                      tt(s, 'any', o, a))
            },
            off: function (e, t, i) {
                !e || Qe(e)
                    ? Fe(this.eventBusEl_, e, t)
                    : ((t = t),
                      $e((e = e), this, 'off'),
                      Je(t, this, 'off'),
                      Ze(i, this, 'off'),
                      (i = Ve(this, i)),
                      this.off('dispose', i),
                      e.nodeName ? (Fe(e, t, i), Fe(e, 'dispose', i)) : it(e) && (e.off(t, i), e.off('dispose', i)))
            },
            trigger: function (e, t) {
                $e(this.eventBusEl_, this, 'trigger')
                var i = e && 'string' != typeof e ? e.type : e
                if (!Qe(i)) {
                    i = 'Invalid event type for ' + Ye(this) + '#trigger; must be a non-empty string or object with a type key that has a non-empty value.'
                    if (!e) throw new Error(i)
                    ;(this.log || h).error(i)
                }
                return je(this.eventBusEl_, e, t)
            },
        }
    function rt(e, t) {
        t = (t = void 0 === t ? {} : t).eventBusKey
        if (t) {
            if (!e[t].nodeName) throw new Error('The eventBusKey "' + t + '" does not refer to an element.')
            e.eventBusEl_ = e[t]
        } else e.eventBusEl_ = $('span', { className: 'vjs-event-bus' })
        return (
            b(e, nt),
            e.eventedCallbacks &&
                e.eventedCallbacks.forEach(function (e) {
                    e()
                }),
            e.on('dispose', function () {
                e.off(),
                    [e, e.el_, e.eventBusEl_].forEach(function (e) {
                        e && De.has(e) && De.delete(e)
                    }),
                    window.setTimeout(function () {
                        e.eventBusEl_ = null
                    }, 0)
            }),
            e
        )
    }
    var at = {
        state: {},
        setState: function (e) {
            var i,
                n = this
            return (
                _((e = 'function' == typeof e ? e() : e), function (e, t) {
                    n.state[t] !== e && ((i = i || {})[t] = { from: n.state[t], to: e }), (n.state[t] = e)
                }),
                i && it(this) && this.trigger({ changes: i, type: 'statechanged' }),
                i
            )
        },
    }
    function st(e, t) {
        return b(e, at), (e.state = b({}, e.state, t)), 'function' == typeof e.handleStateChanged && it(e) && e.on('statechanged', e.handleStateChanged), e
    }
    function ot(e) {
        return 'string' != typeof e
            ? e
            : e.replace(/./, function (e) {
                  return e.toLowerCase()
              })
    }
    function ut(e) {
        return 'string' != typeof e
            ? e
            : e.replace(/./, function (e) {
                  return e.toUpperCase()
              })
    }
    function lt() {
        for (var i = {}, e = arguments.length, t = new Array(e), n = 0; n < e; n++) t[n] = arguments[n]
        return (
            t.forEach(function (e) {
                e &&
                    _(e, function (e, t) {
                        S(e) ? (S(i[t]) || (i[t] = {}), (i[t] = lt(i[t], e))) : (i[t] = e)
                    })
            }),
            i
        )
    }
    var ct =
            window.Map ||
            (function () {
                function e() {
                    this.map_ = {}
                }
                var t = e.prototype
                return (
                    (t.has = function (e) {
                        return e in this.map_
                    }),
                    (t.delete = function (e) {
                        var t = this.has(e)
                        return delete this.map_[e], t
                    }),
                    (t.set = function (e, t) {
                        return (this.map_[e] = t), this
                    }),
                    (t.forEach = function (e, t) {
                        for (var i in this.map_) e.call(t, this.map_[i], i, this)
                    }),
                    e
                )
            })(),
        dt =
            window.Set ||
            (function () {
                function e() {
                    this.set_ = {}
                }
                var t = e.prototype
                return (
                    (t.has = function (e) {
                        return e in this.set_
                    }),
                    (t.delete = function (e) {
                        var t = this.has(e)
                        return delete this.set_[e], t
                    }),
                    (t.add = function (e) {
                        return (this.set_[e] = 1), this
                    }),
                    (t.forEach = function (e, t) {
                        for (var i in this.set_) e.call(t, i, i, this)
                    }),
                    e
                )
            })(),
        ht = m(function (e, t) {
            function i(e) {
                if ((!e || 'object' != typeof e || ((t = e.which || e.keyCode || e.charCode) && (e = t)), 'number' == typeof e)) return o[e]
                var t = String(e),
                    e = n[t.toLowerCase()]
                return e || ((e = r[t.toLowerCase()]) ? e : 1 === t.length ? t.charCodeAt(0) : void 0)
            }
            i.isEventKey = function (e, t) {
                if (e && 'object' == typeof e) {
                    var i = e.which || e.keyCode || e.charCode
                    if (null == i) return !1
                    if ('string' == typeof t) {
                        e = n[t.toLowerCase()]
                        if (e) return e === i
                        if ((e = r[t.toLowerCase()])) return e === i
                    } else if ('number' == typeof t) return t === i
                    return !1
                }
            }
            for (
                var n =
                        ((t = e.exports = i).code =
                        t.codes =
                            {
                                backspace: 8,
                                tab: 9,
                                enter: 13,
                                shift: 16,
                                ctrl: 17,
                                alt: 18,
                                'pause/break': 19,
                                'caps lock': 20,
                                esc: 27,
                                space: 32,
                                'page up': 33,
                                'page down': 34,
                                end: 35,
                                home: 36,
                                left: 37,
                                up: 38,
                                right: 39,
                                down: 40,
                                insert: 45,
                                delete: 46,
                                command: 91,
                                'left command': 91,
                                'right command': 93,
                                'numpad *': 106,
                                'numpad +': 107,
                                'numpad -': 109,
                                'numpad .': 110,
                                'numpad /': 111,
                                'num lock': 144,
                                'scroll lock': 145,
                                'my computer': 182,
                                'my calculator': 183,
                                ';': 186,
                                '=': 187,
                                ',': 188,
                                '-': 189,
                                '.': 190,
                                '/': 191,
                                '`': 192,
                                '[': 219,
                                '\\': 220,
                                ']': 221,
                                "'": 222,
                            }),
                    r = (t.aliases = {
                        windows: 91,
                        '⇧': 16,
                        '⌥': 18,
                        '⌃': 17,
                        '⌘': 91,
                        ctl: 17,
                        control: 17,
                        option: 18,
                        pause: 19,
                        break: 19,
                        caps: 20,
                        return: 13,
                        escape: 27,
                        spc: 32,
                        spacebar: 32,
                        pgup: 33,
                        pgdn: 34,
                        ins: 45,
                        del: 46,
                        cmd: 91,
                    }),
                    a = 97;
                a < 123;
                a++
            )
                n[String.fromCharCode(a)] = a - 32
            for (var a = 48; a < 58; a++) n[a - 48] = a
            for (a = 1; a < 13; a++) n['f' + a] = a + 111
            for (a = 0; a < 10; a++) n['numpad ' + a] = a + 96
            var s,
                o = (t.names = t.title = {})
            for (a in n) o[n[a]] = a
            for (s in r) n[s] = r[s]
        })
    ht.code, ht.codes, ht.aliases, ht.names, ht.title
    var pt = (function () {
        function s(e, t, i) {
            var n = this
            !e && this.play ? (this.player_ = e = this) : (this.player_ = e),
                (this.isDisposed_ = !1),
                (this.parentComponent_ = null),
                (this.options_ = lt({}, this.options_)),
                (t = this.options_ = lt(this.options_, t)),
                (this.id_ = t.id || (t.el && t.el.id)),
                this.id_ || ((e = (e && e.id && e.id()) || 'no_player'), (this.id_ = e + '_component_' + Pe++)),
                (this.name_ = t.name || null),
                t.el ? (this.el_ = t.el) : !1 !== t.createEl && (this.el_ = this.createEl()),
                t.className &&
                    this.el_ &&
                    t.className.split(' ').forEach(function (e) {
                        return n.addClass(e)
                    }),
                !1 !== t.evented &&
                    (rt(this, { eventBusKey: this.el_ ? 'el_' : null }),
                    (this.handleLanguagechange = this.handleLanguagechange.bind(this)),
                    this.on(this.player_, 'languagechange', this.handleLanguagechange)),
                st(this, this.constructor.defaultState),
                (this.children_ = []),
                (this.childIndex_ = {}),
                (this.childNameIndex_ = {}),
                (this.setTimeoutIds_ = new dt()),
                (this.setIntervalIds_ = new dt()),
                (this.rafIds_ = new dt()),
                (this.namedRafs_ = new ct()),
                (this.clearingTimersOnDispose_ = !1) !== t.initChildren && this.initChildren(),
                this.ready(i),
                !1 !== t.reportTouchActivity && this.enableTouchActivity()
        }
        var e = s.prototype
        return (
            (e.dispose = function (e) {
                if ((void 0 === e && (e = {}), !this.isDisposed_)) {
                    if ((this.readyQueue_ && (this.readyQueue_.length = 0), this.trigger({ type: 'dispose', bubbles: !1 }), (this.isDisposed_ = !0), this.children_))
                        for (var t = this.children_.length - 1; 0 <= t; t--) this.children_[t].dispose && this.children_[t].dispose()
                    ;(this.children_ = null),
                        (this.childIndex_ = null),
                        (this.childNameIndex_ = null),
                        (this.parentComponent_ = null),
                        this.el_ && (this.el_.parentNode && (e.restoreEl ? this.el_.parentNode.replaceChild(e.restoreEl, this.el_) : this.el_.parentNode.removeChild(this.el_)), (this.el_ = null)),
                        (this.player_ = null)
                }
            }),
            (e.isDisposed = function () {
                return Boolean(this.isDisposed_)
            }),
            (e.player = function () {
                return this.player_
            }),
            (e.options = function (e) {
                return e && (this.options_ = lt(this.options_, e)), this.options_
            }),
            (e.el = function () {
                return this.el_
            }),
            (e.createEl = function (e, t, i) {
                return $(e, t, i)
            }),
            (e.localize = function (e, i, t) {
                void 0 === t && (t = e)
                var n = this.player_.language && this.player_.language(),
                    r = this.player_.languages && this.player_.languages(),
                    a = r && r[n],
                    n = n && n.split('-')[0],
                    n = r && r[n],
                    t = t
                return (
                    a && a[e] ? (t = a[e]) : n && n[e] && (t = n[e]),
                    (t = i
                        ? t.replace(/\{(\d+)\}/g, function (e, t) {
                              t = i[t - 1]
                              return 'undefined' == typeof t ? e : t
                          })
                        : t)
                )
            }),
            (e.handleLanguagechange = function () {}),
            (e.contentEl = function () {
                return this.contentEl_ || this.el_
            }),
            (e.id = function () {
                return this.id_
            }),
            (e.name = function () {
                return this.name_
            }),
            (e.children = function () {
                return this.children_
            }),
            (e.getChildById = function (e) {
                return this.childIndex_[e]
            }),
            (e.getChild = function (e) {
                if (e) return this.childNameIndex_[e]
            }),
            (e.getDescendant = function () {
                for (var e = arguments.length, t = new Array(e), i = 0; i < e; i++) t[i] = arguments[i]
                for (
                    var t = t.reduce(function (e, t) {
                            return e.concat(t)
                        }, []),
                        n = this,
                        r = 0;
                    r < t.length;
                    r++
                )
                    if (!(n = n.getChild(t[r])) || !n.getChild) return
                return n
            }),
            (e.addChild = function (e, t, i) {
                if ((void 0 === t && (t = {}), void 0 === i && (i = this.children_.length), 'string' == typeof e)) {
                    var n = ut(e),
                        r = t.componentClass || n
                    t.name = n
                    var a = s.getComponent(r)
                    if (!a) throw new Error('Component ' + r + ' does not exist')
                    if ('function' != typeof a) return null
                    a = new a(this.player_ || this, t)
                } else a = e
                return (
                    a.parentComponent_ && a.parentComponent_.removeChild(a),
                    this.children_.splice(i, 0, a),
                    (a.parentComponent_ = this),
                    'function' == typeof a.id && (this.childIndex_[a.id()] = a),
                    (n = n || (a.name && ut(a.name()))) && ((this.childNameIndex_[n] = a), (this.childNameIndex_[ot(n)] = a)),
                    'function' == typeof a.el &&
                        a.el() &&
                        ((n = null),
                        this.children_[i + 1] && (this.children_[i + 1].el_ ? (n = this.children_[i + 1].el_) : K(this.children_[i + 1]) && (n = this.children_[i + 1])),
                        this.contentEl().insertBefore(a.el(), n)),
                    a
                )
            }),
            (e.removeChild = function (e) {
                if ((e = 'string' == typeof e ? this.getChild(e) : e) && this.children_) {
                    for (var t, i = !1, n = this.children_.length - 1; 0 <= n; n--)
                        if (this.children_[n] === e) {
                            ;(i = !0), this.children_.splice(n, 1)
                            break
                        }
                    i &&
                        ((e.parentComponent_ = null),
                        (this.childIndex_[e.id()] = null),
                        (this.childNameIndex_[ut(e.name())] = null),
                        (this.childNameIndex_[ot(e.name())] = null),
                        (t = e.el()) && t.parentNode === this.contentEl() && this.contentEl().removeChild(e.el()))
                }
            }),
            (e.initChildren = function () {
                var i,
                    t,
                    e,
                    n = this,
                    r = this.options_.children
                r &&
                    ((i = this.options_),
                    (t = s.getComponent('Tech')),
                    (e = Array.isArray(r) ? r : Object.keys(r))
                        .concat(
                            Object.keys(this.options_).filter(function (t) {
                                return !e.some(function (e) {
                                    return 'string' == typeof e ? t === e : t === e.name
                                })
                            })
                        )
                        .map(function (e) {
                            var t,
                                e = 'string' == typeof e ? r[(t = e)] || n.options_[t] || {} : ((t = e.name), e)
                            return { name: t, opts: e }
                        })
                        .filter(function (e) {
                            e = s.getComponent(e.opts.componentClass || ut(e.name))
                            return e && !t.isTech(e)
                        })
                        .forEach(function (e) {
                            var t = e.name,
                                e = e.opts
                            !1 !== (e = void 0 !== i[t] ? i[t] : e) && (((e = !0 === e ? {} : e).playerOptions = n.options_.playerOptions), (e = n.addChild(t, e)) && (n[t] = e))
                        }))
            }),
            (e.buildCSSClass = function () {
                return ''
            }),
            (e.ready = function (e, t) {
                if ((void 0 === t && (t = !1), e)) return this.isReady_ ? void (t ? e.call(this) : this.setTimeout(e, 1)) : ((this.readyQueue_ = this.readyQueue_ || []), void this.readyQueue_.push(e))
            }),
            (e.triggerReady = function () {
                ;(this.isReady_ = !0),
                    this.setTimeout(function () {
                        var e = this.readyQueue_
                        ;(this.readyQueue_ = []),
                            e &&
                                0 < e.length &&
                                e.forEach(function (e) {
                                    e.call(this)
                                }, this),
                            this.trigger('ready')
                    }, 1)
            }),
            (e.$ = function (e, t) {
                return Te(e, t || this.contentEl())
            }),
            (e.$$ = function (e, t) {
                return Se(e, t || this.contentEl())
            }),
            (e.hasClass = function (e) {
                return ee(this.el_, e)
            }),
            (e.addClass = function (e) {
                te(this.el_, e)
            }),
            (e.removeClass = function (e) {
                ie(this.el_, e)
            }),
            (e.toggleClass = function (e, t) {
                ne(this.el_, e, t)
            }),
            (e.show = function () {
                this.removeClass('vjs-hidden')
            }),
            (e.hide = function () {
                this.addClass('vjs-hidden')
            }),
            (e.lockShowing = function () {
                this.addClass('vjs-lock-showing')
            }),
            (e.unlockShowing = function () {
                this.removeClass('vjs-lock-showing')
            }),
            (e.getAttribute = function (e) {
                return se(this.el_, e)
            }),
            (e.setAttribute = function (e, t) {
                oe(this.el_, e, t)
            }),
            (e.removeAttribute = function (e) {
                ue(this.el_, e)
            }),
            (e.width = function (e, t) {
                return this.dimension('width', e, t)
            }),
            (e.height = function (e, t) {
                return this.dimension('height', e, t)
            }),
            (e.dimensions = function (e, t) {
                this.width(e, !0), this.height(t)
            }),
            (e.dimension = function (e, t, i) {
                if (void 0 !== t)
                    return (
                        -1 !== ('' + (t = null === t || t != t ? 0 : t)).indexOf('%') || -1 !== ('' + t).indexOf('px') ? (this.el_.style[e] = t) : (this.el_.style[e] = 'auto' === t ? '' : t + 'px'),
                        void (i || this.trigger('componentresize'))
                    )
                if (!this.el_) return 0
                ;(t = this.el_.style[e]), (i = t.indexOf('px'))
                return -1 !== i ? parseInt(t.slice(0, i), 10) : parseInt(this.el_['offset' + ut(e)], 10)
            }),
            (e.currentDimension = function (e) {
                var t = 0
                if ('width' !== e && 'height' !== e) throw new Error('currentDimension only accepts width or height value')
                return (t = w(this.el_, e)), (0 !== (t = parseFloat(t)) && !isNaN(t)) || ((e = 'offset' + ut(e)), (t = this.el_[e])), t
            }),
            (e.currentDimensions = function () {
                return { width: this.currentDimension('width'), height: this.currentDimension('height') }
            }),
            (e.currentWidth = function () {
                return this.currentDimension('width')
            }),
            (e.currentHeight = function () {
                return this.currentDimension('height')
            }),
            (e.focus = function () {
                this.el_.focus()
            }),
            (e.blur = function () {
                this.el_.blur()
            }),
            (e.handleKeyDown = function (e) {
                this.player_ && (ht.isEventKey(e, 'Tab') || e.stopPropagation(), this.player_.handleKeyDown(e))
            }),
            (e.handleKeyPress = function (e) {
                this.handleKeyDown(e)
            }),
            (e.emitTapEvents = function () {
                var i,
                    t = 0,
                    n = null
                this.on('touchstart', function (e) {
                    1 === e.touches.length && ((n = { pageX: e.touches[0].pageX, pageY: e.touches[0].pageY }), (t = window.performance.now()), (i = !0))
                }),
                    this.on('touchmove', function (e) {
                        var t
                        1 < e.touches.length ? (i = !1) : n && ((t = e.touches[0].pageX - n.pageX), (e = e.touches[0].pageY - n.pageY), 10 < Math.sqrt(t * t + e * e) && (i = !1))
                    })
                function e() {
                    i = !1
                }
                this.on('touchleave', e),
                    this.on('touchcancel', e),
                    this.on('touchend', function (e) {
                        !(n = null) === i && window.performance.now() - t < 200 && (e.preventDefault(), this.trigger('tap'))
                    })
            }),
            (e.enableTouchActivity = function () {
                var t, i, e
                this.player() &&
                    this.player().reportUserActivity &&
                    ((t = Ve(this.player(), this.player().reportUserActivity)),
                    this.on('touchstart', function () {
                        t(), this.clearInterval(i), (i = this.setInterval(t, 250))
                    }),
                    (e = function (e) {
                        t(), this.clearInterval(i)
                    }),
                    this.on('touchmove', t),
                    this.on('touchend', e),
                    this.on('touchcancel', e))
            }),
            (e.setTimeout = function (e, t) {
                var i,
                    n = this
                return (
                    (e = Ve(this, e)),
                    this.clearTimersOnDispose_(),
                    (i = window.setTimeout(function () {
                        n.setTimeoutIds_.has(i) && n.setTimeoutIds_.delete(i), e()
                    }, t)),
                    this.setTimeoutIds_.add(i),
                    i
                )
            }),
            (e.clearTimeout = function (e) {
                return this.setTimeoutIds_.has(e) && (this.setTimeoutIds_.delete(e), window.clearTimeout(e)), e
            }),
            (e.setInterval = function (e, t) {
                ;(e = Ve(this, e)), this.clearTimersOnDispose_()
                t = window.setInterval(e, t)
                return this.setIntervalIds_.add(t), t
            }),
            (e.clearInterval = function (e) {
                return this.setIntervalIds_.has(e) && (this.setIntervalIds_.delete(e), window.clearInterval(e)), e
            }),
            (e.requestAnimationFrame = function (e) {
                var t,
                    i = this
                return this.supportsRaf_
                    ? (this.clearTimersOnDispose_(),
                      (e = Ve(this, e)),
                      (t = window.requestAnimationFrame(function () {
                          i.rafIds_.has(t) && i.rafIds_.delete(t), e()
                      })),
                      this.rafIds_.add(t),
                      t)
                    : this.setTimeout(e, 1e3 / 60)
            }),
            (e.requestNamedAnimationFrame = function (e, t) {
                var i = this
                if (!this.namedRafs_.has(e)) {
                    this.clearTimersOnDispose_(), (t = Ve(this, t))
                    var n = this.requestAnimationFrame(function () {
                        t(), i.namedRafs_.has(e) && i.namedRafs_.delete(e)
                    })
                    return this.namedRafs_.set(e, n), e
                }
            }),
            (e.cancelNamedAnimationFrame = function (e) {
                this.namedRafs_.has(e) && (this.cancelAnimationFrame(this.namedRafs_.get(e)), this.namedRafs_.delete(e))
            }),
            (e.cancelAnimationFrame = function (e) {
                return this.supportsRaf_ ? (this.rafIds_.has(e) && (this.rafIds_.delete(e), window.cancelAnimationFrame(e)), e) : this.clearTimeout(e)
            }),
            (e.clearTimersOnDispose_ = function () {
                var n = this
                this.clearingTimersOnDispose_ ||
                    ((this.clearingTimersOnDispose_ = !0),
                    this.one('dispose', function () {
                        ;[
                            ['namedRafs_', 'cancelNamedAnimationFrame'],
                            ['rafIds_', 'cancelAnimationFrame'],
                            ['setTimeoutIds_', 'clearTimeout'],
                            ['setIntervalIds_', 'clearInterval'],
                        ].forEach(function (e) {
                            var t = e[0],
                                i = e[1]
                            n[t].forEach(function (e, t) {
                                return n[i](t)
                            })
                        }),
                            (n.clearingTimersOnDispose_ = !1)
                    }))
            }),
            (s.registerComponent = function (e, t) {
                if ('string' != typeof e || !e) throw new Error('Illegal component name, "' + e + '"; must be a non-empty string.')
                var i = s.getComponent('Tech'),
                    n = i && i.isTech(t),
                    i = s === t || s.prototype.isPrototypeOf(t.prototype)
                if (n || !i) {
                    var r = n ? 'techs must be registered using Tech.registerTech()' : 'must be a Component subclass'
                    throw new Error('Illegal component, "' + e + '"; ' + r + '.')
                }
                ;(e = ut(e)), s.components_ || (s.components_ = {})
                r = s.getComponent('Player')
                if ('Player' === e && r && r.players) {
                    var a = r.players,
                        r = Object.keys(a)
                    if (
                        a &&
                        0 < r.length &&
                        r
                            .map(function (e) {
                                return a[e]
                            })
                            .every(Boolean)
                    )
                        throw new Error('Can not register Player component after player has been created.')
                }
                return (s.components_[e] = t), (s.components_[ot(e)] = t)
            }),
            (s.getComponent = function (e) {
                if (e && s.components_) return s.components_[e]
            }),
            s
        )
    })()
    ;(pt.prototype.supportsRaf_ = 'function' == typeof window.requestAnimationFrame && 'function' == typeof window.cancelAnimationFrame), pt.registerComponent('Component', pt)
    var ft = function (e) {
        if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
        return e
    }
    var mt = function (e, t) {
        ;(e.prototype = Object.create(t.prototype)), ((e.prototype.constructor = e).__proto__ = t)
    }
    function gt(e, t, i, n) {
        return (
            (function (e, t, i) {
                if ('number' != typeof t || t < 0 || i < t)
                    throw new Error("Failed to execute '" + e + "' on 'TimeRanges': The index provided (" + t + ') is non-numeric or out of bounds (0-' + i + ').')
            })(e, n, i.length - 1),
            i[n][t]
        )
    }
    function yt(e) {
        var t =
            void 0 === e || 0 === e.length
                ? {
                      length: 0,
                      start: function () {
                          throw new Error('This TimeRanges object is empty')
                      },
                      end: function () {
                          throw new Error('This TimeRanges object is empty')
                      },
                  }
                : { length: e.length, start: gt.bind(null, 'start', 0, e), end: gt.bind(null, 'end', 1, e) }
        return (
            window.Symbol &&
                window.Symbol.iterator &&
                (t[window.Symbol.iterator] = function () {
                    return (e || []).values()
                }),
            t
        )
    }
    function vt(e, t) {
        return Array.isArray(e) ? yt(e) : void 0 === e || void 0 === t ? yt() : yt([[e, t]])
    }
    function _t(e, t) {
        var i,
            n,
            r = 0
        if (!t) return 0
        ;(e && e.length) || (e = vt(0, 0))
        for (var a = 0; a < e.length; a++) (i = e.start(a)), (r += (n = t < (n = e.end(a)) ? t : n) - i)
        return r / t
    }
    function bt(e) {
        if (e instanceof bt) return e
        'number' == typeof e ? (this.code = e) : 'string' == typeof e ? (this.message = e) : T(e) && ('number' == typeof e.code && (this.code = e.code), b(this, e)),
            this.message || (this.message = bt.defaultMessages[this.code] || '')
    }
    ;(bt.prototype.code = 0),
        (bt.prototype.message = ''),
        (bt.prototype.status = null),
        (bt.errorTypes = ['MEDIA_ERR_CUSTOM', 'MEDIA_ERR_ABORTED', 'MEDIA_ERR_NETWORK', 'MEDIA_ERR_DECODE', 'MEDIA_ERR_SRC_NOT_SUPPORTED', 'MEDIA_ERR_ENCRYPTED']),
        (bt.defaultMessages = {
            1: 'You aborted the media playback',
            2: 'A network error caused the media download to fail part-way.',
            3: 'The media playback was aborted due to a corruption problem or because the media used features your browser did not support.',
            4: 'The media could not be loaded, either because the server or network failed or because the format is not supported.',
            5: 'The media is encrypted and we do not have the keys to decrypt it.',
        })
    for (var Tt = 0; Tt < bt.errorTypes.length; Tt++) (bt[bt.errorTypes[Tt]] = Tt), (bt.prototype[bt.errorTypes[Tt]] = Tt)
    var St = function (e, t) {
        var i,
            n = null
        try {
            i = JSON.parse(e, t)
        } catch (e) {
            n = e
        }
        return [n, i]
    }
    function wt(e) {
        return null != e && 'function' == typeof e.then
    }
    function Et(e) {
        wt(e) && e.then(null, function (e) {})
    }
    function kt(n) {
        return ['kind', 'label', 'language', 'id', 'inBandMetadataTrackDispatchType', 'mode', 'src'].reduce(
            function (e, t, i) {
                return n[t] && (e[t] = n[t]), e
            },
            {
                cues:
                    n.cues &&
                    Array.prototype.map.call(n.cues, function (e) {
                        return { startTime: e.startTime, endTime: e.endTime, text: e.text, id: e.id }
                    }),
            }
        )
    }
    var Ct = function (e) {
            var t = e.$$('track'),
                i = Array.prototype.map.call(t, function (e) {
                    return e.track
                })
            return Array.prototype.map
                .call(t, function (e) {
                    var t = kt(e.track)
                    return e.src && (t.src = e.src), t
                })
                .concat(
                    Array.prototype.filter
                        .call(e.textTracks(), function (e) {
                            return -1 === i.indexOf(e)
                        })
                        .map(kt)
                )
        },
        It = function (e, i) {
            return (
                e.forEach(function (e) {
                    var t = i.addRemoteTextTrack(e).track
                    !e.src &&
                        e.cues &&
                        e.cues.forEach(function (e) {
                            return t.addCue(e)
                        })
                }),
                i.textTracks()
            )
        },
        xt = 'vjs-modal-dialog',
        At = (function (n) {
            function e(e, t) {
                var i = n.call(this, e, t) || this
                return (
                    (i.handleKeyDown_ = function (e) {
                        return i.handleKeyDown(e)
                    }),
                    (i.close_ = function (e) {
                        return i.close(e)
                    }),
                    (i.opened_ = i.hasBeenOpened_ = i.hasBeenFilled_ = !1),
                    i.closeable(!i.options_.uncloseable),
                    i.content(i.options_.content),
                    (i.contentEl_ = $('div', { className: xt + '-content' }, { role: 'document' })),
                    (i.descEl_ = $('p', { className: xt + '-description vjs-control-text', id: i.el().getAttribute('aria-describedby') })),
                    J(i.descEl_, i.description()),
                    i.el_.appendChild(i.descEl_),
                    i.el_.appendChild(i.contentEl_),
                    i
                )
            }
            mt(e, n)
            var t = e.prototype
            return (
                (t.createEl = function () {
                    return n.prototype.createEl.call(
                        this,
                        'div',
                        { className: this.buildCSSClass(), tabIndex: -1 },
                        { 'aria-describedby': this.id() + '_description', 'aria-hidden': 'true', 'aria-label': this.label(), role: 'dialog' }
                    )
                }),
                (t.dispose = function () {
                    ;(this.contentEl_ = null), (this.descEl_ = null), (this.previouslyActiveEl_ = null), n.prototype.dispose.call(this)
                }),
                (t.buildCSSClass = function () {
                    return xt + ' vjs-hidden ' + n.prototype.buildCSSClass.call(this)
                }),
                (t.label = function () {
                    return this.localize(this.options_.label || 'Modal Window')
                }),
                (t.description = function () {
                    var e = this.options_.description || this.localize('This is a modal window.')
                    return this.closeable() && (e += ' ' + this.localize('This modal can be closed by pressing the Escape key or activating the close button.')), e
                }),
                (t.open = function () {
                    var e
                    this.opened_ ||
                        ((e = this.player()),
                        this.trigger('beforemodalopen'),
                        (this.opened_ = !0),
                        (!this.options_.fillAlways && (this.hasBeenOpened_ || this.hasBeenFilled_)) || this.fill(),
                        (this.wasPlaying_ = !e.paused()),
                        this.options_.pauseOnOpen && this.wasPlaying_ && e.pause(),
                        this.on('keydown', this.handleKeyDown_),
                        (this.hadControls_ = e.controls()),
                        e.controls(!1),
                        this.show(),
                        this.conditionalFocus_(),
                        this.el().setAttribute('aria-hidden', 'false'),
                        this.trigger('modalopen'),
                        (this.hasBeenOpened_ = !0))
                }),
                (t.opened = function (e) {
                    return 'boolean' == typeof e && this[e ? 'open' : 'close'](), this.opened_
                }),
                (t.close = function () {
                    var e
                    this.opened_ &&
                        ((e = this.player()),
                        this.trigger('beforemodalclose'),
                        (this.opened_ = !1),
                        this.wasPlaying_ && this.options_.pauseOnOpen && e.play(),
                        this.off('keydown', this.handleKeyDown_),
                        this.hadControls_ && e.controls(!0),
                        this.hide(),
                        this.el().setAttribute('aria-hidden', 'true'),
                        this.trigger('modalclose'),
                        this.conditionalBlur_(),
                        this.options_.temporary && this.dispose())
                }),
                (t.closeable = function (e) {
                    var t, i
                    return (
                        'boolean' == typeof e &&
                            ((t = this.closeable_ = !!e),
                            (i = this.getChild('closeButton')),
                            t &&
                                !i &&
                                ((e = this.contentEl_),
                                (this.contentEl_ = this.el_),
                                (i = this.addChild('closeButton', { controlText: 'Close Modal Dialog' })),
                                (this.contentEl_ = e),
                                this.on(i, 'close', this.close_)),
                            !t && i && (this.off(i, 'close', this.close_), this.removeChild(i), i.dispose())),
                        this.closeable_
                    )
                }),
                (t.fill = function () {
                    this.fillWith(this.content())
                }),
                (t.fillWith = function (e) {
                    var t = this.contentEl(),
                        i = t.parentNode,
                        n = t.nextSibling
                    this.trigger('beforemodalfill'), (this.hasBeenFilled_ = !0), i.removeChild(t), this.empty(), ve(t, e), this.trigger('modalfill'), n ? i.insertBefore(t, n) : i.appendChild(t)
                    t = this.getChild('closeButton')
                    t && i.appendChild(t.el_)
                }),
                (t.empty = function () {
                    this.trigger('beforemodalempty'), me(this.contentEl()), this.trigger('modalempty')
                }),
                (t.content = function (e) {
                    return 'undefined' != typeof e && (this.content_ = e), this.content_
                }),
                (t.conditionalFocus_ = function () {
                    var e = document.activeElement,
                        t = this.player_.el_
                    ;(this.previouslyActiveEl_ = null), (!t.contains(e) && t !== e) || ((this.previouslyActiveEl_ = e), this.focus())
                }),
                (t.conditionalBlur_ = function () {
                    this.previouslyActiveEl_ && (this.previouslyActiveEl_.focus(), (this.previouslyActiveEl_ = null))
                }),
                (t.handleKeyDown = function (e) {
                    if ((e.stopPropagation(), ht.isEventKey(e, 'Escape') && this.closeable())) return e.preventDefault(), void this.close()
                    if (ht.isEventKey(e, 'Tab')) {
                        for (var t, i = this.focusableEls_(), n = this.el_.querySelector(':focus'), r = 0; r < i.length; r++)
                            if (n === i[r]) {
                                t = r
                                break
                            }
                        document.activeElement === this.el_ && (t = 0),
                            e.shiftKey && 0 === t ? (i[i.length - 1].focus(), e.preventDefault()) : e.shiftKey || t !== i.length - 1 || (i[0].focus(), e.preventDefault())
                    }
                }),
                (t.focusableEls_ = function () {
                    var e = this.el_.querySelectorAll('*')
                    return Array.prototype.filter.call(e, function (e) {
                        return (
                            ((e instanceof window.HTMLAnchorElement || e instanceof window.HTMLAreaElement) && e.hasAttribute('href')) ||
                            ((e instanceof window.HTMLInputElement || e instanceof window.HTMLSelectElement || e instanceof window.HTMLTextAreaElement || e instanceof window.HTMLButtonElement) &&
                                !e.hasAttribute('disabled')) ||
                            e instanceof window.HTMLIFrameElement ||
                            e instanceof window.HTMLObjectElement ||
                            e instanceof window.HTMLEmbedElement ||
                            (e.hasAttribute('tabindex') && -1 !== e.getAttribute('tabindex')) ||
                            e.hasAttribute('contenteditable')
                        )
                    })
                }),
                e
            )
        })(pt)
    ;(At.prototype.options_ = { pauseOnOpen: !0, temporary: !0 }), pt.registerComponent('ModalDialog', At)
    var Pt,
        Lt = (function (n) {
            function e(e) {
                var t
                void 0 === e && (e = []),
                    ((t = n.call(this) || this).tracks_ = []),
                    Object.defineProperty(ft(t), 'length', {
                        get: function () {
                            return this.tracks_.length
                        },
                    })
                for (var i = 0; i < e.length; i++) t.addTrack(e[i])
                return t
            }
            mt(e, n)
            var t = e.prototype
            return (
                (t.addTrack = function (e) {
                    var t = this,
                        i = this.tracks_.length
                    '' + i in this ||
                        Object.defineProperty(this, i, {
                            get: function () {
                                return this.tracks_[i]
                            },
                        }),
                        -1 === this.tracks_.indexOf(e) && (this.tracks_.push(e), this.trigger({ track: e, type: 'addtrack', target: this })),
                        (e.labelchange_ = function () {
                            t.trigger({ track: e, type: 'labelchange', target: t })
                        }),
                        it(e) && e.addEventListener('labelchange', e.labelchange_)
                }),
                (t.removeTrack = function (e) {
                    for (var t, i = 0, n = this.length; i < n; i++)
                        if (this[i] === e) {
                            ;(t = this[i]).off && t.off(), this.tracks_.splice(i, 1)
                            break
                        }
                    t && this.trigger({ track: t, type: 'removetrack', target: this })
                }),
                (t.getTrackById = function (e) {
                    for (var t = null, i = 0, n = this.length; i < n; i++) {
                        var r = this[i]
                        if (r.id === e) {
                            t = r
                            break
                        }
                    }
                    return t
                }),
                e
            )
        })(ze)
    for (Pt in ((Lt.prototype.allowedEvents_ = { change: 'change', addtrack: 'addtrack', removetrack: 'removetrack', labelchange: 'labelchange' }), Lt.prototype.allowedEvents_))
        Lt.prototype['on' + Pt] = null
    function Dt(e, t) {
        for (var i = 0; i < e.length; i++) Object.keys(e[i]).length && t.id !== e[i].id && (e[i].enabled = !1)
    }
    function Ot(e, t) {
        for (var i = 0; i < e.length; i++) Object.keys(e[i]).length && t.id !== e[i].id && (e[i].selected = !1)
    }
    function Mt(e) {
        var t = ['protocol', 'hostname', 'port', 'pathname', 'search', 'hash', 'host'],
            i = document.createElement('a')
        i.href = e
        for (var n = {}, r = 0; r < t.length; r++) n[t[r]] = i[t[r]]
        return (
            'http:' === n.protocol && (n.host = n.host.replace(/:80$/, '')),
            'https:' === n.protocol && (n.host = n.host.replace(/:443$/, '')),
            n.protocol || (n.protocol = window.location.protocol),
            n.host || (n.host = window.location.host),
            n
        )
    }
    function Rt(e) {
        var t
        return e.match(/^https?:\/\//) || (((t = document.createElement('a')).href = e), (e = t.href)), e
    }
    function Nt(e) {
        if ('string' == typeof e) {
            e = /^(\/?)([\s\S]*?)((?:\.{1,2}|[^\/]+?)(\.([^\.\/\?]+)))(?:[\/]*|[\?].*)$/.exec(e)
            if (e) return e.pop().toLowerCase()
        }
        return ''
    }
    function Ut(e, t) {
        return void 0 === t && (t = window.location), (':' === (e = Mt(e)).protocol ? t : e).protocol + e.host !== t.protocol + t.host
    }
    var Bt = (function (n) {
            function e(e) {
                for (var t, i = (e = void 0 === e ? [] : e).length - 1; 0 <= i; i--)
                    if (e[i].enabled) {
                        Dt(e, e[i])
                        break
                    }
                return ((t = n.call(this, e) || this).changing_ = !1), t
            }
            mt(e, n)
            var t = e.prototype
            return (
                (t.addTrack = function (e) {
                    var t = this
                    e.enabled && Dt(this, e),
                        n.prototype.addTrack.call(this, e),
                        e.addEventListener &&
                            ((e.enabledChange_ = function () {
                                t.changing_ || ((t.changing_ = !0), Dt(t, e), (t.changing_ = !1), t.trigger('change'))
                            }),
                            e.addEventListener('enabledchange', e.enabledChange_))
                }),
                (t.removeTrack = function (e) {
                    n.prototype.removeTrack.call(this, e), e.removeEventListener && e.enabledChange_ && (e.removeEventListener('enabledchange', e.enabledChange_), (e.enabledChange_ = null))
                }),
                e
            )
        })(Lt),
        Ft = (function (n) {
            function e(e) {
                for (var t, i = (e = void 0 === e ? [] : e).length - 1; 0 <= i; i--)
                    if (e[i].selected) {
                        Ot(e, e[i])
                        break
                    }
                return (
                    ((t = n.call(this, e) || this).changing_ = !1),
                    Object.defineProperty(ft(t), 'selectedIndex', {
                        get: function () {
                            for (var e = 0; e < this.length; e++) if (this[e].selected) return e
                            return -1
                        },
                        set: function () {},
                    }),
                    t
                )
            }
            mt(e, n)
            var t = e.prototype
            return (
                (t.addTrack = function (e) {
                    var t = this
                    e.selected && Ot(this, e),
                        n.prototype.addTrack.call(this, e),
                        e.addEventListener &&
                            ((e.selectedChange_ = function () {
                                t.changing_ || ((t.changing_ = !0), Ot(t, e), (t.changing_ = !1), t.trigger('change'))
                            }),
                            e.addEventListener('selectedchange', e.selectedChange_))
                }),
                (t.removeTrack = function (e) {
                    n.prototype.removeTrack.call(this, e), e.removeEventListener && e.selectedChange_ && (e.removeEventListener('selectedchange', e.selectedChange_), (e.selectedChange_ = null))
                }),
                e
            )
        })(Lt),
        k = (function (i) {
            function e() {
                return i.apply(this, arguments) || this
            }
            mt(e, i)
            var t = e.prototype
            return (
                (t.addTrack = function (e) {
                    var t = this
                    i.prototype.addTrack.call(this, e),
                        this.queueChange_ ||
                            (this.queueChange_ = function () {
                                return t.queueTrigger('change')
                            }),
                        this.triggerSelectedlanguagechange ||
                            (this.triggerSelectedlanguagechange_ = function () {
                                return t.trigger('selectedlanguagechange')
                            }),
                        e.addEventListener('modechange', this.queueChange_)
                    ;-1 === ['metadata', 'chapters'].indexOf(e.kind) && e.addEventListener('modechange', this.triggerSelectedlanguagechange_)
                }),
                (t.removeTrack = function (e) {
                    i.prototype.removeTrack.call(this, e),
                        e.removeEventListener &&
                            (this.queueChange_ && e.removeEventListener('modechange', this.queueChange_),
                            this.selectedlanguagechange_ && e.removeEventListener('modechange', this.triggerSelectedlanguagechange_))
                }),
                e
            )
        })(Lt),
        jt = (function () {
            function e(e) {
                void 0 === e && (e = []),
                    (this.trackElements_ = []),
                    Object.defineProperty(this, 'length', {
                        get: function () {
                            return this.trackElements_.length
                        },
                    })
                for (var t = 0, i = e.length; t < i; t++) this.addTrackElement_(e[t])
            }
            var t = e.prototype
            return (
                (t.addTrackElement_ = function (e) {
                    var t = this.trackElements_.length
                    '' + t in this ||
                        Object.defineProperty(this, t, {
                            get: function () {
                                return this.trackElements_[t]
                            },
                        }),
                        -1 === this.trackElements_.indexOf(e) && this.trackElements_.push(e)
                }),
                (t.getTrackElementByTrack_ = function (e) {
                    for (var t, i = 0, n = this.trackElements_.length; i < n; i++)
                        if (e === this.trackElements_[i].track) {
                            t = this.trackElements_[i]
                            break
                        }
                    return t
                }),
                (t.removeTrackElement_ = function (e) {
                    for (var t = 0, i = this.trackElements_.length; t < i; t++)
                        if (e === this.trackElements_[t]) {
                            this.trackElements_[t].track && 'function' == typeof this.trackElements_[t].track.off && this.trackElements_[t].track.off(),
                                'function' == typeof this.trackElements_[t].off && this.trackElements_[t].off(),
                                this.trackElements_.splice(t, 1)
                            break
                        }
                }),
                e
            )
        })(),
        Ht = (function () {
            function t(e) {
                t.prototype.setCues_.call(this, e),
                    Object.defineProperty(this, 'length', {
                        get: function () {
                            return this.length_
                        },
                    })
            }
            var e = t.prototype
            return (
                (e.setCues_ = function (e) {
                    var t = this.length || 0,
                        i = 0,
                        n = e.length
                    ;(this.cues_ = e), (this.length_ = e.length)
                    function r(e) {
                        '' + e in this ||
                            Object.defineProperty(this, '' + e, {
                                get: function () {
                                    return this.cues_[e]
                                },
                            })
                    }
                    if (t < n) for (i = t; i < n; i++) r.call(this, i)
                }),
                (e.getCueById = function (e) {
                    for (var t = null, i = 0, n = this.length; i < n; i++) {
                        var r = this[i]
                        if (r.id === e) {
                            t = r
                            break
                        }
                    }
                    return t
                }),
                t
            )
        })(),
        qt = { alternative: 'alternative', captions: 'captions', main: 'main', sign: 'sign', subtitles: 'subtitles', commentary: 'commentary' },
        Vt = { alternative: 'alternative', descriptions: 'descriptions', main: 'main', 'main-desc': 'main-desc', translation: 'translation', commentary: 'commentary' },
        Wt = { subtitles: 'subtitles', captions: 'captions', descriptions: 'descriptions', chapters: 'chapters', metadata: 'metadata' },
        Gt = { disabled: 'disabled', hidden: 'hidden', showing: 'showing' },
        C = (function (a) {
            function e(e) {
                void 0 === e && (e = {})
                var t,
                    i = a.call(this) || this,
                    n = { id: e.id || 'vjs_track_' + Pe++, kind: e.kind || '', language: e.language || '' },
                    r = e.label || ''
                for (t in n)
                    !(function (e) {
                        Object.defineProperty(ft(i), e, {
                            get: function () {
                                return n[e]
                            },
                            set: function () {},
                        })
                    })(t)
                return (
                    Object.defineProperty(ft(i), 'label', {
                        get: function () {
                            return r
                        },
                        set: function (e) {
                            e !== r && ((r = e), this.trigger('labelchange'))
                        },
                    }),
                    i
                )
            }
            return mt(e, a), e
        })(ze),
        zt = Object.freeze({ __proto__: null, parseUrl: Mt, getAbsoluteURL: Rt, getFileExtension: Nt, isCrossOrigin: Ut }),
        Xt = 'undefined' != typeof window ? window : 'undefined' != typeof f ? f : 'undefined' != typeof self ? self : {},
        Kt = Xt,
        Yt = function (e) {
            if (!e) return !1
            var t = Qt.call(e)
            return (
                '[object Function]' === t ||
                ('function' == typeof e && '[object RegExp]' !== t) ||
                ('undefined' != typeof window && (e === window.setTimeout || e === window.alert || e === window.confirm || e === window.prompt))
            )
        },
        Qt = Object.prototype.toString
    ei.httpHandler = function (n, r) {
        return (
            void 0 === r && (r = !1),
            function (e, t, i) {
                if (e) n(e)
                else if (400 <= t.statusCode && t.statusCode <= 599) {
                    e = i
                    if (r)
                        if (Kt.TextDecoder) {
                            t = (function (e) {
                                void 0 === e && (e = '')
                                return e
                                    .toLowerCase()
                                    .split(';')
                                    .reduce(function (e, t) {
                                        var i = t.split('='),
                                            t = i[0],
                                            i = i[1]
                                        return 'charset' === t.trim() ? i.trim() : e
                                    }, 'utf-8')
                            })(t.headers && t.headers['content-type'])
                            try {
                                e = new TextDecoder(t).decode(i)
                            } catch (e) {}
                        } else e = String.fromCharCode.apply(null, new Uint8Array(i))
                    n({ cause: e })
                } else n(null, i)
            }
        )
    }
    /**
     * @license
     * slighly modified parse-headers 2.0.2 <https://github.com/kesla/parse-headers/>
     * Copyright (c) 2014 David Björklund
     * Available under the MIT license
     * <https://github.com/kesla/parse-headers/blob/master/LICENCE>
     */
    var $t = function (e) {
            var n = {}
            return (
                e &&
                    e
                        .trim()
                        .split('\n')
                        .forEach(function (e) {
                            var t = e.indexOf(':'),
                                i = e.slice(0, t).trim().toLowerCase(),
                                t = e.slice(t + 1).trim()
                            'undefined' == typeof n[i] ? (n[i] = t) : Array.isArray(n[i]) ? n[i].push(t) : (n[i] = [n[i], t])
                        }),
                n
            )
        },
        Jt = ei,
        I = ei
    function Zt(e, t, i) {
        var n = e
        return Yt(t) ? ((i = t), 'string' == typeof e && (n = { uri: e })) : (n = g({}, t, { uri: e })), (n.callback = i), n
    }
    function ei(e, t, i) {
        return ti((t = Zt(e, t, i)))
    }
    function ti(n) {
        if ('undefined' == typeof n.callback) throw new Error('callback argument missing')
        var r = !1,
            a = function (e, t, i) {
                r || ((r = !0), n.callback(e, t, i))
            }
        function s() {
            var e = void 0,
                e =
                    l.response ||
                    l.responseText ||
                    (function (e) {
                        try {
                            if ('document' === e.responseType) return e.responseXML
                            var t = e.responseXML && 'parsererror' === e.responseXML.documentElement.nodeName
                            if ('' === e.responseType && !t) return e.responseXML
                        } catch (e) {}
                        return null
                    })(l)
            if (m)
                try {
                    e = JSON.parse(e)
                } catch (e) {}
            return e
        }
        function t(e) {
            return clearTimeout(u), ((e = !(e instanceof Error) ? new Error('' + (e || 'Unknown XMLHttpRequest Error')) : e).statusCode = 0), a(e, g)
        }
        function e() {
            if (!o) {
                clearTimeout(u)
                var e = n.useXDR && void 0 === l.status ? 200 : 1223 === l.status ? 204 : l.status,
                    t = g,
                    i = null
                return (
                    0 !== e
                        ? ((t = { body: s(), statusCode: e, method: d, headers: {}, url: c, rawRequest: l }), l.getAllResponseHeaders && (t.headers = $t(l.getAllResponseHeaders())))
                        : (i = new Error('Internal XMLHttpRequest Error')),
                    a(i, t, t.body)
                )
            }
        }
        var i,
            o,
            u,
            l = n.xhr || null,
            c = ((l = l || new (n.cors || n.useXDR ? ei.XDomainRequest : ei.XMLHttpRequest)()).url = n.uri || n.url),
            d = (l.method = n.method || 'GET'),
            h = n.body || n.data,
            p = (l.headers = n.headers || {}),
            f = !!n.sync,
            m = !1,
            g = { body: void 0, headers: {}, statusCode: 0, method: d, url: c, rawRequest: l }
        if (
            ('json' in n &&
                !1 !== n.json &&
                ((m = !0),
                p.accept || p.Accept || (p.Accept = 'application/json'),
                'GET' !== d && 'HEAD' !== d && (p['content-type'] || p['Content-Type'] || (p['Content-Type'] = 'application/json'), (h = JSON.stringify(!0 === n.json ? h : n.json)))),
            (l.onreadystatechange = function () {
                4 === l.readyState && setTimeout(e, 0)
            }),
            (l.onload = e),
            (l.onerror = t),
            (l.onprogress = function () {}),
            (l.onabort = function () {
                o = !0
            }),
            (l.ontimeout = t),
            l.open(d, c, !f, n.username, n.password),
            f || (l.withCredentials = !!n.withCredentials),
            !f &&
                0 < n.timeout &&
                (u = setTimeout(function () {
                    var e
                    o || ((o = !0), l.abort('timeout'), ((e = new Error('XMLHttpRequest timeout')).code = 'ETIMEDOUT'), t(e))
                }, n.timeout)),
            l.setRequestHeader)
        )
            for (i in p) p.hasOwnProperty(i) && l.setRequestHeader(i, p[i])
        else if (
            n.headers &&
            !(function (e) {
                for (var t in e) if (e.hasOwnProperty(t)) return
                return 1
            })(n.headers)
        )
            throw new Error('Headers cannot be set on an XDomainRequest object')
        return 'responseType' in n && (l.responseType = n.responseType), 'beforeSend' in n && 'function' == typeof n.beforeSend && n.beforeSend(l), l.send(h || null), l
    }
    ;(ei.XMLHttpRequest = Kt.XMLHttpRequest || function () {}),
        (ei.XDomainRequest = 'withCredentials' in new ei.XMLHttpRequest() ? ei.XMLHttpRequest : Kt.XDomainRequest),
        (function (e, t) {
            for (var i = 0; i < e.length; i++) t(e[i])
        })(['get', 'put', 'post', 'patch', 'head', 'delete'], function (n) {
            ei['delete' === n ? 'del' : n] = function (e, t, i) {
                return ((t = Zt(e, t, i)).method = n.toUpperCase()), ti(t)
            }
        }),
        (Jt.default = I)
    function ii(e, t) {
        var i = new window.WebVTT.Parser(window, window.vttjs, window.WebVTT.StringDecoder()),
            n = []
        ;(i.oncue = function (e) {
            t.addCue(e)
        }),
            (i.onparsingerror = function (e) {
                n.push(e)
            }),
            (i.onflush = function () {
                t.trigger({ type: 'loadeddata', target: t })
            }),
            i.parse(e),
            0 < n.length &&
                (window.console && window.console.groupCollapsed && window.console.groupCollapsed('Text Track parsing errors for ' + t.src),
                n.forEach(function (e) {
                    return h.error(e)
                }),
                window.console && window.console.groupEnd && window.console.groupEnd()),
            i.flush()
    }
    function ni(e, n) {
        var t = { uri: e }
        ;(e = Ut(e)) && (t.cors = e),
            (e = 'use-credentials' === n.tech_.crossOrigin()) && (t.withCredentials = e),
            Jt(
                t,
                Ve(this, function (e, t, i) {
                    return e
                        ? h.error(e, t)
                        : ((n.loaded_ = !0),
                          void ('function' != typeof window.WebVTT
                              ? n.tech_ &&
                                n.tech_.any(['vttjsloaded', 'vttjserror'], function (e) {
                                    return 'vttjserror' !== e.type ? ii(i, n) : void h.error('vttjs failed to load, stopping trying to process ' + n.src)
                                })
                              : ii(i, n)))
                })
            )
    }
    var ri = (function (a) {
        function e(e) {
            var t
            if (!(e = void 0 === e ? {} : e).tech) throw new Error('A tech was not provided.')
            var e = lt(e, { kind: Wt[e.kind] || 'subtitles', language: e.language || e.srclang || '' }),
                i = Gt[e.mode] || 'disabled',
                n = e.default
            ;('metadata' !== e.kind && 'chapters' !== e.kind) || (i = 'hidden'),
                ((t = a.call(this, e) || this).tech_ = e.tech),
                (t.cues_ = []),
                (t.activeCues_ = []),
                (t.preload_ = !1 !== t.tech_.preloadTextTracks)
            var r = new Ht(t.cues_),
                s = new Ht(t.activeCues_),
                o = !1
            t.timeupdateHandler = Ve(ft(t), function () {
                this.tech_.isDisposed() ||
                    (this.tech_.isReady_ && ((this.activeCues = this.activeCues), o && (this.trigger('cuechange'), (o = !1))),
                    (this.rvf_ = this.tech_.requestVideoFrameCallback(this.timeupdateHandler)))
            })
            return (
                t.tech_.one('dispose', function () {
                    t.stopTracking()
                }),
                'disabled' !== i && t.startTracking(),
                Object.defineProperties(ft(t), {
                    default: {
                        get: function () {
                            return n
                        },
                        set: function () {},
                    },
                    mode: {
                        get: function () {
                            return i
                        },
                        set: function (e) {
                            Gt[e] &&
                                i !== e &&
                                ((i = e),
                                this.preload_ || 'disabled' === i || 0 !== this.cues.length || ni(this.src, this),
                                this.stopTracking(),
                                'disabled' !== i && this.startTracking(),
                                this.trigger('modechange'))
                        },
                    },
                    cues: {
                        get: function () {
                            return this.loaded_ ? r : null
                        },
                        set: function () {},
                    },
                    activeCues: {
                        get: function () {
                            if (!this.loaded_) return null
                            if (0 === this.cues.length) return s
                            for (var e = this.tech_.currentTime(), t = [], i = 0, n = this.cues.length; i < n; i++) {
                                var r = this.cues[i]
                                ;((r.startTime <= e && r.endTime >= e) || (r.startTime === r.endTime && r.startTime <= e && r.startTime + 0.5 >= e)) && t.push(r)
                            }
                            if (((o = !1), t.length !== this.activeCues_.length)) o = !0
                            else for (var a = 0; a < t.length; a++) -1 === this.activeCues_.indexOf(t[a]) && (o = !0)
                            return (this.activeCues_ = t), s.setCues_(this.activeCues_), s
                        },
                        set: function () {},
                    },
                }),
                e.src ? ((t.src = e.src), t.preload_ || (t.loaded_ = !0), (t.preload_ || ('subtitles' !== e.kind && 'captions' !== e.kind)) && ni(t.src, ft(t))) : (t.loaded_ = !0),
                t
            )
        }
        mt(e, a)
        var t = e.prototype
        return (
            (t.startTracking = function () {
                this.rvf_ = this.tech_.requestVideoFrameCallback(this.timeupdateHandler)
            }),
            (t.stopTracking = function () {
                this.rvf_ && (this.tech_.cancelVideoFrameCallback(this.rvf_), (this.rvf_ = void 0))
            }),
            (t.addCue = function (e) {
                var t = e
                if (window.vttjs && !(e instanceof window.vttjs.VTTCue)) {
                    for (var i in ((t = new window.vttjs.VTTCue(e.startTime, e.endTime, e.text)), e)) i in t || (t[i] = e[i])
                    ;(t.id = e.id), (t.originalCue_ = e)
                }
                for (var n = this.tech_.textTracks(), r = 0; r < n.length; r++) n[r] !== this && n[r].removeCue(t)
                this.cues_.push(t), this.cues.setCues_(this.cues_)
            }),
            (t.removeCue = function (e) {
                for (var t = this.cues_.length; t--; ) {
                    var i = this.cues_[t]
                    if (i === e || (i.originalCue_ && i.originalCue_ === e)) {
                        this.cues_.splice(t, 1), this.cues.setCues_(this.cues_)
                        break
                    }
                }
            }),
            e
        )
    })(C)
    ri.prototype.allowedEvents_ = { cuechange: 'cuechange' }
    ;(x = (function (n) {
        function e(e) {
            var t = lt((e = void 0 === e ? {} : e), { kind: Vt[e.kind] || '' }),
                e = n.call(this, t) || this,
                i = !1
            return (
                Object.defineProperty(ft(e), 'enabled', {
                    get: function () {
                        return i
                    },
                    set: function (e) {
                        'boolean' == typeof e && e !== i && ((i = e), this.trigger('enabledchange'))
                    },
                }),
                t.enabled && (e.enabled = t.enabled),
                (e.loaded_ = !0),
                e
            )
        }
        return mt(e, n), e
    })(C)),
        (U = (function (n) {
            function e(e) {
                var t = lt((e = void 0 === e ? {} : e), { kind: qt[e.kind] || '' }),
                    e = n.call(this, t) || this,
                    i = !1
                return (
                    Object.defineProperty(ft(e), 'selected', {
                        get: function () {
                            return i
                        },
                        set: function (e) {
                            'boolean' == typeof e && e !== i && ((i = e), this.trigger('selectedchange'))
                        },
                    }),
                    t.selected && (e.selected = t.selected),
                    e
                )
            }
            return mt(e, n), e
        })(C)),
        (j = (function (r) {
            function e(e) {
                var t
                void 0 === e && (e = {})
                var i = r.call(this) || this,
                    n = new ri(e)
                return (
                    (i.kind = n.kind),
                    (i.src = n.src),
                    (i.srclang = n.language),
                    (i.label = n.label),
                    (i.default = n.default),
                    Object.defineProperties(ft(i), {
                        readyState: {
                            get: function () {
                                return t
                            },
                        },
                        track: {
                            get: function () {
                                return n
                            },
                        },
                    }),
                    (t = 0),
                    n.addEventListener('loadeddata', function () {
                        ;(t = 2), i.trigger({ type: 'load', target: ft(i) })
                    }),
                    i
                )
            }
            return mt(e, r), e
        })(ze))
    ;(j.prototype.allowedEvents_ = { load: 'load' }), (j.NONE = 0), (j.LOADING = 1), (j.LOADED = 2), (j.ERROR = 3)
    var ai = {
        audio: { ListClass: Bt, TrackClass: x, capitalName: 'Audio' },
        video: { ListClass: Ft, TrackClass: U, capitalName: 'Video' },
        text: { ListClass: k, TrackClass: ri, capitalName: 'Text' },
    }
    Object.keys(ai).forEach(function (e) {
        ;(ai[e].getterName = e + 'Tracks'), (ai[e].privateName = e + 'Tracks_')
    })
    var si = {
            remoteText: { ListClass: k, TrackClass: ri, capitalName: 'RemoteText', getterName: 'remoteTextTracks', privateName: 'remoteTextTracks_' },
            remoteTextEl: { ListClass: jt, TrackClass: j, capitalName: 'RemoteTextTrackEls', getterName: 'remoteTextTrackEls', privateName: 'remoteTextTrackEls_' },
        },
        oi = g({}, ai, si)
    ;(si.names = Object.keys(si)), (ai.names = Object.keys(ai)), (oi.names = [].concat(si.names).concat(ai.names))
    var ui = 'undefined' != typeof f ? f : 'undefined' != typeof window ? window : {},
        li = 'undefined' != typeof document ? document : (li = ui['__GLOBAL_DOCUMENT_CACHE@4']) || (ui['__GLOBAL_DOCUMENT_CACHE@4'] = {}),
        Xt = li,
        ci =
            Object.create ||
            function (e) {
                if (1 !== arguments.length) throw new Error('Object.create shim only accepts one parameter.')
                return (di.prototype = e), new di()
            }
    function di() {}
    function hi(e, t) {
        ;(this.name = 'ParsingError'), (this.code = e.code), (this.message = t || e.message)
    }
    function pi(e) {
        function t(e, t, i, n) {
            return 3600 * (0 | e) + 60 * (0 | t) + (0 | i) + (0 | n) / 1e3
        }
        e = e.match(/^(\d+):(\d{1,2})(:\d{1,2})?\.(\d{3})/)
        return e ? (e[3] ? t(e[1], e[2], e[3].replace(':', ''), e[4]) : 59 < e[1] ? t(e[1], e[2], 0, e[4]) : t(0, e[1], e[2], e[4])) : null
    }
    function fi() {
        this.values = ci(null)
    }
    function mi(e, t, i, n) {
        var r,
            a,
            s = n ? e.split(n) : [e]
        for (r in s) 'string' == typeof s[r] && 2 === (a = s[r].split(i)).length && t(a[0], a[1])
    }
    function gi(t, e, s) {
        var i = t
        function n() {
            var e = pi(t)
            if (null === e) throw new hi(hi.Errors.BadTimeStamp, 'Malformed timestamp: ' + i)
            return (t = t.replace(/^[^\sa-zA-Z-]+/, '')), e
        }
        function r() {
            t = t.replace(/^\s+/, '')
        }
        if ((r(), (e.startTime = n()), r(), '--\x3e' !== t.substr(0, 3))) throw new hi(hi.Errors.BadTimeStamp, "Malformed time stamp (time stamps must be separated by '--\x3e'): " + i)
        ;(t = t.substr(3)),
            r(),
            (e.endTime = n()),
            r(),
            (function (e, t) {
                var a = new fi()
                mi(
                    e,
                    function (e, t) {
                        switch (e) {
                            case 'region':
                                for (var i = s.length - 1; 0 <= i; i--)
                                    if (s[i].id === t) {
                                        a.set(e, s[i].region)
                                        break
                                    }
                                break
                            case 'vertical':
                                a.alt(e, t, ['rl', 'lr'])
                                break
                            case 'line':
                                var n = t.split(','),
                                    r = n[0]
                                a.integer(e, r), a.percent(e, r) && a.set('snapToLines', !1), a.alt(e, r, ['auto']), 2 === n.length && a.alt('lineAlign', n[1], ['start', 'center', 'end'])
                                break
                            case 'position':
                                ;(n = t.split(',')), a.percent(e, n[0]), 2 === n.length && a.alt('positionAlign', n[1], ['start', 'center', 'end'])
                                break
                            case 'size':
                                a.percent(e, t)
                                break
                            case 'align':
                                a.alt(e, t, ['start', 'center', 'end', 'left', 'right'])
                        }
                    },
                    /:/,
                    /\s/
                ),
                    (t.region = a.get('region', null)),
                    (t.vertical = a.get('vertical', ''))
                try {
                    t.line = a.get('line', 'auto')
                } catch (e) {}
                ;(t.lineAlign = a.get('lineAlign', 'start')), (t.snapToLines = a.get('snapToLines', !0)), (t.size = a.get('size', 100))
                try {
                    t.align = a.get('align', 'center')
                } catch (e) {
                    t.align = a.get('align', 'middle')
                }
                try {
                    t.position = a.get('position', 'auto')
                } catch (e) {
                    t.position = a.get('position', { start: 0, left: 0, center: 50, middle: 50, end: 100, right: 100 }, t.align)
                }
                t.positionAlign = a.get('positionAlign', { start: 'start', left: 'start', center: 'center', middle: 'center', end: 'end', right: 'end' }, t.align)
            })(t, e)
    }
    ;(((hi.prototype = ci(Error.prototype)).constructor = hi).Errors = {
        BadSignature: { code: 0, message: 'Malformed WebVTT signature.' },
        BadTimeStamp: { code: 1, message: 'Malformed time stamp.' },
    }),
        (fi.prototype = {
            set: function (e, t) {
                this.get(e) || '' === t || (this.values[e] = t)
            },
            get: function (e, t, i) {
                return i ? (this.has(e) ? this.values[e] : t[i]) : this.has(e) ? this.values[e] : t
            },
            has: function (e) {
                return e in this.values
            },
            alt: function (e, t, i) {
                for (var n = 0; n < i.length; ++n)
                    if (t === i[n]) {
                        this.set(e, t)
                        break
                    }
            },
            integer: function (e, t) {
                ;/^-?\d+$/.test(t) && this.set(e, parseInt(t, 10))
            },
            percent: function (e, t) {
                return !!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/) && 0 <= (t = parseFloat(t)) && t <= 100) && (this.set(e, t), !0)
            },
        })
    var yi = Xt.createElement && Xt.createElement('textarea'),
        vi = { c: 'span', i: 'i', b: 'b', u: 'u', ruby: 'ruby', rt: 'rt', v: 'span', lang: 'span' },
        _i = {
            white: 'rgba(255,255,255,1)',
            lime: 'rgba(0,255,0,1)',
            cyan: 'rgba(0,255,255,1)',
            red: 'rgba(255,0,0,1)',
            yellow: 'rgba(255,255,0,1)',
            magenta: 'rgba(255,0,255,1)',
            blue: 'rgba(0,0,255,1)',
            black: 'rgba(0,0,0,1)',
        },
        bi = { v: 'title', lang: 'lang' },
        Ti = { rt: 'ruby' }
    function Si(e, t) {
        for (
            var i, n, r, a, s, o, u, l, c, d, h = e.document.createElement('div'), p = h, f = [];
            null !==
            (i = (function () {
                if (!t) return null
                var e = t.match(/^([^<]*)(<[^>]*>?)?/)
                return (e = e[1] || e[2]), (t = t.substr(e.length)), e
            })());

        )
            '<' !== i[0]
                ? p.appendChild(e.document.createTextNode(((s = i), (yi.innerHTML = s), (s = yi.textContent), (yi.textContent = ''), s)))
                : '/' !== i[1]
                ? (a = pi(i.substr(1, i.length - 2)))
                    ? ((n = e.document.createProcessingInstruction('timestamp', a)), p.appendChild(n))
                    : (r = i.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/)) &&
                      ((l = r[1]),
                      (c = r[3]),
                      (d = void 0),
                      (d = vi[l]),
                      (n = d ? ((d = e.document.createElement(d)), (l = bi[l]) && c && (d[l] = c.trim()), d) : null) &&
                          ((o = p),
                          (Ti[(u = n).localName] && Ti[u.localName] !== o.localName) ||
                              (r[2] &&
                                  ((a = r[2].split('.')).forEach(function (e) {
                                      var t = /^bg_/.test(e),
                                          e = t ? e.slice(3) : e
                                      _i.hasOwnProperty(e) && ((e = _i[e]), (n.style[t ? 'background-color' : 'color'] = e))
                                  }),
                                  (n.className = a.join(' '))),
                              f.push(r[1]),
                              p.appendChild(n),
                              (p = n))))
                : f.length && f[f.length - 1] === i.substr(2).replace('>', '') && (f.pop(), (p = p.parentNode))
        return h
    }
    var wi = [
        [1470, 1470],
        [1472, 1472],
        [1475, 1475],
        [1478, 1478],
        [1488, 1514],
        [1520, 1524],
        [1544, 1544],
        [1547, 1547],
        [1549, 1549],
        [1563, 1563],
        [1566, 1610],
        [1645, 1647],
        [1649, 1749],
        [1765, 1766],
        [1774, 1775],
        [1786, 1805],
        [1807, 1808],
        [1810, 1839],
        [1869, 1957],
        [1969, 1969],
        [1984, 2026],
        [2036, 2037],
        [2042, 2042],
        [2048, 2069],
        [2074, 2074],
        [2084, 2084],
        [2088, 2088],
        [2096, 2110],
        [2112, 2136],
        [2142, 2142],
        [2208, 2208],
        [2210, 2220],
        [8207, 8207],
        [64285, 64285],
        [64287, 64296],
        [64298, 64310],
        [64312, 64316],
        [64318, 64318],
        [64320, 64321],
        [64323, 64324],
        [64326, 64449],
        [64467, 64829],
        [64848, 64911],
        [64914, 64967],
        [65008, 65020],
        [65136, 65140],
        [65142, 65276],
        [67584, 67589],
        [67592, 67592],
        [67594, 67637],
        [67639, 67640],
        [67644, 67644],
        [67647, 67669],
        [67671, 67679],
        [67840, 67867],
        [67872, 67897],
        [67903, 67903],
        [67968, 68023],
        [68030, 68031],
        [68096, 68096],
        [68112, 68115],
        [68117, 68119],
        [68121, 68147],
        [68160, 68167],
        [68176, 68184],
        [68192, 68223],
        [68352, 68405],
        [68416, 68437],
        [68440, 68466],
        [68472, 68479],
        [68608, 68680],
        [126464, 126467],
        [126469, 126495],
        [126497, 126498],
        [126500, 126500],
        [126503, 126503],
        [126505, 126514],
        [126516, 126519],
        [126521, 126521],
        [126523, 126523],
        [126530, 126530],
        [126535, 126535],
        [126537, 126537],
        [126539, 126539],
        [126541, 126543],
        [126545, 126546],
        [126548, 126548],
        [126551, 126551],
        [126553, 126553],
        [126555, 126555],
        [126557, 126557],
        [126559, 126559],
        [126561, 126562],
        [126564, 126564],
        [126567, 126570],
        [126572, 126578],
        [126580, 126583],
        [126585, 126588],
        [126590, 126590],
        [126592, 126601],
        [126603, 126619],
        [126625, 126627],
        [126629, 126633],
        [126635, 126651],
        [1114109, 1114109],
    ]
    function Ei(e) {
        var t = [],
            i = ''
        if (!e || !e.childNodes) return 'ltr'
        function a(e, t) {
            for (var i = t.childNodes.length - 1; 0 <= i; i--) e.push(t.childNodes[i])
        }
        for (
            a(t, e);
            (i = (function e(t) {
                if (!t || !t.length) return null
                var i = t.pop(),
                    n = i.textContent || i.innerText
                if (n) {
                    var r = n.match(/^.*(\n|\r)/)
                    return r ? r[(t.length = 0)] : n
                }
                return 'ruby' === i.tagName ? e(t) : i.childNodes ? (a(t, i), e(t)) : void 0
            })(t));

        )
            for (var n = 0; n < i.length; n++)
                if (
                    (function (e) {
                        for (var t = 0; t < wi.length; t++) {
                            var i = wi[t]
                            if (e >= i[0] && e <= i[1]) return 1
                        }
                    })(i.charCodeAt(n))
                )
                    return 'rtl'
        return 'ltr'
    }
    function ki() {}
    function Ci(e, t, i) {
        ki.call(this), (this.cue = t), (this.cueDiv = Si(e, t.text))
        var n = {
            color: 'rgba(255, 255, 255, 1)',
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            position: 'relative',
            left: 0,
            right: 0,
            top: 0,
            bottom: 0,
            display: 'inline',
            writingMode: '' === t.vertical ? 'horizontal-tb' : 'lr' === t.vertical ? 'vertical-lr' : 'vertical-rl',
            unicodeBidi: 'plaintext',
        }
        this.applyStyles(n, this.cueDiv),
            (this.div = e.document.createElement('div')),
            (n = {
                direction: Ei(this.cueDiv),
                writingMode: '' === t.vertical ? 'horizontal-tb' : 'lr' === t.vertical ? 'vertical-lr' : 'vertical-rl',
                unicodeBidi: 'plaintext',
                textAlign: 'middle' === t.align ? 'center' : t.align,
                font: i.font,
                whiteSpace: 'pre-line',
                position: 'absolute',
            }),
            this.applyStyles(n),
            this.div.appendChild(this.cueDiv)
        var r = 0
        switch (t.positionAlign) {
            case 'start':
                r = t.position
                break
            case 'center':
                r = t.position - t.size / 2
                break
            case 'end':
                r = t.position - t.size
        }
        '' === t.vertical
            ? this.applyStyles({ left: this.formatStyle(r, '%'), width: this.formatStyle(t.size, '%') })
            : this.applyStyles({ top: this.formatStyle(r, '%'), height: this.formatStyle(t.size, '%') }),
            (this.move = function (e) {
                this.applyStyles({
                    top: this.formatStyle(e.top, 'px'),
                    bottom: this.formatStyle(e.bottom, 'px'),
                    left: this.formatStyle(e.left, 'px'),
                    right: this.formatStyle(e.right, 'px'),
                    height: this.formatStyle(e.height, 'px'),
                    width: this.formatStyle(e.width, 'px'),
                })
            })
    }
    function Ii(e) {
        var t, i, n, r
        e.div &&
            ((t = e.div.offsetHeight),
            (i = e.div.offsetWidth),
            (n = e.div.offsetTop),
            (r = (r = e.div.childNodes) && (r = r[0]) && r.getClientRects && r.getClientRects()),
            (e = e.div.getBoundingClientRect()),
            (r = r ? Math.max((r[0] && r[0].height) || 0, e.height / r.length) : 0)),
            (this.left = e.left),
            (this.right = e.right),
            (this.top = e.top || n),
            (this.height = e.height || t),
            (this.bottom = e.bottom || n + (e.height || t)),
            (this.width = e.width || i),
            (this.lineHeight = void 0 !== r ? r : e.lineHeight)
    }
    function xi(e, t, o, u) {
        var i,
            n = new Ii(t),
            r = t.cue,
            a = (function (e) {
                if ('number' == typeof e.line && (e.snapToLines || (0 <= e.line && e.line <= 100))) return e.line
                if (!e.track || !e.track.textTrackList || !e.track.textTrackList.mediaElement) return -1
                for (var t = e.track, i = t.textTrackList, n = 0, r = 0; r < i.length && i[r] !== t; r++) 'showing' === i[r].mode && n++
                return -1 * ++n
            })(r),
            s = []
        if (r.snapToLines) {
            switch (r.vertical) {
                case '':
                    ;(s = ['+y', '-y']), (i = 'height')
                    break
                case 'rl':
                    ;(s = ['+x', '-x']), (i = 'width')
                    break
                case 'lr':
                    ;(s = ['-x', '+x']), (i = 'width')
            }
            var l = n.lineHeight,
                c = l * Math.round(a),
                d = o[i] + l,
                h = s[0]
            Math.abs(c) > d && ((c = c < 0 ? -1 : 1), (c *= Math.ceil(d / l) * l)), a < 0 && ((c += '' === r.vertical ? o.height : o.width), (s = s.reverse())), n.move(h, c)
        } else {
            var p = (n.lineHeight / o.height) * 100
            switch (r.lineAlign) {
                case 'center':
                    a -= p / 2
                    break
                case 'end':
                    a -= p
            }
            switch (r.vertical) {
                case '':
                    t.applyStyles({ top: t.formatStyle(a, '%') })
                    break
                case 'rl':
                    t.applyStyles({ left: t.formatStyle(a, '%') })
                    break
                case 'lr':
                    t.applyStyles({ right: t.formatStyle(a, '%') })
            }
            ;(s = ['+y', '-x', '+x', '-y']), (n = new Ii(t))
        }
        n = (function (e, t) {
            for (var i, n = new Ii(e), r = 1, a = 0; a < t.length; a++) {
                for (; e.overlapsOppositeAxis(o, t[a]) || (e.within(o) && e.overlapsAny(u)); ) e.move(t[a])
                if (e.within(o)) return e
                var s = e.intersectPercentage(o)
                s < r && ((i = new Ii(e)), (r = s)), (e = new Ii(n))
            }
            return i || n
        })(n, s)
        t.move(n.toCSSCompatValues(o))
    }
    function Ai() {}
    ;(ki.prototype.applyStyles = function (e, t) {
        for (var i in ((t = t || this.div), e)) e.hasOwnProperty(i) && (t.style[i] = e[i])
    }),
        (ki.prototype.formatStyle = function (e, t) {
            return 0 === e ? 0 : e + t
        }),
        ((Ci.prototype = ci(ki.prototype)).constructor = Ci),
        (Ii.prototype.move = function (e, t) {
            switch (((t = void 0 !== t ? t : this.lineHeight), e)) {
                case '+x':
                    ;(this.left += t), (this.right += t)
                    break
                case '-x':
                    ;(this.left -= t), (this.right -= t)
                    break
                case '+y':
                    ;(this.top += t), (this.bottom += t)
                    break
                case '-y':
                    ;(this.top -= t), (this.bottom -= t)
            }
        }),
        (Ii.prototype.overlaps = function (e) {
            return this.left < e.right && this.right > e.left && this.top < e.bottom && this.bottom > e.top
        }),
        (Ii.prototype.overlapsAny = function (e) {
            for (var t = 0; t < e.length; t++) if (this.overlaps(e[t])) return !0
            return !1
        }),
        (Ii.prototype.within = function (e) {
            return this.top >= e.top && this.bottom <= e.bottom && this.left >= e.left && this.right <= e.right
        }),
        (Ii.prototype.overlapsOppositeAxis = function (e, t) {
            switch (t) {
                case '+x':
                    return this.left < e.left
                case '-x':
                    return this.right > e.right
                case '+y':
                    return this.top < e.top
                case '-y':
                    return this.bottom > e.bottom
            }
        }),
        (Ii.prototype.intersectPercentage = function (e) {
            return (Math.max(0, Math.min(this.right, e.right) - Math.max(this.left, e.left)) * Math.max(0, Math.min(this.bottom, e.bottom) - Math.max(this.top, e.top))) / (this.height * this.width)
        }),
        (Ii.prototype.toCSSCompatValues = function (e) {
            return { top: this.top - e.top, bottom: e.bottom - this.bottom, left: this.left - e.left, right: e.right - this.right, height: this.height, width: this.width }
        }),
        (Ii.getSimpleBoxPosition = function (e) {
            var t = e.div ? e.div.offsetHeight : e.tagName ? e.offsetHeight : 0,
                i = e.div ? e.div.offsetWidth : e.tagName ? e.offsetWidth : 0,
                n = e.div ? e.div.offsetTop : e.tagName ? e.offsetTop : 0
            return {
                left: (e = e.div ? e.div.getBoundingClientRect() : e.tagName ? e.getBoundingClientRect() : e).left,
                right: e.right,
                top: e.top || n,
                height: e.height || t,
                bottom: e.bottom || n + (e.height || t),
                width: e.width || i,
            }
        }),
        (Ai.StringDecoder = function () {
            return {
                decode: function (e) {
                    if (!e) return ''
                    if ('string' != typeof e) throw new Error('Error - expected string data.')
                    return decodeURIComponent(encodeURIComponent(e))
                },
            }
        }),
        (Ai.convertCueToDOMTree = function (e, t) {
            return e && t ? Si(e, t) : null
        })
    ;(Ai.processCues = function (n, r, e) {
        if (!n || !r || !e) return null
        for (; e.firstChild; ) e.removeChild(e.firstChild)
        var a = n.document.createElement('div')
        if (
            ((a.style.position = 'absolute'),
            (a.style.left = '0'),
            (a.style.right = '0'),
            (a.style.top = '0'),
            (a.style.bottom = '0'),
            (a.style.margin = '1.5%'),
            e.appendChild(a),
            (function (e) {
                for (var t = 0; t < e.length; t++) if (e[t].hasBeenReset || !e[t].displayState) return 1
            })(r))
        ) {
            var s = [],
                o = Ii.getSimpleBoxPosition(a),
                u = { font: Math.round(0.05 * o.height * 100) / 100 + 'px sans-serif' }
            !(function () {
                for (var e, t, i = 0; i < r.length; i++) (t = r[i]), (e = new Ci(n, t, u)), a.appendChild(e.div), xi(0, e, o, s), (t.displayState = e.div), s.push(Ii.getSimpleBoxPosition(e))
            })()
        } else for (var t = 0; t < r.length; t++) a.appendChild(r[t].displayState)
    }),
        ((Ai.Parser = function (e, t, i) {
            i || ((i = t), (t = {})),
                (t = t || {}),
                (this.window = e),
                (this.vttjs = t),
                (this.state = 'INITIAL'),
                (this.buffer = ''),
                (this.decoder = i || new TextDecoder('utf8')),
                (this.regionList = [])
        }).prototype = {
            reportOrThrowError: function (e) {
                if (!(e instanceof hi)) throw e
                this.onparsingerror && this.onparsingerror(e)
            },
            parse: function (e) {
                var n = this
                function t() {
                    for (var e = n.buffer, t = 0; t < e.length && '\r' !== e[t] && '\n' !== e[t]; ) ++t
                    var i = e.substr(0, t)
                    return '\r' === e[t] && ++t, '\n' === e[t] && ++t, (n.buffer = e.substr(t)), i
                }
                function i(e) {
                    e.match(/X-TIMESTAMP-MAP/)
                        ? mi(
                              e,
                              function (e, t) {
                                  var i
                                  'X-TIMESTAMP-MAP' === e &&
                                      ((t = t),
                                      (i = new fi()),
                                      mi(
                                          t,
                                          function (e, t) {
                                              switch (e) {
                                                  case 'MPEGT':
                                                      i.integer(e + 'S', t)
                                                      break
                                                  case 'LOCA':
                                                      i.set(e + 'L', pi(t))
                                              }
                                          },
                                          /[^\d]:/,
                                          /,/
                                      ),
                                      n.ontimestampmap && n.ontimestampmap({ MPEGTS: i.get('MPEGTS'), LOCAL: i.get('LOCAL') }))
                              },
                              /=/
                          )
                        : mi(
                              e,
                              function (e, t) {
                                  var r
                                  'Region' === e &&
                                      ((t = t),
                                      (r = new fi()),
                                      mi(
                                          t,
                                          function (e, t) {
                                              switch (e) {
                                                  case 'id':
                                                      r.set(e, t)
                                                      break
                                                  case 'width':
                                                      r.percent(e, t)
                                                      break
                                                  case 'lines':
                                                      r.integer(e, t)
                                                      break
                                                  case 'regionanchor':
                                                  case 'viewportanchor':
                                                      var i = t.split(',')
                                                      if (2 !== i.length) break
                                                      var n = new fi()
                                                      if ((n.percent('x', i[0]), n.percent('y', i[1]), !n.has('x') || !n.has('y'))) break
                                                      r.set(e + 'X', n.get('x')), r.set(e + 'Y', n.get('y'))
                                                      break
                                                  case 'scroll':
                                                      r.alt(e, t, ['up'])
                                              }
                                          },
                                          /=/,
                                          /\s/
                                      ),
                                      r.has('id') &&
                                          (((t = new (n.vttjs.VTTRegion || n.window.VTTRegion)()).width = r.get('width', 100)),
                                          (t.lines = r.get('lines', 3)),
                                          (t.regionAnchorX = r.get('regionanchorX', 0)),
                                          (t.regionAnchorY = r.get('regionanchorY', 100)),
                                          (t.viewportAnchorX = r.get('viewportanchorX', 0)),
                                          (t.viewportAnchorY = r.get('viewportanchorY', 100)),
                                          (t.scroll = r.get('scroll', '')),
                                          n.onregion && n.onregion(t),
                                          n.regionList.push({ id: r.get('id'), region: t })))
                              },
                              /:/
                          )
                }
                e && (n.buffer += n.decoder.decode(e, { stream: !0 }))
                try {
                    if ('INITIAL' === n.state) {
                        if (!/\r\n|\n/.test(n.buffer)) return this
                        var r,
                            a = (r = t()).match(/^WEBVTT([ \t].*)?$/)
                        if (!a || !a[0]) throw new hi(hi.Errors.BadSignature)
                        n.state = 'HEADER'
                    }
                    for (var s = !1; n.buffer; ) {
                        if (!/\r\n|\n/.test(n.buffer)) return this
                        switch ((s ? (s = !1) : (r = t()), n.state)) {
                            case 'HEADER':
                                ;/:/.test(r) ? i(r) : r || (n.state = 'ID')
                                continue
                            case 'NOTE':
                                r || (n.state = 'ID')
                                continue
                            case 'ID':
                                if (/^NOTE($|[ \t])/.test(r)) {
                                    n.state = 'NOTE'
                                    break
                                }
                                if (!r) continue
                                n.cue = new (n.vttjs.VTTCue || n.window.VTTCue)(0, 0, '')
                                try {
                                    n.cue.align = 'center'
                                } catch (e) {
                                    n.cue.align = 'middle'
                                }
                                if (((n.state = 'CUE'), -1 === r.indexOf('--\x3e'))) {
                                    n.cue.id = r
                                    continue
                                }
                            case 'CUE':
                                try {
                                    gi(r, n.cue, n.regionList)
                                } catch (e) {
                                    n.reportOrThrowError(e), (n.cue = null), (n.state = 'BADCUE')
                                    continue
                                }
                                n.state = 'CUETEXT'
                                continue
                            case 'CUETEXT':
                                var o = -1 !== r.indexOf('--\x3e')
                                if (!r || (o && (s = !0))) {
                                    n.oncue && n.oncue(n.cue), (n.cue = null), (n.state = 'ID')
                                    continue
                                }
                                n.cue.text && (n.cue.text += '\n'), (n.cue.text += r.replace(/\u2028/g, '\n').replace(/u2029/g, '\n'))
                                continue
                            case 'BADCUE':
                                r || (n.state = 'ID')
                                continue
                        }
                    }
                } catch (e) {
                    n.reportOrThrowError(e), 'CUETEXT' === n.state && n.cue && n.oncue && n.oncue(n.cue), (n.cue = null), (n.state = 'INITIAL' === n.state ? 'BADWEBVTT' : 'BADCUE')
                }
                return this
            },
            flush: function () {
                var t = this
                try {
                    if (((t.buffer += t.decoder.decode()), (!t.cue && 'HEADER' !== t.state) || ((t.buffer += '\n\n'), t.parse()), 'INITIAL' === t.state)) throw new hi(hi.Errors.BadSignature)
                } catch (e) {
                    t.reportOrThrowError(e)
                }
                return t.onflush && t.onflush(), this
            },
        })
    var Pi = Ai,
        Li = { '': 1, lr: 1, rl: 1 },
        Di = { start: 1, center: 1, end: 1, left: 1, right: 1, auto: 1, 'line-left': 1, 'line-right': 1 }
    function Oi(e) {
        return 'string' == typeof e && !!Di[e.toLowerCase()] && e.toLowerCase()
    }
    function Mi(e, t, i) {
        this.hasBeenReset = !1
        var n = '',
            r = !1,
            a = e,
            s = t,
            o = i,
            u = null,
            l = '',
            c = !0,
            d = 'auto',
            h = 'start',
            p = 'auto',
            f = 'auto',
            m = 100,
            g = 'center'
        Object.defineProperties(this, {
            id: {
                enumerable: !0,
                get: function () {
                    return n
                },
                set: function (e) {
                    n = '' + e
                },
            },
            pauseOnExit: {
                enumerable: !0,
                get: function () {
                    return r
                },
                set: function (e) {
                    r = !!e
                },
            },
            startTime: {
                enumerable: !0,
                get: function () {
                    return a
                },
                set: function (e) {
                    if ('number' != typeof e) throw new TypeError('Start time must be set to a number.')
                    ;(a = e), (this.hasBeenReset = !0)
                },
            },
            endTime: {
                enumerable: !0,
                get: function () {
                    return s
                },
                set: function (e) {
                    if ('number' != typeof e) throw new TypeError('End time must be set to a number.')
                    ;(s = e), (this.hasBeenReset = !0)
                },
            },
            text: {
                enumerable: !0,
                get: function () {
                    return o
                },
                set: function (e) {
                    ;(o = '' + e), (this.hasBeenReset = !0)
                },
            },
            region: {
                enumerable: !0,
                get: function () {
                    return u
                },
                set: function (e) {
                    ;(u = e), (this.hasBeenReset = !0)
                },
            },
            vertical: {
                enumerable: !0,
                get: function () {
                    return l
                },
                set: function (e) {
                    e = 'string' == typeof (e = e) && !!Li[e.toLowerCase()] && e.toLowerCase()
                    if (!1 === e) throw new SyntaxError('Vertical: an invalid or illegal direction string was specified.')
                    ;(l = e), (this.hasBeenReset = !0)
                },
            },
            snapToLines: {
                enumerable: !0,
                get: function () {
                    return c
                },
                set: function (e) {
                    ;(c = !!e), (this.hasBeenReset = !0)
                },
            },
            line: {
                enumerable: !0,
                get: function () {
                    return d
                },
                set: function (e) {
                    if ('number' != typeof e && 'auto' !== e) throw new SyntaxError('Line: an invalid number or illegal string was specified.')
                    ;(d = e), (this.hasBeenReset = !0)
                },
            },
            lineAlign: {
                enumerable: !0,
                get: function () {
                    return h
                },
                set: function (e) {
                    e = Oi(e)
                    e && ((h = e), (this.hasBeenReset = !0))
                },
            },
            position: {
                enumerable: !0,
                get: function () {
                    return p
                },
                set: function (e) {
                    if (e < 0 || 100 < e) throw new Error('Position must be between 0 and 100.')
                    ;(p = e), (this.hasBeenReset = !0)
                },
            },
            positionAlign: {
                enumerable: !0,
                get: function () {
                    return f
                },
                set: function (e) {
                    e = Oi(e)
                    e && ((f = e), (this.hasBeenReset = !0))
                },
            },
            size: {
                enumerable: !0,
                get: function () {
                    return m
                },
                set: function (e) {
                    if (e < 0 || 100 < e) throw new Error('Size must be between 0 and 100.')
                    ;(m = e), (this.hasBeenReset = !0)
                },
            },
            align: {
                enumerable: !0,
                get: function () {
                    return g
                },
                set: function (e) {
                    e = Oi(e)
                    if (!e) throw new SyntaxError('align: an invalid or illegal alignment string was specified.')
                    ;(g = e), (this.hasBeenReset = !0)
                },
            },
        }),
            (this.displayState = void 0)
    }
    Mi.prototype.getCueAsHTML = function () {
        return WebVTT.convertCueToDOMTree(window, this.text)
    }
    var Ri = Mi,
        Ni = { '': !0, up: !0 }
    function Ui(e) {
        return 'number' == typeof e && 0 <= e && e <= 100
    }
    function Bi() {
        var t = 100,
            i = 3,
            n = 0,
            r = 100,
            a = 0,
            s = 100,
            o = ''
        Object.defineProperties(this, {
            width: {
                enumerable: !0,
                get: function () {
                    return t
                },
                set: function (e) {
                    if (!Ui(e)) throw new Error('Width must be between 0 and 100.')
                    t = e
                },
            },
            lines: {
                enumerable: !0,
                get: function () {
                    return i
                },
                set: function (e) {
                    if ('number' != typeof e) throw new TypeError('Lines must be set to a number.')
                    i = e
                },
            },
            regionAnchorY: {
                enumerable: !0,
                get: function () {
                    return r
                },
                set: function (e) {
                    if (!Ui(e)) throw new Error('RegionAnchorX must be between 0 and 100.')
                    r = e
                },
            },
            regionAnchorX: {
                enumerable: !0,
                get: function () {
                    return n
                },
                set: function (e) {
                    if (!Ui(e)) throw new Error('RegionAnchorY must be between 0 and 100.')
                    n = e
                },
            },
            viewportAnchorY: {
                enumerable: !0,
                get: function () {
                    return s
                },
                set: function (e) {
                    if (!Ui(e)) throw new Error('ViewportAnchorY must be between 0 and 100.')
                    s = e
                },
            },
            viewportAnchorX: {
                enumerable: !0,
                get: function () {
                    return a
                },
                set: function (e) {
                    if (!Ui(e)) throw new Error('ViewportAnchorX must be between 0 and 100.')
                    a = e
                },
            },
            scroll: {
                enumerable: !0,
                get: function () {
                    return o
                },
                set: function (e) {
                    e = 'string' == typeof (e = e) && !!Ni[e.toLowerCase()] && e.toLowerCase()
                    !1 === e || (o = e)
                },
            },
        })
    }
    var Fi = m(function (e) {
        e = e.exports = { WebVTT: Pi, VTTCue: Ri, VTTRegion: Bi }
        ;(Kt.vttjs = e), (Kt.WebVTT = e.WebVTT)
        var t = e.VTTCue,
            i = e.VTTRegion,
            n = Kt.VTTCue,
            r = Kt.VTTRegion
        ;(e.shim = function () {
            ;(Kt.VTTCue = t), (Kt.VTTRegion = i)
        }),
            (e.restore = function () {
                ;(Kt.VTTCue = n), (Kt.VTTRegion = r)
            }),
            Kt.VTTCue || e.shim()
    })
    Fi.WebVTT, Fi.VTTCue, Fi.VTTRegion
    var ji = (function (n) {
        function i(t, e) {
            var i
            return (
                void 0 === e && (e = function () {}),
                ((t = void 0 === t ? {} : t).reportTouchActivity = !1),
                ((i = n.call(this, null, t, e) || this).onDurationChange_ = function (e) {
                    return i.onDurationChange(e)
                }),
                (i.trackProgress_ = function (e) {
                    return i.trackProgress(e)
                }),
                (i.trackCurrentTime_ = function (e) {
                    return i.trackCurrentTime(e)
                }),
                (i.stopTrackingCurrentTime_ = function (e) {
                    return i.stopTrackingCurrentTime(e)
                }),
                (i.disposeSourceHandler_ = function (e) {
                    return i.disposeSourceHandler(e)
                }),
                (i.queuedHanders_ = new Set()),
                (i.hasStarted_ = !1),
                i.on('playing', function () {
                    this.hasStarted_ = !0
                }),
                i.on('loadstart', function () {
                    this.hasStarted_ = !1
                }),
                oi.names.forEach(function (e) {
                    e = oi[e]
                    t && t[e.getterName] && (i[e.privateName] = t[e.getterName])
                }),
                i.featuresProgressEvents || i.manualProgressOn(),
                i.featuresTimeupdateEvents || i.manualTimeUpdatesOn(),
                ['Text', 'Audio', 'Video'].forEach(function (e) {
                    !1 === t['native' + e + 'Tracks'] && (i['featuresNative' + e + 'Tracks'] = !1)
                }),
                !1 === t.nativeCaptions || !1 === t.nativeTextTracks ? (i.featuresNativeTextTracks = !1) : (!0 !== t.nativeCaptions && !0 !== t.nativeTextTracks) || (i.featuresNativeTextTracks = !0),
                i.featuresNativeTextTracks || i.emulateTextTracks(),
                (i.preloadTextTracks = !1 !== t.preloadTextTracks),
                (i.autoRemoteTextTracks_ = new oi.text.ListClass()),
                i.initTrackListeners(),
                t.nativeControlsForTouch || i.emitTapEvents(),
                i.constructor && (i.name_ = i.constructor.name || 'Unknown Tech'),
                i
            )
        }
        mt(i, n)
        var e = i.prototype
        return (
            (e.triggerSourceset = function (e) {
                var t = this
                this.isReady_ ||
                    this.one('ready', function () {
                        return t.setTimeout(function () {
                            return t.triggerSourceset(e)
                        }, 1)
                    }),
                    this.trigger({ src: e, type: 'sourceset' })
            }),
            (e.manualProgressOn = function () {
                this.on('durationchange', this.onDurationChange_), (this.manualProgress = !0), this.one('ready', this.trackProgress_)
            }),
            (e.manualProgressOff = function () {
                ;(this.manualProgress = !1), this.stopTrackingProgress(), this.off('durationchange', this.onDurationChange_)
            }),
            (e.trackProgress = function (e) {
                this.stopTrackingProgress(),
                    (this.progressInterval = this.setInterval(
                        Ve(this, function () {
                            var e = this.bufferedPercent()
                            this.bufferedPercent_ !== e && this.trigger('progress'), 1 === (this.bufferedPercent_ = e) && this.stopTrackingProgress()
                        }),
                        500
                    ))
            }),
            (e.onDurationChange = function (e) {
                this.duration_ = this.duration()
            }),
            (e.buffered = function () {
                return vt(0, 0)
            }),
            (e.bufferedPercent = function () {
                return _t(this.buffered(), this.duration_)
            }),
            (e.stopTrackingProgress = function () {
                this.clearInterval(this.progressInterval)
            }),
            (e.manualTimeUpdatesOn = function () {
                ;(this.manualTimeUpdates = !0), this.on('play', this.trackCurrentTime_), this.on('pause', this.stopTrackingCurrentTime_)
            }),
            (e.manualTimeUpdatesOff = function () {
                ;(this.manualTimeUpdates = !1), this.stopTrackingCurrentTime(), this.off('play', this.trackCurrentTime_), this.off('pause', this.stopTrackingCurrentTime_)
            }),
            (e.trackCurrentTime = function () {
                this.currentTimeInterval && this.stopTrackingCurrentTime(),
                    (this.currentTimeInterval = this.setInterval(function () {
                        this.trigger({ type: 'timeupdate', target: this, manuallyTriggered: !0 })
                    }, 250))
            }),
            (e.stopTrackingCurrentTime = function () {
                this.clearInterval(this.currentTimeInterval), this.trigger({ type: 'timeupdate', target: this, manuallyTriggered: !0 })
            }),
            (e.dispose = function () {
                this.clearTracks(ai.names), this.manualProgress && this.manualProgressOff(), this.manualTimeUpdates && this.manualTimeUpdatesOff(), n.prototype.dispose.call(this)
            }),
            (e.clearTracks = function (e) {
                var r = this
                ;(e = [].concat(e)).forEach(function (e) {
                    for (var t = r[e + 'Tracks']() || [], i = t.length; i--; ) {
                        var n = t[i]
                        'text' === e && r.removeRemoteTextTrack(n), t.removeTrack(n)
                    }
                })
            }),
            (e.cleanupAutoTextTracks = function () {
                for (var e = this.autoRemoteTextTracks_ || [], t = e.length; t--; ) {
                    var i = e[t]
                    this.removeRemoteTextTrack(i)
                }
            }),
            (e.reset = function () {}),
            (e.crossOrigin = function () {}),
            (e.setCrossOrigin = function () {}),
            (e.error = function (e) {
                return void 0 !== e && ((this.error_ = new bt(e)), this.trigger('error')), this.error_
            }),
            (e.played = function () {
                return this.hasStarted_ ? vt(0, 0) : vt()
            }),
            (e.play = function () {}),
            (e.setScrubbing = function () {}),
            (e.scrubbing = function () {}),
            (e.setCurrentTime = function () {
                this.manualTimeUpdates && this.trigger({ type: 'timeupdate', target: this, manuallyTriggered: !0 })
            }),
            (e.initTrackListeners = function () {
                var r = this
                ai.names.forEach(function (e) {
                    function t() {
                        r.trigger(e + 'trackchange')
                    }
                    var i = ai[e],
                        n = r[i.getterName]()
                    n.addEventListener('removetrack', t),
                        n.addEventListener('addtrack', t),
                        r.on('dispose', function () {
                            n.removeEventListener('removetrack', t), n.removeEventListener('addtrack', t)
                        })
                })
            }),
            (e.addWebVttScript_ = function () {
                var e,
                    t = this
                window.WebVTT ||
                    (document.body.contains(this.el())
                        ? !this.options_['vtt.js'] && S(Fi) && 0 < Object.keys(Fi).length
                            ? this.trigger('vttjsloaded')
                            : (((e = document.createElement('script')).src = this.options_['vtt.js'] || 'https://vjs.zencdn.net/vttjs/0.14.1/vtt.min.js'),
                              (e.onload = function () {
                                  t.trigger('vttjsloaded')
                              }),
                              (e.onerror = function () {
                                  t.trigger('vttjserror')
                              }),
                              this.on('dispose', function () {
                                  ;(e.onload = null), (e.onerror = null)
                              }),
                              (window.WebVTT = !0),
                              this.el().parentNode.appendChild(e))
                        : this.ready(this.addWebVttScript_))
            }),
            (e.emulateTextTracks = function () {
                function t(e) {
                    return n.addTrack(e.track)
                }
                function i(e) {
                    return n.removeTrack(e.track)
                }
                var e = this,
                    n = this.textTracks(),
                    r = this.remoteTextTracks()
                r.on('addtrack', t), r.on('removetrack', i), this.addWebVttScript_()
                function a() {
                    return e.trigger('texttrackchange')
                }
                function s() {
                    a()
                    for (var e = 0; e < n.length; e++) {
                        var t = n[e]
                        t.removeEventListener('cuechange', a), 'showing' === t.mode && t.addEventListener('cuechange', a)
                    }
                }
                s(),
                    n.addEventListener('change', s),
                    n.addEventListener('addtrack', s),
                    n.addEventListener('removetrack', s),
                    this.on('dispose', function () {
                        r.off('addtrack', t), r.off('removetrack', i), n.removeEventListener('change', s), n.removeEventListener('addtrack', s), n.removeEventListener('removetrack', s)
                        for (var e = 0; e < n.length; e++) n[e].removeEventListener('cuechange', a)
                    })
            }),
            (e.addTextTrack = function (e, t, i) {
                if (!e) throw new Error('TextTrack kind is required but was not provided')
                return (function (e, t, i, n, r) {
                    void 0 === r && (r = {})
                    var a = e.textTracks()
                    return (r.kind = t), i && (r.label = i), n && (r.language = n), (r.tech = e), (r = new oi.text.TrackClass(r)), a.addTrack(r), r
                })(this, e, t, i)
            }),
            (e.createRemoteTextTrack = function (e) {
                e = lt(e, { tech: this })
                return new si.remoteTextEl.TrackClass(e)
            }),
            (e.addRemoteTextTrack = function (e, t) {
                var i = this,
                    n = this.createRemoteTextTrack((e = void 0 === e ? {} : e))
                return (
                    !0 !== t &&
                        !1 !== t &&
                        (h.warn('Calling addRemoteTextTrack without explicitly setting the "manualCleanup" parameter to `true` is deprecated and default to `false` in future version of video.js'),
                        (t = !0)),
                    this.remoteTextTrackEls().addTrackElement_(n),
                    this.remoteTextTracks().addTrack(n.track),
                    !0 !== t &&
                        this.ready(function () {
                            return i.autoRemoteTextTracks_.addTrack(n.track)
                        }),
                    n
                )
            }),
            (e.removeRemoteTextTrack = function (e) {
                var t = this.remoteTextTrackEls().getTrackElementByTrack_(e)
                this.remoteTextTrackEls().removeTrackElement_(t), this.remoteTextTracks().removeTrack(e), this.autoRemoteTextTracks_.removeTrack(e)
            }),
            (e.getVideoPlaybackQuality = function () {
                return {}
            }),
            (e.requestPictureInPicture = function () {
                var e = this.options_.Promise || window.Promise
                if (e) return e.reject()
            }),
            (e.disablePictureInPicture = function () {
                return !0
            }),
            (e.setDisablePictureInPicture = function () {}),
            (e.requestVideoFrameCallback = function (e) {
                var t = this,
                    i = Pe++
                return (
                    this.paused()
                        ? (this.queuedHanders_.add(i),
                          this.one('playing', function () {
                              t.queuedHanders_.has(i) && (t.queuedHanders_.delete(i), e())
                          }))
                        : this.requestNamedAnimationFrame(i, e),
                    i
                )
            }),
            (e.cancelVideoFrameCallback = function (e) {
                this.queuedHanders_.has(e) ? this.queuedHanders_.delete(e) : this.cancelNamedAnimationFrame(e)
            }),
            (e.setPoster = function () {}),
            (e.playsinline = function () {}),
            (e.setPlaysinline = function () {}),
            (e.overrideNativeAudioTracks = function () {}),
            (e.overrideNativeVideoTracks = function () {}),
            (e.canPlayType = function () {
                return ''
            }),
            (i.canPlayType = function () {
                return ''
            }),
            (i.canPlaySource = function (e, t) {
                return i.canPlayType(e.type)
            }),
            (i.isTech = function (e) {
                return e.prototype instanceof i || e instanceof i || e === i
            }),
            (i.registerTech = function (e, t) {
                if ((i.techs_ || (i.techs_ = {}), !i.isTech(t))) throw new Error('Tech ' + e + ' must be a Tech')
                if (!i.canPlayType) throw new Error('Techs must have a static canPlayType method on them')
                if (!i.canPlaySource) throw new Error('Techs must have a static canPlaySource method on them')
                return (e = ut(e)), (i.techs_[e] = t), (i.techs_[ot(e)] = t), 'Tech' !== e && i.defaultTechOrder_.push(e), t
            }),
            (i.getTech = function (e) {
                if (e)
                    return i.techs_ && i.techs_[e]
                        ? i.techs_[e]
                        : ((e = ut(e)),
                          window && window.videojs && window.videojs[e]
                              ? (h.warn('The ' + e + ' tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)'), window.videojs[e])
                              : void 0)
            }),
            i
        )
    })(pt)
    oi.names.forEach(function (e) {
        var t = oi[e]
        ji.prototype[t.getterName] = function () {
            return (this[t.privateName] = this[t.privateName] || new t.ListClass()), this[t.privateName]
        }
    }),
        (ji.prototype.featuresVolumeControl = !0),
        (ji.prototype.featuresMuteControl = !0),
        (ji.prototype.featuresFullscreenResize = !1),
        (ji.prototype.featuresPlaybackRate = !1),
        (ji.prototype.featuresProgressEvents = !1),
        (ji.prototype.featuresSourceset = !1),
        (ji.prototype.featuresTimeupdateEvents = !1),
        (ji.prototype.featuresNativeTextTracks = !1),
        (ji.prototype.featuresVideoFrameCallback = !1),
        (ji.withSourceHandlers = function (r) {
            ;(r.registerSourceHandler = function (e, t) {
                var i = (i = r.sourceHandlers) || (r.sourceHandlers = [])
                void 0 === t && (t = i.length), i.splice(t, 0, e)
            }),
                (r.canPlayType = function (e) {
                    for (var t, i = r.sourceHandlers || [], n = 0; n < i.length; n++) if ((t = i[n].canPlayType(e))) return t
                    return ''
                }),
                (r.selectSourceHandler = function (e, t) {
                    for (var i = r.sourceHandlers || [], n = 0; n < i.length; n++) if (i[n].canHandleSource(e, t)) return i[n]
                    return null
                }),
                (r.canPlaySource = function (e, t) {
                    var i = r.selectSourceHandler(e, t)
                    return i ? i.canHandleSource(e, t) : ''
                })
            ;['seekable', 'seeking', 'duration'].forEach(function (e) {
                var t = this[e]
                'function' == typeof t &&
                    (this[e] = function () {
                        return this.sourceHandler_ && this.sourceHandler_[e] ? this.sourceHandler_[e].apply(this.sourceHandler_, arguments) : t.apply(this, arguments)
                    })
            }, r.prototype),
                (r.prototype.setSource = function (e) {
                    var t = r.selectSourceHandler(e, this.options_)
                    t || (r.nativeSourceHandler ? (t = r.nativeSourceHandler) : h.error('No source handler found for the current source.')),
                        this.disposeSourceHandler(),
                        this.off('dispose', this.disposeSourceHandler_),
                        t !== r.nativeSourceHandler && (this.currentSource_ = e),
                        (this.sourceHandler_ = t.handleSource(e, this, this.options_)),
                        this.one('dispose', this.disposeSourceHandler_)
                }),
                (r.prototype.disposeSourceHandler = function () {
                    this.currentSource_ && (this.clearTracks(['audio', 'video']), (this.currentSource_ = null)),
                        this.cleanupAutoTextTracks(),
                        this.sourceHandler_ && (this.sourceHandler_.dispose && this.sourceHandler_.dispose(), (this.sourceHandler_ = null))
                })
        }),
        pt.registerComponent('Tech', ji),
        ji.registerTech('Tech', ji),
        (ji.defaultTechOrder_ = [])
    var Hi = {},
        qi = {},
        Vi = {}
    function Wi(e, t, i) {
        e.setTimeout(function () {
            return (function i(n, e, r, a, s, o) {
                void 0 === n && (n = {})
                void 0 === e && (e = [])
                void 0 === s && (s = [])
                void 0 === o && (o = !1)
                var t = e,
                    e = t[0],
                    u = t.slice(1)
                if ('string' == typeof e) i(n, Hi[e], r, a, s, o)
                else if (e) {
                    var l = Qi(a, e)
                    if (!l.setSource) return s.push(l), i(n, u, r, a, s, o)
                    l.setSource(b({}, n), function (e, t) {
                        return e ? i(n, u, r, a, s, o) : (s.push(l), void i(t, n.type === t.type ? u : Hi[t.type], r, a, s, o))
                    })
                } else u.length ? i(n, u, r, a, s, o) : o ? r(n, s) : i(n, Hi['*'], r, a, s, !0)
            })(t, Hi[t.type], i, e)
        }, 1)
    }
    function Gi(e, t, i, n) {
        void 0 === n && (n = null)
        var r = 'call' + ut(i),
            r = e.reduce(Yi(r), n),
            n = r === Vi,
            r = n ? null : t[i](r)
        return (
            (function (e, t, i, n) {
                for (var r = e.length - 1; 0 <= r; r--) {
                    var a = e[r]
                    a[t] && a[t](n, i)
                }
            })(e, i, r, n),
            r
        )
    }
    var zi = { buffered: 1, currentTime: 1, duration: 1, muted: 1, played: 1, paused: 1, seekable: 1, volume: 1, ended: 1 },
        Xi = { setCurrentTime: 1, setMuted: 1, setVolume: 1 },
        Ki = { play: 1, pause: 1 }
    function Yi(i) {
        return function (e, t) {
            return e === Vi ? Vi : t[i] ? t[i](e) : e
        }
    }
    function Qi(e, t) {
        var i = qi[e.id()],
            n = null
        if (null == i) return (n = t(e)), (qi[e.id()] = [[t, n]]), n
        for (var r = 0; r < i.length; r++) {
            var a = i[r],
                s = a[0],
                a = a[1]
            s === t && (n = a)
        }
        return null === n && ((n = t(e)), i.push([t, n])), n
    }
    function $i(e) {
        return (e = Nt((e = void 0 === e ? '' : e))), Zi[e.toLowerCase()] || ''
    }
    function Ji(e) {
        var t
        return (e = Array.isArray(e)
            ? ((t = []),
              e.forEach(function (e) {
                  ;(e = Ji(e)), Array.isArray(e) ? (t = t.concat(e)) : T(e) && t.push(e)
              }),
              t)
            : 'string' == typeof e && e.trim()
            ? [en({ src: e })]
            : T(e) && 'string' == typeof e.src && e.src && e.src.trim()
            ? [en(e)]
            : [])
    }
    var Zi = {
        opus: 'video/ogg',
        ogv: 'video/ogg',
        mp4: 'video/mp4',
        mov: 'video/mp4',
        m4v: 'video/mp4',
        mkv: 'video/x-matroska',
        m4a: 'audio/mp4',
        mp3: 'audio/mpeg',
        aac: 'audio/aac',
        caf: 'audio/x-caf',
        flac: 'audio/flac',
        oga: 'audio/ogg',
        wav: 'audio/wav',
        m3u8: 'application/x-mpegURL',
        mpd: 'application/dash+xml',
        jpg: 'image/jpeg',
        jpeg: 'image/jpeg',
        gif: 'image/gif',
        png: 'image/png',
        svg: 'image/svg+xml',
        webp: 'image/webp',
    }
    function en(e) {
        var t
        return e.type || ((t = $i(e.src)) && (e.type = t)), e
    }
    I = (function (u) {
        function e(e, t, i) {
            var n = lt({ createEl: !1 }, t),
                i = u.call(this, e, n, i) || this
            if (t.playerOptions.sources && 0 !== t.playerOptions.sources.length) e.src(t.playerOptions.sources)
            else
                for (var r = 0, a = t.playerOptions.techOrder; r < a.length; r++) {
                    var s = ut(a[r]),
                        o = ji.getTech(s)
                    if ((o = !s ? pt.getComponent(s) : o) && o.isSupported()) {
                        e.loadTech_(s)
                        break
                    }
                }
            return i
        }
        return mt(e, u), e
    })(pt)
    pt.registerComponent('MediaLoader', I)
    C = (function (n) {
        function e(e, t) {
            var i = n.call(this, e, t) || this
            return (
                i.options_.controlText && i.controlText(i.options_.controlText),
                (i.handleMouseOver_ = function (e) {
                    return i.handleMouseOver(e)
                }),
                (i.handleMouseOut_ = function (e) {
                    return i.handleMouseOut(e)
                }),
                (i.handleClick_ = function (e) {
                    return i.handleClick(e)
                }),
                (i.handleKeyDown_ = function (e) {
                    return i.handleKeyDown(e)
                }),
                i.emitTapEvents(),
                i.enable(),
                i
            )
        }
        mt(e, n)
        var t = e.prototype
        return (
            (t.createEl = function (e, t, i) {
                void 0 === e && (e = 'div'),
                    void 0 === t && (t = {}),
                    void 0 === i && (i = {}),
                    (t = b({ className: this.buildCSSClass(), tabIndex: 0 }, t)),
                    'button' === e && h.error('Creating a ClickableComponent with an HTML element of ' + e + ' is not supported; use a Button instead.'),
                    (i = b({ role: 'button' }, i)),
                    (this.tabIndex_ = t.tabIndex)
                i = $(e, t, i)
                return i.appendChild($('span', { className: 'vjs-icon-placeholder' }, { 'aria-hidden': !0 })), this.createControlTextEl(i), i
            }),
            (t.dispose = function () {
                ;(this.controlTextEl_ = null), n.prototype.dispose.call(this)
            }),
            (t.createControlTextEl = function (e) {
                return (
                    (this.controlTextEl_ = $('span', { className: 'vjs-control-text' }, { 'aria-live': 'polite' })),
                    e && e.appendChild(this.controlTextEl_),
                    this.controlText(this.controlText_, e),
                    this.controlTextEl_
                )
            }),
            (t.controlText = function (e, t) {
                if ((void 0 === t && (t = this.el()), void 0 === e)) return this.controlText_ || 'Need Text'
                var i = this.localize(e)
                ;(this.controlText_ = e), J(this.controlTextEl_, i), this.nonIconControl || this.player_.options_.noUITitleAttributes || t.setAttribute('title', i)
            }),
            (t.buildCSSClass = function () {
                return 'vjs-control vjs-button ' + n.prototype.buildCSSClass.call(this)
            }),
            (t.enable = function () {
                this.enabled_ ||
                    ((this.enabled_ = !0),
                    this.removeClass('vjs-disabled'),
                    this.el_.setAttribute('aria-disabled', 'false'),
                    'undefined' != typeof this.tabIndex_ && this.el_.setAttribute('tabIndex', this.tabIndex_),
                    this.on(['tap', 'click'], this.handleClick_),
                    this.on('keydown', this.handleKeyDown_))
            }),
            (t.disable = function () {
                ;(this.enabled_ = !1),
                    this.addClass('vjs-disabled'),
                    this.el_.setAttribute('aria-disabled', 'true'),
                    'undefined' != typeof this.tabIndex_ && this.el_.removeAttribute('tabIndex'),
                    this.off('mouseover', this.handleMouseOver_),
                    this.off('mouseout', this.handleMouseOut_),
                    this.off(['tap', 'click'], this.handleClick_),
                    this.off('keydown', this.handleKeyDown_)
            }),
            (t.handleLanguagechange = function () {
                this.controlText(this.controlText_)
            }),
            (t.handleClick = function (e) {
                this.options_.clickHandler && this.options_.clickHandler.call(this, arguments)
            }),
            (t.handleKeyDown = function (e) {
                ht.isEventKey(e, 'Space') || ht.isEventKey(e, 'Enter') ? (e.preventDefault(), e.stopPropagation(), this.trigger('click')) : n.prototype.handleKeyDown.call(this, e)
            }),
            e
        )
    })(pt)
    pt.registerComponent('ClickableComponent', C),
        pt.registerComponent(
            'PosterImage',
            (function (n) {
                function e(e, t) {
                    var i = n.call(this, e, t) || this
                    return (
                        i.update(),
                        (i.update_ = function (e) {
                            return i.update(e)
                        }),
                        e.on('posterchange', i.update_),
                        i
                    )
                }
                mt(e, n)
                var t = e.prototype
                return (
                    (t.dispose = function () {
                        this.player().off('posterchange', this.update_), n.prototype.dispose.call(this)
                    }),
                    (t.createEl = function () {
                        return $('div', { className: 'vjs-poster', tabIndex: -1 })
                    }),
                    (t.update = function (e) {
                        var t = this.player().poster()
                        this.setSrc(t), t ? this.show() : this.hide()
                    }),
                    (t.setSrc = function (e) {
                        this.el_.style.backgroundImage = e ? 'url("' + e + '")' : ''
                    }),
                    (t.handleClick = function (e) {
                        var t
                        this.player_.controls() &&
                            ((t = this.player_.usingPlugin('eme') && this.player_.eme.sessions && 0 < this.player_.eme.sessions.length),
                            !this.player_.tech(!0) || ((N || O) && t) || this.player_.tech(!0).focus(),
                            this.player_.paused() ? Et(this.player_.play()) : this.player_.pause())
                    }),
                    e
                )
            })(C)
        )
    var tn = '#222',
        nn = {
            monospace: 'monospace',
            sansSerif: 'sans-serif',
            serif: 'serif',
            monospaceSansSerif: '"Andale Mono", "Lucida Console", monospace',
            monospaceSerif: '"Courier New", monospace',
            proportionalSansSerif: 'sans-serif',
            proportionalSerif: 'serif',
            casual: '"Comic Sans MS", Impact, fantasy',
            script: '"Monotype Corsiva", cursive',
            smallcaps: '"Andale Mono", "Lucida Console", monospace, sans-serif',
        }
    function rn(e, t) {
        var i
        if (4 === e.length) i = e[1] + e[1] + e[2] + e[2] + e[3] + e[3]
        else {
            if (7 !== e.length) throw new Error('Invalid color code provided, ' + e + '; must be formatted as e.g. #f0e or #f604e2.')
            i = e.slice(1)
        }
        return 'rgba(' + parseInt(i.slice(0, 2), 16) + ',' + parseInt(i.slice(2, 4), 16) + ',' + parseInt(i.slice(4, 6), 16) + ',' + t + ')'
    }
    function an(e, t, i) {
        try {
            e.style[t] = i
        } catch (e) {
            return
        }
    }
    pt.registerComponent(
        'TextTrackDisplay',
        (function (a) {
            function e(i, e, t) {
                function n(e) {
                    return r.updateDisplay(e)
                }
                var r = a.call(this, i, e, t) || this
                return (
                    i.on('loadstart', function (e) {
                        return r.toggleDisplay(e)
                    }),
                    i.on('texttrackchange', n),
                    i.on('loadedmetadata', function (e) {
                        return r.preselectTrack(e)
                    }),
                    i.ready(
                        Ve(ft(r), function () {
                            if (i.tech_ && i.tech_.featuresNativeTextTracks) this.hide()
                            else {
                                i.on('fullscreenchange', n),
                                    i.on('playerresize', n),
                                    window.addEventListener('orientationchange', n),
                                    i.on('dispose', function () {
                                        return window.removeEventListener('orientationchange', n)
                                    })
                                for (var e = this.options_.playerOptions.tracks || [], t = 0; t < e.length; t++) this.player_.addRemoteTextTrack(e[t], !0)
                                this.preselectTrack()
                            }
                        })
                    ),
                    r
                )
            }
            mt(e, a)
            var t = e.prototype
            return (
                (t.preselectTrack = function () {
                    for (var e, t, i, n = { captions: 1, subtitles: 1 }, r = this.player_.textTracks(), a = this.player_.cache_.selectedLanguage, s = 0; s < r.length; s++) {
                        var o = r[s]
                        a && a.enabled && a.language && a.language === o.language && o.kind in n
                            ? (i = (o.kind !== a.kind && i) || o)
                            : a && !a.enabled
                            ? (t = e = i = null)
                            : o.default && ('descriptions' !== o.kind || e ? o.kind in n && !t && (t = o) : (e = o))
                    }
                    i ? (i.mode = 'showing') : t ? (t.mode = 'showing') : e && (e.mode = 'showing')
                }),
                (t.toggleDisplay = function () {
                    this.player_.tech_ && this.player_.tech_.featuresNativeTextTracks ? this.hide() : this.show()
                }),
                (t.createEl = function () {
                    return a.prototype.createEl.call(this, 'div', { className: 'vjs-text-track-display' }, { translate: 'yes', 'aria-live': 'off', 'aria-atomic': 'true' })
                }),
                (t.clearDisplay = function () {
                    'function' == typeof window.WebVTT && window.WebVTT.processCues(window, [], this.el_)
                }),
                (t.updateDisplay = function () {
                    var e = this.player_.textTracks(),
                        t = this.options_.allowMultipleShowingTracks
                    if ((this.clearDisplay(), t)) {
                        for (var i = [], n = 0; n < e.length; ++n) {
                            var r = e[n]
                            'showing' === r.mode && i.push(r)
                        }
                        this.updateForTrack(i)
                    } else {
                        for (var a = null, s = null, o = e.length; o--; ) {
                            var u = e[o]
                            'showing' === u.mode && ('descriptions' === u.kind ? (a = u) : (s = u))
                        }
                        s
                            ? ('off' !== this.getAttribute('aria-live') && this.setAttribute('aria-live', 'off'), this.updateForTrack(s))
                            : a && ('assertive' !== this.getAttribute('aria-live') && this.setAttribute('aria-live', 'assertive'), this.updateForTrack(a))
                    }
                }),
                (t.updateDisplayState = function (e) {
                    for (var t = this.player_.textTrackSettings.getValues(), i = e.activeCues, n = i.length; n--; ) {
                        var r,
                            a = i[n]
                        a &&
                            ((r = a.displayState),
                            t.color && (r.firstChild.style.color = t.color),
                            t.textOpacity && an(r.firstChild, 'color', rn(t.color || '#fff', t.textOpacity)),
                            t.backgroundColor && (r.firstChild.style.backgroundColor = t.backgroundColor),
                            t.backgroundOpacity && an(r.firstChild, 'backgroundColor', rn(t.backgroundColor || '#000', t.backgroundOpacity)),
                            t.windowColor && (t.windowOpacity ? an(r, 'backgroundColor', rn(t.windowColor, t.windowOpacity)) : (r.style.backgroundColor = t.windowColor)),
                            t.edgeStyle &&
                                ('dropshadow' === t.edgeStyle
                                    ? (r.firstChild.style.textShadow = '2px 2px 3px #222, 2px 2px 4px #222, 2px 2px 5px ' + tn)
                                    : 'raised' === t.edgeStyle
                                    ? (r.firstChild.style.textShadow = '1px 1px #222, 2px 2px #222, 3px 3px ' + tn)
                                    : 'depressed' === t.edgeStyle
                                    ? (r.firstChild.style.textShadow = '1px 1px #ccc, 0 1px #ccc, -1px -1px #222, 0 -1px ' + tn)
                                    : 'uniform' === t.edgeStyle && (r.firstChild.style.textShadow = '0 0 4px #222, 0 0 4px #222, 0 0 4px #222, 0 0 4px ' + tn)),
                            t.fontPercent &&
                                1 !== t.fontPercent &&
                                ((a = window.parseFloat(r.style.fontSize)), (r.style.fontSize = a * t.fontPercent + 'px'), (r.style.height = 'auto'), (r.style.top = 'auto')),
                            t.fontFamily &&
                                'default' !== t.fontFamily &&
                                ('small-caps' === t.fontFamily ? (r.firstChild.style.fontVariant = 'small-caps') : (r.firstChild.style.fontFamily = nn[t.fontFamily])))
                    }
                }),
                (t.updateForTrack = function (e) {
                    if (
                        (Array.isArray(e) || (e = [e]),
                        'function' == typeof window.WebVTT &&
                            !e.every(function (e) {
                                return !e.activeCues
                            }))
                    ) {
                        for (var t = [], i = 0; i < e.length; ++i) for (var n = e[i], r = 0; r < n.activeCues.length; ++r) t.push(n.activeCues[r])
                        window.WebVTT.processCues(window, t, this.el_)
                        for (var a = 0; a < e.length; ++a) {
                            for (var s = e[a], o = 0; o < s.activeCues.length; ++o) {
                                var u = s.activeCues[o].displayState
                                te(u, 'vjs-text-track-cue'), te(u, 'vjs-text-track-cue-' + (s.language || a)), s.language && oe(u, 'lang', s.language)
                            }
                            this.player_.textTrackSettings && this.updateDisplayState(s)
                        }
                    }
                }),
                e
            )
        })(pt)
    ),
        pt.registerComponent(
            'LoadingSpinner',
            (function (i) {
                function e() {
                    return i.apply(this, arguments) || this
                }
                return (
                    mt(e, i),
                    (e.prototype.createEl = function () {
                        var e = this.player_.isAudio(),
                            t = this.localize(e ? 'Audio Player' : 'Video Player'),
                            e = $('span', { className: 'vjs-control-text', textContent: this.localize('{1} is loading.', [t]) }),
                            t = i.prototype.createEl.call(this, 'div', { className: 'vjs-loading-spinner', dir: 'ltr' })
                        return t.appendChild(e), t
                    }),
                    e
                )
            })(pt)
        )
    var sn = (function (t) {
        function e() {
            return t.apply(this, arguments) || this
        }
        mt(e, t)
        var i = e.prototype
        return (
            (i.createEl = function (e, t, i) {
                void 0 === t && (t = {}), void 0 === i && (i = {})
                i = $('button', (t = b({ className: this.buildCSSClass() }, t)), (i = b({ type: 'button' }, i)))
                return i.appendChild($('span', { className: 'vjs-icon-placeholder' }, { 'aria-hidden': !0 })), this.createControlTextEl(i), i
            }),
            (i.addChild = function (e, t) {
                void 0 === t && (t = {})
                var i = this.constructor.name
                return h.warn('Adding an actionable (user controllable) child to a Button (' + i + ') is not supported; use a ClickableComponent instead.'), pt.prototype.addChild.call(this, e, t)
            }),
            (i.enable = function () {
                t.prototype.enable.call(this), this.el_.removeAttribute('disabled')
            }),
            (i.disable = function () {
                t.prototype.disable.call(this), this.el_.setAttribute('disabled', 'disabled')
            }),
            (i.handleKeyDown = function (e) {
                ht.isEventKey(e, 'Space') || ht.isEventKey(e, 'Enter') ? e.stopPropagation() : t.prototype.handleKeyDown.call(this, e)
            }),
            e
        )
    })(C)
    pt.registerComponent('Button', sn)
    Bt = (function (n) {
        function e(e, t) {
            var i = n.call(this, e, t) || this
            return (
                (i.mouseused_ = !1),
                i.on('mousedown', function (e) {
                    return i.handleMouseDown(e)
                }),
                i
            )
        }
        mt(e, n)
        var t = e.prototype
        return (
            (t.buildCSSClass = function () {
                return 'vjs-big-play-button'
            }),
            (t.handleClick = function (e) {
                var t = this.player_.play()
                if (this.mouseused_ && e.clientX && e.clientY) {
                    var i = this.player_.usingPlugin('eme') && this.player_.eme.sessions && 0 < this.player_.eme.sessions.length
                    return Et(t), void (!this.player_.tech(!0) || ((N || O) && i) || this.player_.tech(!0).focus())
                }
                var i = this.player_.getChild('controlBar'),
                    n = i && i.getChild('playToggle')
                n
                    ? ((i = function () {
                          return n.focus()
                      }),
                      wt(t) ? t.then(i, function () {}) : this.setTimeout(i, 1))
                    : this.player_.tech(!0).focus()
            }),
            (t.handleKeyDown = function (e) {
                ;(this.mouseused_ = !1), n.prototype.handleKeyDown.call(this, e)
            }),
            (t.handleMouseDown = function (e) {
                this.mouseused_ = !0
            }),
            e
        )
    })(sn)
    ;(Bt.prototype.controlText_ = 'Play Video'),
        pt.registerComponent('BigPlayButton', Bt),
        pt.registerComponent(
            'CloseButton',
            (function (i) {
                function e(e, t) {
                    e = i.call(this, e, t) || this
                    return e.controlText((t && t.controlText) || e.localize('Close')), e
                }
                mt(e, i)
                var t = e.prototype
                return (
                    (t.buildCSSClass = function () {
                        return 'vjs-close-button ' + i.prototype.buildCSSClass.call(this)
                    }),
                    (t.handleClick = function (e) {
                        this.trigger({ type: 'close', bubbles: !1 })
                    }),
                    (t.handleKeyDown = function (e) {
                        ht.isEventKey(e, 'Esc') ? (e.preventDefault(), e.stopPropagation(), this.trigger('click')) : i.prototype.handleKeyDown.call(this, e)
                    }),
                    e
                )
            })(sn)
        )
    Ft = (function (n) {
        function e(e, t) {
            var i = n.call(this, e, (t = void 0 === t ? {} : t)) || this
            return (
                (t.replay = void 0 === t.replay || t.replay),
                i.on(e, 'play', function (e) {
                    return i.handlePlay(e)
                }),
                i.on(e, 'pause', function (e) {
                    return i.handlePause(e)
                }),
                t.replay &&
                    i.on(e, 'ended', function (e) {
                        return i.handleEnded(e)
                    }),
                i
            )
        }
        mt(e, n)
        var t = e.prototype
        return (
            (t.buildCSSClass = function () {
                return 'vjs-play-control ' + n.prototype.buildCSSClass.call(this)
            }),
            (t.handleClick = function (e) {
                this.player_.paused() ? Et(this.player_.play()) : this.player_.pause()
            }),
            (t.handleSeeked = function (e) {
                this.removeClass('vjs-ended'), this.player_.paused() ? this.handlePause(e) : this.handlePlay(e)
            }),
            (t.handlePlay = function (e) {
                this.removeClass('vjs-ended'), this.removeClass('vjs-paused'), this.addClass('vjs-playing'), this.controlText('Pause')
            }),
            (t.handlePause = function (e) {
                this.removeClass('vjs-playing'), this.addClass('vjs-paused'), this.controlText('Play')
            }),
            (t.handleEnded = function (e) {
                var t = this
                this.removeClass('vjs-playing'),
                    this.addClass('vjs-ended'),
                    this.controlText('Replay'),
                    this.one(this.player_, 'seeked', function (e) {
                        return t.handleSeeked(e)
                    })
            }),
            e
        )
    })(sn)
    ;(Ft.prototype.controlText_ = 'Play'), pt.registerComponent('PlayToggle', Ft)
    function on(e, t) {
        e = e < 0 ? 0 : e
        var i = Math.floor(e % 60),
            n = Math.floor((e / 60) % 60),
            r = Math.floor(e / 3600),
            a = Math.floor((t / 60) % 60),
            t = Math.floor(t / 3600)
        return (r = 0 < (r = isNaN(e) || e === 1 / 0 ? (n = i = '-') : r) || 0 < t ? r + ':' : '') + (n = ((r || 10 <= a) && n < 10 ? '0' + n : n) + ':') + (i = i < 10 ? '0' + i : i)
    }
    var un = on
    function ln(e, t) {
        return un(e, (t = void 0 === t ? e : t))
    }
    k = (function (n) {
        function e(e, t) {
            var i = n.call(this, e, t) || this
            return (
                i.on(e, ['timeupdate', 'ended'], function (e) {
                    return i.updateContent(e)
                }),
                i.updateTextNode_(),
                i
            )
        }
        mt(e, n)
        var t = e.prototype
        return (
            (t.createEl = function () {
                var e = this.buildCSSClass(),
                    t = n.prototype.createEl.call(this, 'div', { className: e + ' vjs-time-control vjs-control' }),
                    i = $('span', { className: 'vjs-control-text', textContent: this.localize(this.labelText_) + ' ' }, { role: 'presentation' })
                return t.appendChild(i), (this.contentEl_ = $('span', { className: e + '-display' }, { 'aria-live': 'off', role: 'presentation' })), t.appendChild(this.contentEl_), t
            }),
            (t.dispose = function () {
                ;(this.contentEl_ = null), (this.textNode_ = null), n.prototype.dispose.call(this)
            }),
            (t.updateTextNode_ = function (e) {
                var t = this
                ;(e = ln((e = void 0 === e ? 0 : e))),
                    this.formattedTime_ !== e &&
                        ((this.formattedTime_ = e),
                        this.requestNamedAnimationFrame('TimeDisplay#updateTextNode_', function () {
                            var e
                            t.contentEl_ &&
                                ((e = t.textNode_) &&
                                    t.contentEl_.firstChild !== e &&
                                    ((e = null),
                                    h.warn('TimeDisplay#updateTextnode_: Prevented replacement of text node element since it was no longer a child of this node. Appending a new node instead.')),
                                (t.textNode_ = document.createTextNode(t.formattedTime_)),
                                t.textNode_ && (e ? t.contentEl_.replaceChild(t.textNode_, e) : t.contentEl_.appendChild(t.textNode_)))
                        }))
            }),
            (t.updateContent = function (e) {}),
            e
        )
    })(pt)
    ;(k.prototype.labelText_ = 'Time'), (k.prototype.controlText_ = 'Time'), pt.registerComponent('TimeDisplay', k)
    jt = (function (e) {
        function t() {
            return e.apply(this, arguments) || this
        }
        mt(t, e)
        var i = t.prototype
        return (
            (i.buildCSSClass = function () {
                return 'vjs-current-time'
            }),
            (i.updateContent = function (e) {
                var t = this.player_.ended() ? this.player_.duration() : this.player_.scrubbing() ? this.player_.getCache().currentTime : this.player_.currentTime()
                this.updateTextNode_(t)
            }),
            t
        )
    })(k)
    ;(jt.prototype.labelText_ = 'Current Time'), (jt.prototype.controlText_ = 'Current Time'), pt.registerComponent('CurrentTimeDisplay', jt)
    j = (function (n) {
        function e(e, t) {
            var i = n.call(this, e, t) || this,
                t = function (e) {
                    return i.updateContent(e)
                }
            return i.on(e, 'durationchange', t), i.on(e, 'loadstart', t), i.on(e, 'loadedmetadata', t), i
        }
        mt(e, n)
        var t = e.prototype
        return (
            (t.buildCSSClass = function () {
                return 'vjs-duration'
            }),
            (t.updateContent = function (e) {
                var t = this.player_.duration()
                this.updateTextNode_(t)
            }),
            e
        )
    })(k)
    ;(j.prototype.labelText_ = 'Duration'),
        (j.prototype.controlText_ = 'Duration'),
        pt.registerComponent('DurationDisplay', j),
        pt.registerComponent(
            'TimeDivider',
            (function (n) {
                function e() {
                    return n.apply(this, arguments) || this
                }
                return (
                    mt(e, n),
                    (e.prototype.createEl = function () {
                        var e = n.prototype.createEl.call(this, 'div', { className: 'vjs-time-control vjs-time-divider' }, { 'aria-hidden': !0 }),
                            t = n.prototype.createEl.call(this, 'div'),
                            i = n.prototype.createEl.call(this, 'span', { textContent: '/' })
                        return t.appendChild(i), e.appendChild(t), e
                    }),
                    e
                )
            })(pt)
        )
    f = (function (n) {
        function e(e, t) {
            var i = n.call(this, e, t) || this
            return (
                i.on(e, 'durationchange', function (e) {
                    return i.updateContent(e)
                }),
                i
            )
        }
        mt(e, n)
        var t = e.prototype
        return (
            (t.buildCSSClass = function () {
                return 'vjs-remaining-time'
            }),
            (t.createEl = function () {
                var e = n.prototype.createEl.call(this)
                return !1 !== this.options_.displayNegative && e.insertBefore($('span', {}, { 'aria-hidden': !0 }, '-'), this.contentEl_), e
            }),
            (t.updateContent = function (e) {
                var t
                'number' == typeof this.player_.duration() &&
                    ((t = this.player_.ended() ? 0 : this.player_.remainingTimeDisplay ? this.player_.remainingTimeDisplay() : this.player_.remainingTime()), this.updateTextNode_(t))
            }),
            e
        )
    })(k)
    ;(f.prototype.labelText_ = 'Remaining Time'),
        (f.prototype.controlText_ = 'Remaining Time'),
        pt.registerComponent('RemainingTimeDisplay', f),
        pt.registerComponent(
            'LiveDisplay',
            (function (n) {
                function e(e, t) {
                    var i = n.call(this, e, t) || this
                    return (
                        i.updateShowing(),
                        i.on(i.player(), 'durationchange', function (e) {
                            return i.updateShowing(e)
                        }),
                        i
                    )
                }
                mt(e, n)
                var t = e.prototype
                return (
                    (t.createEl = function () {
                        var e = n.prototype.createEl.call(this, 'div', { className: 'vjs-live-control vjs-control' })
                        return (
                            (this.contentEl_ = $('div', { className: 'vjs-live-display' }, { 'aria-live': 'off' })),
                            this.contentEl_.appendChild($('span', { className: 'vjs-control-text', textContent: this.localize('Stream Type') + ' ' })),
                            this.contentEl_.appendChild(document.createTextNode(this.localize('LIVE'))),
                            e.appendChild(this.contentEl_),
                            e
                        )
                    }),
                    (t.dispose = function () {
                        ;(this.contentEl_ = null), n.prototype.dispose.call(this)
                    }),
                    (t.updateShowing = function (e) {
                        this.player().duration() === 1 / 0 ? this.show() : this.hide()
                    }),
                    e
                )
            })(pt)
        )
    ui = (function (n) {
        function e(e, t) {
            var i = n.call(this, e, t) || this
            return (
                i.updateLiveEdgeStatus(),
                i.player_.liveTracker &&
                    ((i.updateLiveEdgeStatusHandler_ = function (e) {
                        return i.updateLiveEdgeStatus(e)
                    }),
                    i.on(i.player_.liveTracker, 'liveedgechange', i.updateLiveEdgeStatusHandler_)),
                i
            )
        }
        mt(e, n)
        var t = e.prototype
        return (
            (t.createEl = function () {
                var e = n.prototype.createEl.call(this, 'button', { className: 'vjs-seek-to-live-control vjs-control' })
                return (this.textEl_ = $('span', { className: 'vjs-seek-to-live-text', textContent: this.localize('LIVE') }, { 'aria-hidden': 'true' })), e.appendChild(this.textEl_), e
            }),
            (t.updateLiveEdgeStatus = function () {
                !this.player_.liveTracker || this.player_.liveTracker.atLiveEdge()
                    ? (this.setAttribute('aria-disabled', !0), this.addClass('vjs-at-live-edge'), this.controlText('Seek to live, currently playing live'))
                    : (this.setAttribute('aria-disabled', !1), this.removeClass('vjs-at-live-edge'), this.controlText('Seek to live, currently behind live'))
            }),
            (t.handleClick = function () {
                this.player_.liveTracker.seekToLiveEdge()
            }),
            (t.dispose = function () {
                this.player_.liveTracker && this.off(this.player_.liveTracker, 'liveedgechange', this.updateLiveEdgeStatusHandler_), (this.textEl_ = null), n.prototype.dispose.call(this)
            }),
            e
        )
    })(sn)
    ;(ui.prototype.controlText_ = 'Seek to live, currently playing live'), pt.registerComponent('SeekToLive', ui)
    function cn(e, t, i) {
        return (e = Number(e)), Math.min(i, Math.max(t, isNaN(e) ? t : e))
    }
    li = (function (n) {
        function e(e, t) {
            var i = n.call(this, e, t) || this
            return (
                (i.handleMouseDown_ = function (e) {
                    return i.handleMouseDown(e)
                }),
                (i.handleMouseUp_ = function (e) {
                    return i.handleMouseUp(e)
                }),
                (i.handleKeyDown_ = function (e) {
                    return i.handleKeyDown(e)
                }),
                (i.handleClick_ = function (e) {
                    return i.handleClick(e)
                }),
                (i.handleMouseMove_ = function (e) {
                    return i.handleMouseMove(e)
                }),
                (i.update_ = function (e) {
                    return i.update(e)
                }),
                (i.bar = i.getChild(i.options_.barName)),
                i.vertical(!!i.options_.vertical),
                i.enable(),
                i
            )
        }
        mt(e, n)
        var t = e.prototype
        return (
            (t.enabled = function () {
                return this.enabled_
            }),
            (t.enable = function () {
                this.enabled() ||
                    (this.on('mousedown', this.handleMouseDown_),
                    this.on('touchstart', this.handleMouseDown_),
                    this.on('keydown', this.handleKeyDown_),
                    this.on('click', this.handleClick_),
                    this.on(this.player_, 'controlsvisible', this.update),
                    this.playerEvent && this.on(this.player_, this.playerEvent, this.update),
                    this.removeClass('disabled'),
                    this.setAttribute('tabindex', 0),
                    (this.enabled_ = !0))
            }),
            (t.disable = function () {
                var e
                this.enabled() &&
                    ((e = this.bar.el_.ownerDocument),
                    this.off('mousedown', this.handleMouseDown_),
                    this.off('touchstart', this.handleMouseDown_),
                    this.off('keydown', this.handleKeyDown_),
                    this.off('click', this.handleClick_),
                    this.off(this.player_, 'controlsvisible', this.update_),
                    this.off(e, 'mousemove', this.handleMouseMove_),
                    this.off(e, 'mouseup', this.handleMouseUp_),
                    this.off(e, 'touchmove', this.handleMouseMove_),
                    this.off(e, 'touchend', this.handleMouseUp_),
                    this.removeAttribute('tabindex'),
                    this.addClass('disabled'),
                    this.playerEvent && this.off(this.player_, this.playerEvent, this.update),
                    (this.enabled_ = !1))
            }),
            (t.createEl = function (e, t, i) {
                return (
                    void 0 === i && (i = {}),
                    ((t = void 0 === t ? {} : t).className = t.className + ' vjs-slider'),
                    (t = b({ tabIndex: 0 }, t)),
                    (i = b({ role: 'slider', 'aria-valuenow': 0, 'aria-valuemin': 0, 'aria-valuemax': 100, tabIndex: 0 }, i)),
                    n.prototype.createEl.call(this, e, t, i)
                )
            }),
            (t.handleMouseDown = function (e) {
                var t = this.bar.el_.ownerDocument
                'mousedown' === e.type && e.preventDefault(),
                    'touchstart' !== e.type || M || e.preventDefault(),
                    le(),
                    this.addClass('vjs-sliding'),
                    this.trigger('slideractive'),
                    this.on(t, 'mousemove', this.handleMouseMove_),
                    this.on(t, 'mouseup', this.handleMouseUp_),
                    this.on(t, 'touchmove', this.handleMouseMove_),
                    this.on(t, 'touchend', this.handleMouseUp_),
                    this.handleMouseMove(e, !0)
            }),
            (t.handleMouseMove = function (e) {}),
            (t.handleMouseUp = function () {
                var e = this.bar.el_.ownerDocument
                ce(),
                    this.removeClass('vjs-sliding'),
                    this.trigger('sliderinactive'),
                    this.off(e, 'mousemove', this.handleMouseMove_),
                    this.off(e, 'mouseup', this.handleMouseUp_),
                    this.off(e, 'touchmove', this.handleMouseMove_),
                    this.off(e, 'touchend', this.handleMouseUp_),
                    this.update()
            }),
            (t.update = function () {
                var t = this
                if (this.el_ && this.bar) {
                    var i = this.getProgress()
                    return i === this.progress_
                        ? i
                        : ((this.progress_ = i),
                          this.requestNamedAnimationFrame('Slider#update', function () {
                              var e = t.vertical() ? 'height' : 'width'
                              t.bar.el().style[e] = (100 * i).toFixed(2) + '%'
                          }),
                          i)
                }
            }),
            (t.getProgress = function () {
                return Number(cn(this.getPercent(), 0, 1).toFixed(4))
            }),
            (t.calculateDistance = function (e) {
                e = pe(this.el_, e)
                return this.vertical() ? e.y : e.x
            }),
            (t.handleKeyDown = function (e) {
                ht.isEventKey(e, 'Left') || ht.isEventKey(e, 'Down')
                    ? (e.preventDefault(), e.stopPropagation(), this.stepBack())
                    : ht.isEventKey(e, 'Right') || ht.isEventKey(e, 'Up')
                    ? (e.preventDefault(), e.stopPropagation(), this.stepForward())
                    : n.prototype.handleKeyDown.call(this, e)
            }),
            (t.handleClick = function (e) {
                e.stopPropagation(), e.preventDefault()
            }),
            (t.vertical = function (e) {
                if (void 0 === e) return this.vertical_ || !1
                ;(this.vertical_ = !!e), this.vertical_ ? this.addClass('vjs-slider-vertical') : this.addClass('vjs-slider-horizontal')
            }),
            e
        )
    })(pt)
    pt.registerComponent('Slider', li)
    function dn(e, t) {
        return cn((e / t) * 100, 0, 100).toFixed(2) + '%'
    }
    pt.registerComponent(
        'LoadProgressBar',
        (function (r) {
            function e(e, t) {
                var i = r.call(this, e, t) || this
                return (
                    (i.partEls_ = []),
                    i.on(e, 'progress', function (e) {
                        return i.update(e)
                    }),
                    i
                )
            }
            mt(e, r)
            var t = e.prototype
            return (
                (t.createEl = function () {
                    var e = r.prototype.createEl.call(this, 'div', { className: 'vjs-load-progress' }),
                        t = $('span', { className: 'vjs-control-text' }),
                        i = $('span', { textContent: this.localize('Loaded') }),
                        n = document.createTextNode(': ')
                    return (
                        (this.percentageEl_ = $('span', { className: 'vjs-control-text-loaded-percentage', textContent: '0%' })),
                        e.appendChild(t),
                        t.appendChild(i),
                        t.appendChild(n),
                        t.appendChild(this.percentageEl_),
                        e
                    )
                }),
                (t.dispose = function () {
                    ;(this.partEls_ = null), (this.percentageEl_ = null), r.prototype.dispose.call(this)
                }),
                (t.update = function (e) {
                    var l = this
                    this.requestNamedAnimationFrame('LoadProgressBar#update', function () {
                        var e = l.player_.liveTracker,
                            t = l.player_.buffered(),
                            e = e && e.isLive() ? e.seekableEnd() : l.player_.duration(),
                            i = l.player_.bufferedEnd(),
                            n = l.partEls_,
                            e = dn(i, e)
                        l.percent_ !== e && ((l.el_.style.width = e), J(l.percentageEl_, e), (l.percent_ = e))
                        for (var r = 0; r < t.length; r++) {
                            var a = t.start(r),
                                s = t.end(r),
                                o = n[r]
                            o || ((o = l.el_.appendChild($())), (n[r] = o)),
                                (o.dataset.start === a && o.dataset.end === s) || ((o.dataset.start = a), (o.dataset.end = s), (o.style.left = dn(a, i)), (o.style.width = dn(s - a, i)))
                        }
                        for (var u = n.length; u > t.length; u--) l.el_.removeChild(n[u - 1])
                        n.length = t.length
                    })
                }),
                e
            )
        })(pt)
    ),
        pt.registerComponent(
            'TimeTooltip',
            (function (i) {
                function e(e, t) {
                    t = i.call(this, e, t) || this
                    return (t.update = We(Ve(ft(t), t.update), 30)), t
                }
                mt(e, i)
                var t = e.prototype
                return (
                    (t.createEl = function () {
                        return i.prototype.createEl.call(this, 'div', { className: 'vjs-time-tooltip' }, { 'aria-hidden': 'true' })
                    }),
                    (t.update = function (e, t, i) {
                        var n = he(this.el_),
                            r = de(this.player_.el()),
                            a = e.width * t
                        r &&
                            n &&
                            ((t = e.left - r.left + a),
                            (r = e.width - a + (r.right - e.right)),
                            t < (e = n.width / 2) ? (e += e - t) : r < e && (e = r),
                            e < 0 ? (e = 0) : e > n.width && (e = n.width),
                            (e = Math.round(e)),
                            (this.el_.style.right = '-' + e + 'px'),
                            this.write(i))
                    }),
                    (t.write = function (e) {
                        J(this.el_, e)
                    }),
                    (t.updateTime = function (n, r, a, s) {
                        var o = this
                        this.requestNamedAnimationFrame('TimeTooltip#updateTime', function () {
                            var e,
                                t,
                                i = o.player_.duration()
                            ;(i = o.player_.liveTracker && o.player_.liveTracker.isLive() ? ((t = (e = o.player_.liveTracker.liveWindow()) - r * e) < 1 ? '' : '-') + ln(t, e) : ln(a, i)),
                                o.update(n, r, i),
                                s && s()
                        })
                    }),
                    e
                )
            })(pt)
        )
    Xt = (function (i) {
        function e(e, t) {
            t = i.call(this, e, t) || this
            return (t.update = We(Ve(ft(t), t.update), 30)), t
        }
        mt(e, i)
        var t = e.prototype
        return (
            (t.createEl = function () {
                return i.prototype.createEl.call(this, 'div', { className: 'vjs-play-progress vjs-slider-bar' }, { 'aria-hidden': 'true' })
            }),
            (t.update = function (e, t) {
                var i,
                    n = this.getChild('timeTooltip')
                n && ((i = this.player_.scrubbing() ? this.player_.getCache().currentTime : this.player_.currentTime()), n.updateTime(e, t, i))
            }),
            e
        )
    })(pt)
    ;(Xt.prototype.options_ = { children: [] }), q || A || Xt.prototype.options_.children.push('timeTooltip'), pt.registerComponent('PlayProgressBar', Xt)
    I = (function (i) {
        function e(e, t) {
            t = i.call(this, e, t) || this
            return (t.update = We(Ve(ft(t), t.update), 30)), t
        }
        mt(e, i)
        var t = e.prototype
        return (
            (t.createEl = function () {
                return i.prototype.createEl.call(this, 'div', { className: 'vjs-mouse-display' })
            }),
            (t.update = function (e, t) {
                var i = this,
                    n = t * this.player_.duration()
                this.getChild('timeTooltip').updateTime(e, t, n, function () {
                    i.el_.style.left = e.width * t + 'px'
                })
            }),
            e
        )
    })(pt)
    ;(I.prototype.options_ = { children: ['timeTooltip'] }), pt.registerComponent('MouseTimeDisplay', I)
    Bt = (function (a) {
        function e(e, t) {
            t = a.call(this, e, t) || this
            return t.setEventHandlers_(), t
        }
        mt(e, a)
        var t = e.prototype
        return (
            (t.setEventHandlers_ = function () {
                var t = this
                ;(this.update_ = Ve(this, this.update)),
                    (this.update = We(this.update_, 30)),
                    this.on(this.player_, ['ended', 'durationchange', 'timeupdate'], this.update),
                    this.player_.liveTracker && this.on(this.player_.liveTracker, 'liveedgechange', this.update),
                    (this.updateInterval = null),
                    (this.enableIntervalHandler_ = function (e) {
                        return t.enableInterval_(e)
                    }),
                    (this.disableIntervalHandler_ = function (e) {
                        return t.disableInterval_(e)
                    }),
                    this.on(this.player_, ['playing'], this.enableIntervalHandler_),
                    this.on(this.player_, ['ended', 'pause', 'waiting'], this.disableIntervalHandler_),
                    'hidden' in document && 'visibilityState' in document && this.on(document, 'visibilitychange', this.toggleVisibility_)
            }),
            (t.toggleVisibility_ = function (e) {
                'hidden' === document.visibilityState
                    ? (this.cancelNamedAnimationFrame('SeekBar#update'), this.cancelNamedAnimationFrame('Slider#update'), this.disableInterval_(e))
                    : (this.player_.ended() || this.player_.paused() || this.enableInterval_(), this.update())
            }),
            (t.enableInterval_ = function () {
                this.updateInterval || (this.updateInterval = this.setInterval(this.update, 30))
            }),
            (t.disableInterval_ = function (e) {
                ;(this.player_.liveTracker && this.player_.liveTracker.isLive() && e && 'ended' !== e.type) ||
                    (this.updateInterval && (this.clearInterval(this.updateInterval), (this.updateInterval = null)))
            }),
            (t.createEl = function () {
                return a.prototype.createEl.call(this, 'div', { className: 'vjs-progress-holder' }, { 'aria-label': this.localize('Progress Bar') })
            }),
            (t.update = function (e) {
                var n = this
                if ('hidden' !== document.visibilityState) {
                    var r = a.prototype.update.call(this)
                    return (
                        this.requestNamedAnimationFrame('SeekBar#update', function () {
                            var e = n.player_.ended() ? n.player_.duration() : n.getCurrentTime_(),
                                t = n.player_.liveTracker,
                                i = n.player_.duration()
                            t && t.isLive() && (i = n.player_.liveTracker.liveCurrentTime()),
                                n.percent_ !== r && (n.el_.setAttribute('aria-valuenow', (100 * r).toFixed(2)), (n.percent_ = r)),
                                (n.currentTime_ === e && n.duration_ === i) ||
                                    (n.el_.setAttribute('aria-valuetext', n.localize('progress bar timing: currentTime={1} duration={2}', [ln(e, i), ln(i, i)], '{1} of {2}')),
                                    (n.currentTime_ = e),
                                    (n.duration_ = i)),
                                n.bar && n.bar.update(de(n.el()), n.getProgress())
                        }),
                        r
                    )
                }
            }),
            (t.userSeek_ = function (e) {
                this.player_.liveTracker && this.player_.liveTracker.isLive() && this.player_.liveTracker.nextSeekedFromUser(), this.player_.currentTime(e)
            }),
            (t.getCurrentTime_ = function () {
                return this.player_.scrubbing() ? this.player_.getCache().currentTime : this.player_.currentTime()
            }),
            (t.getPercent = function () {
                var e,
                    t = this.getCurrentTime_(),
                    i = this.player_.liveTracker
                return i && i.isLive() ? ((e = (t - i.seekableStart()) / i.liveWindow()), i.atLiveEdge() && (e = 1)) : (e = t / this.player_.duration()), e
            }),
            (t.handleMouseDown = function (e) {
                _e(e) && (e.stopPropagation(), (this.videoWasPlaying = !this.player_.paused()), this.player_.pause(), a.prototype.handleMouseDown.call(this, e))
            }),
            (t.handleMouseMove = function (e, t) {
                if ((void 0 === t && (t = !1), _e(e))) {
                    t || this.player_.scrubbing() || this.player_.scrubbing(!0)
                    var i = this.calculateDistance(e),
                        n = this.player_.liveTracker
                    if (n && n.isLive()) {
                        if (0.99 <= i) return void n.seekToLiveEdge()
                        var r,
                            t = n.seekableStart(),
                            e = n.liveCurrentTime()
                        if ((r = (r = e <= (r = t + i * n.liveWindow()) ? e : r) <= t ? t + 0.1 : r) === 1 / 0) return
                    } else (r = i * this.player_.duration()) === this.player_.duration() && (r -= 0.1)
                    this.userSeek_(r)
                }
            }),
            (t.enable = function () {
                a.prototype.enable.call(this)
                var e = this.getChild('mouseTimeDisplay')
                e && e.show()
            }),
            (t.disable = function () {
                a.prototype.disable.call(this)
                var e = this.getChild('mouseTimeDisplay')
                e && e.hide()
            }),
            (t.handleMouseUp = function (e) {
                a.prototype.handleMouseUp.call(this, e),
                    e && e.stopPropagation(),
                    this.player_.scrubbing(!1),
                    this.player_.trigger({ type: 'timeupdate', target: this, manuallyTriggered: !0 }),
                    this.videoWasPlaying ? Et(this.player_.play()) : this.update_()
            }),
            (t.stepForward = function () {
                this.userSeek_(this.player_.currentTime() + 5)
            }),
            (t.stepBack = function () {
                this.userSeek_(this.player_.currentTime() - 5)
            }),
            (t.handleAction = function (e) {
                this.player_.paused() ? this.player_.play() : this.player_.pause()
            }),
            (t.handleKeyDown = function (e) {
                var t,
                    i = this.player_.liveTracker
                ht.isEventKey(e, 'Space') || ht.isEventKey(e, 'Enter')
                    ? (e.preventDefault(), e.stopPropagation(), this.handleAction(e))
                    : ht.isEventKey(e, 'Home')
                    ? (e.preventDefault(), e.stopPropagation(), this.userSeek_(0))
                    : ht.isEventKey(e, 'End')
                    ? (e.preventDefault(), e.stopPropagation(), i && i.isLive() ? this.userSeek_(i.liveCurrentTime()) : this.userSeek_(this.player_.duration()))
                    : /^[0-9]$/.test(ht(e))
                    ? (e.preventDefault(),
                      e.stopPropagation(),
                      (t = (10 * (ht.codes[ht(e)] - ht.codes[0])) / 100),
                      i && i.isLive() ? this.userSeek_(i.seekableStart() + i.liveWindow() * t) : this.userSeek_(this.player_.duration() * t))
                    : ht.isEventKey(e, 'PgDn')
                    ? (e.preventDefault(), e.stopPropagation(), this.userSeek_(this.player_.currentTime() - 60))
                    : ht.isEventKey(e, 'PgUp')
                    ? (e.preventDefault(), e.stopPropagation(), this.userSeek_(this.player_.currentTime() + 60))
                    : a.prototype.handleKeyDown.call(this, e)
            }),
            (t.dispose = function () {
                this.disableInterval_(),
                    this.off(this.player_, ['ended', 'durationchange', 'timeupdate'], this.update),
                    this.player_.liveTracker && this.off(this.player_.liveTracker, 'liveedgechange', this.update),
                    this.off(this.player_, ['playing'], this.enableIntervalHandler_),
                    this.off(this.player_, ['ended', 'pause', 'waiting'], this.disableIntervalHandler_),
                    'hidden' in document && 'visibilityState' in document && this.off(document, 'visibilitychange', this.toggleVisibility_),
                    a.prototype.dispose.call(this)
            }),
            e
        )
    })(li)
    ;(Bt.prototype.options_ = { children: ['loadProgressBar', 'playProgressBar'], barName: 'playProgressBar' }),
        q || A || Bt.prototype.options_.children.splice(1, 0, 'mouseTimeDisplay'),
        pt.registerComponent('SeekBar', Bt)
    Ft = (function (n) {
        function e(e, t) {
            var i = n.call(this, e, t) || this
            return (
                (i.handleMouseMove = We(Ve(ft(i), i.handleMouseMove), 30)),
                (i.throttledHandleMouseSeek = We(Ve(ft(i), i.handleMouseSeek), 30)),
                (i.handleMouseUpHandler_ = function (e) {
                    return i.handleMouseUp(e)
                }),
                (i.handleMouseDownHandler_ = function (e) {
                    return i.handleMouseDown(e)
                }),
                i.enable(),
                i
            )
        }
        mt(e, n)
        var t = e.prototype
        return (
            (t.createEl = function () {
                return n.prototype.createEl.call(this, 'div', { className: 'vjs-progress-control vjs-control' })
            }),
            (t.handleMouseMove = function (e) {
                var t,
                    i,
                    n,
                    r,
                    a = this.getChild('seekBar')
                a &&
                    ((t = a.getChild('playProgressBar')),
                    (i = a.getChild('mouseTimeDisplay')),
                    (t || i) && ((r = he((n = a.el()))), (e = pe(n, e).x), (e = cn(e, 0, 1)), i && i.update(r, e), t && t.update(r, a.getProgress())))
            }),
            (t.handleMouseSeek = function (e) {
                var t = this.getChild('seekBar')
                t && t.handleMouseMove(e)
            }),
            (t.enabled = function () {
                return this.enabled_
            }),
            (t.disable = function () {
                var e
                this.children().forEach(function (e) {
                    return e.disable && e.disable()
                }),
                    this.enabled() &&
                        (this.off(['mousedown', 'touchstart'], this.handleMouseDownHandler_),
                        this.off(this.el_, 'mousemove', this.handleMouseMove),
                        this.removeListenersAddedOnMousedownAndTouchstart(),
                        this.addClass('disabled'),
                        (this.enabled_ = !1),
                        this.player_.scrubbing() && ((e = this.getChild('seekBar')), this.player_.scrubbing(!1), e.videoWasPlaying && Et(this.player_.play())))
            }),
            (t.enable = function () {
                this.children().forEach(function (e) {
                    return e.enable && e.enable()
                }),
                    this.enabled() ||
                        (this.on(['mousedown', 'touchstart'], this.handleMouseDownHandler_), this.on(this.el_, 'mousemove', this.handleMouseMove), this.removeClass('disabled'), (this.enabled_ = !0))
            }),
            (t.removeListenersAddedOnMousedownAndTouchstart = function () {
                var e = this.el_.ownerDocument
                this.off(e, 'mousemove', this.throttledHandleMouseSeek),
                    this.off(e, 'touchmove', this.throttledHandleMouseSeek),
                    this.off(e, 'mouseup', this.handleMouseUpHandler_),
                    this.off(e, 'touchend', this.handleMouseUpHandler_)
            }),
            (t.handleMouseDown = function (e) {
                var t = this.el_.ownerDocument,
                    i = this.getChild('seekBar')
                i && i.handleMouseDown(e),
                    this.on(t, 'mousemove', this.throttledHandleMouseSeek),
                    this.on(t, 'touchmove', this.throttledHandleMouseSeek),
                    this.on(t, 'mouseup', this.handleMouseUpHandler_),
                    this.on(t, 'touchend', this.handleMouseUpHandler_)
            }),
            (t.handleMouseUp = function (e) {
                var t = this.getChild('seekBar')
                t && t.handleMouseUp(e), this.removeListenersAddedOnMousedownAndTouchstart()
            }),
            e
        )
    })(pt)
    ;(Ft.prototype.options_ = { children: ['seekBar'] }), pt.registerComponent('ProgressControl', Ft)
    jt = (function (n) {
        function e(e, t) {
            var i = n.call(this, e, t) || this
            return (
                i.on(e, ['enterpictureinpicture', 'leavepictureinpicture'], function (e) {
                    return i.handlePictureInPictureChange(e)
                }),
                i.on(e, ['disablepictureinpicturechanged', 'loadedmetadata'], function (e) {
                    return i.handlePictureInPictureEnabledChange(e)
                }),
                i.on(e, ['loadedmetadata', 'audioonlymodechange', 'audiopostermodechange'], function () {
                    'audio' === e.currentType().substring(0, 5) || e.audioPosterMode() || e.audioOnlyMode() ? (e.isInPictureInPicture() && e.exitPictureInPicture(), i.hide()) : i.show()
                }),
                i.disable(),
                i
            )
        }
        mt(e, n)
        var t = e.prototype
        return (
            (t.buildCSSClass = function () {
                return 'vjs-picture-in-picture-control ' + n.prototype.buildCSSClass.call(this)
            }),
            (t.handlePictureInPictureEnabledChange = function () {
                document.pictureInPictureEnabled && !1 === this.player_.disablePictureInPicture() ? this.enable() : this.disable()
            }),
            (t.handlePictureInPictureChange = function (e) {
                this.player_.isInPictureInPicture() ? this.controlText('Exit Picture-in-Picture') : this.controlText('Picture-in-Picture'), this.handlePictureInPictureEnabledChange()
            }),
            (t.handleClick = function (e) {
                this.player_.isInPictureInPicture() ? this.player_.exitPictureInPicture() : this.player_.requestPictureInPicture()
            }),
            e
        )
    })(sn)
    ;(jt.prototype.controlText_ = 'Picture-in-Picture'), pt.registerComponent('PictureInPictureToggle', jt)
    j = (function (n) {
        function e(e, t) {
            var i = n.call(this, e, t) || this
            return (
                i.on(e, 'fullscreenchange', function (e) {
                    return i.handleFullscreenChange(e)
                }),
                !1 === document[e.fsApi_.fullscreenEnabled] && i.disable(),
                i
            )
        }
        mt(e, n)
        var t = e.prototype
        return (
            (t.buildCSSClass = function () {
                return 'vjs-fullscreen-control ' + n.prototype.buildCSSClass.call(this)
            }),
            (t.handleFullscreenChange = function (e) {
                this.player_.isFullscreen() ? this.controlText('Non-Fullscreen') : this.controlText('Fullscreen')
            }),
            (t.handleClick = function (e) {
                this.player_.isFullscreen() ? this.player_.exitFullscreen() : this.player_.requestFullscreen()
            }),
            e
        )
    })(sn)
    ;(j.prototype.controlText_ = 'Fullscreen'), pt.registerComponent('FullscreenToggle', j)
    pt.registerComponent(
        'VolumeLevel',
        (function (t) {
            function e() {
                return t.apply(this, arguments) || this
            }
            return (
                mt(e, t),
                (e.prototype.createEl = function () {
                    var e = t.prototype.createEl.call(this, 'div', { className: 'vjs-volume-level' })
                    return e.appendChild(t.prototype.createEl.call(this, 'span', { className: 'vjs-control-text' })), e
                }),
                e
            )
        })(pt)
    ),
        pt.registerComponent(
            'VolumeLevelTooltip',
            (function (i) {
                function e(e, t) {
                    t = i.call(this, e, t) || this
                    return (t.update = We(Ve(ft(t), t.update), 30)), t
                }
                mt(e, i)
                var t = e.prototype
                return (
                    (t.createEl = function () {
                        return i.prototype.createEl.call(this, 'div', { className: 'vjs-volume-tooltip' }, { 'aria-hidden': 'true' })
                    }),
                    (t.update = function (e, t, i, n) {
                        if (!i) {
                            var r = de(this.el_),
                                a = de(this.player_.el()),
                                i = e.width * t
                            if (!a || !r) return
                            ;(t = e.left - a.left + i), (a = e.width - i + (a.right - e.right)), (e = r.width / 2)
                            t < e ? (e += e - t) : a < e && (e = a), e < 0 ? (e = 0) : e > r.width && (e = r.width), (this.el_.style.right = '-' + e + 'px')
                        }
                        this.write(n + '%')
                    }),
                    (t.write = function (e) {
                        J(this.el_, e)
                    }),
                    (t.updateVolume = function (e, t, i, n, r) {
                        var a = this
                        this.requestNamedAnimationFrame('VolumeLevelTooltip#updateVolume', function () {
                            a.update(e, t, i, n.toFixed(0)), r && r()
                        })
                    }),
                    e
                )
            })(pt)
        )
    k = (function (i) {
        function e(e, t) {
            t = i.call(this, e, t) || this
            return (t.update = We(Ve(ft(t), t.update), 30)), t
        }
        mt(e, i)
        var t = e.prototype
        return (
            (t.createEl = function () {
                return i.prototype.createEl.call(this, 'div', { className: 'vjs-mouse-display' })
            }),
            (t.update = function (e, t, i) {
                var n = this,
                    r = 100 * t
                this.getChild('volumeLevelTooltip').updateVolume(e, t, i, r, function () {
                    i ? (n.el_.style.bottom = e.height * t + 'px') : (n.el_.style.left = e.width * t + 'px')
                })
            }),
            e
        )
    })(pt)
    ;(k.prototype.options_ = { children: ['volumeLevelTooltip'] }), pt.registerComponent('MouseVolumeLevelDisplay', k)
    f = (function (n) {
        function e(e, t) {
            var i = n.call(this, e, t) || this
            return (
                i.on('slideractive', function (e) {
                    return i.updateLastVolume_(e)
                }),
                i.on(e, 'volumechange', function (e) {
                    return i.updateARIAAttributes(e)
                }),
                e.ready(function () {
                    return i.updateARIAAttributes()
                }),
                i
            )
        }
        mt(e, n)
        var t = e.prototype
        return (
            (t.createEl = function () {
                return n.prototype.createEl.call(this, 'div', { className: 'vjs-volume-bar vjs-slider-bar' }, { 'aria-label': this.localize('Volume Level'), 'aria-live': 'polite' })
            }),
            (t.handleMouseDown = function (e) {
                _e(e) && n.prototype.handleMouseDown.call(this, e)
            }),
            (t.handleMouseMove = function (e) {
                var t,
                    i,
                    n,
                    r = this.getChild('mouseVolumeLevelDisplay')
                r && ((t = de((n = this.el()))), (i = this.vertical()), (n = pe(n, e)), (n = i ? n.y : n.x), (n = cn(n, 0, 1)), r.update(t, n, i)),
                    _e(e) && (this.checkMuted(), this.player_.volume(this.calculateDistance(e)))
            }),
            (t.checkMuted = function () {
                this.player_.muted() && this.player_.muted(!1)
            }),
            (t.getPercent = function () {
                return this.player_.muted() ? 0 : this.player_.volume()
            }),
            (t.stepForward = function () {
                this.checkMuted(), this.player_.volume(this.player_.volume() + 0.1)
            }),
            (t.stepBack = function () {
                this.checkMuted(), this.player_.volume(this.player_.volume() - 0.1)
            }),
            (t.updateARIAAttributes = function (e) {
                var t = this.player_.muted() ? 0 : this.volumeAsPercentage_()
                this.el_.setAttribute('aria-valuenow', t), this.el_.setAttribute('aria-valuetext', t + '%')
            }),
            (t.volumeAsPercentage_ = function () {
                return Math.round(100 * this.player_.volume())
            }),
            (t.updateLastVolume_ = function () {
                var e = this,
                    t = this.player_.volume()
                this.one('sliderinactive', function () {
                    0 === e.player_.volume() && e.player_.lastVolume_(t)
                })
            }),
            e
        )
    })(li)
    ;(f.prototype.options_ = { children: ['volumeLevel'], barName: 'volumeLevel' }),
        q || A || f.prototype.options_.children.splice(0, 0, 'mouseVolumeLevelDisplay'),
        (f.prototype.playerEvent = 'volumechange'),
        pt.registerComponent('VolumeBar', f)
    ui = (function (a) {
        function e(e, t) {
            var i, n, r
            return (
                ((t = void 0 === t ? {} : t).vertical = t.vertical || !1),
                ('undefined' != typeof t.volumeBar && !S(t.volumeBar)) || ((t.volumeBar = t.volumeBar || {}), (t.volumeBar.vertical = t.vertical)),
                (i = a.call(this, e, t) || this),
                (n = ft(i)),
                (r = e).tech_ && !r.tech_.featuresVolumeControl && n.addClass('vjs-hidden'),
                n.on(r, 'loadstart', function () {
                    r.tech_.featuresVolumeControl ? n.removeClass('vjs-hidden') : n.addClass('vjs-hidden')
                }),
                (i.throttledHandleMouseMove = We(Ve(ft(i), i.handleMouseMove), 30)),
                (i.handleMouseUpHandler_ = function (e) {
                    return i.handleMouseUp(e)
                }),
                i.on('mousedown', function (e) {
                    return i.handleMouseDown(e)
                }),
                i.on('touchstart', function (e) {
                    return i.handleMouseDown(e)
                }),
                i.on('mousemove', function (e) {
                    return i.handleMouseMove(e)
                }),
                i.on(i.volumeBar, ['focus', 'slideractive'], function () {
                    i.volumeBar.addClass('vjs-slider-active'), i.addClass('vjs-slider-active'), i.trigger('slideractive')
                }),
                i.on(i.volumeBar, ['blur', 'sliderinactive'], function () {
                    i.volumeBar.removeClass('vjs-slider-active'), i.removeClass('vjs-slider-active'), i.trigger('sliderinactive')
                }),
                i
            )
        }
        mt(e, a)
        var t = e.prototype
        return (
            (t.createEl = function () {
                var e = 'vjs-volume-horizontal'
                return this.options_.vertical && (e = 'vjs-volume-vertical'), a.prototype.createEl.call(this, 'div', { className: 'vjs-volume-control vjs-control ' + e })
            }),
            (t.handleMouseDown = function (e) {
                var t = this.el_.ownerDocument
                this.on(t, 'mousemove', this.throttledHandleMouseMove),
                    this.on(t, 'touchmove', this.throttledHandleMouseMove),
                    this.on(t, 'mouseup', this.handleMouseUpHandler_),
                    this.on(t, 'touchend', this.handleMouseUpHandler_)
            }),
            (t.handleMouseUp = function (e) {
                var t = this.el_.ownerDocument
                this.off(t, 'mousemove', this.throttledHandleMouseMove),
                    this.off(t, 'touchmove', this.throttledHandleMouseMove),
                    this.off(t, 'mouseup', this.handleMouseUpHandler_),
                    this.off(t, 'touchend', this.handleMouseUpHandler_)
            }),
            (t.handleMouseMove = function (e) {
                this.volumeBar.handleMouseMove(e)
            }),
            e
        )
    })(pt)
    ;(ui.prototype.options_ = { children: ['volumeBar'] }), pt.registerComponent('VolumeControl', ui)
    Xt = (function (a) {
        function e(e, t) {
            var i,
                n,
                r = a.call(this, e, t) || this
            return (
                (i = ft(r)),
                (n = e).tech_ && !n.tech_.featuresMuteControl && i.addClass('vjs-hidden'),
                i.on(n, 'loadstart', function () {
                    n.tech_.featuresMuteControl ? i.removeClass('vjs-hidden') : i.addClass('vjs-hidden')
                }),
                r.on(e, ['loadstart', 'volumechange'], function (e) {
                    return r.update(e)
                }),
                r
            )
        }
        mt(e, a)
        var t = e.prototype
        return (
            (t.buildCSSClass = function () {
                return 'vjs-mute-control ' + a.prototype.buildCSSClass.call(this)
            }),
            (t.handleClick = function (e) {
                var t = this.player_.volume(),
                    i = this.player_.lastVolume_()
                0 === t ? (this.player_.volume(i < 0.1 ? 0.1 : i), this.player_.muted(!1)) : this.player_.muted(!this.player_.muted())
            }),
            (t.update = function (e) {
                this.updateIcon_(), this.updateControlText_()
            }),
            (t.updateIcon_ = function () {
                var e = this.player_.volume(),
                    t = 3
                q && this.player_.tech_ && this.player_.tech_.el_ && this.player_.muted(this.player_.tech_.el_.muted),
                    0 === e || this.player_.muted() ? (t = 0) : e < 0.33 ? (t = 1) : e < 0.67 && (t = 2)
                for (var i = 0; i < 4; i++) ie(this.el_, 'vjs-vol-' + i)
                te(this.el_, 'vjs-vol-' + t)
            }),
            (t.updateControlText_ = function () {
                var e = this.player_.muted() || 0 === this.player_.volume() ? 'Unmute' : 'Mute'
                this.controlText() !== e && this.controlText(e)
            }),
            e
        )
    })(sn)
    ;(Xt.prototype.controlText_ = 'Mute'), pt.registerComponent('MuteToggle', Xt)
    I = (function (n) {
        function e(e, t) {
            var i
            return (
                'undefined' != typeof (t = void 0 === t ? {} : t).inline ? (t.inline = t.inline) : (t.inline = !0),
                ('undefined' != typeof t.volumeControl && !S(t.volumeControl)) || ((t.volumeControl = t.volumeControl || {}), (t.volumeControl.vertical = !t.inline)),
                ((i = n.call(this, e, t) || this).handleKeyPressHandler_ = function (e) {
                    return i.handleKeyPress(e)
                }),
                i.on(e, ['loadstart'], function (e) {
                    return i.volumePanelState_(e)
                }),
                i.on(i.muteToggle, 'keyup', function (e) {
                    return i.handleKeyPress(e)
                }),
                i.on(i.volumeControl, 'keyup', function (e) {
                    return i.handleVolumeControlKeyUp(e)
                }),
                i.on('keydown', function (e) {
                    return i.handleKeyPress(e)
                }),
                i.on('mouseover', function (e) {
                    return i.handleMouseOver(e)
                }),
                i.on('mouseout', function (e) {
                    return i.handleMouseOut(e)
                }),
                i.on(i.volumeControl, ['slideractive'], i.sliderActive_),
                i.on(i.volumeControl, ['sliderinactive'], i.sliderInactive_),
                i
            )
        }
        mt(e, n)
        var t = e.prototype
        return (
            (t.sliderActive_ = function () {
                this.addClass('vjs-slider-active')
            }),
            (t.sliderInactive_ = function () {
                this.removeClass('vjs-slider-active')
            }),
            (t.volumePanelState_ = function () {
                this.volumeControl.hasClass('vjs-hidden') && this.muteToggle.hasClass('vjs-hidden') && this.addClass('vjs-hidden'),
                    this.volumeControl.hasClass('vjs-hidden') && !this.muteToggle.hasClass('vjs-hidden') && this.addClass('vjs-mute-toggle-only')
            }),
            (t.createEl = function () {
                var e = 'vjs-volume-panel-horizontal'
                return this.options_.inline || (e = 'vjs-volume-panel-vertical'), n.prototype.createEl.call(this, 'div', { className: 'vjs-volume-panel vjs-control ' + e })
            }),
            (t.dispose = function () {
                this.handleMouseOut(), n.prototype.dispose.call(this)
            }),
            (t.handleVolumeControlKeyUp = function (e) {
                ht.isEventKey(e, 'Esc') && this.muteToggle.focus()
            }),
            (t.handleMouseOver = function (e) {
                this.addClass('vjs-hover'), Be(document, 'keyup', this.handleKeyPressHandler_)
            }),
            (t.handleMouseOut = function (e) {
                this.removeClass('vjs-hover'), Fe(document, 'keyup', this.handleKeyPressHandler_)
            }),
            (t.handleKeyPress = function (e) {
                ht.isEventKey(e, 'Esc') && this.handleMouseOut()
            }),
            e
        )
    })(pt)
    ;(I.prototype.options_ = { children: ['muteToggle', 'volumeControl'] }), pt.registerComponent('VolumePanel', I)
    var hn = (function (n) {
        function e(e, t) {
            var i = n.call(this, e, t) || this
            return (
                t && (i.menuButton_ = t.menuButton),
                (i.focusedChild_ = -1),
                i.on('keydown', function (e) {
                    return i.handleKeyDown(e)
                }),
                (i.boundHandleBlur_ = function (e) {
                    return i.handleBlur(e)
                }),
                (i.boundHandleTapClick_ = function (e) {
                    return i.handleTapClick(e)
                }),
                i
            )
        }
        mt(e, n)
        var t = e.prototype
        return (
            (t.addEventListenerForItem = function (e) {
                e instanceof pt && (this.on(e, 'blur', this.boundHandleBlur_), this.on(e, ['tap', 'click'], this.boundHandleTapClick_))
            }),
            (t.removeEventListenerForItem = function (e) {
                e instanceof pt && (this.off(e, 'blur', this.boundHandleBlur_), this.off(e, ['tap', 'click'], this.boundHandleTapClick_))
            }),
            (t.removeChild = function (e) {
                'string' == typeof e && (e = this.getChild(e)), this.removeEventListenerForItem(e), n.prototype.removeChild.call(this, e)
            }),
            (t.addItem = function (e) {
                e = this.addChild(e)
                e && this.addEventListenerForItem(e)
            }),
            (t.createEl = function () {
                var e = this.options_.contentElType || 'ul'
                ;(this.contentEl_ = $(e, { className: 'vjs-menu-content' })), this.contentEl_.setAttribute('role', 'menu')
                e = n.prototype.createEl.call(this, 'div', { append: this.contentEl_, className: 'vjs-menu' })
                return (
                    e.appendChild(this.contentEl_),
                    Be(e, 'click', function (e) {
                        e.preventDefault(), e.stopImmediatePropagation()
                    }),
                    e
                )
            }),
            (t.dispose = function () {
                ;(this.contentEl_ = null), (this.boundHandleBlur_ = null), (this.boundHandleTapClick_ = null), n.prototype.dispose.call(this)
            }),
            (t.handleBlur = function (e) {
                var t = e.relatedTarget || document.activeElement
                this.children().some(function (e) {
                    return e.el() === t
                }) ||
                    ((e = this.menuButton_) && e.buttonPressed_ && t !== e.el().firstChild && e.unpressButton())
            }),
            (t.handleTapClick = function (t) {
                var e
                this.menuButton_ &&
                    (this.menuButton_.unpressButton(),
                    (e = this.children()),
                    !Array.isArray(e) ||
                        ((e = e.filter(function (e) {
                            return e.el() === t.target
                        })[0]) &&
                            'CaptionSettingsMenuItem' !== e.name() &&
                            this.menuButton_.focus()))
            }),
            (t.handleKeyDown = function (e) {
                ht.isEventKey(e, 'Left') || ht.isEventKey(e, 'Down')
                    ? (e.preventDefault(), e.stopPropagation(), this.stepForward())
                    : (ht.isEventKey(e, 'Right') || ht.isEventKey(e, 'Up')) && (e.preventDefault(), e.stopPropagation(), this.stepBack())
            }),
            (t.stepForward = function () {
                var e = 0
                void 0 !== this.focusedChild_ && (e = this.focusedChild_ + 1), this.focus(e)
            }),
            (t.stepBack = function () {
                var e = 0
                void 0 !== this.focusedChild_ && (e = this.focusedChild_ - 1), this.focus(e)
            }),
            (t.focus = function (e) {
                void 0 === e && (e = 0)
                var t = this.children().slice()
                t.length && t[0].hasClass('vjs-menu-title') && t.shift(), 0 < t.length && (e < 0 ? (e = 0) : e >= t.length && (e = t.length - 1), t[(this.focusedChild_ = e)].el_.focus())
            }),
            e
        )
    })(pt)
    pt.registerComponent('Menu', hn)
    Bt = (function (n) {
        function e(e, t) {
            var i
            ;((i = n.call(this, e, (t = void 0 === t ? {} : t)) || this).menuButton_ = new sn(e, t)), i.menuButton_.controlText(i.controlText_), i.menuButton_.el_.setAttribute('aria-haspopup', 'true')
            t = sn.prototype.buildCSSClass()
            ;(i.menuButton_.el_.className = i.buildCSSClass() + ' ' + t), i.menuButton_.removeClass('vjs-control'), i.addChild(i.menuButton_), i.update(), (i.enabled_ = !0)
            t = function (e) {
                return i.handleClick(e)
            }
            return (
                (i.handleMenuKeyUp_ = function (e) {
                    return i.handleMenuKeyUp(e)
                }),
                i.on(i.menuButton_, 'tap', t),
                i.on(i.menuButton_, 'click', t),
                i.on(i.menuButton_, 'keydown', function (e) {
                    return i.handleKeyDown(e)
                }),
                i.on(i.menuButton_, 'mouseenter', function () {
                    i.addClass('vjs-hover'), i.menu.show(), Be(document, 'keyup', i.handleMenuKeyUp_)
                }),
                i.on('mouseleave', function (e) {
                    return i.handleMouseLeave(e)
                }),
                i.on('keydown', function (e) {
                    return i.handleSubmenuKeyDown(e)
                }),
                i
            )
        }
        mt(e, n)
        var t = e.prototype
        return (
            (t.update = function () {
                var e = this.createMenu()
                this.menu && (this.menu.dispose(), this.removeChild(this.menu)),
                    (this.menu = e),
                    this.addChild(e),
                    (this.buttonPressed_ = !1),
                    this.menuButton_.el_.setAttribute('aria-expanded', 'false'),
                    this.items && this.items.length <= this.hideThreshold_
                        ? (this.hide(), this.menu.contentEl_.removeAttribute('role'))
                        : (this.show(), this.menu.contentEl_.setAttribute('role', 'menu'))
            }),
            (t.createMenu = function () {
                var e,
                    t = new hn(this.player_, { menuButton: this })
                if (
                    ((this.hideThreshold_ = 0),
                    this.options_.title && ((e = $('li', { className: 'vjs-menu-title', textContent: ut(this.options_.title), tabIndex: -1 })), (e = new pt(this.player_, { el: e })), t.addItem(e)),
                    (this.items = this.createItems()),
                    this.items)
                )
                    for (var i = 0; i < this.items.length; i++) t.addItem(this.items[i])
                return t
            }),
            (t.createItems = function () {}),
            (t.createEl = function () {
                return n.prototype.createEl.call(this, 'div', { className: this.buildWrapperCSSClass() }, {})
            }),
            (t.buildWrapperCSSClass = function () {
                var e = 'vjs-menu-button'
                return !0 === this.options_.inline ? (e += '-inline') : (e += '-popup'), 'vjs-menu-button ' + e + ' ' + sn.prototype.buildCSSClass() + ' ' + n.prototype.buildCSSClass.call(this)
            }),
            (t.buildCSSClass = function () {
                var e = 'vjs-menu-button'
                return !0 === this.options_.inline ? (e += '-inline') : (e += '-popup'), 'vjs-menu-button ' + e + ' ' + n.prototype.buildCSSClass.call(this)
            }),
            (t.controlText = function (e, t) {
                return void 0 === t && (t = this.menuButton_.el()), this.menuButton_.controlText(e, t)
            }),
            (t.dispose = function () {
                this.handleMouseLeave(), n.prototype.dispose.call(this)
            }),
            (t.handleClick = function (e) {
                this.buttonPressed_ ? this.unpressButton() : this.pressButton()
            }),
            (t.handleMouseLeave = function (e) {
                this.removeClass('vjs-hover'), Fe(document, 'keyup', this.handleMenuKeyUp_)
            }),
            (t.focus = function () {
                this.menuButton_.focus()
            }),
            (t.blur = function () {
                this.menuButton_.blur()
            }),
            (t.handleKeyDown = function (e) {
                ht.isEventKey(e, 'Esc') || ht.isEventKey(e, 'Tab')
                    ? (this.buttonPressed_ && this.unpressButton(), ht.isEventKey(e, 'Tab') || (e.preventDefault(), this.menuButton_.focus()))
                    : (ht.isEventKey(e, 'Up') || ht.isEventKey(e, 'Down')) && (this.buttonPressed_ || (e.preventDefault(), this.pressButton()))
            }),
            (t.handleMenuKeyUp = function (e) {
                ;(ht.isEventKey(e, 'Esc') || ht.isEventKey(e, 'Tab')) && this.removeClass('vjs-hover')
            }),
            (t.handleSubmenuKeyPress = function (e) {
                this.handleSubmenuKeyDown(e)
            }),
            (t.handleSubmenuKeyDown = function (e) {
                ;(ht.isEventKey(e, 'Esc') || ht.isEventKey(e, 'Tab')) && (this.buttonPressed_ && this.unpressButton(), ht.isEventKey(e, 'Tab') || (e.preventDefault(), this.menuButton_.focus()))
            }),
            (t.pressButton = function () {
                this.enabled_ && ((this.buttonPressed_ = !0), this.menu.show(), this.menu.lockShowing(), this.menuButton_.el_.setAttribute('aria-expanded', 'true'), (q && Y()) || this.menu.focus())
            }),
            (t.unpressButton = function () {
                this.enabled_ && ((this.buttonPressed_ = !1), this.menu.unlockShowing(), this.menu.hide(), this.menuButton_.el_.setAttribute('aria-expanded', 'false'))
            }),
            (t.disable = function () {
                this.unpressButton(), (this.enabled_ = !1), this.addClass('vjs-disabled'), this.menuButton_.disable()
            }),
            (t.enable = function () {
                ;(this.enabled_ = !0), this.removeClass('vjs-disabled'), this.menuButton_.enable()
            }),
            e
        )
    })(pt)
    pt.registerComponent('MenuButton', Bt)
    Ft = (function (r) {
        function e(e, t) {
            var i = t.tracks,
                t = r.call(this, e, t) || this
            if ((t.items.length <= 1 && t.hide(), !i)) return ft(t)
            var n = Ve(ft(t), t.update)
            return (
                i.addEventListener('removetrack', n),
                i.addEventListener('addtrack', n),
                i.addEventListener('labelchange', n),
                t.player_.on('ready', n),
                t.player_.on('dispose', function () {
                    i.removeEventListener('removetrack', n), i.removeEventListener('addtrack', n), i.removeEventListener('labelchange', n)
                }),
                t
            )
        }
        return mt(e, r), e
    })(Bt)
    pt.registerComponent('TrackButton', Ft)
    var pn = ['Tab', 'Esc', 'Up', 'Down', 'Right', 'Left'],
        jt = (function (n) {
            function e(e, t) {
                e = n.call(this, e, t) || this
                return (
                    (e.selectable = t.selectable),
                    (e.isSelected_ = t.selected || !1),
                    (e.multiSelectable = t.multiSelectable),
                    e.selected(e.isSelected_),
                    e.selectable ? (e.multiSelectable ? e.el_.setAttribute('role', 'menuitemcheckbox') : e.el_.setAttribute('role', 'menuitemradio')) : e.el_.setAttribute('role', 'menuitem'),
                    e
                )
            }
            mt(e, n)
            var t = e.prototype
            return (
                (t.createEl = function (e, t, i) {
                    this.nonIconControl = !0
                    i = n.prototype.createEl.call(this, 'li', b({ className: 'vjs-menu-item', tabIndex: -1 }, t), i)
                    return i.replaceChild($('span', { className: 'vjs-menu-item-text', textContent: this.localize(this.options_.label) }), i.querySelector('.vjs-icon-placeholder')), i
                }),
                (t.handleKeyDown = function (t) {
                    pn.some(function (e) {
                        return ht.isEventKey(t, e)
                    }) || n.prototype.handleKeyDown.call(this, t)
                }),
                (t.handleClick = function (e) {
                    this.selected(!0)
                }),
                (t.selected = function (e) {
                    this.selectable &&
                        (e
                            ? (this.addClass('vjs-selected'), this.el_.setAttribute('aria-checked', 'true'), this.controlText(', selected'), (this.isSelected_ = !0))
                            : (this.removeClass('vjs-selected'), this.el_.setAttribute('aria-checked', 'false'), this.controlText(''), (this.isSelected_ = !1)))
                }),
                e
            )
        })(C)
    pt.registerComponent('MenuItem', jt)
    var fn = (function (u) {
        function e(e, t) {
            var n,
                i = t.track,
                r = e.textTracks()
            ;(t.label = i.label || i.language || 'Unknown'),
                (t.selected = 'showing' === i.mode),
                ((n = u.call(this, e, t) || this).track = i),
                (n.kinds = (t.kinds || [t.kind || n.track.kind]).filter(Boolean))
            function a() {
                for (var e = arguments.length, t = new Array(e), i = 0; i < e; i++) t[i] = arguments[i]
                n.handleTracksChange.apply(ft(n), t)
            }
            function s() {
                for (var e = arguments.length, t = new Array(e), i = 0; i < e; i++) t[i] = arguments[i]
                n.handleSelectedLanguageChange.apply(ft(n), t)
            }
            var o
            return (
                e.on(['loadstart', 'texttrackchange'], a),
                r.addEventListener('change', a),
                r.addEventListener('selectedlanguagechange', s),
                n.on('dispose', function () {
                    e.off(['loadstart', 'texttrackchange'], a), r.removeEventListener('change', a), r.removeEventListener('selectedlanguagechange', s)
                }),
                void 0 === r.onchange &&
                    n.on(['tap', 'click'], function () {
                        if ('object' != typeof window.Event)
                            try {
                                o = new window.Event('change')
                            } catch (e) {}
                        o || (o = document.createEvent('Event')).initEvent('change', !0, !0), r.dispatchEvent(o)
                    }),
                n.handleTracksChange(),
                n
            )
        }
        mt(e, u)
        var t = e.prototype
        return (
            (t.handleClick = function (e) {
                var t = this.track,
                    i = this.player_.textTracks()
                if ((u.prototype.handleClick.call(this, e), i))
                    for (var n = 0; n < i.length; n++) {
                        var r = i[n]
                        ;-1 !== this.kinds.indexOf(r.kind) && (r === t ? 'showing' !== r.mode && (r.mode = 'showing') : 'disabled' !== r.mode && (r.mode = 'disabled'))
                    }
            }),
            (t.handleTracksChange = function (e) {
                var t = 'showing' === this.track.mode
                t !== this.isSelected_ && this.selected(t)
            }),
            (t.handleSelectedLanguageChange = function (e) {
                var t
                'showing' === this.track.mode &&
                    (((t = this.player_.cache_.selectedLanguage) && t.enabled && t.language === this.track.language && t.kind !== this.track.kind) ||
                        (this.player_.cache_.selectedLanguage = { enabled: !0, language: this.track.language, kind: this.track.kind }))
            }),
            (t.dispose = function () {
                ;(this.track = null), u.prototype.dispose.call(this)
            }),
            e
        )
    })(jt)
    pt.registerComponent('TextTrackMenuItem', fn)
    var mn = (function (i) {
        function e(e, t) {
            return (
                (t.track = { player: e, kind: t.kind, kinds: t.kinds, default: !1, mode: 'disabled' }),
                t.kinds || (t.kinds = [t.kind]),
                t.label ? (t.track.label = t.label) : (t.track.label = t.kinds.join(' and ') + ' off'),
                (t.selectable = !0),
                (t.multiSelectable = !1),
                i.call(this, e, t) || this
            )
        }
        mt(e, i)
        var t = e.prototype
        return (
            (t.handleTracksChange = function (e) {
                for (var t = this.player().textTracks(), i = !0, n = 0, r = t.length; n < r; n++) {
                    var a = t[n]
                    if (-1 < this.options_.kinds.indexOf(a.kind) && 'showing' === a.mode) {
                        i = !1
                        break
                    }
                }
                i !== this.isSelected_ && this.selected(i)
            }),
            (t.handleSelectedLanguageChange = function (e) {
                for (var t = this.player().textTracks(), i = !0, n = 0, r = t.length; n < r; n++) {
                    var a = t[n]
                    if (-1 < ['captions', 'descriptions', 'subtitles'].indexOf(a.kind) && 'showing' === a.mode) {
                        i = !1
                        break
                    }
                }
                i && (this.player_.cache_.selectedLanguage = { enabled: !1 })
            }),
            e
        )
    })(fn)
    pt.registerComponent('OffTextTrackMenuItem', mn)
    j = (function (i) {
        function e(e, t) {
            return ((t = void 0 === t ? {} : t).tracks = e.textTracks()), i.call(this, e, t) || this
        }
        return (
            mt(e, i),
            (e.prototype.createItems = function (e, t) {
                var i
                void 0 === t && (t = fn),
                    this.label_ && (i = this.label_ + ' off'),
                    (e = void 0 === e ? [] : e).push(new mn(this.player_, { kinds: this.kinds_, kind: this.kind_, label: i })),
                    (this.hideThreshold_ += 1)
                var n = this.player_.textTracks()
                Array.isArray(this.kinds_) || (this.kinds_ = [this.kind_])
                for (var r = 0; r < n.length; r++) {
                    var a,
                        s = n[r]
                    ;-1 < this.kinds_.indexOf(s.kind) &&
                        ((a = new t(this.player_, { track: s, kinds: this.kinds_, kind: this.kind_, selectable: !0, multiSelectable: !1 })).addClass('vjs-' + s.kind + '-menu-item'), e.push(a))
                }
                return e
            }),
            e
        )
    })(Ft)
    pt.registerComponent('TextTrackButton', j)
    var gn = (function (a) {
        function e(e, t) {
            var i = t.track,
                n = t.cue,
                r = e.currentTime()
            return (t.selectable = !0), (t.multiSelectable = !1), (t.label = n.text), (t.selected = n.startTime <= r && r < n.endTime), ((t = a.call(this, e, t) || this).track = i), (t.cue = n), t
        }
        return (
            mt(e, a),
            (e.prototype.handleClick = function (e) {
                a.prototype.handleClick.call(this), this.player_.currentTime(this.cue.startTime)
            }),
            e
        )
    })(jt)
    pt.registerComponent('ChaptersTrackMenuItem', gn)
    k = (function (r) {
        function e(e, t, i) {
            var n = r.call(this, e, t, i) || this
            return (
                (n.selectCurrentItem_ = function () {
                    n.items.forEach(function (e) {
                        e.selected(n.track_.activeCues[0] === e.cue)
                    })
                }),
                n
            )
        }
        mt(e, r)
        var t = e.prototype
        return (
            (t.buildCSSClass = function () {
                return 'vjs-chapters-button ' + r.prototype.buildCSSClass.call(this)
            }),
            (t.buildWrapperCSSClass = function () {
                return 'vjs-chapters-button ' + r.prototype.buildWrapperCSSClass.call(this)
            }),
            (t.update = function (e) {
                ;(e && e.track && 'chapters' !== e.track.kind) ||
                    ((e = this.findChaptersTrack()) !== this.track_
                        ? (this.setTrack(e), r.prototype.update.call(this))
                        : (!this.items || (e && e.cues && e.cues.length !== this.items.length)) && r.prototype.update.call(this))
            }),
            (t.setTrack = function (e) {
                var t
                this.track_ !== e &&
                    (this.updateHandler_ || (this.updateHandler_ = this.update.bind(this)),
                    this.track_ &&
                        ((t = this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_)) && t.removeEventListener('load', this.updateHandler_),
                        this.track_.removeEventListener('cuechange', this.selectCurrentItem_),
                        (this.track_ = null)),
                    (this.track_ = e),
                    this.track_ &&
                        ((this.track_.mode = 'hidden'),
                        (e = this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_)) && e.addEventListener('load', this.updateHandler_),
                        this.track_.addEventListener('cuechange', this.selectCurrentItem_)))
            }),
            (t.findChaptersTrack = function () {
                for (var e = this.player_.textTracks() || [], t = e.length - 1; 0 <= t; t--) {
                    var i = e[t]
                    if (i.kind === this.kind_) return i
                }
            }),
            (t.getMenuCaption = function () {
                return this.track_ && this.track_.label ? this.track_.label : this.localize(ut(this.kind_))
            }),
            (t.createMenu = function () {
                return (this.options_.title = this.getMenuCaption()), r.prototype.createMenu.call(this)
            }),
            (t.createItems = function () {
                var e = []
                if (!this.track_) return e
                var t = this.track_.cues
                if (!t) return e
                for (var i = 0, n = t.length; i < n; i++) {
                    var r = t[i],
                        r = new gn(this.player_, { track: this.track_, cue: r })
                    e.push(r)
                }
                return e
            }),
            e
        )
    })(j)
    ;(k.prototype.kind_ = 'chapters'), (k.prototype.controlText_ = 'Chapters'), pt.registerComponent('ChaptersButton', k)
    li = (function (a) {
        function e(e, t, i) {
            var i = a.call(this, e, t, i) || this,
                n = e.textTracks(),
                r = Ve(ft(i), i.handleTracksChange)
            return (
                n.addEventListener('change', r),
                i.on('dispose', function () {
                    n.removeEventListener('change', r)
                }),
                i
            )
        }
        mt(e, a)
        var t = e.prototype
        return (
            (t.handleTracksChange = function (e) {
                for (var t = this.player().textTracks(), i = !1, n = 0, r = t.length; n < r; n++) {
                    var a = t[n]
                    if (a.kind !== this.kind_ && 'showing' === a.mode) {
                        i = !0
                        break
                    }
                }
                i ? this.disable() : this.enable()
            }),
            (t.buildCSSClass = function () {
                return 'vjs-descriptions-button ' + a.prototype.buildCSSClass.call(this)
            }),
            (t.buildWrapperCSSClass = function () {
                return 'vjs-descriptions-button ' + a.prototype.buildWrapperCSSClass.call(this)
            }),
            e
        )
    })(j)
    ;(li.prototype.kind_ = 'descriptions'), (li.prototype.controlText_ = 'Descriptions'), pt.registerComponent('DescriptionsButton', li)
    f = (function (n) {
        function e(e, t, i) {
            return n.call(this, e, t, i) || this
        }
        mt(e, n)
        var t = e.prototype
        return (
            (t.buildCSSClass = function () {
                return 'vjs-subtitles-button ' + n.prototype.buildCSSClass.call(this)
            }),
            (t.buildWrapperCSSClass = function () {
                return 'vjs-subtitles-button ' + n.prototype.buildWrapperCSSClass.call(this)
            }),
            e
        )
    })(j)
    ;(f.prototype.kind_ = 'subtitles'), (f.prototype.controlText_ = 'Subtitles'), pt.registerComponent('SubtitlesButton', f)
    var yn = (function (i) {
        function e(e, t) {
            return (
                (t.track = { player: e, kind: t.kind, label: t.kind + ' settings', selectable: !1, default: !1, mode: 'disabled' }),
                (t.selectable = !1),
                (t.name = 'CaptionSettingsMenuItem'),
                (e = i.call(this, e, t) || this).addClass('vjs-texttrack-settings'),
                e.controlText(', opens ' + t.kind + ' settings dialog'),
                e
            )
        }
        return (
            mt(e, i),
            (e.prototype.handleClick = function (e) {
                this.player().getChild('textTrackSettings').open()
            }),
            e
        )
    })(fn)
    pt.registerComponent('CaptionSettingsMenuItem', yn)
    ui = (function (n) {
        function e(e, t, i) {
            return n.call(this, e, t, i) || this
        }
        mt(e, n)
        var t = e.prototype
        return (
            (t.buildCSSClass = function () {
                return 'vjs-captions-button ' + n.prototype.buildCSSClass.call(this)
            }),
            (t.buildWrapperCSSClass = function () {
                return 'vjs-captions-button ' + n.prototype.buildWrapperCSSClass.call(this)
            }),
            (t.createItems = function () {
                var e = []
                return (
                    (this.player().tech_ && this.player().tech_.featuresNativeTextTracks) ||
                        !this.player().getChild('textTrackSettings') ||
                        (e.push(new yn(this.player_, { kind: this.kind_ })), (this.hideThreshold_ += 1)),
                    n.prototype.createItems.call(this, e)
                )
            }),
            e
        )
    })(j)
    ;(ui.prototype.kind_ = 'captions'), (ui.prototype.controlText_ = 'Captions'), pt.registerComponent('CaptionsButton', ui)
    var vn = (function (n) {
        function e() {
            return n.apply(this, arguments) || this
        }
        return (
            mt(e, n),
            (e.prototype.createEl = function (e, t, i) {
                ;(t = n.prototype.createEl.call(this, e, t, i)), (i = t.querySelector('.vjs-menu-item-text'))
                return (
                    'captions' === this.options_.track.kind &&
                        (i.appendChild($('span', { className: 'vjs-icon-placeholder' }, { 'aria-hidden': !0 })),
                        i.appendChild($('span', { className: 'vjs-control-text', textContent: ' ' + this.localize('Captions') }))),
                    t
                )
            }),
            e
        )
    })(fn)
    pt.registerComponent('SubsCapsMenuItem', vn)
    Xt = (function (i) {
        function e(e, t) {
            return (
                ((t = i.call(this, e, (t = void 0 === t ? {} : t)) || this).label_ = 'subtitles'),
                -1 < ['en', 'en-us', 'en-ca', 'fr-ca'].indexOf(t.player_.language_) && (t.label_ = 'captions'),
                t.menuButton_.controlText(ut(t.label_)),
                t
            )
        }
        mt(e, i)
        var t = e.prototype
        return (
            (t.buildCSSClass = function () {
                return 'vjs-subs-caps-button ' + i.prototype.buildCSSClass.call(this)
            }),
            (t.buildWrapperCSSClass = function () {
                return 'vjs-subs-caps-button ' + i.prototype.buildWrapperCSSClass.call(this)
            }),
            (t.createItems = function () {
                var e = []
                return (
                    (this.player().tech_ && this.player().tech_.featuresNativeTextTracks) ||
                        !this.player().getChild('textTrackSettings') ||
                        (e.push(new yn(this.player_, { kind: this.label_ })), (this.hideThreshold_ += 1)),
                    (e = i.prototype.createItems.call(this, e, vn))
                )
            }),
            e
        )
    })(j)
    ;(Xt.prototype.kinds_ = ['captions', 'subtitles']), (Xt.prototype.controlText_ = 'Subtitles'), pt.registerComponent('SubsCapsButton', Xt)
    var _n = (function (s) {
        function e(e, t) {
            var n,
                i = t.track,
                r = e.audioTracks()
            ;(t.label = i.label || i.language || 'Unknown'), (t.selected = i.enabled), ((n = s.call(this, e, t) || this).track = i), n.addClass('vjs-' + i.kind + '-menu-item')
            function a() {
                for (var e = arguments.length, t = new Array(e), i = 0; i < e; i++) t[i] = arguments[i]
                n.handleTracksChange.apply(ft(n), t)
            }
            return (
                r.addEventListener('change', a),
                n.on('dispose', function () {
                    r.removeEventListener('change', a)
                }),
                n
            )
        }
        mt(e, s)
        var t = e.prototype
        return (
            (t.createEl = function (e, t, i) {
                ;(t = s.prototype.createEl.call(this, e, t, i)), (i = t.querySelector('.vjs-menu-item-text'))
                return (
                    'main-desc' === this.options_.track.kind &&
                        (i.appendChild($('span', { className: 'vjs-icon-placeholder' }, { 'aria-hidden': !0 })),
                        i.appendChild($('span', { className: 'vjs-control-text', textContent: ' ' + this.localize('Descriptions') }))),
                    t
                )
            }),
            (t.handleClick = function (e) {
                if ((s.prototype.handleClick.call(this, e), (this.track.enabled = !0), this.player_.tech_.featuresNativeAudioTracks))
                    for (var t = this.player_.audioTracks(), i = 0; i < t.length; i++) {
                        var n = t[i]
                        n !== this.track && (n.enabled = n === this.track)
                    }
            }),
            (t.handleTracksChange = function (e) {
                this.selected(this.track.enabled)
            }),
            e
        )
    })(jt)
    pt.registerComponent('AudioTrackMenuItem', _n)
    I = (function (i) {
        function e(e, t) {
            return ((t = void 0 === t ? {} : t).tracks = e.audioTracks()), i.call(this, e, t) || this
        }
        mt(e, i)
        var t = e.prototype
        return (
            (t.buildCSSClass = function () {
                return 'vjs-audio-button ' + i.prototype.buildCSSClass.call(this)
            }),
            (t.buildWrapperCSSClass = function () {
                return 'vjs-audio-button ' + i.prototype.buildWrapperCSSClass.call(this)
            }),
            (t.createItems = function (e) {
                void 0 === e && (e = []), (this.hideThreshold_ = 1)
                for (var t = this.player_.audioTracks(), i = 0; i < t.length; i++) {
                    var n = t[i]
                    e.push(new _n(this.player_, { track: n, selectable: !0, multiSelectable: !1 }))
                }
                return e
            }),
            e
        )
    })(Ft)
    ;(I.prototype.controlText_ = 'Audio Track'), pt.registerComponent('AudioTrackButton', I)
    var bn = (function (a) {
        function e(e, t) {
            var i,
                n = t.rate,
                r = parseFloat(n, 10)
            return (
                (t.label = n),
                (t.selected = r === e.playbackRate()),
                (t.selectable = !0),
                (t.multiSelectable = !1),
                ((i = a.call(this, e, t) || this).label = n),
                (i.rate = r),
                i.on(e, 'ratechange', function (e) {
                    return i.update(e)
                }),
                i
            )
        }
        mt(e, a)
        var t = e.prototype
        return (
            (t.handleClick = function (e) {
                a.prototype.handleClick.call(this), this.player().playbackRate(this.rate)
            }),
            (t.update = function (e) {
                this.selected(this.player().playbackRate() === this.rate)
            }),
            e
        )
    })(jt)
    ;(bn.prototype.contentElType = 'button'), pt.registerComponent('PlaybackRateMenuItem', bn)
    C = (function (n) {
        function e(e, t) {
            var i = n.call(this, e, t) || this
            return (
                i.menuButton_.el_.setAttribute('aria-describedby', i.labelElId_),
                i.updateVisibility(),
                i.updateLabel(),
                i.on(e, 'loadstart', function (e) {
                    return i.updateVisibility(e)
                }),
                i.on(e, 'ratechange', function (e) {
                    return i.updateLabel(e)
                }),
                i.on(e, 'playbackrateschange', function (e) {
                    return i.handlePlaybackRateschange(e)
                }),
                i
            )
        }
        mt(e, n)
        var t = e.prototype
        return (
            (t.createEl = function () {
                var e = n.prototype.createEl.call(this)
                return (
                    (this.labelElId_ = 'vjs-playback-rate-value-label-' + this.id_),
                    (this.labelEl_ = $('div', { className: 'vjs-playback-rate-value', id: this.labelElId_, textContent: '1x' })),
                    e.appendChild(this.labelEl_),
                    e
                )
            }),
            (t.dispose = function () {
                ;(this.labelEl_ = null), n.prototype.dispose.call(this)
            }),
            (t.buildCSSClass = function () {
                return 'vjs-playback-rate ' + n.prototype.buildCSSClass.call(this)
            }),
            (t.buildWrapperCSSClass = function () {
                return 'vjs-playback-rate ' + n.prototype.buildWrapperCSSClass.call(this)
            }),
            (t.createItems = function () {
                for (var e = this.playbackRates(), t = [], i = e.length - 1; 0 <= i; i--) t.push(new bn(this.player(), { rate: e[i] + 'x' }))
                return t
            }),
            (t.updateARIAAttributes = function () {
                this.el().setAttribute('aria-valuenow', this.player().playbackRate())
            }),
            (t.handleClick = function (e) {
                var t = this.player().playbackRate(),
                    i = this.playbackRates(),
                    t = (i.indexOf(t) + 1) % i.length
                this.player().playbackRate(i[t])
            }),
            (t.handlePlaybackRateschange = function (e) {
                this.update()
            }),
            (t.playbackRates = function () {
                var e = this.player()
                return (e.playbackRates && e.playbackRates()) || []
            }),
            (t.playbackRateSupported = function () {
                return this.player().tech_ && this.player().tech_.featuresPlaybackRate && this.playbackRates() && 0 < this.playbackRates().length
            }),
            (t.updateVisibility = function (e) {
                this.playbackRateSupported() ? this.removeClass('vjs-hidden') : this.addClass('vjs-hidden')
            }),
            (t.updateLabel = function (e) {
                this.playbackRateSupported() && (this.labelEl_.textContent = this.player().playbackRate() + 'x')
            }),
            e
        )
    })(Bt)
    ;(C.prototype.controlText_ = 'Playback Rate'), pt.registerComponent('PlaybackRateMenuButton', C)
    k = (function (n) {
        function e() {
            return n.apply(this, arguments) || this
        }
        mt(e, n)
        var t = e.prototype
        return (
            (t.buildCSSClass = function () {
                return 'vjs-spacer ' + n.prototype.buildCSSClass.call(this)
            }),
            (t.createEl = function (e, t, i) {
                return void 0 === e && (e = 'div'), void 0 === i && (i = {}), (t = void 0 === t ? {} : t).className || (t.className = this.buildCSSClass()), n.prototype.createEl.call(this, e, t, i)
            }),
            e
        )
    })(pt)
    pt.registerComponent('Spacer', k),
        pt.registerComponent(
            'CustomControlSpacer',
            (function (e) {
                function t() {
                    return e.apply(this, arguments) || this
                }
                mt(t, e)
                var i = t.prototype
                return (
                    (i.buildCSSClass = function () {
                        return 'vjs-custom-control-spacer ' + e.prototype.buildCSSClass.call(this)
                    }),
                    (i.createEl = function () {
                        return e.prototype.createEl.call(this, 'div', { className: this.buildCSSClass(), textContent: ' ' })
                    }),
                    t
                )
            })(k)
        )
    li = (function (e) {
        function t() {
            return e.apply(this, arguments) || this
        }
        return (
            mt(t, e),
            (t.prototype.createEl = function () {
                return e.prototype.createEl.call(this, 'div', { className: 'vjs-control-bar', dir: 'ltr' })
            }),
            t
        )
    })(pt)
    ;(li.prototype.options_ = {
        children: [
            'playToggle',
            'volumePanel',
            'currentTimeDisplay',
            'timeDivider',
            'durationDisplay',
            'progressControl',
            'liveDisplay',
            'seekToLive',
            'remainingTimeDisplay',
            'customControlSpacer',
            'playbackRateMenuButton',
            'chaptersButton',
            'descriptionsButton',
            'subsCapsButton',
            'audioTrackButton',
            'fullscreenToggle',
        ],
    }),
        'exitPictureInPicture' in document && li.prototype.options_.children.splice(li.prototype.options_.children.length - 1, 0, 'pictureInPictureToggle'),
        pt.registerComponent('ControlBar', li)
    f = (function (n) {
        function e(e, t) {
            var i = n.call(this, e, t) || this
            return (
                i.on(e, 'error', function (e) {
                    return i.open(e)
                }),
                i
            )
        }
        mt(e, n)
        var t = e.prototype
        return (
            (t.buildCSSClass = function () {
                return 'vjs-error-display ' + n.prototype.buildCSSClass.call(this)
            }),
            (t.content = function () {
                var e = this.player().error()
                return e ? this.localize(e.message) : ''
            }),
            e
        )
    })(At)
    ;(f.prototype.options_ = g({}, At.prototype.options_, { pauseOnOpen: !1, fillAlways: !0, temporary: !1, uncloseable: !0 })), pt.registerComponent('ErrorDisplay', f)
    var Tn = 'vjs-text-track-settings',
        ui = ['#000', 'Black'],
        j = ['#00F', 'Blue'],
        Xt = ['#0FF', 'Cyan'],
        Ft = ['#0F0', 'Green'],
        I = ['#F0F', 'Magenta'],
        jt = ['#F00', 'Red'],
        Bt = ['#FFF', 'White'],
        C = ['#FF0', 'Yellow'],
        k = ['1', 'Opaque'],
        li = ['0.5', 'Semi-Transparent'],
        f = ['0', 'Transparent'],
        Sn = {
            backgroundColor: { selector: '.vjs-bg-color > select', id: 'captions-background-color-%s', label: 'Color', options: [ui, Bt, jt, Ft, j, C, I, Xt] },
            backgroundOpacity: { selector: '.vjs-bg-opacity > select', id: 'captions-background-opacity-%s', label: 'Transparency', options: [k, li, f] },
            color: { selector: '.vjs-fg-color > select', id: 'captions-foreground-color-%s', label: 'Color', options: [Bt, ui, jt, Ft, j, C, I, Xt] },
            edgeStyle: {
                selector: '.vjs-edge-style > select',
                id: '%s',
                label: 'Text Edge Style',
                options: [
                    ['none', 'None'],
                    ['raised', 'Raised'],
                    ['depressed', 'Depressed'],
                    ['uniform', 'Uniform'],
                    ['dropshadow', 'Dropshadow'],
                ],
            },
            fontFamily: {
                selector: '.vjs-font-family > select',
                id: 'captions-font-family-%s',
                label: 'Font Family',
                options: [
                    ['proportionalSansSerif', 'Proportional Sans-Serif'],
                    ['monospaceSansSerif', 'Monospace Sans-Serif'],
                    ['proportionalSerif', 'Proportional Serif'],
                    ['monospaceSerif', 'Monospace Serif'],
                    ['casual', 'Casual'],
                    ['script', 'Script'],
                    ['small-caps', 'Small Caps'],
                ],
            },
            fontPercent: {
                selector: '.vjs-font-percent > select',
                id: 'captions-font-size-%s',
                label: 'Font Size',
                options: [
                    ['0.50', '50%'],
                    ['0.75', '75%'],
                    ['1.00', '100%'],
                    ['1.25', '125%'],
                    ['1.50', '150%'],
                    ['1.75', '175%'],
                    ['2.00', '200%'],
                    ['3.00', '300%'],
                    ['4.00', '400%'],
                ],
                default: 2,
                parser: function (e) {
                    return '1.00' === e ? null : Number(e)
                },
            },
            textOpacity: { selector: '.vjs-text-opacity > select', id: 'captions-foreground-opacity-%s', label: 'Transparency', options: [k, li] },
            windowColor: { selector: '.vjs-window-color > select', id: 'captions-window-color-%s', label: 'Color' },
            windowOpacity: { selector: '.vjs-window-opacity > select', id: 'captions-window-opacity-%s', label: 'Transparency', options: [f, li, k] },
        }
    function wn(e, t) {
        if ((e = t ? t(e) : e) && 'none' !== e) return e
    }
    ;(Sn.windowColor.options = Sn.backgroundColor.options),
        pt.registerComponent(
            'TextTrackSettings',
            (function (n) {
                function e(e, t) {
                    var i
                    return (
                        (t.temporary = !1),
                        ((i = n.call(this, e, t) || this).updateDisplay = i.updateDisplay.bind(ft(i))),
                        i.fill(),
                        (i.hasBeenOpened_ = i.hasBeenFilled_ = !0),
                        (i.endDialog = $('p', { className: 'vjs-control-text', textContent: i.localize('End of dialog window.') })),
                        i.el().appendChild(i.endDialog),
                        i.setDefaults(),
                        void 0 === t.persistTextTrackSettings && (i.options_.persistTextTrackSettings = i.options_.playerOptions.persistTextTrackSettings),
                        i.on(i.$('.vjs-done-button'), 'click', function () {
                            i.saveSettings(), i.close()
                        }),
                        i.on(i.$('.vjs-default-button'), 'click', function () {
                            i.setDefaults(), i.updateDisplay()
                        }),
                        _(Sn, function (e) {
                            i.on(i.$(e.selector), 'change', i.updateDisplay)
                        }),
                        i.options_.persistTextTrackSettings && i.restoreSettings(),
                        i
                    )
                }
                mt(e, n)
                var t = e.prototype
                return (
                    (t.dispose = function () {
                        ;(this.endDialog = null), n.prototype.dispose.call(this)
                    }),
                    (t.createElSelect_ = function (e, t, i) {
                        var n = this
                        void 0 === t && (t = ''), void 0 === i && (i = 'label')
                        var e = Sn[e],
                            r = e.id.replace('%s', this.id_),
                            a = [t, r].join(' ').trim()
                        return ['<' + i + ' id="' + r + '" class="' + ('label' === i ? 'vjs-label' : '') + '">', this.localize(e.label), '</' + i + '>', '<select aria-labelledby="' + a + '">']
                            .concat(
                                e.options.map(function (e) {
                                    var t = r + '-' + e[1].replace(/\W+/g, '')
                                    return ['<option id="' + t + '" value="' + e[0] + '" ', 'aria-labelledby="' + a + ' ' + t + '">', n.localize(e[1]), '</option>'].join('')
                                })
                            )
                            .concat('</select>')
                            .join('')
                    }),
                    (t.createElFgColor_ = function () {
                        var e = 'captions-text-legend-' + this.id_
                        return [
                            '<fieldset class="vjs-fg-color vjs-track-setting">',
                            '<legend id="' + e + '">',
                            this.localize('Text'),
                            '</legend>',
                            this.createElSelect_('color', e),
                            '<span class="vjs-text-opacity vjs-opacity">',
                            this.createElSelect_('textOpacity', e),
                            '</span>',
                            '</fieldset>',
                        ].join('')
                    }),
                    (t.createElBgColor_ = function () {
                        var e = 'captions-background-' + this.id_
                        return [
                            '<fieldset class="vjs-bg-color vjs-track-setting">',
                            '<legend id="' + e + '">',
                            this.localize('Background'),
                            '</legend>',
                            this.createElSelect_('backgroundColor', e),
                            '<span class="vjs-bg-opacity vjs-opacity">',
                            this.createElSelect_('backgroundOpacity', e),
                            '</span>',
                            '</fieldset>',
                        ].join('')
                    }),
                    (t.createElWinColor_ = function () {
                        var e = 'captions-window-' + this.id_
                        return [
                            '<fieldset class="vjs-window-color vjs-track-setting">',
                            '<legend id="' + e + '">',
                            this.localize('Window'),
                            '</legend>',
                            this.createElSelect_('windowColor', e),
                            '<span class="vjs-window-opacity vjs-opacity">',
                            this.createElSelect_('windowOpacity', e),
                            '</span>',
                            '</fieldset>',
                        ].join('')
                    }),
                    (t.createElColors_ = function () {
                        return $('div', { className: 'vjs-track-settings-colors', innerHTML: [this.createElFgColor_(), this.createElBgColor_(), this.createElWinColor_()].join('') })
                    }),
                    (t.createElFont_ = function () {
                        return $('div', {
                            className: 'vjs-track-settings-font',
                            innerHTML: [
                                '<fieldset class="vjs-font-percent vjs-track-setting">',
                                this.createElSelect_('fontPercent', '', 'legend'),
                                '</fieldset>',
                                '<fieldset class="vjs-edge-style vjs-track-setting">',
                                this.createElSelect_('edgeStyle', '', 'legend'),
                                '</fieldset>',
                                '<fieldset class="vjs-font-family vjs-track-setting">',
                                this.createElSelect_('fontFamily', '', 'legend'),
                                '</fieldset>',
                            ].join(''),
                        })
                    }),
                    (t.createElControls_ = function () {
                        var e = this.localize('restore all settings to the default values')
                        return $('div', {
                            className: 'vjs-track-settings-controls',
                            innerHTML: [
                                '<button type="button" class="vjs-default-button" title="' + e + '">',
                                this.localize('Reset'),
                                '<span class="vjs-control-text"> ' + e + '</span>',
                                '</button>',
                                '<button type="button" class="vjs-done-button">' + this.localize('Done') + '</button>',
                            ].join(''),
                        })
                    }),
                    (t.content = function () {
                        return [this.createElColors_(), this.createElFont_(), this.createElControls_()]
                    }),
                    (t.label = function () {
                        return this.localize('Caption Settings Dialog')
                    }),
                    (t.description = function () {
                        return this.localize('Beginning of dialog window. Escape will cancel and close the window.')
                    }),
                    (t.buildCSSClass = function () {
                        return n.prototype.buildCSSClass.call(this) + ' vjs-text-track-settings'
                    }),
                    (t.getValues = function () {
                        var i,
                            n,
                            e,
                            r = this
                        return (
                            (n = function (e, t, i) {
                                var n,
                                    t = ((n = r.$(t.selector)), (t = t.parser), wn(n.options[n.options.selectedIndex].value, t))
                                return void 0 !== t && (e[i] = t), e
                            }),
                            void 0 === (e = {}) && (e = 0),
                            v((i = Sn)).reduce(function (e, t) {
                                return n(e, i[t], t)
                            }, e)
                        )
                    }),
                    (t.setValues = function (i) {
                        var n = this
                        _(Sn, function (e, t) {
                            !(function (e, t, i) {
                                if (t)
                                    for (var n = 0; n < e.options.length; n++)
                                        if (wn(e.options[n].value, i) === t) {
                                            e.selectedIndex = n
                                            break
                                        }
                            })(n.$(e.selector), i[t], e.parser)
                        })
                    }),
                    (t.setDefaults = function () {
                        var i = this
                        _(Sn, function (e) {
                            var t = e.hasOwnProperty('default') ? e.default : 0
                            i.$(e.selector).selectedIndex = t
                        })
                    }),
                    (t.restoreSettings = function () {
                        var e
                        try {
                            e = JSON.parse(window.localStorage.getItem(Tn))
                        } catch (e) {
                            h.warn(e)
                        }
                        e && this.setValues(e)
                    }),
                    (t.saveSettings = function () {
                        if (this.options_.persistTextTrackSettings) {
                            var e = this.getValues()
                            try {
                                Object.keys(e).length ? window.localStorage.setItem(Tn, JSON.stringify(e)) : window.localStorage.removeItem(Tn)
                            } catch (e) {
                                h.warn(e)
                            }
                        }
                    }),
                    (t.updateDisplay = function () {
                        var e = this.player_.getChild('textTrackDisplay')
                        e && e.updateDisplay()
                    }),
                    (t.conditionalBlur_ = function () {
                        this.previouslyActiveEl_ = null
                        var e = this.player_.controlBar,
                            t = e && e.subsCapsButton,
                            e = e && e.captionsButton
                        t ? t.focus() : e && e.focus()
                    }),
                    e
                )
            })(At)
        ),
        pt.registerComponent(
            'ResizeManager',
            (function (a) {
                function e(e, t) {
                    var i,
                        n = t.ResizeObserver || window.ResizeObserver,
                        r = lt({ createEl: !(n = null === t.ResizeObserver ? !1 : n), reportTouchActivity: !1 }, t)
                    return (
                        ((i = a.call(this, e, r) || this).ResizeObserver = t.ResizeObserver || window.ResizeObserver),
                        (i.loadListener_ = null),
                        (i.resizeObserver_ = null),
                        (i.debouncedHandler_ = Ge(
                            function () {
                                i.resizeHandler()
                            },
                            100,
                            !1,
                            ft(i)
                        )),
                        n
                            ? ((i.resizeObserver_ = new i.ResizeObserver(i.debouncedHandler_)), i.resizeObserver_.observe(e.el()))
                            : ((i.loadListener_ = function () {
                                  var e, t
                                  i.el_ &&
                                      i.el_.contentWindow &&
                                      ((e = i.debouncedHandler_),
                                      (t = i.unloadListener_ =
                                          function () {
                                              Fe(this, 'resize', e), Fe(this, 'unload', t), (t = null)
                                          }),
                                      Be(i.el_.contentWindow, 'unload', t),
                                      Be(i.el_.contentWindow, 'resize', e))
                              }),
                              i.one('load', i.loadListener_)),
                        i
                    )
                }
                mt(e, a)
                var t = e.prototype
                return (
                    (t.createEl = function () {
                        return a.prototype.createEl.call(this, 'iframe', { className: 'vjs-resize-manager', tabIndex: -1, title: this.localize('No content') }, { 'aria-hidden': 'true' })
                    }),
                    (t.resizeHandler = function () {
                        this.player_ && this.player_.trigger && this.player_.trigger('playerresize')
                    }),
                    (t.dispose = function () {
                        this.debouncedHandler_ && this.debouncedHandler_.cancel(),
                            this.resizeObserver_ && (this.player_.el() && this.resizeObserver_.unobserve(this.player_.el()), this.resizeObserver_.disconnect()),
                            this.loadListener_ && this.off('load', this.loadListener_),
                            this.el_ && this.el_.contentWindow && this.unloadListener_ && this.unloadListener_.call(this.el_.contentWindow),
                            (this.ResizeObserver = null),
                            (this.resizeObserver = null),
                            (this.debouncedHandler_ = null),
                            (this.loadListener_ = null),
                            a.prototype.dispose.call(this)
                    }),
                    e
                )
            })(pt)
        )
    var En = { trackingThreshold: 20, liveTolerance: 15 }
    pt.registerComponent(
        'LiveTracker',
        (function (n) {
            function e(e, t) {
                var t = lt(En, t, { createEl: !1 }),
                    i = n.call(this, e, t) || this
                return (
                    (i.handleVisibilityChange_ = function (e) {
                        return i.handleVisibilityChange(e)
                    }),
                    (i.trackLiveHandler_ = function () {
                        return i.trackLive_()
                    }),
                    (i.handlePlay_ = function (e) {
                        return i.handlePlay(e)
                    }),
                    (i.handleFirstTimeupdate_ = function (e) {
                        return i.handleFirstTimeupdate(e)
                    }),
                    (i.handleSeeked_ = function (e) {
                        return i.handleSeeked(e)
                    }),
                    (i.seekToLiveEdge_ = function (e) {
                        return i.seekToLiveEdge(e)
                    }),
                    i.reset_(),
                    i.on(i.player_, 'durationchange', function (e) {
                        return i.handleDurationchange(e)
                    }),
                    i.on(i.player_, 'canplay', function () {
                        return i.toggleTracking()
                    }),
                    N && 'hidden' in document && 'visibilityState' in document && i.on(document, 'visibilitychange', i.handleVisibilityChange_),
                    i
                )
            }
            mt(e, n)
            var t = e.prototype
            return (
                (t.handleVisibilityChange = function () {
                    this.player_.duration() === 1 / 0 && (document.hidden ? this.stopTracking() : this.startTracking())
                }),
                (t.trackLive_ = function () {
                    var e,
                        t = this.player_.seekable()
                    t &&
                        t.length &&
                        ((e = Number(window.performance.now().toFixed(4))),
                        (t = -1 === this.lastTime_ ? 0 : (e - this.lastTime_) / 1e3),
                        (this.lastTime_ = e),
                        (this.pastSeekEnd_ = this.pastSeekEnd() + t),
                        (e = this.liveCurrentTime()),
                        (t = this.player_.currentTime()),
                        (t = this.player_.paused() || this.seekedBehindLive_ || Math.abs(e - t) > this.options_.liveTolerance),
                        (t = !this.timeupdateSeen_ || e === 1 / 0 ? !1 : t) !== this.behindLiveEdge_ && ((this.behindLiveEdge_ = t), this.trigger('liveedgechange')))
                }),
                (t.handleDurationchange = function () {
                    this.toggleTracking()
                }),
                (t.toggleTracking = function () {
                    this.player_.duration() === 1 / 0 && this.liveWindow() >= this.options_.trackingThreshold
                        ? (this.player_.options_.liveui && this.player_.addClass('vjs-liveui'), this.startTracking())
                        : (this.player_.removeClass('vjs-liveui'), this.stopTracking())
                }),
                (t.startTracking = function () {
                    this.isTracking() ||
                        (this.timeupdateSeen_ || (this.timeupdateSeen_ = this.player_.hasStarted()),
                        (this.trackingInterval_ = this.setInterval(this.trackLiveHandler_, 30)),
                        this.trackLive_(),
                        this.on(this.player_, ['play', 'pause'], this.trackLiveHandler_),
                        this.timeupdateSeen_
                            ? this.on(this.player_, 'seeked', this.handleSeeked_)
                            : (this.one(this.player_, 'play', this.handlePlay_), this.one(this.player_, 'timeupdate', this.handleFirstTimeupdate_)))
                }),
                (t.handleFirstTimeupdate = function () {
                    ;(this.timeupdateSeen_ = !0), this.on(this.player_, 'seeked', this.handleSeeked_)
                }),
                (t.handleSeeked = function () {
                    var e = Math.abs(this.liveCurrentTime() - this.player_.currentTime())
                    ;(this.seekedBehindLive_ = this.nextSeekedFromUser_ && 2 < e), (this.nextSeekedFromUser_ = !1), this.trackLive_()
                }),
                (t.handlePlay = function () {
                    this.one(this.player_, 'timeupdate', this.seekToLiveEdge_)
                }),
                (t.reset_ = function () {
                    ;(this.lastTime_ = -1),
                        (this.pastSeekEnd_ = 0),
                        (this.lastSeekEnd_ = -1),
                        (this.behindLiveEdge_ = !0),
                        (this.timeupdateSeen_ = !1),
                        (this.seekedBehindLive_ = !1),
                        (this.nextSeekedFromUser_ = !1),
                        this.clearInterval(this.trackingInterval_),
                        (this.trackingInterval_ = null),
                        this.off(this.player_, ['play', 'pause'], this.trackLiveHandler_),
                        this.off(this.player_, 'seeked', this.handleSeeked_),
                        this.off(this.player_, 'play', this.handlePlay_),
                        this.off(this.player_, 'timeupdate', this.handleFirstTimeupdate_),
                        this.off(this.player_, 'timeupdate', this.seekToLiveEdge_)
                }),
                (t.nextSeekedFromUser = function () {
                    this.nextSeekedFromUser_ = !0
                }),
                (t.stopTracking = function () {
                    this.isTracking() && (this.reset_(), this.trigger('liveedgechange'))
                }),
                (t.seekableEnd = function () {
                    for (var e = this.player_.seekable(), t = [], i = e ? e.length : 0; i--; ) t.push(e.end(i))
                    return t.length ? t.sort()[t.length - 1] : 1 / 0
                }),
                (t.seekableStart = function () {
                    for (var e = this.player_.seekable(), t = [], i = e ? e.length : 0; i--; ) t.push(e.start(i))
                    return t.length ? t.sort()[0] : 0
                }),
                (t.liveWindow = function () {
                    var e = this.liveCurrentTime()
                    return e === 1 / 0 ? 0 : e - this.seekableStart()
                }),
                (t.isLive = function () {
                    return this.isTracking()
                }),
                (t.atLiveEdge = function () {
                    return !this.behindLiveEdge()
                }),
                (t.liveCurrentTime = function () {
                    return this.pastSeekEnd() + this.seekableEnd()
                }),
                (t.pastSeekEnd = function () {
                    var e = this.seekableEnd()
                    return -1 !== this.lastSeekEnd_ && e !== this.lastSeekEnd_ && (this.pastSeekEnd_ = 0), (this.lastSeekEnd_ = e), this.pastSeekEnd_
                }),
                (t.behindLiveEdge = function () {
                    return this.behindLiveEdge_
                }),
                (t.isTracking = function () {
                    return 'number' == typeof this.trackingInterval_
                }),
                (t.seekToLiveEdge = function () {
                    ;(this.seekedBehindLive_ = !1), this.atLiveEdge() || ((this.nextSeekedFromUser_ = !1), this.player_.currentTime(this.liveCurrentTime()))
                }),
                (t.dispose = function () {
                    this.off(document, 'visibilitychange', this.handleVisibilityChange_), this.stopTracking(), n.prototype.dispose.call(this)
                }),
                e
            )
        })(pt)
    )
    function kn(e) {
        if ((n = e.el()).hasAttribute('src')) return e.triggerSourceset(n.src), 1
        var t = e.$$('source'),
            i = [],
            n = ''
        if (t.length) {
            for (var r = 0; r < t.length; r++) {
                var a = t[r].src
                a && -1 === i.indexOf(a) && i.push(a)
            }
            return !!i.length && (1 === i.length && (n = i[0]), e.triggerSourceset(n), !0)
        }
    }
    function Cn(e, t) {
        for (var i = {}, n = 0; n < e.length && !((i = Object.getOwnPropertyDescriptor(e[n], t)) && i.set && i.get); n++);
        return (i.enumerable = !0), (i.configurable = !0), i
    }
    function In(a) {
        var t,
            e,
            i,
            s = a.el()
        s.resetSourceWatch_ ||
            ((t = {}),
            (e = Cn([a.el(), window.HTMLMediaElement.prototype, window.Element.prototype, Ln], 'innerHTML')),
            (i = function (r) {
                return function () {
                    for (var e = arguments.length, t = new Array(e), i = 0; i < e; i++) t[i] = arguments[i]
                    var n = r.apply(s, t)
                    return kn(a), n
                }
            }),
            ['append', 'appendChild', 'insertAdjacentHTML'].forEach(function (e) {
                s[e] && ((t[e] = s[e]), (s[e] = i(t[e])))
            }),
            Object.defineProperty(s, 'innerHTML', lt(e, { set: i(e.set) })),
            (s.resetSourceWatch_ = function () {
                ;(s.resetSourceWatch_ = null),
                    Object.keys(t).forEach(function (e) {
                        s[e] = t[e]
                    }),
                    Object.defineProperty(s, 'innerHTML', e)
            }),
            a.one('sourceset', s.resetSourceWatch_))
    }
    function xn(i) {
        var n, t, r, a
        i.featuresSourceset &&
            ((n = i.el()).resetSourceset_ ||
                ((t = Cn([i.el(), window.HTMLMediaElement.prototype, Dn], 'src')),
                (r = n.setAttribute),
                (a = n.load),
                Object.defineProperty(
                    n,
                    'src',
                    lt(t, {
                        set: function (e) {
                            e = t.set.call(n, e)
                            return i.triggerSourceset(n.src), e
                        },
                    })
                ),
                (n.setAttribute = function (e, t) {
                    t = r.call(n, e, t)
                    return /src/i.test(e) && i.triggerSourceset(n.src), t
                }),
                (n.load = function () {
                    var e = a.call(n)
                    return kn(i) || (i.triggerSourceset(''), In(i)), e
                }),
                n.currentSrc ? i.triggerSourceset(n.currentSrc) : kn(i) || In(i),
                (n.resetSourceset_ = function () {
                    ;(n.resetSourceset_ = null), (n.load = a), (n.setAttribute = r), Object.defineProperty(n, 'src', t), n.resetSourceWatch_ && n.resetSourceWatch_()
                })))
    }
    function An(t, i, n, e) {
        function r(e) {
            return Object.defineProperty(t, i, { value: e, enumerable: !0, writable: !0 })
        }
        var a = {
            configurable: !0,
            enumerable: !0,
            get: function () {
                var e = n()
                return r(e), e
            },
        }
        return (e = void 0 === e ? !0 : e) && (a.set = r), Object.defineProperty(t, i, a)
    }
    var Pn,
        Ln = Object.defineProperty({}, 'innerHTML', {
            get: function () {
                return this.cloneNode(!0).innerHTML
            },
            set: function (e) {
                var t = document.createElement(this.nodeName.toLowerCase())
                t.innerHTML = e
                for (var i = document.createDocumentFragment(); t.childNodes.length; ) i.appendChild(t.childNodes[0])
                return (this.innerText = ''), window.Element.prototype.appendChild.call(this, i), this.innerHTML
            },
        }),
        Dn = Object.defineProperty({}, 'src', {
            get: function () {
                return this.hasAttribute('src') ? Rt(window.Element.prototype.getAttribute.call(this, 'src')) : ''
            },
            set: function (e) {
                return window.Element.prototype.setAttribute.call(this, 'src', e), e
            },
        }),
        On = (function (l) {
            function s(e, t) {
                var i = l.call(this, e, t) || this,
                    t = e.source,
                    n = !1
                if (
                    ((i.featuresVideoFrameCallback = i.featuresVideoFrameCallback && 'VIDEO' === i.el_.tagName),
                    t && (i.el_.currentSrc !== t.src || (e.tag && 3 === e.tag.initNetworkState_)) ? i.setSource(t) : i.handleLateInit_(i.el_),
                    e.enableSourceset && i.setupSourcesetHandling_(),
                    (i.isScrubbing_ = !1),
                    i.el_.hasChildNodes())
                ) {
                    for (var r = i.el_.childNodes, a = r.length, s = []; a--; ) {
                        var o = r[a]
                        'track' === o.nodeName.toLowerCase() &&
                            (i.featuresNativeTextTracks
                                ? (i.remoteTextTrackEls().addTrackElement_(o),
                                  i.remoteTextTracks().addTrack(o.track),
                                  i.textTracks().addTrack(o.track),
                                  n || i.el_.hasAttribute('crossorigin') || !Ut(o.src) || (n = !0))
                                : s.push(o))
                    }
                    for (var u = 0; u < s.length; u++) i.el_.removeChild(s[u])
                }
                return (
                    i.proxyNativeTracks_(),
                    i.featuresNativeTextTracks && n && h.warn("Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.\nThis may prevent text tracks from loading."),
                    i.restoreMetadataTracksInIOSNativePlayer_(),
                    (F || H || L) && !0 === e.nativeControlsForTouch && i.setControls(!0),
                    i.proxyWebkitFullscreen_(),
                    i.triggerReady(),
                    i
                )
            }
            mt(s, l)
            var e = s.prototype
            return (
                (e.dispose = function () {
                    this.el_ && this.el_.resetSourceset_ && this.el_.resetSourceset_(), s.disposeMediaElement(this.el_), (this.options_ = null), l.prototype.dispose.call(this)
                }),
                (e.setupSourcesetHandling_ = function () {
                    xn(this)
                }),
                (e.restoreMetadataTracksInIOSNativePlayer_ = function () {
                    function e() {
                        i = []
                        for (var e = 0; e < n.length; e++) {
                            var t = n[e]
                            'metadata' === t.kind && i.push({ track: t, storedMode: t.mode })
                        }
                    }
                    var i,
                        n = this.textTracks()
                    e(),
                        n.addEventListener('change', e),
                        this.on('dispose', function () {
                            return n.removeEventListener('change', e)
                        })
                    function r() {
                        for (var e = 0; e < i.length; e++) {
                            var t = i[e]
                            'disabled' === t.track.mode && t.track.mode !== t.storedMode && (t.track.mode = t.storedMode)
                        }
                        n.removeEventListener('change', r)
                    }
                    this.on('webkitbeginfullscreen', function () {
                        n.removeEventListener('change', e), n.removeEventListener('change', r), n.addEventListener('change', r)
                    }),
                        this.on('webkitendfullscreen', function () {
                            n.removeEventListener('change', e), n.addEventListener('change', e), n.removeEventListener('change', r)
                        })
                }),
                (e.overrideNative_ = function (e, t) {
                    var i,
                        n = this
                    t === this['featuresNative' + e + 'Tracks'] &&
                        (this[(i = e.toLowerCase()) + 'TracksListeners_'] &&
                            Object.keys(this[i + 'TracksListeners_']).forEach(function (e) {
                                n.el()[i + 'Tracks'].removeEventListener(e, n[i + 'TracksListeners_'][e])
                            }),
                        (this['featuresNative' + e + 'Tracks'] = !t),
                        (this[i + 'TracksListeners_'] = null),
                        this.proxyNativeTracksForType_(i))
                }),
                (e.overrideNativeAudioTracks = function (e) {
                    this.overrideNative_('Audio', e)
                }),
                (e.overrideNativeVideoTracks = function (e) {
                    this.overrideNative_('Video', e)
                }),
                (e.proxyNativeTracksForType_ = function (i) {
                    var e,
                        t,
                        n = this,
                        r = ai[i],
                        a = this.el()[r.getterName],
                        s = this[r.getterName]()
                    this['featuresNative' + r.capitalName + 'Tracks'] &&
                        a &&
                        a.addEventListener &&
                        ((t = function () {
                            for (var e = [], t = 0; t < s.length; t++) {
                                for (var i = !1, n = 0; n < a.length; n++)
                                    if (a[n] === s[t]) {
                                        i = !0
                                        break
                                    }
                                i || e.push(s[t])
                            }
                            for (; e.length; ) s.removeTrack(e.shift())
                        }),
                        (this[r.getterName + 'Listeners_'] = e =
                            {
                                change: function (e) {
                                    var t = { type: 'change', target: s, currentTarget: s, srcElement: s }
                                    s.trigger(t), 'text' === i && n[si.remoteText.getterName]().trigger(t)
                                },
                                addtrack: function (e) {
                                    s.addTrack(e.track)
                                },
                                removetrack: function (e) {
                                    s.removeTrack(e.track)
                                },
                            }),
                        Object.keys(e).forEach(function (t) {
                            var i = e[t]
                            a.addEventListener(t, i),
                                n.on('dispose', function (e) {
                                    return a.removeEventListener(t, i)
                                })
                        }),
                        this.on('loadstart', t),
                        this.on('dispose', function (e) {
                            return n.off('loadstart', t)
                        }))
                }),
                (e.proxyNativeTracks_ = function () {
                    var t = this
                    ai.names.forEach(function (e) {
                        t.proxyNativeTracksForType_(e)
                    })
                }),
                (e.createEl = function () {
                    var e,
                        t = this.options_.tag
                    ;(t && (this.options_.playerElIngest || this.movingMediaElementInDOM)) ||
                        (t
                            ? ((e = t.cloneNode(!0)), t.parentNode && t.parentNode.insertBefore(e, t), s.disposeMediaElement(t), (t = e))
                            : ((t = document.createElement('video')),
                              (e = lt({}, this.options_.tag && ae(this.options_.tag))),
                              (F && !0 === this.options_.nativeControlsForTouch) || delete e.controls,
                              re(t, b(e, { id: this.options_.techId, class: 'vjs-tech' }))),
                        (t.playerId = this.options_.playerId)),
                        'undefined' != typeof this.options_.preload && oe(t, 'preload', this.options_.preload),
                        void 0 !== this.options_.disablePictureInPicture && (t.disablePictureInPicture = this.options_.disablePictureInPicture)
                    for (var i = ['loop', 'muted', 'playsinline', 'autoplay'], n = 0; n < i.length; n++) {
                        var r = i[n],
                            a = this.options_[r]
                        'undefined' != typeof a && (a ? oe(t, r, r) : ue(t, r), (t[r] = a))
                    }
                    return t
                }),
                (e.handleLateInit_ = function (e) {
                    if (0 !== e.networkState && 3 !== e.networkState) {
                        if (0 === e.readyState) {
                            var t = !1,
                                i = function () {
                                    t = !0
                                }
                            this.on('loadstart', i)
                            var n = function () {
                                t || this.trigger('loadstart')
                            }
                            return (
                                this.on('loadedmetadata', n),
                                void this.ready(function () {
                                    this.off('loadstart', i), this.off('loadedmetadata', n), t || this.trigger('loadstart')
                                })
                            )
                        }
                        var r = ['loadstart']
                        r.push('loadedmetadata'),
                            2 <= e.readyState && r.push('loadeddata'),
                            3 <= e.readyState && r.push('canplay'),
                            4 <= e.readyState && r.push('canplaythrough'),
                            this.ready(function () {
                                r.forEach(function (e) {
                                    this.trigger(e)
                                }, this)
                            })
                    }
                }),
                (e.setScrubbing = function (e) {
                    this.isScrubbing_ = e
                }),
                (e.scrubbing = function () {
                    return this.isScrubbing_
                }),
                (e.setCurrentTime = function (e) {
                    try {
                        this.isScrubbing_ && this.el_.fastSeek && V ? this.el_.fastSeek(e) : (this.el_.currentTime = e)
                    } catch (e) {
                        h(e, 'Video is not ready. (Video.js)')
                    }
                }),
                (e.duration = function () {
                    var t = this
                    return this.el_.duration === 1 / 0 && A && M && 0 === this.el_.currentTime
                        ? (this.on('timeupdate', function e() {
                              0 < t.el_.currentTime && (t.el_.duration === 1 / 0 && t.trigger('durationchange'), t.off('timeupdate', e))
                          }),
                          NaN)
                        : this.el_.duration || NaN
                }),
                (e.width = function () {
                    return this.el_.offsetWidth
                }),
                (e.height = function () {
                    return this.el_.offsetHeight
                }),
                (e.proxyWebkitFullscreen_ = function () {
                    var e,
                        t,
                        i = this
                    'webkitDisplayingFullscreen' in this.el_ &&
                        ((e = function () {
                            this.trigger('fullscreenchange', { isFullscreen: !1 }), this.el_.controls && !this.options_.nativeControlsForTouch && this.controls() && (this.el_.controls = !1)
                        }),
                        (t = function () {
                            'webkitPresentationMode' in this.el_ &&
                                'picture-in-picture' !== this.el_.webkitPresentationMode &&
                                (this.one('webkitendfullscreen', e), this.trigger('fullscreenchange', { isFullscreen: !0, nativeIOSFullscreen: !0 }))
                        }),
                        this.on('webkitbeginfullscreen', t),
                        this.on('dispose', function () {
                            i.off('webkitbeginfullscreen', t), i.off('webkitendfullscreen', e)
                        }))
                }),
                (e.supportsFullScreen = function () {
                    if ('function' == typeof this.el_.webkitEnterFullScreen) {
                        var e = (window.navigator && window.navigator.userAgent) || ''
                        if (/Android/.test(e) || !/Chrome|Mac OS X 10.5/.test(e)) return !0
                    }
                    return !1
                }),
                (e.enterFullScreen = function () {
                    var e = this.el_
                    if (e.paused && e.networkState <= e.HAVE_METADATA)
                        Et(this.el_.play()),
                            this.setTimeout(function () {
                                e.pause()
                                try {
                                    e.webkitEnterFullScreen()
                                } catch (e) {
                                    this.trigger('fullscreenerror', e)
                                }
                            }, 0)
                    else
                        try {
                            e.webkitEnterFullScreen()
                        } catch (e) {
                            this.trigger('fullscreenerror', e)
                        }
                }),
                (e.exitFullScreen = function () {
                    this.el_.webkitDisplayingFullscreen ? this.el_.webkitExitFullScreen() : this.trigger('fullscreenerror', new Error('The video is not fullscreen'))
                }),
                (e.requestPictureInPicture = function () {
                    return this.el_.requestPictureInPicture()
                }),
                (e.requestVideoFrameCallback = function (e) {
                    return this.featuresVideoFrameCallback && !this.el_.webkitKeys ? this.el_.requestVideoFrameCallback(e) : l.prototype.requestVideoFrameCallback.call(this, e)
                }),
                (e.cancelVideoFrameCallback = function (e) {
                    this.featuresVideoFrameCallback && !this.el_.webkitKeys ? this.el_.cancelVideoFrameCallback(e) : l.prototype.cancelVideoFrameCallback.call(this, e)
                }),
                (e.src = function (e) {
                    if (void 0 === e) return this.el_.src
                    this.setSrc(e)
                }),
                (e.reset = function () {
                    s.resetMediaElement(this.el_)
                }),
                (e.currentSrc = function () {
                    return this.currentSource_ ? this.currentSource_.src : this.el_.currentSrc
                }),
                (e.setControls = function (e) {
                    this.el_.controls = !!e
                }),
                (e.addTextTrack = function (e, t, i) {
                    return this.featuresNativeTextTracks ? this.el_.addTextTrack(e, t, i) : l.prototype.addTextTrack.call(this, e, t, i)
                }),
                (e.createRemoteTextTrack = function (e) {
                    if (!this.featuresNativeTextTracks) return l.prototype.createRemoteTextTrack.call(this, e)
                    var t = document.createElement('track')
                    return (
                        e.kind && (t.kind = e.kind),
                        e.label && (t.label = e.label),
                        (e.language || e.srclang) && (t.srclang = e.language || e.srclang),
                        e.default && (t.default = e.default),
                        e.id && (t.id = e.id),
                        e.src && (t.src = e.src),
                        t
                    )
                }),
                (e.addRemoteTextTrack = function (e, t) {
                    t = l.prototype.addRemoteTextTrack.call(this, e, t)
                    return this.featuresNativeTextTracks && this.el().appendChild(t), t
                }),
                (e.removeRemoteTextTrack = function (e) {
                    if ((l.prototype.removeRemoteTextTrack.call(this, e), this.featuresNativeTextTracks))
                        for (var t = this.$$('track'), i = t.length; i--; ) (e !== t[i] && e !== t[i].track) || this.el().removeChild(t[i])
                }),
                (e.getVideoPlaybackQuality = function () {
                    if ('function' == typeof this.el().getVideoPlaybackQuality) return this.el().getVideoPlaybackQuality()
                    var e = {}
                    return (
                        'undefined' != typeof this.el().webkitDroppedFrameCount &&
                            'undefined' != typeof this.el().webkitDecodedFrameCount &&
                            ((e.droppedVideoFrames = this.el().webkitDroppedFrameCount), (e.totalVideoFrames = this.el().webkitDecodedFrameCount)),
                        window.performance && 'function' == typeof window.performance.now
                            ? (e.creationTime = window.performance.now())
                            : window.performance &&
                              window.performance.timing &&
                              'number' == typeof window.performance.timing.navigationStart &&
                              (e.creationTime = window.Date.now() - window.performance.timing.navigationStart),
                        e
                    )
                }),
                s
            )
        })(ji)
    An(On, 'TEST_VID', function () {
        if (X()) {
            var e = document.createElement('video'),
                t = document.createElement('track')
            return (t.kind = 'captions'), (t.srclang = 'en'), (t.label = 'English'), e.appendChild(t), e
        }
    }),
        (On.isSupported = function () {
            try {
                On.TEST_VID.volume = 0.5
            } catch (e) {
                return !1
            }
            return !(!On.TEST_VID || !On.TEST_VID.canPlayType)
        }),
        (On.canPlayType = function (e) {
            return On.TEST_VID.canPlayType(e)
        }),
        (On.canPlaySource = function (e, t) {
            return On.canPlayType(e.type)
        }),
        (On.canControlVolume = function () {
            try {
                var e = On.TEST_VID.volume
                On.TEST_VID.volume = e / 2 + 0.1
                var t = e !== On.TEST_VID.volume
                return t && q
                    ? (window.setTimeout(function () {
                          On && On.prototype && (On.prototype.featuresVolumeControl = e !== On.TEST_VID.volume)
                      }),
                      !1)
                    : t
            } catch (e) {
                return !1
            }
        }),
        (On.canMuteVolume = function () {
            try {
                var e = On.TEST_VID.muted
                return (On.TEST_VID.muted = !e), On.TEST_VID.muted ? oe(On.TEST_VID, 'muted', 'muted') : ue(On.TEST_VID, 'muted'), e !== On.TEST_VID.muted
            } catch (e) {
                return !1
            }
        }),
        (On.canControlPlaybackRate = function () {
            if (A && M && R < 58) return !1
            try {
                var e = On.TEST_VID.playbackRate
                return (On.TEST_VID.playbackRate = e / 2 + 0.1), e !== On.TEST_VID.playbackRate
            } catch (e) {
                return !1
            }
        }),
        (On.canOverrideAttributes = function () {
            try {
                var e = function () {}
                Object.defineProperty(document.createElement('video'), 'src', { get: e, set: e }),
                    Object.defineProperty(document.createElement('audio'), 'src', { get: e, set: e }),
                    Object.defineProperty(document.createElement('video'), 'innerHTML', { get: e, set: e }),
                    Object.defineProperty(document.createElement('audio'), 'innerHTML', { get: e, set: e })
            } catch (e) {
                return !1
            }
            return !0
        }),
        (On.supportsNativeTextTracks = function () {
            return V || (q && M)
        }),
        (On.supportsNativeVideoTracks = function () {
            return !(!On.TEST_VID || !On.TEST_VID.videoTracks)
        }),
        (On.supportsNativeAudioTracks = function () {
            return !(!On.TEST_VID || !On.TEST_VID.audioTracks)
        }),
        (On.Events = [
            'loadstart',
            'suspend',
            'abort',
            'error',
            'emptied',
            'stalled',
            'loadedmetadata',
            'loadeddata',
            'canplay',
            'canplaythrough',
            'playing',
            'waiting',
            'seeking',
            'seeked',
            'ended',
            'durationchange',
            'timeupdate',
            'progress',
            'play',
            'pause',
            'ratechange',
            'resize',
            'volumechange',
        ]),
        [
            ['featuresMuteControl', 'canMuteVolume'],
            ['featuresPlaybackRate', 'canControlPlaybackRate'],
            ['featuresSourceset', 'canOverrideAttributes'],
            ['featuresNativeTextTracks', 'supportsNativeTextTracks'],
            ['featuresNativeVideoTracks', 'supportsNativeVideoTracks'],
            ['featuresNativeAudioTracks', 'supportsNativeAudioTracks'],
        ].forEach(function (e) {
            var t = e[0],
                i = e[1]
            An(
                On.prototype,
                t,
                function () {
                    return On[i]()
                },
                !0
            )
        }),
        (On.prototype.featuresVolumeControl = On.canControlVolume()),
        (On.prototype.movingMediaElementInDOM = !q),
        (On.prototype.featuresFullscreenResize = !0),
        (On.prototype.featuresProgressEvents = !0),
        (On.prototype.featuresTimeupdateEvents = !0),
        (On.prototype.featuresVideoFrameCallback = !(!On.TEST_VID || !On.TEST_VID.requestVideoFrameCallback)),
        (On.patchCanPlayType = function () {
            4 <= P &&
                !D &&
                !M &&
                ((Pn = On.TEST_VID && On.TEST_VID.constructor.prototype.canPlayType),
                (On.TEST_VID.constructor.prototype.canPlayType = function (e) {
                    return e && /^application\/(?:x-|vnd\.apple\.)mpegurl/i.test(e) ? 'maybe' : Pn.call(this, e)
                }))
        }),
        (On.unpatchCanPlayType = function () {
            var e = On.TEST_VID.constructor.prototype.canPlayType
            return Pn && (On.TEST_VID.constructor.prototype.canPlayType = Pn), e
        }),
        On.patchCanPlayType(),
        (On.disposeMediaElement = function (e) {
            if (e) {
                for (e.parentNode && e.parentNode.removeChild(e); e.hasChildNodes(); ) e.removeChild(e.firstChild)
                e.removeAttribute('src'),
                    'function' == typeof e.load &&
                        (function () {
                            try {
                                e.load()
                            } catch (e) {}
                        })()
            }
        }),
        (On.resetMediaElement = function (e) {
            if (e) {
                for (var t = e.querySelectorAll('source'), i = t.length; i--; ) e.removeChild(t[i])
                e.removeAttribute('src'),
                    'function' == typeof e.load &&
                        (function () {
                            try {
                                e.load()
                            } catch (e) {}
                        })()
            }
        }),
        ['muted', 'defaultMuted', 'autoplay', 'controls', 'loop', 'playsinline'].forEach(function (e) {
            On.prototype[e] = function () {
                return this.el_[e] || this.el_.hasAttribute(e)
            }
        }),
        ['muted', 'defaultMuted', 'autoplay', 'loop', 'playsinline'].forEach(function (t) {
            On.prototype['set' + ut(t)] = function (e) {
                ;(this.el_[t] = e) ? this.el_.setAttribute(t, t) : this.el_.removeAttribute(t)
            }
        }),
        [
            'paused',
            'currentTime',
            'buffered',
            'volume',
            'poster',
            'preload',
            'error',
            'seeking',
            'seekable',
            'ended',
            'playbackRate',
            'defaultPlaybackRate',
            'disablePictureInPicture',
            'played',
            'networkState',
            'readyState',
            'videoWidth',
            'videoHeight',
            'crossOrigin',
        ].forEach(function (e) {
            On.prototype[e] = function () {
                return this.el_[e]
            }
        }),
        ['volume', 'src', 'poster', 'preload', 'playbackRate', 'defaultPlaybackRate', 'disablePictureInPicture', 'crossOrigin'].forEach(function (t) {
            On.prototype['set' + ut(t)] = function (e) {
                this.el_[t] = e
            }
        }),
        ['pause', 'load', 'play'].forEach(function (e) {
            On.prototype[e] = function () {
                return this.el_[e]()
            }
        }),
        ji.withSourceHandlers(On),
        (On.nativeSourceHandler = {}),
        (On.nativeSourceHandler.canPlayType = function (e) {
            try {
                return On.TEST_VID.canPlayType(e)
            } catch (e) {
                return ''
            }
        }),
        (On.nativeSourceHandler.canHandleSource = function (e, t) {
            if (e.type) return On.nativeSourceHandler.canPlayType(e.type)
            if (e.src) {
                e = Nt(e.src)
                return On.nativeSourceHandler.canPlayType('video/' + e)
            }
            return ''
        }),
        (On.nativeSourceHandler.handleSource = function (e, t, i) {
            t.setSrc(e.src)
        }),
        (On.nativeSourceHandler.dispose = function () {}),
        On.registerSourceHandler(On.nativeSourceHandler),
        ji.registerTech('Html5', On)
    var Mn = ['progress', 'abort', 'suspend', 'emptied', 'stalled', 'loadedmetadata', 'loadeddata', 'timeupdate', 'resize', 'volumechange', 'texttrackchange'],
        Rn = { canplay: 'CanPlay', canplaythrough: 'CanPlayThrough', playing: 'Playing', seeked: 'Seeked' },
        Nn = ['tiny', 'xsmall', 'small', 'medium', 'large', 'xlarge', 'huge'],
        Un = {}
    Nn.forEach(function (e) {
        var t = 'x' === e.charAt(0) ? 'x-' + e.substring(1) : e
        Un[e] = 'vjs-layout-' + t
    })
    var Bn = { tiny: 210, xsmall: 320, small: 425, medium: 768, large: 1440, xlarge: 2560, huge: 1 / 0 },
        Fn = (function (c) {
            function o(e, t, i) {
                var n, r
                if (((e.id = e.id || t.id || 'vjs_video_' + Pe++), ((t = b(o.getTagSettings(e), t)).initChildren = !1), (t.createEl = !1), (t.evented = !1), (t.reportTouchActivity = !1), !t.language))
                    if ('function' == typeof e.closest) {
                        var a = e.closest('[lang]')
                        a && a.getAttribute && (t.language = a.getAttribute('lang'))
                    } else
                        for (var s = e; s && 1 === s.nodeType; ) {
                            if (ae(s).hasOwnProperty('lang')) {
                                t.language = s.getAttribute('lang')
                                break
                            }
                            s = s.parentNode
                        }
                if (
                    (((n = c.call(this, null, t, i) || this).boundDocumentFullscreenChange_ = function (e) {
                        return n.documentFullscreenChange_(e)
                    }),
                    (n.boundFullWindowOnEscKey_ = function (e) {
                        return n.fullWindowOnEscKey(e)
                    }),
                    (n.boundUpdateStyleEl_ = function (e) {
                        return n.updateStyleEl_(e)
                    }),
                    (n.boundApplyInitTime_ = function (e) {
                        return n.applyInitTime_(e)
                    }),
                    (n.boundUpdateCurrentBreakpoint_ = function (e) {
                        return n.updateCurrentBreakpoint_(e)
                    }),
                    (n.boundHandleTechClick_ = function (e) {
                        return n.handleTechClick_(e)
                    }),
                    (n.boundHandleTechDoubleClick_ = function (e) {
                        return n.handleTechDoubleClick_(e)
                    }),
                    (n.boundHandleTechTouchStart_ = function (e) {
                        return n.handleTechTouchStart_(e)
                    }),
                    (n.boundHandleTechTouchMove_ = function (e) {
                        return n.handleTechTouchMove_(e)
                    }),
                    (n.boundHandleTechTouchEnd_ = function (e) {
                        return n.handleTechTouchEnd_(e)
                    }),
                    (n.boundHandleTechTap_ = function (e) {
                        return n.handleTechTap_(e)
                    }),
                    (n.isFullscreen_ = !1),
                    (n.log = p(n.id_)),
                    (n.fsApi_ = l),
                    (n.isPosterFromTech_ = !1),
                    (n.queuedCallbacks_ = []),
                    (n.isReady_ = !1),
                    (n.hasStarted_ = !1),
                    (n.userActive_ = !1),
                    (n.debugEnabled_ = !1),
                    (n.audioOnlyMode_ = !1),
                    (n.audioPosterMode_ = !1),
                    (n.audioOnlyCache_ = { playerHeight: null, hiddenChildren: [] }),
                    !n.options_ || !n.options_.techOrder || !n.options_.techOrder.length)
                )
                    throw new Error('No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?')
                ;(n.tag = e),
                    (n.tagAttributes = e && ae(e)),
                    n.language(n.options_.language),
                    t.languages
                        ? ((r = {}),
                          Object.getOwnPropertyNames(t.languages).forEach(function (e) {
                              r[e.toLowerCase()] = t.languages[e]
                          }),
                          (n.languages_ = r))
                        : (n.languages_ = o.prototype.options_.languages),
                    n.resetCache_(),
                    (n.poster_ = t.poster || ''),
                    (n.controls_ = !!t.controls),
                    (e.controls = !1),
                    e.removeAttribute('controls'),
                    (n.changingSrc_ = !1),
                    (n.playCallbacks_ = []),
                    (n.playTerminatedQueue_ = []),
                    e.hasAttribute('autoplay') ? n.autoplay(!0) : n.autoplay(n.options_.autoplay),
                    t.plugins &&
                        Object.keys(t.plugins).forEach(function (e) {
                            if ('function' != typeof n[e]) throw new Error('plugin "' + e + '" does not exist')
                        }),
                    (n.scrubbing_ = !1),
                    (n.el_ = n.createEl()),
                    rt(ft(n), { eventBusKey: 'el_' }),
                    n.fsApi_.requestFullscreen && (Be(document, n.fsApi_.fullscreenchange, n.boundDocumentFullscreenChange_), n.on(n.fsApi_.fullscreenchange, n.boundDocumentFullscreenChange_)),
                    n.fluid_ && n.on(['playerreset', 'resize'], n.boundUpdateStyleEl_)
                i = lt(n.options_)
                t.plugins &&
                    Object.keys(t.plugins).forEach(function (e) {
                        n[e](t.plugins[e])
                    }),
                    t.debug && n.debug(!0),
                    (n.options_.playerOptions = i),
                    (n.middleware_ = []),
                    n.playbackRates(t.playbackRates),
                    n.initChildren(),
                    n.isAudio('audio' === e.nodeName.toLowerCase()),
                    n.controls() ? n.addClass('vjs-controls-enabled') : n.addClass('vjs-controls-disabled'),
                    n.el_.setAttribute('role', 'region'),
                    n.isAudio() ? n.el_.setAttribute('aria-label', n.localize('Audio Player')) : n.el_.setAttribute('aria-label', n.localize('Video Player')),
                    n.isAudio() && n.addClass('vjs-audio'),
                    n.flexNotSupported_() && n.addClass('vjs-no-flex'),
                    F && n.addClass('vjs-touch-enabled'),
                    q || n.addClass('vjs-workinghover'),
                    (o.players[n.id_] = ft(n))
                e = u.split('.')[0]
                return (
                    n.addClass('vjs-v' + e),
                    n.userActive(!0),
                    n.reportUserActivity(),
                    n.one('play', function (e) {
                        return n.listenForUserActivity_(e)
                    }),
                    n.on('stageclick', function (e) {
                        return n.handleStageClick_(e)
                    }),
                    n.on('keydown', function (e) {
                        return n.handleKeyDown(e)
                    }),
                    n.on('languagechange', function (e) {
                        return n.handleLanguagechange(e)
                    }),
                    n.breakpoints(n.options_.breakpoints),
                    n.responsive(n.options_.responsive),
                    n.on('ready', function () {
                        n.audioPosterMode(n.options_.audioPosterMode), n.audioOnlyMode(n.options_.audioOnlyMode)
                    }),
                    n
                )
            }
            mt(o, c)
            var e = o.prototype
            return (
                (e.dispose = function () {
                    var t = this
                    this.trigger('dispose'),
                        this.off('dispose'),
                        Fe(document, this.fsApi_.fullscreenchange, this.boundDocumentFullscreenChange_),
                        Fe(document, 'keydown', this.boundFullWindowOnEscKey_),
                        this.styleEl_ && this.styleEl_.parentNode && (this.styleEl_.parentNode.removeChild(this.styleEl_), (this.styleEl_ = null)),
                        (o.players[this.id_] = null),
                        this.tag && this.tag.player && (this.tag.player = null),
                        this.el_ && this.el_.player && (this.el_.player = null),
                        this.tech_ && (this.tech_.dispose(), (this.isPosterFromTech_ = !1), (this.poster_ = '')),
                        this.playerElIngest_ && (this.playerElIngest_ = null),
                        this.tag && (this.tag = null),
                        (qi[this.id()] = null),
                        oi.names.forEach(function (e) {
                            ;(e = oi[e]), (e = t[e.getterName]())
                            e && e.off && e.off()
                        }),
                        c.prototype.dispose.call(this, { restoreEl: this.options_.restoreEl })
                }),
                (e.createEl = function () {
                    var t,
                        i = this.tag,
                        e = (this.playerElIngest_ = i.parentNode && i.parentNode.hasAttribute && i.parentNode.hasAttribute('data-vjs-player')),
                        n = 'video-js' === this.tag.tagName.toLowerCase()
                    e ? (t = this.el_ = i.parentNode) : n || (t = this.el_ = c.prototype.createEl.call(this, 'div'))
                    var r,
                        a,
                        s = ae(i)
                    if (n) {
                        for (t = this.el_ = i, i = this.tag = document.createElement('video'); t.children.length; ) i.appendChild(t.firstChild)
                        ee(t, 'video-js') || te(t, 'video-js'),
                            t.appendChild(i),
                            (e = this.playerElIngest_ = t),
                            Object.keys(t).forEach(function (e) {
                                try {
                                    i[e] = t[e]
                                } catch (e) {}
                            })
                    }
                    i.setAttribute('tabindex', '-1'),
                        (s.tabindex = '-1'),
                        (N || (M && B)) && (i.setAttribute('role', 'application'), (s.role = 'application')),
                        i.removeAttribute('width'),
                        i.removeAttribute('height'),
                        'width' in s && delete s.width,
                        'height' in s && delete s.height,
                        Object.getOwnPropertyNames(s).forEach(function (e) {
                            ;(n && 'class' === e) || t.setAttribute(e, s[e]), n && i.setAttribute(e, s[e])
                        }),
                        (i.playerId = i.id),
                        (i.id += '_html5_api'),
                        (i.className = 'vjs-tech'),
                        (i.player = t.player = this).addClass('vjs-paused'),
                        !0 !== window.VIDEOJS_NO_DYNAMIC_STYLE &&
                            ((this.styleEl_ = xe('vjs-styles-dimensions')), (r = Te('.vjs-styles-defaults')), (a = Te('head')).insertBefore(this.styleEl_, r ? r.nextSibling : a.firstChild)),
                        (this.fill_ = !1),
                        (this.fluid_ = !1),
                        this.width(this.options_.width),
                        this.height(this.options_.height),
                        this.fill(this.options_.fill),
                        this.fluid(this.options_.fluid),
                        this.aspectRatio(this.options_.aspectRatio),
                        this.crossOrigin(this.options_.crossOrigin || this.options_.crossorigin)
                    for (var o = i.getElementsByTagName('a'), u = 0; u < o.length; u++) {
                        var l = o.item(u)
                        te(l, 'vjs-hidden'), l.setAttribute('hidden', 'hidden')
                    }
                    return (
                        (i.initNetworkState_ = i.networkState),
                        i.parentNode && !e && i.parentNode.insertBefore(t, i),
                        Z(i, t),
                        this.children_.unshift(i),
                        this.el_.setAttribute('lang', this.language_),
                        this.el_.setAttribute('translate', 'no'),
                        (this.el_ = t)
                    )
                }),
                (e.crossOrigin = function (e) {
                    if (!e) return this.techGet_('crossOrigin')
                    'anonymous' === e || 'use-credentials' === e ? this.techCall_('setCrossOrigin', e) : h.warn('crossOrigin must be "anonymous" or "use-credentials", given "' + e + '"')
                }),
                (e.width = function (e) {
                    return this.dimension('width', e)
                }),
                (e.height = function (e) {
                    return this.dimension('height', e)
                }),
                (e.dimension = function (e, t) {
                    var i = e + '_'
                    if (void 0 === t) return this[i] || 0
                    if ('' === t || 'auto' === t) return (this[i] = void 0), void this.updateStyleEl_()
                    var n = parseFloat(t)
                    isNaN(n) ? h.error('Improper value "' + t + '" supplied for for ' + e) : ((this[i] = n), this.updateStyleEl_())
                }),
                (e.fluid = function (e) {
                    var t,
                        i = this
                    if (void 0 === e) return !!this.fluid_
                    ;(this.fluid_ = !!e),
                        it(this) && this.off(['playerreset', 'resize'], this.boundUpdateStyleEl_),
                        e
                            ? (this.addClass('vjs-fluid'),
                              this.fill(!1),
                              (t = function () {
                                  i.on(['playerreset', 'resize'], i.boundUpdateStyleEl_)
                              }),
                              it((e = this)) ? t() : (e.eventedCallbacks || (e.eventedCallbacks = []), e.eventedCallbacks.push(t)))
                            : this.removeClass('vjs-fluid'),
                        this.updateStyleEl_()
                }),
                (e.fill = function (e) {
                    if (void 0 === e) return !!this.fill_
                    ;(this.fill_ = !!e), e ? (this.addClass('vjs-fill'), this.fluid(!1)) : this.removeClass('vjs-fill')
                }),
                (e.aspectRatio = function (e) {
                    if (void 0 === e) return this.aspectRatio_
                    if (!/^\d+\:\d+$/.test(e)) throw new Error('Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.')
                    ;(this.aspectRatio_ = e), this.fluid(!0), this.updateStyleEl_()
                }),
                (e.updateStyleEl_ = function () {
                    var e, t, i, n
                    !0 !== window.VIDEOJS_NO_DYNAMIC_STYLE
                        ? ((n =
                              (i = (
                                  void 0 !== this.aspectRatio_ && 'auto' !== this.aspectRatio_ ? this.aspectRatio_ : 0 < this.videoWidth() ? this.videoWidth() + ':' + this.videoHeight() : '16:9'
                              ).split(':'))[1] / i[0]),
                          (e = void 0 !== this.width_ ? this.width_ : void 0 !== this.height_ ? this.height_ / n : this.videoWidth() || 300),
                          (t = void 0 !== this.height_ ? this.height_ : e * n),
                          (i = /^[^a-zA-Z]/.test(this.id()) ? 'dimensions-' + this.id() : this.id() + '-dimensions'),
                          this.addClass(i),
                          Ae(
                              this.styleEl_,
                              '\n      .' +
                                  i +
                                  ' {\n        width: ' +
                                  e +
                                  'px;\n        height: ' +
                                  t +
                                  'px;\n      }\n\n      .' +
                                  i +
                                  '.vjs-fluid:not(.vjs-audio-only-mode) {\n        padding-top: ' +
                                  100 * n +
                                  '%;\n      }\n    '
                          ))
                        : ((t = 'number' == typeof this.width_ ? this.width_ : this.options_.width),
                          (i = 'number' == typeof this.height_ ? this.height_ : this.options_.height),
                          (n = this.tech_ && this.tech_.el()) && (0 <= t && (n.width = t), 0 <= i && (n.height = i)))
                }),
                (e.loadTech_ = function (e, t) {
                    var i = this
                    this.tech_ && this.unloadTech_()
                    var n = ut(e),
                        r = e.charAt(0).toLowerCase() + e.slice(1)
                    'Html5' !== n && this.tag && (ji.getTech('Html5').disposeMediaElement(this.tag), (this.tag.player = null), (this.tag = null)), (this.techName_ = n), (this.isReady_ = !1)
                    var a = this.autoplay(),
                        s = {
                            source: t,
                            autoplay: (a = 'string' == typeof this.autoplay() || (!0 === this.autoplay() && this.options_.normalizeAutoplay) ? !1 : a),
                            nativeControlsForTouch: this.options_.nativeControlsForTouch,
                            playerId: this.id(),
                            techId: this.id() + '_' + r + '_api',
                            playsinline: this.options_.playsinline,
                            preload: this.options_.preload,
                            loop: this.options_.loop,
                            disablePictureInPicture: this.options_.disablePictureInPicture,
                            muted: this.options_.muted,
                            poster: this.poster(),
                            language: this.language(),
                            playerElIngest: this.playerElIngest_ || !1,
                            'vtt.js': this.options_['vtt.js'],
                            canOverridePoster: !!this.options_.techCanOverridePoster,
                            enableSourceset: this.options_.enableSourceset,
                            Promise: this.options_.Promise,
                        }
                    oi.names.forEach(function (e) {
                        e = oi[e]
                        s[e.getterName] = i[e.privateName]
                    }),
                        b(s, this.options_[n]),
                        b(s, this.options_[r]),
                        b(s, this.options_[e.toLowerCase()]),
                        this.tag && (s.tag = this.tag),
                        t && t.src === this.cache_.src && 0 < this.cache_.currentTime && (s.startTime = this.cache_.currentTime)
                    e = ji.getTech(e)
                    if (!e) throw new Error("No Tech named '" + n + "' exists! '" + n + "' should be registered using videojs.registerTech()'")
                    ;(this.tech_ = new e(s)),
                        this.tech_.ready(Ve(this, this.handleTechReady_), !0),
                        It(this.textTracksJson_ || [], this.tech_),
                        Mn.forEach(function (t) {
                            i.on(i.tech_, t, function (e) {
                                return i['handleTech' + ut(t) + '_'](e)
                            })
                        }),
                        Object.keys(Rn).forEach(function (t) {
                            i.on(i.tech_, t, function (e) {
                                0 === i.tech_.playbackRate() && i.tech_.seeking()
                                    ? i.queuedCallbacks_.push({ callback: i['handleTech' + Rn[t] + '_'].bind(i), event: e })
                                    : i['handleTech' + Rn[t] + '_'](e)
                            })
                        }),
                        this.on(this.tech_, 'loadstart', function (e) {
                            return i.handleTechLoadStart_(e)
                        }),
                        this.on(this.tech_, 'sourceset', function (e) {
                            return i.handleTechSourceset_(e)
                        }),
                        this.on(this.tech_, 'waiting', function (e) {
                            return i.handleTechWaiting_(e)
                        }),
                        this.on(this.tech_, 'ended', function (e) {
                            return i.handleTechEnded_(e)
                        }),
                        this.on(this.tech_, 'seeking', function (e) {
                            return i.handleTechSeeking_(e)
                        }),
                        this.on(this.tech_, 'play', function (e) {
                            return i.handleTechPlay_(e)
                        }),
                        this.on(this.tech_, 'firstplay', function (e) {
                            return i.handleTechFirstPlay_(e)
                        }),
                        this.on(this.tech_, 'pause', function (e) {
                            return i.handleTechPause_(e)
                        }),
                        this.on(this.tech_, 'durationchange', function (e) {
                            return i.handleTechDurationChange_(e)
                        }),
                        this.on(this.tech_, 'fullscreenchange', function (e, t) {
                            return i.handleTechFullscreenChange_(e, t)
                        }),
                        this.on(this.tech_, 'fullscreenerror', function (e, t) {
                            return i.handleTechFullscreenError_(e, t)
                        }),
                        this.on(this.tech_, 'enterpictureinpicture', function (e) {
                            return i.handleTechEnterPictureInPicture_(e)
                        }),
                        this.on(this.tech_, 'leavepictureinpicture', function (e) {
                            return i.handleTechLeavePictureInPicture_(e)
                        }),
                        this.on(this.tech_, 'error', function (e) {
                            return i.handleTechError_(e)
                        }),
                        this.on(this.tech_, 'posterchange', function (e) {
                            return i.handleTechPosterChange_(e)
                        }),
                        this.on(this.tech_, 'textdata', function (e) {
                            return i.handleTechTextData_(e)
                        }),
                        this.on(this.tech_, 'ratechange', function (e) {
                            return i.handleTechRateChange_(e)
                        }),
                        this.on(this.tech_, 'loadedmetadata', this.boundUpdateStyleEl_),
                        this.usingNativeControls(this.techGet_('controls')),
                        this.controls() && !this.usingNativeControls() && this.addTechControlsListeners_(),
                        this.tech_.el().parentNode === this.el() || ('Html5' === n && this.tag) || Z(this.tech_.el(), this.el()),
                        this.tag && ((this.tag.player = null), (this.tag = null))
                }),
                (e.unloadTech_ = function () {
                    var t = this
                    oi.names.forEach(function (e) {
                        e = oi[e]
                        t[e.privateName] = t[e.getterName]()
                    }),
                        (this.textTracksJson_ = Ct(this.tech_)),
                        (this.isReady_ = !1),
                        this.tech_.dispose(),
                        (this.tech_ = !1),
                        this.isPosterFromTech_ && ((this.poster_ = ''), this.trigger('posterchange')),
                        (this.isPosterFromTech_ = !1)
                }),
                (e.tech = function (e) {
                    return (
                        void 0 === e && h.warn("Using the tech directly can be dangerous. I hope you know what you're doing.\nSee https://github.com/videojs/video.js/issues/2617 for more info.\n"),
                        this.tech_
                    )
                }),
                (e.addTechControlsListeners_ = function () {
                    this.removeTechControlsListeners_(),
                        this.on(this.tech_, 'click', this.boundHandleTechClick_),
                        this.on(this.tech_, 'dblclick', this.boundHandleTechDoubleClick_),
                        this.on(this.tech_, 'touchstart', this.boundHandleTechTouchStart_),
                        this.on(this.tech_, 'touchmove', this.boundHandleTechTouchMove_),
                        this.on(this.tech_, 'touchend', this.boundHandleTechTouchEnd_),
                        this.on(this.tech_, 'tap', this.boundHandleTechTap_)
                }),
                (e.removeTechControlsListeners_ = function () {
                    this.off(this.tech_, 'tap', this.boundHandleTechTap_),
                        this.off(this.tech_, 'touchstart', this.boundHandleTechTouchStart_),
                        this.off(this.tech_, 'touchmove', this.boundHandleTechTouchMove_),
                        this.off(this.tech_, 'touchend', this.boundHandleTechTouchEnd_),
                        this.off(this.tech_, 'click', this.boundHandleTechClick_),
                        this.off(this.tech_, 'dblclick', this.boundHandleTechDoubleClick_)
                }),
                (e.handleTechReady_ = function () {
                    this.triggerReady(), this.cache_.volume && this.techCall_('setVolume', this.cache_.volume), this.handleTechPosterChange_(), this.handleTechDurationChange_()
                }),
                (e.handleTechLoadStart_ = function () {
                    this.removeClass('vjs-ended'),
                        this.removeClass('vjs-seeking'),
                        this.error(null),
                        this.handleTechDurationChange_(),
                        this.paused() ? (this.hasStarted(!1), this.trigger('loadstart')) : (this.trigger('loadstart'), this.trigger('firstplay')),
                        this.manualAutoplay_(!0 === this.autoplay() && this.options_.normalizeAutoplay ? 'play' : this.autoplay())
                }),
                (e.manualAutoplay_ = function (e) {
                    var n = this
                    if (this.tech_ && 'string' == typeof e) {
                        var t,
                            i = function () {
                                var e = n.muted()
                                n.muted(!0)
                                function t() {
                                    n.muted(e)
                                }
                                n.playTerminatedQueue_.push(t)
                                var i = n.play()
                                if (wt(i))
                                    return i.catch(function (e) {
                                        throw (t(), new Error('Rejection at manualAutoplay. Restoring muted value. ' + (e || '')))
                                    })
                            }
                        if (('any' !== e || this.muted() ? (t = 'muted' !== e || this.muted() ? this.play() : i()) : wt((t = this.play())) && (t = t.catch(i)), wt(t)))
                            return t
                                .then(function () {
                                    n.trigger({ type: 'autoplay-success', autoplay: e })
                                })
                                .catch(function () {
                                    n.trigger({ type: 'autoplay-failure', autoplay: e })
                                })
                    }
                }),
                (e.updateSourceCaches_ = function (e) {
                    var t = (e = void 0 === e ? '' : e),
                        i = ''
                    'string' != typeof t && ((t = e.src), (i = e.type)),
                        (this.cache_.source = this.cache_.source || {}),
                        (this.cache_.sources = this.cache_.sources || []),
                        t &&
                            !i &&
                            (i = (function (e, t) {
                                if (!t) return ''
                                if (e.cache_.source.src === t && e.cache_.source.type) return e.cache_.source.type
                                var i = e.cache_.sources.filter(function (e) {
                                    return e.src === t
                                })
                                if (i.length) return i[0].type
                                for (var n = e.$$('source'), r = 0; r < n.length; r++) {
                                    var a = n[r]
                                    if (a.type && a.src && a.src === t) return a.type
                                }
                                return $i(t)
                            })(this, t)),
                        (this.cache_.source = lt({}, e, { src: t, type: i }))
                    for (
                        var i = this.cache_.sources.filter(function (e) {
                                return e.src && e.src === t
                            }),
                            n = [],
                            r = this.$$('source'),
                            a = [],
                            s = 0;
                        s < r.length;
                        s++
                    ) {
                        var o = ae(r[s])
                        n.push(o), o.src && o.src === t && a.push(o.src)
                    }
                    a.length && !i.length ? (this.cache_.sources = n) : i.length || (this.cache_.sources = [this.cache_.source]), (this.cache_.src = t)
                }),
                (e.handleTechSourceset_ = function (e) {
                    var t,
                        i,
                        n,
                        r = this
                    this.changingSrc_ ||
                        ((t = function (e) {
                            return r.updateSourceCaches_(e)
                        }),
                        (i = this.currentSource().src),
                        (n = e.src),
                        i && !/^blob:/.test(i) && /^blob:/.test(n) && ((this.lastSource_ && (this.lastSource_.tech === n || this.lastSource_.player === i)) || (t = function () {})),
                        t(n),
                        e.src ||
                            this.tech_.any(['sourceset', 'loadstart'], function (e) {
                                'sourceset' !== e.type && ((e = r.techGet('currentSrc')), (r.lastSource_.tech = e), r.updateSourceCaches_(e))
                            })),
                        (this.lastSource_ = { player: this.currentSource().src, tech: e.src }),
                        this.trigger({ src: e.src, type: 'sourceset' })
                }),
                (e.hasStarted = function (e) {
                    if (void 0 === e) return this.hasStarted_
                    e !== this.hasStarted_ && ((this.hasStarted_ = e), this.hasStarted_ ? (this.addClass('vjs-has-started'), this.trigger('firstplay')) : this.removeClass('vjs-has-started'))
                }),
                (e.handleTechPlay_ = function () {
                    this.removeClass('vjs-ended'), this.removeClass('vjs-paused'), this.addClass('vjs-playing'), this.hasStarted(!0), this.trigger('play')
                }),
                (e.handleTechRateChange_ = function () {
                    0 < this.tech_.playbackRate() &&
                        0 === this.cache_.lastPlaybackRate &&
                        (this.queuedCallbacks_.forEach(function (e) {
                            return e.callback(e.event)
                        }),
                        (this.queuedCallbacks_ = [])),
                        (this.cache_.lastPlaybackRate = this.tech_.playbackRate()),
                        this.trigger('ratechange')
                }),
                (e.handleTechWaiting_ = function () {
                    var t = this
                    this.addClass('vjs-waiting'), this.trigger('waiting')
                    var i = this.currentTime()
                    this.on('timeupdate', function e() {
                        i !== t.currentTime() && (t.removeClass('vjs-waiting'), t.off('timeupdate', e))
                    })
                }),
                (e.handleTechCanPlay_ = function () {
                    this.removeClass('vjs-waiting'), this.trigger('canplay')
                }),
                (e.handleTechCanPlayThrough_ = function () {
                    this.removeClass('vjs-waiting'), this.trigger('canplaythrough')
                }),
                (e.handleTechPlaying_ = function () {
                    this.removeClass('vjs-waiting'), this.trigger('playing')
                }),
                (e.handleTechSeeking_ = function () {
                    this.addClass('vjs-seeking'), this.trigger('seeking')
                }),
                (e.handleTechSeeked_ = function () {
                    this.removeClass('vjs-seeking'), this.removeClass('vjs-ended'), this.trigger('seeked')
                }),
                (e.handleTechFirstPlay_ = function () {
                    this.options_.starttime && (h.warn('Passing the `starttime` option to the player will be deprecated in 6.0'), this.currentTime(this.options_.starttime)),
                        this.addClass('vjs-has-started'),
                        this.trigger('firstplay')
                }),
                (e.handleTechPause_ = function () {
                    this.removeClass('vjs-playing'), this.addClass('vjs-paused'), this.trigger('pause')
                }),
                (e.handleTechEnded_ = function () {
                    this.addClass('vjs-ended'), this.removeClass('vjs-waiting'), this.options_.loop ? (this.currentTime(0), this.play()) : this.paused() || this.pause(), this.trigger('ended')
                }),
                (e.handleTechDurationChange_ = function () {
                    this.duration(this.techGet_('duration'))
                }),
                (e.handleTechClick_ = function (e) {
                    this.controls_ &&
                        ((void 0 !== this.options_ && void 0 !== this.options_.userActions && void 0 !== this.options_.userActions.click && !1 === this.options_.userActions.click) ||
                            (void 0 !== this.options_ && void 0 !== this.options_.userActions && 'function' == typeof this.options_.userActions.click
                                ? this.options_.userActions.click.call(this, e)
                                : this.paused()
                                ? Et(this.play())
                                : this.pause()))
                }),
                (e.handleTechDoubleClick_ = function (t) {
                    this.controls_ &&
                        (Array.prototype.some.call(this.$$('.vjs-control-bar, .vjs-modal-dialog'), function (e) {
                            return e.contains(t.target)
                        }) ||
                            (void 0 !== this.options_ && void 0 !== this.options_.userActions && void 0 !== this.options_.userActions.doubleClick && !1 === this.options_.userActions.doubleClick) ||
                            (void 0 !== this.options_ && void 0 !== this.options_.userActions && 'function' == typeof this.options_.userActions.doubleClick
                                ? this.options_.userActions.doubleClick.call(this, t)
                                : this.isFullscreen()
                                ? this.exitFullscreen()
                                : this.requestFullscreen()))
                }),
                (e.handleTechTap_ = function () {
                    this.userActive(!this.userActive())
                }),
                (e.handleTechTouchStart_ = function () {
                    this.userWasActive = this.userActive()
                }),
                (e.handleTechTouchMove_ = function () {
                    this.userWasActive && this.reportUserActivity()
                }),
                (e.handleTechTouchEnd_ = function (e) {
                    e.cancelable && e.preventDefault()
                }),
                (e.handleStageClick_ = function () {
                    this.reportUserActivity()
                }),
                (e.toggleFullscreenClass_ = function () {
                    this.isFullscreen() ? this.addClass('vjs-fullscreen') : this.removeClass('vjs-fullscreen')
                }),
                (e.documentFullscreenChange_ = function (e) {
                    var t = e.target.player
                    ;(t && t !== this) ||
                        ((e = this.el()),
                        !(t = document[this.fsApi_.fullscreenElement] === e) && e.matches
                            ? (t = e.matches(':' + this.fsApi_.fullscreen))
                            : !t && e.msMatchesSelector && (t = e.msMatchesSelector(':' + this.fsApi_.fullscreen)),
                        this.isFullscreen(t))
                }),
                (e.handleTechFullscreenChange_ = function (e, t) {
                    var i = this
                    t &&
                        (t.nativeIOSFullscreen &&
                            (this.addClass('vjs-ios-native-fs'),
                            this.tech_.one('webkitendfullscreen', function () {
                                i.removeClass('vjs-ios-native-fs')
                            })),
                        this.isFullscreen(t.isFullscreen))
                }),
                (e.handleTechFullscreenError_ = function (e, t) {
                    this.trigger('fullscreenerror', t)
                }),
                (e.togglePictureInPictureClass_ = function () {
                    this.isInPictureInPicture() ? this.addClass('vjs-picture-in-picture') : this.removeClass('vjs-picture-in-picture')
                }),
                (e.handleTechEnterPictureInPicture_ = function (e) {
                    this.isInPictureInPicture(!0)
                }),
                (e.handleTechLeavePictureInPicture_ = function (e) {
                    this.isInPictureInPicture(!1)
                }),
                (e.handleTechError_ = function () {
                    var e = this.tech_.error()
                    this.error(e)
                }),
                (e.handleTechTextData_ = function () {
                    this.trigger('textdata', 1 < arguments.length ? arguments[1] : null)
                }),
                (e.getCache = function () {
                    return this.cache_
                }),
                (e.resetCache_ = function () {
                    this.cache_ = {
                        currentTime: 0,
                        initTime: 0,
                        inactivityTimeout: this.options_.inactivityTimeout,
                        duration: NaN,
                        lastVolume: 1,
                        lastPlaybackRate: this.defaultPlaybackRate(),
                        media: null,
                        src: '',
                        source: {},
                        sources: [],
                        playbackRates: [],
                        volume: 1,
                    }
                }),
                (e.techCall_ = function (n, r) {
                    this.ready(function () {
                        if (n in Xi) return (e = this.middleware_), (t = this.tech_), (i = r), t[(t = n)](e.reduce(Yi(t), i))
                        if (n in Ki) return Gi(this.middleware_, this.tech_, n, r)
                        var e, t, i
                        try {
                            this.tech_ && this.tech_[n](r)
                        } catch (e) {
                            throw (h(e), e)
                        }
                    }, !0)
                }),
                (e.techGet_ = function (t) {
                    if (this.tech_ && this.tech_.isReady_) {
                        if (t in zi) return (e = this.middleware_), (i = this.tech_), (n = t), e.reduceRight(Yi(n), i[n]())
                        if (t in Ki) return Gi(this.middleware_, this.tech_, t)
                        var e, i, n
                        try {
                            return this.tech_[t]()
                        } catch (e) {
                            if (void 0 === this.tech_[t]) throw (h('Video.js: ' + t + ' method not defined for ' + this.techName_ + ' playback technology.', e), e)
                            if ('TypeError' === e.name) throw (h('Video.js: ' + t + ' unavailable on ' + this.techName_ + ' playback technology element.', e), (this.tech_.isReady_ = !1), e)
                            throw (h(e), e)
                        }
                    }
                }),
                (e.play = function () {
                    var t = this,
                        e = this.options_.Promise || window.Promise
                    return e
                        ? new e(function (e) {
                              t.play_(e)
                          })
                        : this.play_()
                }),
                (e.play_ = function (e) {
                    var t = this
                    this.playCallbacks_.push((e = void 0 === e ? Et : e))
                    e = Boolean(!this.changingSrc_ && (this.src() || this.currentSrc()))
                    if ((this.waitToPlay_ && (this.off(['ready', 'loadstart'], this.waitToPlay_), (this.waitToPlay_ = null)), !this.isReady_ || !e))
                        return (
                            (this.waitToPlay_ = function (e) {
                                t.play_()
                            }),
                            this.one(['ready', 'loadstart'], this.waitToPlay_),
                            void (e || (!V && !q) || this.load())
                        )
                    e = this.techGet_('play')
                    null === e ? this.runPlayTerminatedQueue_() : this.runPlayCallbacks_(e)
                }),
                (e.runPlayTerminatedQueue_ = function () {
                    var e = this.playTerminatedQueue_.slice(0)
                    ;(this.playTerminatedQueue_ = []),
                        e.forEach(function (e) {
                            e()
                        })
                }),
                (e.runPlayCallbacks_ = function (t) {
                    var e = this.playCallbacks_.slice(0)
                    ;(this.playCallbacks_ = []),
                        (this.playTerminatedQueue_ = []),
                        e.forEach(function (e) {
                            e(t)
                        })
                }),
                (e.pause = function () {
                    this.techCall_('pause')
                }),
                (e.paused = function () {
                    return !1 !== this.techGet_('paused')
                }),
                (e.played = function () {
                    return this.techGet_('played') || vt(0, 0)
                }),
                (e.scrubbing = function (e) {
                    if ('undefined' == typeof e) return this.scrubbing_
                    ;(this.scrubbing_ = !!e), this.techCall_('setScrubbing', this.scrubbing_), e ? this.addClass('vjs-scrubbing') : this.removeClass('vjs-scrubbing')
                }),
                (e.currentTime = function (e) {
                    return 'undefined' != typeof e
                        ? (e < 0 && (e = 0),
                          this.isReady_ && !this.changingSrc_ && this.tech_ && this.tech_.isReady_
                              ? (this.techCall_('setCurrentTime', e), void (this.cache_.initTime = 0))
                              : ((this.cache_.initTime = e), this.off('canplay', this.boundApplyInitTime_), void this.one('canplay', this.boundApplyInitTime_)))
                        : ((this.cache_.currentTime = this.techGet_('currentTime') || 0), this.cache_.currentTime)
                }),
                (e.applyInitTime_ = function () {
                    this.currentTime(this.cache_.initTime)
                }),
                (e.duration = function (e) {
                    if (void 0 === e) return void 0 !== this.cache_.duration ? this.cache_.duration : NaN
                    ;(e = (e = parseFloat(e)) < 0 ? 1 / 0 : e) !== this.cache_.duration &&
                        ((this.cache_.duration = e) === 1 / 0 ? this.addClass('vjs-live') : this.removeClass('vjs-live'), isNaN(e) || this.trigger('durationchange'))
                }),
                (e.remainingTime = function () {
                    return this.duration() - this.currentTime()
                }),
                (e.remainingTimeDisplay = function () {
                    return Math.floor(this.duration()) - Math.floor(this.currentTime())
                }),
                (e.buffered = function () {
                    var e
                    return (e = !(e = this.techGet_('buffered')) || !e.length ? vt(0, 0) : e)
                }),
                (e.bufferedPercent = function () {
                    return _t(this.buffered(), this.duration())
                }),
                (e.bufferedEnd = function () {
                    var e = this.buffered(),
                        t = this.duration(),
                        e = e.end(e.length - 1)
                    return (e = t < e ? t : e)
                }),
                (e.volume = function (e) {
                    var t
                    return void 0 !== e
                        ? ((t = Math.max(0, Math.min(1, parseFloat(e)))), (this.cache_.volume = t), this.techCall_('setVolume', t), void (0 < t && this.lastVolume_(t)))
                        : ((t = parseFloat(this.techGet_('volume'))), isNaN(t) ? 1 : t)
                }),
                (e.muted = function (e) {
                    if (void 0 === e) return this.techGet_('muted') || !1
                    this.techCall_('setMuted', e)
                }),
                (e.defaultMuted = function (e) {
                    return void 0 !== e ? this.techCall_('setDefaultMuted', e) : this.techGet_('defaultMuted') || !1
                }),
                (e.lastVolume_ = function (e) {
                    if (void 0 === e || 0 === e) return this.cache_.lastVolume
                    this.cache_.lastVolume = e
                }),
                (e.supportsFullScreen = function () {
                    return this.techGet_('supportsFullScreen') || !1
                }),
                (e.isFullscreen = function (e) {
                    if (void 0 === e) return this.isFullscreen_
                    var t = this.isFullscreen_
                    ;(this.isFullscreen_ = Boolean(e)), this.isFullscreen_ !== t && this.fsApi_.prefixed && this.trigger('fullscreenchange'), this.toggleFullscreenClass_()
                }),
                (e.requestFullscreen = function (s) {
                    var e = this.options_.Promise || window.Promise
                    if (e) {
                        var o = this
                        return new e(function (e, i) {
                            function n() {
                                o.off('fullscreenerror', r), o.off('fullscreenchange', t)
                            }
                            function t() {
                                n(), e()
                            }
                            function r(e, t) {
                                n(), i(t)
                            }
                            o.one('fullscreenchange', t), o.one('fullscreenerror', r)
                            var a = o.requestFullscreenHelper_(s)
                            a && (a.then(n, n), a.then(e, i))
                        })
                    }
                    return this.requestFullscreenHelper_()
                }),
                (e.requestFullscreenHelper_ = function (e) {
                    var t = this
                    if ((this.fsApi_.prefixed || ((i = (this.options_.fullscreen && this.options_.fullscreen.options) || {}), void 0 !== e && (i = e)), this.fsApi_.requestFullscreen)) {
                        var i = this.el_[this.fsApi_.requestFullscreen](i)
                        return (
                            i &&
                                i.then(
                                    function () {
                                        return t.isFullscreen(!0)
                                    },
                                    function () {
                                        return t.isFullscreen(!1)
                                    }
                                ),
                            i
                        )
                    }
                    this.tech_.supportsFullScreen() && !0 == !this.options_.preferFullWindow ? this.techCall_('enterFullScreen') : this.enterFullWindow()
                }),
                (e.exitFullscreen = function () {
                    var e = this.options_.Promise || window.Promise
                    if (e) {
                        var s = this
                        return new e(function (e, i) {
                            function n() {
                                s.off('fullscreenerror', r), s.off('fullscreenchange', t)
                            }
                            function t() {
                                n(), e()
                            }
                            function r(e, t) {
                                n(), i(t)
                            }
                            s.one('fullscreenchange', t), s.one('fullscreenerror', r)
                            var a = s.exitFullscreenHelper_()
                            a && (a.then(n, n), a.then(e, i))
                        })
                    }
                    return this.exitFullscreenHelper_()
                }),
                (e.exitFullscreenHelper_ = function () {
                    var e = this
                    if (this.fsApi_.requestFullscreen) {
                        var t = document[this.fsApi_.exitFullscreen]()
                        return (
                            t &&
                                Et(
                                    t.then(function () {
                                        return e.isFullscreen(!1)
                                    })
                                ),
                            t
                        )
                    }
                    this.tech_.supportsFullScreen() && !0 == !this.options_.preferFullWindow ? this.techCall_('exitFullScreen') : this.exitFullWindow()
                }),
                (e.enterFullWindow = function () {
                    this.isFullscreen(!0),
                        (this.isFullWindow = !0),
                        (this.docOrigOverflow = document.documentElement.style.overflow),
                        Be(document, 'keydown', this.boundFullWindowOnEscKey_),
                        (document.documentElement.style.overflow = 'hidden'),
                        te(document.body, 'vjs-full-window'),
                        this.trigger('enterFullWindow')
                }),
                (e.fullWindowOnEscKey = function (e) {
                    ht.isEventKey(e, 'Esc') && !0 === this.isFullscreen() && (this.isFullWindow ? this.exitFullWindow() : this.exitFullscreen())
                }),
                (e.exitFullWindow = function () {
                    this.isFullscreen(!1),
                        (this.isFullWindow = !1),
                        Fe(document, 'keydown', this.boundFullWindowOnEscKey_),
                        (document.documentElement.style.overflow = this.docOrigOverflow),
                        ie(document.body, 'vjs-full-window'),
                        this.trigger('exitFullWindow')
                }),
                (e.disablePictureInPicture = function (e) {
                    if (void 0 === e) return this.techGet_('disablePictureInPicture')
                    this.techCall_('setDisablePictureInPicture', e), (this.options_.disablePictureInPicture = e), this.trigger('disablepictureinpicturechanged')
                }),
                (e.isInPictureInPicture = function (e) {
                    return void 0 !== e ? ((this.isInPictureInPicture_ = !!e), void this.togglePictureInPictureClass_()) : !!this.isInPictureInPicture_
                }),
                (e.requestPictureInPicture = function () {
                    if ('pictureInPictureEnabled' in document && !1 === this.disablePictureInPicture()) return this.techGet_('requestPictureInPicture')
                }),
                (e.exitPictureInPicture = function () {
                    if ('pictureInPictureEnabled' in document) return document.exitPictureInPicture()
                }),
                (e.handleKeyDown = function (e) {
                    var t = this.options_.userActions
                    t &&
                        t.hotkeys &&
                        ((function (e) {
                            var t = e.tagName.toLowerCase()
                            if (e.isContentEditable) return !0
                            if ('input' === t) return -1 === ['button', 'checkbox', 'hidden', 'radio', 'reset', 'submit'].indexOf(e.type)
                            return -1 !== ['textarea'].indexOf(t)
                        })(this.el_.ownerDocument.activeElement) ||
                            ('function' == typeof t.hotkeys ? t.hotkeys.call(this, e) : this.handleHotkeys(e)))
                }),
                (e.handleHotkeys = function (e) {
                    var t = this.options_.userActions ? this.options_.userActions.hotkeys : {},
                        i = t.fullscreenKey,
                        n = t.muteKey,
                        n =
                            void 0 === n
                                ? function (e) {
                                      return ht.isEventKey(e, 'm')
                                  }
                                : n,
                        t = t.playPauseKey,
                        t =
                            void 0 === t
                                ? function (e) {
                                      return ht.isEventKey(e, 'k') || ht.isEventKey(e, 'Space')
                                  }
                                : t
                    ;(void 0 === i
                        ? function (e) {
                              return ht.isEventKey(e, 'f')
                          }
                        : i
                    ).call(this, e)
                        ? (e.preventDefault(), e.stopPropagation(), (i = pt.getComponent('FullscreenToggle')), !1 !== document[this.fsApi_.fullscreenEnabled] && i.prototype.handleClick.call(this, e))
                        : n.call(this, e)
                        ? (e.preventDefault(), e.stopPropagation(), pt.getComponent('MuteToggle').prototype.handleClick.call(this, e))
                        : t.call(this, e) && (e.preventDefault(), e.stopPropagation(), pt.getComponent('PlayToggle').prototype.handleClick.call(this, e))
                }),
                (e.canPlayType = function (e) {
                    for (var t, i = 0, n = this.options_.techOrder; i < n.length; i++) {
                        var r = n[i],
                            a = ji.getTech(r)
                        if ((a = a || pt.getComponent(r))) {
                            if (a.isSupported() && (t = a.canPlayType(e))) return t
                        } else h.error('The "' + r + '" tech is undefined. Skipped browser support check for that tech.')
                    }
                    return ''
                }),
                (e.selectSource = function (e) {
                    function t(e, i, n) {
                        var r
                        return (
                            e.some(function (t) {
                                return i.some(function (e) {
                                    if ((r = n(t, e))) return !0
                                })
                            }),
                            r
                        )
                    }
                    var i,
                        n = this,
                        r = this.options_.techOrder
                            .map(function (e) {
                                return [e, ji.getTech(e)]
                            })
                            .filter(function (e) {
                                var t = e[0],
                                    e = e[1]
                                return e ? e.isSupported() : (h.error('The "' + t + '" tech is undefined. Skipped browser support check for that tech.'), !1)
                            }),
                        a = function (e, t) {
                            var i = e[0]
                            if (e[1].canPlaySource(t, n.options_[i.toLowerCase()])) return { source: t, tech: i }
                        },
                        a = this.options_.sourceOrder
                            ? t(
                                  e,
                                  r,
                                  ((i = a),
                                  function (e, t) {
                                      return i(t, e)
                                  })
                              )
                            : t(r, e, a)
                    return a || !1
                }),
                (e.handleSrc_ = function (e, n) {
                    var r = this
                    if ('undefined' == typeof e) return this.cache_.src || ''
                    this.resetRetryOnError_ && this.resetRetryOnError_()
                    var t,
                        i,
                        a = Ji(e)
                    a.length
                        ? ((this.changingSrc_ = !0),
                          n || (this.cache_.sources = a),
                          this.updateSourceCaches_(a[0]),
                          Wi(this, a[0], function (e, t) {
                              var i
                              return (
                                  (r.middleware_ = t),
                                  n || (r.cache_.sources = a),
                                  r.updateSourceCaches_(e),
                                  r.src_(e)
                                      ? 1 < a.length
                                          ? r.handleSrc_(a.slice(1))
                                          : ((r.changingSrc_ = !1),
                                            r.setTimeout(function () {
                                                this.error({ code: 4, message: this.options_.notSupportedMessage })
                                            }, 0),
                                            void r.triggerReady())
                                      : ((t = t),
                                        (i = r.tech_),
                                        void t.forEach(function (e) {
                                            return e.setTech && e.setTech(i)
                                        }))
                              )
                          }),
                          this.options_.retryOnError &&
                              1 < a.length &&
                              ((i = function () {
                                  r.off('error', t)
                              }),
                              this.one(
                                  'error',
                                  (t = function () {
                                      r.error(null), r.handleSrc_(a.slice(1), !0)
                                  })
                              ),
                              this.one('playing', i),
                              (this.resetRetryOnError_ = function () {
                                  r.off('error', t), r.off('playing', i)
                              })))
                        : this.setTimeout(function () {
                              this.error({ code: 4, message: this.options_.notSupportedMessage })
                          }, 0)
                }),
                (e.src = function (e) {
                    return this.handleSrc_(e, !1)
                }),
                (e.src_ = function (e) {
                    var t,
                        i,
                        n = this,
                        r = this.selectSource([e])
                    return (
                        !r ||
                        ((t = r.tech),
                        (i = this.techName_),
                        ut(t) !== ut(i)
                            ? ((this.changingSrc_ = !0),
                              this.loadTech_(r.tech, r.source),
                              this.tech_.ready(function () {
                                  n.changingSrc_ = !1
                              }))
                            : this.ready(function () {
                                  this.tech_.constructor.prototype.hasOwnProperty('setSource') ? this.techCall_('setSource', e) : this.techCall_('src', e.src), (this.changingSrc_ = !1)
                              }, !0),
                        !1)
                    )
                }),
                (e.load = function () {
                    this.techCall_('load')
                }),
                (e.reset = function () {
                    var e = this,
                        t = this.options_.Promise || window.Promise
                    this.paused() || !t
                        ? this.doReset_()
                        : Et(
                              this.play().then(function () {
                                  return e.doReset_()
                              })
                          )
                }),
                (e.doReset_ = function () {
                    this.tech_ && this.tech_.clearTracks('text'),
                        this.resetCache_(),
                        this.poster(''),
                        this.loadTech_(this.options_.techOrder[0], null),
                        this.techCall_('reset'),
                        this.resetControlBarUI_(),
                        it(this) && this.trigger('playerreset')
                }),
                (e.resetControlBarUI_ = function () {
                    this.resetProgressBar_(), this.resetPlaybackRate_(), this.resetVolumeBar_()
                }),
                (e.resetProgressBar_ = function () {
                    this.currentTime(0)
                    var e = this.controlBar || {},
                        t = e.durationDisplay,
                        e = e.remainingTimeDisplay
                    t && t.updateContent(), e && e.updateContent()
                }),
                (e.resetPlaybackRate_ = function () {
                    this.playbackRate(this.defaultPlaybackRate()), this.handleTechRateChange_()
                }),
                (e.resetVolumeBar_ = function () {
                    this.volume(1), this.trigger('volumechange')
                }),
                (e.currentSources = function () {
                    var e = this.currentSource(),
                        t = []
                    return 0 !== Object.keys(e).length && t.push(e), this.cache_.sources || t
                }),
                (e.currentSource = function () {
                    return this.cache_.source || {}
                }),
                (e.currentSrc = function () {
                    return (this.currentSource() && this.currentSource().src) || ''
                }),
                (e.currentType = function () {
                    return (this.currentSource() && this.currentSource().type) || ''
                }),
                (e.preload = function (e) {
                    return void 0 !== e ? (this.techCall_('setPreload', e), void (this.options_.preload = e)) : this.techGet_('preload')
                }),
                (e.autoplay = function (e) {
                    if (void 0 === e) return this.options_.autoplay || !1
                    var t
                    ;('string' == typeof e && /(any|play|muted)/.test(e)) || (!0 === e && this.options_.normalizeAutoplay)
                        ? ((this.options_.autoplay = e), this.manualAutoplay_('string' == typeof e ? e : 'play'), (t = !1))
                        : (this.options_.autoplay = !!e),
                        (t = 'undefined' == typeof t ? this.options_.autoplay : t),
                        this.tech_ && this.techCall_('setAutoplay', t)
                }),
                (e.playsinline = function (e) {
                    return void 0 !== e ? (this.techCall_('setPlaysinline', e), (this.options_.playsinline = e), this) : this.techGet_('playsinline')
                }),
                (e.loop = function (e) {
                    return void 0 !== e ? (this.techCall_('setLoop', e), void (this.options_.loop = e)) : this.techGet_('loop')
                }),
                (e.poster = function (e) {
                    if (void 0 === e) return this.poster_
                    ;(e = e || '') !== this.poster_ && ((this.poster_ = e), this.techCall_('setPoster', e), (this.isPosterFromTech_ = !1), this.trigger('posterchange'))
                }),
                (e.handleTechPosterChange_ = function () {
                    var e
                    ;(this.poster_ && !this.options_.techCanOverridePoster) ||
                        !this.tech_ ||
                        !this.tech_.poster ||
                        ((e = this.tech_.poster() || '') !== this.poster_ && ((this.poster_ = e), (this.isPosterFromTech_ = !0), this.trigger('posterchange')))
                }),
                (e.controls = function (e) {
                    if (void 0 === e) return !!this.controls_
                    this.controls_ !== (e = !!e) &&
                        ((this.controls_ = e),
                        this.usingNativeControls() && this.techCall_('setControls', e),
                        this.controls_
                            ? (this.removeClass('vjs-controls-disabled'),
                              this.addClass('vjs-controls-enabled'),
                              this.trigger('controlsenabled'),
                              this.usingNativeControls() || this.addTechControlsListeners_())
                            : (this.removeClass('vjs-controls-enabled'),
                              this.addClass('vjs-controls-disabled'),
                              this.trigger('controlsdisabled'),
                              this.usingNativeControls() || this.removeTechControlsListeners_()))
                }),
                (e.usingNativeControls = function (e) {
                    if (void 0 === e) return !!this.usingNativeControls_
                    this.usingNativeControls_ !== (e = !!e) &&
                        ((this.usingNativeControls_ = e),
                        this.usingNativeControls_
                            ? (this.addClass('vjs-using-native-controls'), this.trigger('usingnativecontrols'))
                            : (this.removeClass('vjs-using-native-controls'), this.trigger('usingcustomcontrols')))
                }),
                (e.error = function (t) {
                    var i = this
                    if (void 0 === t) return this.error_ || null
                    if (
                        (a('beforeerror').forEach(function (e) {
                            e = e(i, t)
                            ;(T(e) && !Array.isArray(e)) || 'string' == typeof e || 'number' == typeof e || null === e
                                ? (t = e)
                                : i.log.error('please return a value that MediaError expects in beforeerror hooks')
                        }),
                        this.options_.suppressNotSupportedError && t && 4 === t.code)
                    ) {
                        var e = function () {
                            this.error(t)
                        }
                        return (
                            (this.options_.suppressNotSupportedError = !1),
                            this.any(['click', 'touchstart'], e),
                            void this.one('loadstart', function () {
                                this.off(['click', 'touchstart'], e)
                            })
                        )
                    }
                    if (null === t) return (this.error_ = t), this.removeClass('vjs-error'), void (this.errorDisplay && this.errorDisplay.close())
                    ;(this.error_ = new bt(t)),
                        this.addClass('vjs-error'),
                        h.error('(CODE:' + this.error_.code + ' ' + bt.errorTypes[this.error_.code] + ')', this.error_.message, this.error_),
                        this.trigger('error'),
                        a('error').forEach(function (e) {
                            return e(i, i.error_)
                        })
                }),
                (e.reportUserActivity = function (e) {
                    this.userActivity_ = !0
                }),
                (e.userActive = function (e) {
                    if (void 0 === e) return this.userActive_
                    if ((e = !!e) !== this.userActive_) {
                        if (((this.userActive_ = e), this.userActive_))
                            return (this.userActivity_ = !0), this.removeClass('vjs-user-inactive'), this.addClass('vjs-user-active'), void this.trigger('useractive')
                        this.tech_ &&
                            this.tech_.one('mousemove', function (e) {
                                e.stopPropagation(), e.preventDefault()
                            }),
                            (this.userActivity_ = !1),
                            this.removeClass('vjs-user-active'),
                            this.addClass('vjs-user-inactive'),
                            this.trigger('userinactive')
                    }
                }),
                (e.listenForUserActivity_ = function () {
                    var t,
                        i,
                        n,
                        r = Ve(this, this.reportUserActivity),
                        e = function (e) {
                            r(), this.clearInterval(t)
                        }
                    this.on('mousedown', function () {
                        r(), this.clearInterval(t), (t = this.setInterval(r, 250))
                    }),
                        this.on('mousemove', function (e) {
                            ;(e.screenX === i && e.screenY === n) || ((i = e.screenX), (n = e.screenY), r())
                        }),
                        this.on('mouseup', e),
                        this.on('mouseleave', e)
                    var a,
                        e = this.getChild('controlBar')
                    !e ||
                        q ||
                        A ||
                        (e.on('mouseenter', function (e) {
                            0 !== this.player().options_.inactivityTimeout && (this.player().cache_.inactivityTimeout = this.player().options_.inactivityTimeout),
                                (this.player().options_.inactivityTimeout = 0)
                        }),
                        e.on('mouseleave', function (e) {
                            this.player().options_.inactivityTimeout = this.player().cache_.inactivityTimeout
                        })),
                        this.on('keydown', r),
                        this.on('keyup', r),
                        this.setInterval(function () {
                            var e
                            this.userActivity_ &&
                                ((this.userActivity_ = !1),
                                this.userActive(!0),
                                this.clearTimeout(a),
                                (e = this.options_.inactivityTimeout) <= 0 ||
                                    (a = this.setTimeout(function () {
                                        this.userActivity_ || this.userActive(!1)
                                    }, e)))
                        }, 250)
                }),
                (e.playbackRate = function (e) {
                    if (void 0 === e) return this.tech_ && this.tech_.featuresPlaybackRate ? this.cache_.lastPlaybackRate || this.techGet_('playbackRate') : 1
                    this.techCall_('setPlaybackRate', e)
                }),
                (e.defaultPlaybackRate = function (e) {
                    return void 0 !== e ? this.techCall_('setDefaultPlaybackRate', e) : this.tech_ && this.tech_.featuresPlaybackRate ? this.techGet_('defaultPlaybackRate') : 1
                }),
                (e.isAudio = function (e) {
                    if (void 0 === e) return !!this.isAudio_
                    this.isAudio_ = !!e
                }),
                (e.enableAudioOnlyUI_ = function () {
                    var t = this
                    this.addClass('vjs-audio-only-mode')
                    var e = this.children(),
                        i = this.getChild('ControlBar'),
                        n = i && i.currentHeight()
                    e.forEach(function (e) {
                        e !== i && e.el_ && !e.hasClass('vjs-hidden') && (e.hide(), t.audioOnlyCache_.hiddenChildren.push(e))
                    }),
                        (this.audioOnlyCache_.playerHeight = this.currentHeight()),
                        this.height(n),
                        this.trigger('audioonlymodechange')
                }),
                (e.disableAudioOnlyUI_ = function () {
                    this.removeClass('vjs-audio-only-mode'),
                        this.audioOnlyCache_.hiddenChildren.forEach(function (e) {
                            return e.show()
                        }),
                        this.height(this.audioOnlyCache_.playerHeight),
                        this.trigger('audioonlymodechange')
                }),
                (e.audioOnlyMode = function (e) {
                    var t = this
                    if ('boolean' != typeof e || e === this.audioOnlyMode_) return this.audioOnlyMode_
                    this.audioOnlyMode_ = e
                    var i = this.options_.Promise || window.Promise
                    if (i) {
                        if (e) {
                            var n = []
                            return (
                                this.isInPictureInPicture() && n.push(this.exitPictureInPicture()),
                                this.isFullscreen() && n.push(this.exitFullscreen()),
                                this.audioPosterMode() && n.push(this.audioPosterMode(!1)),
                                i.all(n).then(function () {
                                    return t.enableAudioOnlyUI_()
                                })
                            )
                        }
                        return i.resolve().then(function () {
                            return t.disableAudioOnlyUI_()
                        })
                    }
                    e ? (this.isInPictureInPicture() && this.exitPictureInPicture(), this.isFullscreen() && this.exitFullscreen(), this.enableAudioOnlyUI_()) : this.disableAudioOnlyUI_()
                }),
                (e.enablePosterModeUI_ = function () {
                    ;(this.tech_ && this.tech_).hide(), this.addClass('vjs-audio-poster-mode'), this.trigger('audiopostermodechange')
                }),
                (e.disablePosterModeUI_ = function () {
                    ;(this.tech_ && this.tech_).show(), this.removeClass('vjs-audio-poster-mode'), this.trigger('audiopostermodechange')
                }),
                (e.audioPosterMode = function (e) {
                    var t = this
                    if ('boolean' != typeof e || e === this.audioPosterMode_) return this.audioPosterMode_
                    this.audioPosterMode_ = e
                    var i = this.options_.Promise || window.Promise
                    return i
                        ? e
                            ? (this.audioOnlyMode() ? this.audioOnlyMode(!1) : i.resolve()).then(function () {
                                  t.enablePosterModeUI_()
                              })
                            : i.resolve().then(function () {
                                  t.disablePosterModeUI_()
                              })
                        : e
                        ? (this.audioOnlyMode() && this.audioOnlyMode(!1), void this.enablePosterModeUI_())
                        : void this.disablePosterModeUI_()
                }),
                (e.addTextTrack = function (e, t, i) {
                    if (this.tech_) return this.tech_.addTextTrack(e, t, i)
                }),
                (e.addRemoteTextTrack = function (e, t) {
                    if (this.tech_) return this.tech_.addRemoteTextTrack(e, t)
                }),
                (e.removeRemoteTextTrack = function (e) {
                    var t = (t = (e = void 0 === e ? {} : e).track) || e
                    if (this.tech_) return this.tech_.removeRemoteTextTrack(t)
                }),
                (e.getVideoPlaybackQuality = function () {
                    return this.techGet_('getVideoPlaybackQuality')
                }),
                (e.videoWidth = function () {
                    return (this.tech_ && this.tech_.videoWidth && this.tech_.videoWidth()) || 0
                }),
                (e.videoHeight = function () {
                    return (this.tech_ && this.tech_.videoHeight && this.tech_.videoHeight()) || 0
                }),
                (e.language = function (e) {
                    if (void 0 === e) return this.language_
                    this.language_ !== String(e).toLowerCase() && ((this.language_ = String(e).toLowerCase()), it(this) && this.trigger('languagechange'))
                }),
                (e.languages = function () {
                    return lt(o.prototype.options_.languages, this.languages_)
                }),
                (e.toJSON = function () {
                    var e = lt(this.options_),
                        t = e.tracks
                    e.tracks = []
                    for (var i = 0; i < t.length; i++) {
                        var n = t[i]
                        ;((n = lt(n)).player = void 0), (e.tracks[i] = n)
                    }
                    return e
                }),
                (e.createModal = function (e, t) {
                    var i = this
                    ;(t = t || {}).content = e || ''
                    var n = new At(this, t)
                    return (
                        this.addChild(n),
                        n.on('dispose', function () {
                            i.removeChild(n)
                        }),
                        n.open(),
                        n
                    )
                }),
                (e.updateCurrentBreakpoint_ = function () {
                    if (this.responsive())
                        for (var e = this.currentBreakpoint(), t = this.currentWidth(), i = 0; i < Nn.length; i++) {
                            var n = Nn[i]
                            if (t <= this.breakpoints_[n]) {
                                if (e === n) return
                                e && this.removeClass(Un[e]), this.addClass(Un[n]), (this.breakpoint_ = n)
                                break
                            }
                        }
                }),
                (e.removeCurrentBreakpoint_ = function () {
                    var e = this.currentBreakpointClass()
                    ;(this.breakpoint_ = ''), e && this.removeClass(e)
                }),
                (e.breakpoints = function (e) {
                    return void 0 === e || ((this.breakpoint_ = ''), (this.breakpoints_ = b({}, Bn, e)), this.updateCurrentBreakpoint_()), b(this.breakpoints_)
                }),
                (e.responsive = function (e) {
                    return void 0 === e
                        ? this.responsive_
                        : (e = Boolean(e)) !== this.responsive_
                        ? ((this.responsive_ = e)
                              ? (this.on('playerresize', this.boundUpdateCurrentBreakpoint_), this.updateCurrentBreakpoint_())
                              : (this.off('playerresize', this.boundUpdateCurrentBreakpoint_), this.removeCurrentBreakpoint_()),
                          e)
                        : void 0
                }),
                (e.currentBreakpoint = function () {
                    return this.breakpoint_
                }),
                (e.currentBreakpointClass = function () {
                    return Un[this.breakpoint_] || ''
                }),
                (e.loadMedia = function (e, t) {
                    var i,
                        n,
                        r,
                        a = this
                    e &&
                        'object' == typeof e &&
                        (this.reset(),
                        (this.cache_.media = lt(e)),
                        (i = (r = this.cache_.media).artwork),
                        (n = r.poster),
                        (e = r.src),
                        (r = r.textTracks),
                        !i && n && (this.cache_.media.artwork = [{ src: n, type: $i(n) }]),
                        e && this.src(e),
                        n && this.poster(n),
                        Array.isArray(r) &&
                            r.forEach(function (e) {
                                return a.addRemoteTextTrack(e, !1)
                            }),
                        this.ready(t))
                }),
                (e.getMedia = function () {
                    if (this.cache_.media) return lt(this.cache_.media)
                    var e = this.poster(),
                        t = {
                            src: this.currentSources(),
                            textTracks: Array.prototype.map.call(this.remoteTextTracks(), function (e) {
                                return { kind: e.kind, label: e.label, language: e.language, src: e.src }
                            }),
                        }
                    return e && ((t.poster = e), (t.artwork = [{ src: t.poster, type: $i(t.poster) }])), t
                }),
                (o.getTagSettings = function (e) {
                    var t,
                        i = { sources: [], tracks: [] },
                        n = ae(e),
                        r = n['data-setup']
                    if (
                        (ee(e, 'vjs-fill') && (n.fill = !0),
                        ee(e, 'vjs-fluid') && (n.fluid = !0),
                        null !== r && ((r = (t = St(r || '{}'))[0]), (t = t[1]), r && h.error(r), b(n, t)),
                        b(i, n),
                        e.hasChildNodes())
                    )
                        for (var a = e.childNodes, s = 0, o = a.length; s < o; s++) {
                            var u = a[s],
                                l = u.nodeName.toLowerCase()
                            'source' === l ? i.sources.push(ae(u)) : 'track' === l && i.tracks.push(ae(u))
                        }
                    return i
                }),
                (e.flexNotSupported_ = function () {
                    var e = document.createElement('i')
                    return !('flexBasis' in e.style || 'webkitFlexBasis' in e.style || 'mozFlexBasis' in e.style || 'msFlexBasis' in e.style || 'msFlexOrder' in e.style)
                }),
                (e.debug = function (e) {
                    if (void 0 === e) return this.debugEnabled_
                    e
                        ? (this.trigger('debugon'), (this.previousLogLevel_ = this.log.level), this.log.level('debug'), (this.debugEnabled_ = !0))
                        : (this.trigger('debugoff'), this.log.level(this.previousLogLevel_), (this.previousLogLevel_ = void 0), (this.debugEnabled_ = !1))
                }),
                (e.playbackRates = function (e) {
                    if (void 0 === e) return this.cache_.playbackRates
                    Array.isArray(e) &&
                        e.every(function (e) {
                            return 'number' == typeof e
                        }) &&
                        ((this.cache_.playbackRates = e), this.trigger('playbackrateschange'))
                }),
                o
            )
        })(pt)
    oi.names.forEach(function (e) {
        var t = oi[e]
        Fn.prototype[t.getterName] = function () {
            return this.tech_ ? this.tech_[t.getterName]() : ((this[t.privateName] = this[t.privateName] || new t.ListClass()), this[t.privateName])
        }
    }),
        (Fn.prototype.crossorigin = Fn.prototype.crossOrigin),
        (Fn.players = {})
    k = window.navigator
    ;(Fn.prototype.options_ = {
        techOrder: ji.defaultTechOrder_,
        html5: {},
        inactivityTimeout: 2e3,
        playbackRates: [],
        liveui: !1,
        children: ['mediaLoader', 'posterImage', 'textTrackDisplay', 'loadingSpinner', 'bigPlayButton', 'liveTracker', 'controlBar', 'errorDisplay', 'textTrackSettings', 'resizeManager'],
        language: (k && ((k.languages && k.languages[0]) || k.userLanguage || k.language)) || 'en',
        languages: {},
        notSupportedMessage: 'No compatible source was found for this media.',
        normalizeAutoplay: !1,
        fullscreen: { options: { navigationUI: 'hide' } },
        breakpoints: {},
        responsive: !1,
        audioOnlyMode: !1,
        audioPosterMode: !1,
    }),
        ['ended', 'seeking', 'seekable', 'networkState', 'readyState'].forEach(function (e) {
            Fn.prototype[e] = function () {
                return this.techGet_(e)
            }
        }),
        Mn.forEach(function (e) {
            Fn.prototype['handleTech' + ut(e) + '_'] = function () {
                return this.trigger(e)
            }
        }),
        pt.registerComponent('Player', Fn)
    var jn = m(function (i) {
        function n(e, t) {
            return (
                (i.exports = n =
                    Object.setPrototypeOf ||
                    function (e, t) {
                        return (e.__proto__ = t), e
                    }),
                n(e, t)
            )
        }
        i.exports = n
    })
    function Hn(e) {
        return Qn.hasOwnProperty(e)
    }
    function qn(e) {
        return Hn(e) ? Qn[e] : void 0
    }
    function Vn(e, t, i) {
        ;(i = (i ? 'before' : '') + 'pluginsetup'), e.trigger(i, t), e.trigger(i + ':' + t.name, t)
    }
    function Wn(t, i) {
        function n() {
            Vn(this, { name: t, plugin: i, instance: null }, !0)
            var e = i.apply(this, arguments)
            return $n(this, t), Vn(this, { name: t, plugin: i, instance: e }), e
        }
        return (
            Object.keys(i).forEach(function (e) {
                n[e] = i[e]
            }),
            n
        )
    }
    function Gn(r, a) {
        return (
            (a.prototype.name = r),
            function () {
                Vn(this, { name: r, plugin: a, instance: null }, !0)
                for (var e = arguments.length, t = new Array(e), i = 0; i < e; i++) t[i] = arguments[i]
                var n = Xn(a, [this].concat(t))
                return (
                    (this[r] = function () {
                        return n
                    }),
                    Vn(this, n.getEventHash()),
                    n
                )
            }
        )
    }
    var zn = function () {
            if ('undefined' == typeof Reflect || !Reflect.construct) return !1
            if (Reflect.construct.sham) return !1
            if ('function' == typeof Proxy) return !0
            try {
                return Date.prototype.toString.call(Reflect.construct(Date, [], function () {})), !0
            } catch (e) {
                return !1
            }
        },
        Xn = m(function (n) {
            function r(e, t, i) {
                return (
                    zn()
                        ? (n.exports = r = Reflect.construct)
                        : (n.exports = r =
                              function (e, t, i) {
                                  var n = [null]
                                  n.push.apply(n, t)
                                  n = new (Function.bind.apply(e, n))()
                                  return i && jn(n, i.prototype), n
                              }),
                    r.apply(null, arguments)
                )
            }
            n.exports = r
        }),
        Kn = 'plugin',
        Yn = 'activePlugins_',
        Qn = {},
        $n = function (e, t) {
            ;(e[Yn] = e[Yn] || {}), (e[Yn][t] = !0)
        },
        Jn = (function () {
            function i(e) {
                if (this.constructor === i) throw new Error('Plugin must be sub-classed; not directly instantiated.')
                ;(this.player = e),
                    this.log || (this.log = this.player.log.createLogger(this.name)),
                    rt(this),
                    delete this.trigger,
                    st(this, this.constructor.defaultState),
                    $n(e, this.name),
                    (this.dispose = this.dispose.bind(this)),
                    e.on('dispose', this.dispose)
            }
            var e = i.prototype
            return (
                (e.version = function () {
                    return this.constructor.VERSION
                }),
                (e.getEventHash = function (e) {
                    return ((e = void 0 === e ? {} : e).name = this.name), (e.plugin = this.constructor), (e.instance = this), e
                }),
                (e.trigger = function (e, t) {
                    return je(this.eventBusEl_, e, this.getEventHash((t = void 0 === t ? {} : t)))
                }),
                (e.handleStateChanged = function (e) {}),
                (e.dispose = function () {
                    var e = this.name,
                        t = this.player
                    this.trigger('dispose'), this.off(), t.off('dispose', this.dispose), (t[Yn][e] = !1), (this.player = this.state = null), (t[e] = Gn(e, Qn[e]))
                }),
                (i.isBasic = function (e) {
                    e = 'string' == typeof e ? qn(e) : e
                    return 'function' == typeof e && !i.prototype.isPrototypeOf(e.prototype)
                }),
                (i.registerPlugin = function (e, t) {
                    if ('string' != typeof e) throw new Error('Illegal plugin name, "' + e + '", must be a string, was ' + typeof e + '.')
                    if (Hn(e)) h.warn('A plugin named "' + e + '" already exists. You may want to avoid re-registering plugins!')
                    else if (Fn.prototype.hasOwnProperty(e)) throw new Error('Illegal plugin name, "' + e + '", cannot share a name with an existing player method!')
                    if ('function' != typeof t) throw new Error('Illegal plugin for "' + e + '", must be a function, was ' + typeof t + '.')
                    return (Qn[e] = t), e !== Kn && (i.isBasic(t) ? (Fn.prototype[e] = Wn(e, t)) : (Fn.prototype[e] = Gn(e, t))), t
                }),
                (i.deregisterPlugin = function (e) {
                    if (e === Kn) throw new Error('Cannot de-register base plugin.')
                    Hn(e) && (delete Qn[e], delete Fn.prototype[e])
                }),
                (i.getPlugins = function (e) {
                    var i
                    return (
                        (e = void 0 === e ? Object.keys(Qn) : e).forEach(function (e) {
                            var t = qn(e)
                            t && ((i = i || {})[e] = t)
                        }),
                        i
                    )
                }),
                (i.getPluginVersion = function (e) {
                    e = qn(e)
                    return (e && e.VERSION) || ''
                }),
                i
            )
        })()
    ;(Jn.getPlugin = qn),
        (Jn.BASE_PLUGIN_NAME = Kn),
        Jn.registerPlugin(Kn, Jn),
        (Fn.prototype.usingPlugin = function (e) {
            return !!this[Yn] && !0 === this[Yn][e]
        }),
        (Fn.prototype.hasPlugin = function (e) {
            return !!Hn(e)
        })
    var Zn = function (e, t) {
            if ('function' != typeof t && null !== t) throw new TypeError('Super expression must either be null or a function')
            ;(e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } })), t && jn(e, t)
        },
        er = function (e) {
            return 0 === e.indexOf('#') ? e.slice(1) : e
        }
    function tr(e, t, i) {
        if ((r = tr.getPlayer(e))) return t && h.warn('Player "' + e + '" is already initialised. Options will not be applied.'), i && r.ready(i), r
        var n = 'string' == typeof e ? Te('#' + er(e)) : e
        if (!K(n)) throw new TypeError('The element or ID supplied is not valid. (videojs)')
        ;(n.ownerDocument.defaultView && n.ownerDocument.body.contains(n)) || h.warn('The element supplied is not included in the DOM'),
            !0 === (t = t || {}).restoreEl && (t.restoreEl = (n.parentNode && n.parentNode.hasAttribute('data-vjs-player') ? n.parentNode : n).cloneNode(!0)),
            a('beforesetup').forEach(function (e) {
                e = e(n, lt(t))
                T(e) && !Array.isArray(e) ? (t = lt(t, e)) : h.error('please return an object in beforesetup hooks')
            })
        var r = new (pt.getComponent('Player'))(n, t, i)
        return (
            a('setup').forEach(function (e) {
                return e(r)
            }),
            r
        )
    }
    ;(tr.hooks_ = i),
        (tr.hooks = a),
        (tr.hook = function (e, t) {
            a(e, t)
        }),
        (tr.hookOnce = function (i, e) {
            a(
                i,
                [].concat(e).map(function (t) {
                    return function e() {
                        return n(i, e), t.apply(void 0, arguments)
                    }
                })
            )
        }),
        (tr.removeHook = n),
        !0 !== window.VIDEOJS_NO_DYNAMIC_STYLE &&
            X() &&
            ((ar = Te('.vjs-styles-defaults')) ||
                ((ar = xe('vjs-styles-defaults')),
                (k = Te('head')) && k.insertBefore(ar, k.firstChild),
                Ae(ar, '\n      .video-js {\n        width: 300px;\n        height: 150px;\n      }\n\n      .vjs-fluid:not(.vjs-audio-only-mode) {\n        padding-top: 56.25%\n      }\n    '))),
        Ce(1, tr),
        (tr.VERSION = u),
        (tr.options = Fn.prototype.options_),
        (tr.getPlayers = function () {
            return Fn.players
        }),
        (tr.getPlayer = function (e) {
            var t = Fn.players
            if ('string' == typeof e) {
                var i = er(e),
                    n = t[i]
                if (n) return n
                i = Te('#' + i)
            } else i = e
            if (K(i)) {
                ;(e = i.player), (i = i.playerId)
                if (e || t[i]) return e || t[i]
            }
        }),
        (tr.getAllPlayers = function () {
            return Object.keys(Fn.players)
                .map(function (e) {
                    return Fn.players[e]
                })
                .filter(Boolean)
        }),
        (tr.players = Fn.players),
        (tr.getComponent = pt.getComponent),
        (tr.registerComponent = function (e, t) {
            ji.isTech(t) && h.warn('The ' + e + ' tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)'), pt.registerComponent.call(pt, e, t)
        }),
        (tr.getTech = ji.getTech),
        (tr.registerTech = ji.registerTech),
        (tr.use = function (e, t) {
            ;(Hi[e] = Hi[e] || []), Hi[e].push(t)
        }),
        Object.defineProperty(tr, 'middleware', { value: {}, writeable: !1, enumerable: !0 }),
        Object.defineProperty(tr.middleware, 'TERMINATOR', { value: Vi, writeable: !1, enumerable: !0 }),
        (tr.browser = W),
        (tr.TOUCH_ENABLED = F),
        (tr.extend = function (e, t) {
            var i,
                n = function () {
                    e.apply(this, arguments)
                },
                r = {}
            for (i in ('object' == typeof (t = void 0 === t ? {} : t) ? (t.constructor !== Object.prototype.constructor && (n = t.constructor), (r = t)) : 'function' == typeof t && (n = t),
            Zn(n, e),
            e && (n.super_ = e),
            r))
                r.hasOwnProperty(i) && (n.prototype[i] = r[i])
            return n
        }),
        (tr.mergeOptions = lt),
        (tr.bind = Ve),
        (tr.registerPlugin = Jn.registerPlugin),
        (tr.deregisterPlugin = Jn.deregisterPlugin),
        (tr.plugin = function (e, t) {
            return h.warn('videojs.plugin() is deprecated; use videojs.registerPlugin() instead'), Jn.registerPlugin(e, t)
        }),
        (tr.getPlugins = Jn.getPlugins),
        (tr.getPlugin = Jn.getPlugin),
        (tr.getPluginVersion = Jn.getPluginVersion),
        (tr.addLanguage = function (e, t) {
            var i
            return (e = ('' + e).toLowerCase()), (tr.options.languages = lt(tr.options.languages, (((i = {})[e] = t), i))), tr.options.languages[e]
        }),
        (tr.log = h),
        (tr.createLogger = p),
        (tr.createTimeRange = tr.createTimeRanges = vt),
        (tr.formatTime = ln),
        (tr.setFormatTime = function (e) {
            un = e
        }),
        (tr.resetFormatTime = function () {
            un = on
        }),
        (tr.parseUrl = Mt),
        (tr.isCrossOrigin = Ut),
        (tr.EventTarget = ze),
        (tr.on = Be),
        (tr.one = He),
        (tr.off = Fe),
        (tr.trigger = je),
        (tr.xhr = Jt),
        (tr.TextTrack = ri),
        (tr.AudioTrack = x),
        (tr.VideoTrack = U),
        ['isEl', 'isTextNode', 'createEl', 'hasClass', 'addClass', 'removeClass', 'toggleClass', 'setAttributes', 'getAttributes', 'emptyEl', 'appendContent', 'insertContent'].forEach(function (e) {
            tr[e] = function () {
                return h.warn('videojs.' + e + '() is deprecated; use videojs.dom.' + e + '() instead'), we[e].apply(null, arguments)
            }
        }),
        (tr.computedStyle = w),
        (tr.dom = we),
        (tr.url = zt),
        (tr.defineLazyProperty = An),
        tr.addLanguage('en', { 'Non-Fullscreen': 'Exit Fullscreen' })
    function ir(e, t) {
        if (/^[a-z]+:/i.test(t)) return t
        ;/^data:/.test(e) && (e = (window.location && window.location.href) || '')
        var i = 'function' == typeof window.URL,
            n = /^\/\//.test(e),
            r = !window.location && !/\/\//i.test(e)
        if ((i ? (e = new window.URL(e, window.location || rr)) : /\/\//i.test(e) || (e = nr.buildAbsoluteURL((window.location && window.location.href) || '', e)), i)) {
            i = new URL(t, e)
            return r ? i.href.slice(rr.length) : n ? i.href.slice(i.protocol.length) : i.href
        }
        return nr.buildAbsoluteURL(e, t)
    }
    var nr = m(function (e, t) {
            var i, a, n, r, s
            ;(i = /^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/),
                (a = /^([^\/?#]*)([^]*)$/),
                (n = /(?:\/|^)\.(?=\/)/g),
                (r = /(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g),
                (s = {
                    buildAbsoluteURL: function (e, t, i) {
                        if (((i = i || {}), (e = e.trim()), !(t = t.trim()))) {
                            if (!i.alwaysNormalize) return e
                            var n = s.parseURL(e)
                            if (!n) throw new Error('Error trying to parse base URL.')
                            return (n.path = s.normalizePath(n.path)), s.buildURLFromParts(n)
                        }
                        n = s.parseURL(t)
                        if (!n) throw new Error('Error trying to parse relative URL.')
                        if (n.scheme) return i.alwaysNormalize ? ((n.path = s.normalizePath(n.path)), s.buildURLFromParts(n)) : t
                        t = s.parseURL(e)
                        if (!t) throw new Error('Error trying to parse base URL.')
                        !t.netLoc && t.path && '/' !== t.path[0] && ((r = a.exec(t.path)), (t.netLoc = r[1]), (t.path = r[2])), t.netLoc && !t.path && (t.path = '/')
                        var r,
                            e = { scheme: t.scheme, netLoc: n.netLoc, path: null, params: n.params, query: n.query, fragment: n.fragment }
                        return (
                            n.netLoc ||
                                ((e.netLoc = t.netLoc),
                                '/' !== n.path[0] &&
                                    (n.path
                                        ? ((r = (r = t.path).substring(0, r.lastIndexOf('/') + 1) + n.path), (e.path = s.normalizePath(r)))
                                        : ((e.path = t.path), n.params || ((e.params = t.params), n.query || (e.query = t.query))))),
                            null === e.path && (e.path = i.alwaysNormalize ? s.normalizePath(n.path) : n.path),
                            s.buildURLFromParts(e)
                        )
                    },
                    parseURL: function (e) {
                        e = i.exec(e)
                        return e ? { scheme: e[1] || '', netLoc: e[2] || '', path: e[3] || '', params: e[4] || '', query: e[5] || '', fragment: e[6] || '' } : null
                    },
                    normalizePath: function (e) {
                        for (e = e.split('').reverse().join('').replace(n, ''); e.length !== (e = e.replace(r, '')).length; );
                        return e.split('').reverse().join('')
                    },
                    buildURLFromParts: function (e) {
                        return e.scheme + e.netLoc + e.path + e.params + e.query + e.fragment
                    },
                }),
                (e.exports = s)
        }),
        rr = 'http://example.com',
        ar = (function () {
            function e() {
                this.listeners = {}
            }
            var t = e.prototype
            return (
                (t.on = function (e, t) {
                    this.listeners[e] || (this.listeners[e] = []), this.listeners[e].push(t)
                }),
                (t.off = function (e, t) {
                    if (!this.listeners[e]) return !1
                    t = this.listeners[e].indexOf(t)
                    return (this.listeners[e] = this.listeners[e].slice(0)), this.listeners[e].splice(t, 1), -1 < t
                }),
                (t.trigger = function (e) {
                    var t = this.listeners[e]
                    if (t)
                        if (2 === arguments.length) for (var i = t.length, n = 0; n < i; ++n) t[n].call(this, arguments[1])
                        else for (var r = Array.prototype.slice.call(arguments, 1), a = t.length, s = 0; s < a; ++s) t[s].apply(this, r)
                }),
                (t.dispose = function () {
                    this.listeners = {}
                }),
                (t.pipe = function (t) {
                    this.on('data', function (e) {
                        t.push(e)
                    })
                }),
                e
            )
        })(),
        sr = function (e) {
            return window.atob ? window.atob(e) : Buffer.from(e, 'base64').toString('binary')
        }
    function or(e) {
        for (var t = sr(e), i = new Uint8Array(t.length), n = 0; n < t.length; n++) i[n] = t.charCodeAt(n)
        return i
    }
    /*! @name m3u8-parser @version 4.7.1 @license Apache-2.0 */ function ur(e) {
        var t = /([0-9.]*)?@?([0-9.]*)?/.exec(e || ''),
            e = {}
        return t[1] && (e.length = parseInt(t[1], 10)), t[2] && (e.offset = parseInt(t[2], 10)), e
    }
    function lr(e) {
        for (var t, i = e.split(new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))')), n = {}, r = i.length; r--; )
            '' !== i[r] &&
                (((t = /([^=]*)=(.*)/.exec(i[r]).slice(1))[0] = t[0].replace(/^\s+|\s+$/g, '')),
                (t[1] = t[1].replace(/^\s+|\s+$/g, '')),
                (t[1] = t[1].replace(/^['"](.*)['"]$/g, '$1')),
                (n[t[0]] = t[1]))
        return n
    }
    function cr(t) {
        var i = {}
        return (
            Object.keys(t).forEach(function (e) {
                i[
                    e.toLowerCase().replace(/-(\w)/g, function (e) {
                        return e[1].toUpperCase()
                    })
                ] = t[e]
            }),
            i
        )
    }
    function dr(e) {
        var t,
            i,
            n,
            r,
            a = e.serverControl,
            s = e.targetDuration,
            o = e.partTargetDuration
        a &&
            ((t = '#EXT-X-SERVER-CONTROL'),
            (i = 'holdBack'),
            (n = 'partHoldBack'),
            (r = s && 3 * s),
            (e = o && 2 * o),
            s && !a.hasOwnProperty(i) && ((a[i] = r), this.trigger('info', { message: t + ' defaulting HOLD-BACK to targetDuration * 3 (' + r + ').' })),
            r && a[i] < r && (this.trigger('warn', { message: t + ' clamping HOLD-BACK (' + a[i] + ') to targetDuration * 3 (' + r + ')' }), (a[i] = r)),
            o && !a.hasOwnProperty(n) && ((a[n] = 3 * o), this.trigger('info', { message: t + ' defaulting PART-HOLD-BACK to partTargetDuration * 3 (' + a[n] + ').' })),
            o && a[n] < e && (this.trigger('warn', { message: t + ' clamping PART-HOLD-BACK (' + a[n] + ') to partTargetDuration * 2 (' + e + ').' }), (a[n] = e)))
    }
    function hr(e) {
        return (
            e &&
            e.replace(/avc1\.(\d+)\.(\d+)/i, function (e, t, i) {
                return 'avc1.' + ('00' + Number(t).toString(16)).slice(-2) + '00' + ('00' + Number(i).toString(16)).slice(-2)
            })
        )
    }
    function pr(e) {
        var e = (e = void 0 === e ? '' : e).split(','),
            a = []
        return (
            e.forEach(function (n) {
                var r
                ;(n = n.trim()),
                    Ar.forEach(function (e) {
                        var t,
                            i = xr[e].exec(n.toLowerCase())
                        !i || i.length <= 1 || ((r = e), (t = n.substring(0, i[1].length)), (i = n.replace(t, '')), a.push({ type: t, details: i, mediaType: e }))
                    }),
                    r || a.push({ type: n, details: '', mediaType: 'unknown' })
            }),
            a
        )
    }
    function fr(e) {
        return xr.audio.test((e = void 0 === e ? '' : e).trim().toLowerCase())
    }
    function mr(e) {
        if (e && 'string' == typeof e) {
            var t = e
                    .toLowerCase()
                    .split(',')
                    .map(function (e) {
                        return hr(e.trim())
                    }),
                i = 'video'
            1 === t.length && fr(t[0]) ? (i = 'audio') : 1 === t.length && ((n = t[0]), xr.text.test((n = void 0 === n ? '' : n).trim().toLowerCase())) && (i = 'application')
            var n = 'mp4'
            return (
                t.every(function (e) {
                    return xr.mp4.test(e)
                })
                    ? (n = 'mp4')
                    : t.every(function (e) {
                          return xr.webm.test(e)
                      })
                    ? (n = 'webm')
                    : t.every(function (e) {
                          return xr.ogg.test(e)
                      }) && (n = 'ogg'),
                i + '/' + n + ';codecs="' + e + '"'
            )
        }
    }
    function gr(e) {
        return void 0 === e && (e = ''), (window.MediaSource && window.MediaSource.isTypeSupported && window.MediaSource.isTypeSupported(mr(e))) || !1
    }
    function yr(e) {
        return (e = void 0 === e ? '' : e)
            .toLowerCase()
            .split(',')
            .every(function (e) {
                e = e.trim()
                for (var t = 0; t < Pr.length; t++) if (xr['muxer' + Pr[t]].test(e)) return !0
                return !1
            })
    }
    function vr(e) {
        return Dr.test(e) ? 'hls' : Or.test(e) ? 'dash' : 'application/vnd.videojs.vhs+json' === e ? 'vhs-json' : null
    }
    function _r(e) {
        return 'function' === ArrayBuffer.isView ? ArrayBuffer.isView(e) : e && e.buffer instanceof ArrayBuffer
    }
    function br(e) {
        return e instanceof Uint8Array
            ? e
            : (Array.isArray(e) || Mr(e) || e instanceof ArrayBuffer || (e = 'number' != typeof e || ('number' == typeof e && e != e) ? 0 : [e]),
              new Uint8Array((e && e.buffer) || e, (e && e.byteOffset) || 0, (e && e.byteLength) || 0))
    }
    function Tr(e, t) {
        var i = void 0 !== (t = (void 0 === t ? {} : t).le) && t
        e = Rr((e = ('bigint' != typeof e && 'number' != typeof e) || ('number' == typeof e && e != e) ? 0 : e))
        for (var n = ((t = e), Math.ceil(t.toString(2).length / 8)), r = new Uint8Array(new ArrayBuffer(n)), a = 0; a < n; a++) {
            var s = i ? a : Math.abs(a + 1 - r.length)
            ;(r[s] = Number((e / Nr[a]) & Rr(255))), e < 0 && ((r[s] = Math.abs(~r[s])), (r[s] -= 0 === a ? 1 : 2))
        }
        return r
    }
    function Sr(e, t) {
        if ('string' != typeof (e = 'string' != typeof e && e && 'function' == typeof e.toString ? e.toString() : e)) return new Uint8Array()
        t || (e = unescape(encodeURIComponent(e)))
        for (var i = new Uint8Array(e.length), n = 0; n < e.length; n++) i[n] = e.charCodeAt(n)
        return i
    }
    function wr(i, e, t) {
        var n = void 0 === t ? {} : t,
            r = void 0 === (t = n.offset) ? 0 : t,
            a = void 0 === (n = n.mask) ? [] : n
        return (
            (i = br(i)),
            (n = (e = br(e)).every || Array.prototype.every),
            e.length &&
                i.length - r >= e.length &&
                n.call(e, function (e, t) {
                    return e === (a[t] ? a[t] & i[r + t] : i[r + t])
                })
        )
    }
    var Er = (function (t) {
            function e() {
                var e = t.call(this) || this
                return (e.buffer = ''), e
            }
            return (
                mt(e, t),
                (e.prototype.push = function (e) {
                    var t
                    for (this.buffer += e, t = this.buffer.indexOf('\n'); -1 < t; t = this.buffer.indexOf('\n'))
                        this.trigger('data', this.buffer.substring(0, t)), (this.buffer = this.buffer.substring(t + 1))
                }),
                e
            )
        })(ar),
        kr = String.fromCharCode(9),
        Cr = (function (t) {
            function e() {
                var e = t.call(this) || this
                return (e.customParsers = []), (e.tagMappers = []), e
            }
            mt(e, t)
            var i = e.prototype
            return (
                (i.push = function (i) {
                    var r,
                        a,
                        s = this
                    0 !== (i = i.trim()).length &&
                        ('#' === i[0]
                            ? this.tagMappers
                                  .reduce(
                                      function (e, t) {
                                          t = t(i)
                                          return t === i ? e : e.concat([t])
                                      },
                                      [i]
                                  )
                                  .forEach(function (e) {
                                      for (var t, i, n = 0; n < s.customParsers.length; n++) if (s.customParsers[n].call(s, e)) return
                                      if (0 === e.indexOf('#EXT'))
                                          if (((e = e.replace('\r', '')), (r = /^#EXTM3U/.exec(e)))) s.trigger('data', { type: 'tag', tagType: 'm3u' })
                                          else {
                                              if ((r = /^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(e)))
                                                  return (a = { type: 'tag', tagType: 'inf' }), r[1] && (a.duration = parseFloat(r[1])), r[2] && (a.title = r[2]), void s.trigger('data', a)
                                              if ((r = /^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(e)))
                                                  return (a = { type: 'tag', tagType: 'targetduration' }), r[1] && (a.duration = parseInt(r[1], 10)), void s.trigger('data', a)
                                              if ((r = /^#EXT-X-VERSION:?([0-9.]*)?/.exec(e)))
                                                  return (a = { type: 'tag', tagType: 'version' }), r[1] && (a.version = parseInt(r[1], 10)), void s.trigger('data', a)
                                              if ((r = /^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(e)))
                                                  return (a = { type: 'tag', tagType: 'media-sequence' }), r[1] && (a.number = parseInt(r[1], 10)), void s.trigger('data', a)
                                              if ((r = /^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(e)))
                                                  return (a = { type: 'tag', tagType: 'discontinuity-sequence' }), r[1] && (a.number = parseInt(r[1], 10)), void s.trigger('data', a)
                                              if ((r = /^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(e)))
                                                  return (a = { type: 'tag', tagType: 'playlist-type' }), r[1] && (a.playlistType = r[1]), void s.trigger('data', a)
                                              if ((r = /^#EXT-X-BYTERANGE:?(.*)?$/.exec(e))) return (a = g(ur(r[1]), { type: 'tag', tagType: 'byterange' })), void s.trigger('data', a)
                                              if ((r = /^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(e)))
                                                  return (a = { type: 'tag', tagType: 'allow-cache' }), r[1] && (a.allowed = !/NO/.test(r[1])), void s.trigger('data', a)
                                              if ((r = /^#EXT-X-MAP:?(.*)$/.exec(e)))
                                                  return (
                                                      (a = { type: 'tag', tagType: 'map' }),
                                                      r[1] && ((t = lr(r[1])).URI && (a.uri = t.URI), t.BYTERANGE && (a.byterange = ur(t.BYTERANGE))),
                                                      void s.trigger('data', a)
                                                  )
                                              if ((r = /^#EXT-X-STREAM-INF:?(.*)$/.exec(e)))
                                                  return (
                                                      (a = { type: 'tag', tagType: 'stream-inf' }),
                                                      r[1] &&
                                                          ((a.attributes = lr(r[1])),
                                                          a.attributes.RESOLUTION &&
                                                              ((i = {}),
                                                              (t = a.attributes.RESOLUTION.split('x'))[0] && (i.width = parseInt(t[0], 10)),
                                                              t[1] && (i.height = parseInt(t[1], 10)),
                                                              (a.attributes.RESOLUTION = i)),
                                                          a.attributes.BANDWIDTH && (a.attributes.BANDWIDTH = parseInt(a.attributes.BANDWIDTH, 10)),
                                                          a.attributes['PROGRAM-ID'] && (a.attributes['PROGRAM-ID'] = parseInt(a.attributes['PROGRAM-ID'], 10))),
                                                      void s.trigger('data', a)
                                                  )
                                              if ((r = /^#EXT-X-MEDIA:?(.*)$/.exec(e))) return (a = { type: 'tag', tagType: 'media' }), r[1] && (a.attributes = lr(r[1])), void s.trigger('data', a)
                                              if ((r = /^#EXT-X-ENDLIST/.exec(e))) s.trigger('data', { type: 'tag', tagType: 'endlist' })
                                              else {
                                                  if (!(r = /^#EXT-X-DISCONTINUITY/.exec(e)))
                                                      return (r = /^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(e))
                                                          ? ((a = { type: 'tag', tagType: 'program-date-time' }),
                                                            r[1] && ((a.dateTimeString = r[1]), (a.dateTimeObject = new Date(r[1]))),
                                                            void s.trigger('data', a))
                                                          : (r = /^#EXT-X-KEY:?(.*)$/.exec(e))
                                                          ? ((a = { type: 'tag', tagType: 'key' }),
                                                            r[1] &&
                                                                ((a.attributes = lr(r[1])),
                                                                a.attributes.IV &&
                                                                    ('0x' === a.attributes.IV.substring(0, 2).toLowerCase() && (a.attributes.IV = a.attributes.IV.substring(2)),
                                                                    (a.attributes.IV = a.attributes.IV.match(/.{8}/g)),
                                                                    (a.attributes.IV[0] = parseInt(a.attributes.IV[0], 16)),
                                                                    (a.attributes.IV[1] = parseInt(a.attributes.IV[1], 16)),
                                                                    (a.attributes.IV[2] = parseInt(a.attributes.IV[2], 16)),
                                                                    (a.attributes.IV[3] = parseInt(a.attributes.IV[3], 16)),
                                                                    (a.attributes.IV = new Uint32Array(a.attributes.IV)))),
                                                            void s.trigger('data', a))
                                                          : (r = /^#EXT-X-START:?(.*)$/.exec(e))
                                                          ? ((a = { type: 'tag', tagType: 'start' }),
                                                            r[1] &&
                                                                ((a.attributes = lr(r[1])),
                                                                (a.attributes['TIME-OFFSET'] = parseFloat(a.attributes['TIME-OFFSET'])),
                                                                (a.attributes.PRECISE = /YES/.test(a.attributes.PRECISE))),
                                                            void s.trigger('data', a))
                                                          : (r = /^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(e))
                                                          ? ((a = { type: 'tag', tagType: 'cue-out-cont' }), r[1] ? (a.data = r[1]) : (a.data = ''), void s.trigger('data', a))
                                                          : (r = /^#EXT-X-CUE-OUT:?(.*)?$/.exec(e))
                                                          ? ((a = { type: 'tag', tagType: 'cue-out' }), r[1] ? (a.data = r[1]) : (a.data = ''), void s.trigger('data', a))
                                                          : (r = /^#EXT-X-CUE-IN:?(.*)?$/.exec(e))
                                                          ? ((a = { type: 'tag', tagType: 'cue-in' }), r[1] ? (a.data = r[1]) : (a.data = ''), void s.trigger('data', a))
                                                          : (r = /^#EXT-X-SKIP:(.*)$/.exec(e)) && r[1]
                                                          ? (((a = { type: 'tag', tagType: 'skip' }).attributes = lr(r[1])),
                                                            a.attributes.hasOwnProperty('SKIPPED-SEGMENTS') && (a.attributes['SKIPPED-SEGMENTS'] = parseInt(a.attributes['SKIPPED-SEGMENTS'], 10)),
                                                            a.attributes.hasOwnProperty('RECENTLY-REMOVED-DATERANGES') &&
                                                                (a.attributes['RECENTLY-REMOVED-DATERANGES'] = a.attributes['RECENTLY-REMOVED-DATERANGES'].split(kr)),
                                                            void s.trigger('data', a))
                                                          : (r = /^#EXT-X-PART:(.*)$/.exec(e)) && r[1]
                                                          ? (((a = { type: 'tag', tagType: 'part' }).attributes = lr(r[1])),
                                                            ['DURATION'].forEach(function (e) {
                                                                a.attributes.hasOwnProperty(e) && (a.attributes[e] = parseFloat(a.attributes[e]))
                                                            }),
                                                            ['INDEPENDENT', 'GAP'].forEach(function (e) {
                                                                a.attributes.hasOwnProperty(e) && (a.attributes[e] = /YES/.test(a.attributes[e]))
                                                            }),
                                                            a.attributes.hasOwnProperty('BYTERANGE') && (a.attributes.byterange = ur(a.attributes.BYTERANGE)),
                                                            void s.trigger('data', a))
                                                          : (r = /^#EXT-X-SERVER-CONTROL:(.*)$/.exec(e)) && r[1]
                                                          ? (((a = { type: 'tag', tagType: 'server-control' }).attributes = lr(r[1])),
                                                            ['CAN-SKIP-UNTIL', 'PART-HOLD-BACK', 'HOLD-BACK'].forEach(function (e) {
                                                                a.attributes.hasOwnProperty(e) && (a.attributes[e] = parseFloat(a.attributes[e]))
                                                            }),
                                                            ['CAN-SKIP-DATERANGES', 'CAN-BLOCK-RELOAD'].forEach(function (e) {
                                                                a.attributes.hasOwnProperty(e) && (a.attributes[e] = /YES/.test(a.attributes[e]))
                                                            }),
                                                            void s.trigger('data', a))
                                                          : (r = /^#EXT-X-PART-INF:(.*)$/.exec(e)) && r[1]
                                                          ? (((a = { type: 'tag', tagType: 'part-inf' }).attributes = lr(r[1])),
                                                            ['PART-TARGET'].forEach(function (e) {
                                                                a.attributes.hasOwnProperty(e) && (a.attributes[e] = parseFloat(a.attributes[e]))
                                                            }),
                                                            void s.trigger('data', a))
                                                          : (r = /^#EXT-X-PRELOAD-HINT:(.*)$/.exec(e)) && r[1]
                                                          ? (((a = { type: 'tag', tagType: 'preload-hint' }).attributes = lr(r[1])),
                                                            ['BYTERANGE-START', 'BYTERANGE-LENGTH'].forEach(function (e) {
                                                                var t
                                                                a.attributes.hasOwnProperty(e) &&
                                                                    ((a.attributes[e] = parseInt(a.attributes[e], 10)),
                                                                    (t = 'BYTERANGE-LENGTH' === e ? 'length' : 'offset'),
                                                                    (a.attributes.byterange = a.attributes.byterange || {}),
                                                                    (a.attributes.byterange[t] = a.attributes[e]),
                                                                    delete a.attributes[e])
                                                            }),
                                                            void s.trigger('data', a))
                                                          : (r = /^#EXT-X-RENDITION-REPORT:(.*)$/.exec(e)) && r[1]
                                                          ? (((a = { type: 'tag', tagType: 'rendition-report' }).attributes = lr(r[1])),
                                                            ['LAST-MSN', 'LAST-PART'].forEach(function (e) {
                                                                a.attributes.hasOwnProperty(e) && (a.attributes[e] = parseInt(a.attributes[e], 10))
                                                            }),
                                                            void s.trigger('data', a))
                                                          : void s.trigger('data', { type: 'tag', data: e.slice(4) })
                                                  s.trigger('data', { type: 'tag', tagType: 'discontinuity' })
                                              }
                                          }
                                      else s.trigger('data', { type: 'comment', text: e.slice(1) })
                                  })
                            : this.trigger('data', { type: 'uri', uri: i }))
                }),
                (i.addParser = function (e) {
                    var t = this,
                        i = e.expression,
                        n = e.customType,
                        r = e.dataParser,
                        a = e.segment
                    'function' != typeof r &&
                        (r = function (e) {
                            return e
                        }),
                        this.customParsers.push(function (e) {
                            if (i.exec(e)) return t.trigger('data', { type: 'custom', data: r(e), customType: n, segment: a }), !0
                        })
                }),
                (i.addTagMapper = function (e) {
                    var t = e.expression,
                        i = e.map
                    this.tagMappers.push(function (e) {
                        return t.test(e) ? i(e) : e
                    })
                }),
                e
            )
        })(ar),
        Ir = (function (t) {
            function e() {
                var e = t.call(this) || this
                ;(e.lineStream = new Er()), (e.parseStream = new Cr()), e.lineStream.pipe(e.parseStream)
                var n,
                    r,
                    a = ft(e),
                    o = [],
                    u = {},
                    l = !1,
                    c = { AUDIO: {}, VIDEO: {}, 'CLOSED-CAPTIONS': {}, SUBTITLES: {} },
                    d = 0
                e.manifest = { allowCache: !0, discontinuityStarts: [], segments: [] }
                var h = 0,
                    p = 0
                return (
                    e.on('end', function () {
                        u.uri ||
                            (!u.parts && !u.preloadHints) ||
                            (!u.map && n && (u.map = n), !u.key && r && (u.key = r), u.timeline || 'number' != typeof d || (u.timeline = d), (e.manifest.preloadSegment = u))
                    }),
                    e.parseStream.on('data', function (s) {
                        var t, i
                        ;({
                            tag: function () {
                                ;((
                                    {
                                        version: function () {
                                            s.version && (this.manifest.version = s.version)
                                        },
                                        'allow-cache': function () {
                                            ;(this.manifest.allowCache = s.allowed),
                                                'allowed' in s || (this.trigger('info', { message: 'defaulting allowCache to YES' }), (this.manifest.allowCache = !0))
                                        },
                                        byterange: function () {
                                            var e = {}
                                            'length' in s && (((u.byterange = e).length = s.length), 'offset' in s || (s.offset = h)),
                                                'offset' in s && ((u.byterange = e).offset = s.offset),
                                                (h = e.offset + e.length)
                                        },
                                        endlist: function () {
                                            this.manifest.endList = !0
                                        },
                                        inf: function () {
                                            'mediaSequence' in this.manifest || ((this.manifest.mediaSequence = 0), this.trigger('info', { message: 'defaulting media sequence to zero' })),
                                                'discontinuitySequence' in this.manifest ||
                                                    ((this.manifest.discontinuitySequence = 0), this.trigger('info', { message: 'defaulting discontinuity sequence to zero' })),
                                                0 < s.duration && (u.duration = s.duration),
                                                0 === s.duration && ((u.duration = 0.01), this.trigger('info', { message: 'updating zero segment duration to a small value' })),
                                                (this.manifest.segments = o)
                                        },
                                        key: function () {
                                            if (s.attributes)
                                                if ('NONE' !== s.attributes.METHOD)
                                                    if (s.attributes.URI) {
                                                        if ('com.apple.streamingkeydelivery' === s.attributes.KEYFORMAT)
                                                            return (
                                                                (this.manifest.contentProtection = this.manifest.contentProtection || {}),
                                                                void (this.manifest.contentProtection['com.apple.fps.1_0'] = { attributes: s.attributes })
                                                            )
                                                        if ('com.microsoft.playready' === s.attributes.KEYFORMAT)
                                                            return (
                                                                (this.manifest.contentProtection = this.manifest.contentProtection || {}),
                                                                void (this.manifest.contentProtection['com.microsoft.playready'] = { uri: s.attributes.URI })
                                                            )
                                                        if ('urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed' === s.attributes.KEYFORMAT)
                                                            return -1 === ['SAMPLE-AES', 'SAMPLE-AES-CTR', 'SAMPLE-AES-CENC'].indexOf(s.attributes.METHOD)
                                                                ? void this.trigger('warn', { message: 'invalid key method provided for Widevine' })
                                                                : ('SAMPLE-AES-CENC' === s.attributes.METHOD &&
                                                                      this.trigger('warn', { message: 'SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead' }),
                                                                  'data:text/plain;base64,' !== s.attributes.URI.substring(0, 23)
                                                                      ? void this.trigger('warn', { message: 'invalid key URI provided for Widevine' })
                                                                      : s.attributes.KEYID && '0x' === s.attributes.KEYID.substring(0, 2)
                                                                      ? ((this.manifest.contentProtection = this.manifest.contentProtection || {}),
                                                                        void (this.manifest.contentProtection['com.widevine.alpha'] = {
                                                                            attributes: { schemeIdUri: s.attributes.KEYFORMAT, keyId: s.attributes.KEYID.substring(2) },
                                                                            pssh: or(s.attributes.URI.split(',')[1]),
                                                                        }))
                                                                      : void this.trigger('warn', { message: 'invalid key ID provided for Widevine' }))
                                                        s.attributes.METHOD || this.trigger('warn', { message: 'defaulting key method to AES-128' }),
                                                            (r = { method: s.attributes.METHOD || 'AES-128', uri: s.attributes.URI }),
                                                            'undefined' != typeof s.attributes.IV && (r.iv = s.attributes.IV)
                                                    } else this.trigger('warn', { message: 'ignoring key declaration without URI' })
                                                else r = null
                                            else this.trigger('warn', { message: 'ignoring key declaration without attribute list' })
                                        },
                                        'media-sequence': function () {
                                            isFinite(s.number) ? (this.manifest.mediaSequence = s.number) : this.trigger('warn', { message: 'ignoring invalid media sequence: ' + s.number })
                                        },
                                        'discontinuity-sequence': function () {
                                            isFinite(s.number)
                                                ? ((this.manifest.discontinuitySequence = s.number), (d = s.number))
                                                : this.trigger('warn', { message: 'ignoring invalid discontinuity sequence: ' + s.number })
                                        },
                                        'playlist-type': function () {
                                            ;/VOD|EVENT/.test(s.playlistType)
                                                ? (this.manifest.playlistType = s.playlistType)
                                                : this.trigger('warn', { message: 'ignoring unknown playlist type: ' + s.playlist })
                                        },
                                        map: function () {
                                            ;(n = {}), s.uri && (n.uri = s.uri), s.byterange && (n.byterange = s.byterange), r && (n.key = r)
                                        },
                                        'stream-inf': function () {
                                            ;(this.manifest.playlists = o),
                                                (this.manifest.mediaGroups = this.manifest.mediaGroups || c),
                                                s.attributes
                                                    ? (u.attributes || (u.attributes = {}), g(u.attributes, s.attributes))
                                                    : this.trigger('warn', { message: 'ignoring empty stream-inf attributes' })
                                        },
                                        media: function () {
                                            var e
                                            ;(this.manifest.mediaGroups = this.manifest.mediaGroups || c),
                                                s.attributes && s.attributes.TYPE && s.attributes['GROUP-ID'] && s.attributes.NAME
                                                    ? (((e = this.manifest.mediaGroups[s.attributes.TYPE])[s.attributes['GROUP-ID']] = e[s.attributes['GROUP-ID']] || {}),
                                                      (t = e[s.attributes['GROUP-ID']]),
                                                      (i = { default: /yes/i.test(s.attributes.DEFAULT) }).default ? (i.autoselect = !0) : (i.autoselect = /yes/i.test(s.attributes.AUTOSELECT)),
                                                      s.attributes.LANGUAGE && (i.language = s.attributes.LANGUAGE),
                                                      s.attributes.URI && (i.uri = s.attributes.URI),
                                                      s.attributes['INSTREAM-ID'] && (i.instreamId = s.attributes['INSTREAM-ID']),
                                                      s.attributes.CHARACTERISTICS && (i.characteristics = s.attributes.CHARACTERISTICS),
                                                      s.attributes.FORCED && (i.forced = /yes/i.test(s.attributes.FORCED)),
                                                      (t[s.attributes.NAME] = i))
                                                    : this.trigger('warn', { message: 'ignoring incomplete or missing media group' })
                                        },
                                        discontinuity: function () {
                                            ;(d += 1), (u.discontinuity = !0), this.manifest.discontinuityStarts.push(o.length)
                                        },
                                        'program-date-time': function () {
                                            'undefined' == typeof this.manifest.dateTimeString &&
                                                ((this.manifest.dateTimeString = s.dateTimeString), (this.manifest.dateTimeObject = s.dateTimeObject)),
                                                (u.dateTimeString = s.dateTimeString),
                                                (u.dateTimeObject = s.dateTimeObject)
                                        },
                                        targetduration: function () {
                                            !isFinite(s.duration) || s.duration < 0
                                                ? this.trigger('warn', { message: 'ignoring invalid target duration: ' + s.duration })
                                                : ((this.manifest.targetDuration = s.duration), dr.call(this, this.manifest))
                                        },
                                        start: function () {
                                            s.attributes && !isNaN(s.attributes['TIME-OFFSET'])
                                                ? (this.manifest.start = { timeOffset: s.attributes['TIME-OFFSET'], precise: s.attributes.PRECISE })
                                                : this.trigger('warn', { message: 'ignoring start declaration without appropriate attribute list' })
                                        },
                                        'cue-out': function () {
                                            u.cueOut = s.data
                                        },
                                        'cue-out-cont': function () {
                                            u.cueOutCont = s.data
                                        },
                                        'cue-in': function () {
                                            u.cueIn = s.data
                                        },
                                        skip: function () {
                                            ;(this.manifest.skip = cr(s.attributes)), this.warnOnMissingAttributes_('#EXT-X-SKIP', s.attributes, ['SKIPPED-SEGMENTS'])
                                        },
                                        part: function () {
                                            var i = this
                                            l = !0
                                            var e = this.manifest.segments.length,
                                                t = cr(s.attributes)
                                            ;(u.parts = u.parts || []),
                                                u.parts.push(t),
                                                t.byterange && (t.byterange.hasOwnProperty('offset') || (t.byterange.offset = p), (p = t.byterange.offset + t.byterange.length))
                                            var n = u.parts.length - 1
                                            this.warnOnMissingAttributes_('#EXT-X-PART #' + n + ' for segment #' + e, s.attributes, ['URI', 'DURATION']),
                                                this.manifest.renditionReports &&
                                                    this.manifest.renditionReports.forEach(function (e, t) {
                                                        e.hasOwnProperty('lastPart') || i.trigger('warn', { message: '#EXT-X-RENDITION-REPORT #' + t + ' lacks required attribute(s): LAST-PART' })
                                                    })
                                        },
                                        'server-control': function () {
                                            var e = (this.manifest.serverControl = cr(s.attributes))
                                            e.hasOwnProperty('canBlockReload') ||
                                                ((e.canBlockReload = !1), this.trigger('info', { message: '#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false' })),
                                                dr.call(this, this.manifest),
                                                e.canSkipDateranges &&
                                                    !e.hasOwnProperty('canSkipUntil') &&
                                                    this.trigger('warn', { message: '#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set' })
                                        },
                                        'preload-hint': function () {
                                            var e = this.manifest.segments.length,
                                                t = cr(s.attributes),
                                                i = t.type && 'PART' === t.type
                                            ;(u.preloadHints = u.preloadHints || []),
                                                u.preloadHints.push(t),
                                                t.byterange && (t.byterange.hasOwnProperty('offset') || ((t.byterange.offset = i ? p : 0), i && (p = t.byterange.offset + t.byterange.length)))
                                            var n = u.preloadHints.length - 1
                                            if ((this.warnOnMissingAttributes_('#EXT-X-PRELOAD-HINT #' + n + ' for segment #' + e, s.attributes, ['TYPE', 'URI']), t.type))
                                                for (var r = 0; r < u.preloadHints.length - 1; r++) {
                                                    var a = u.preloadHints[r]
                                                    a.type &&
                                                        a.type === t.type &&
                                                        this.trigger('warn', {
                                                            message: '#EXT-X-PRELOAD-HINT #' + n + ' for segment #' + e + ' has the same TYPE ' + t.type + ' as preload hint #' + r,
                                                        })
                                                }
                                        },
                                        'rendition-report': function () {
                                            var e = cr(s.attributes)
                                            ;(this.manifest.renditionReports = this.manifest.renditionReports || []), this.manifest.renditionReports.push(e)
                                            var t = this.manifest.renditionReports.length - 1,
                                                e = ['LAST-MSN', 'URI']
                                            l && e.push('LAST-PART'), this.warnOnMissingAttributes_('#EXT-X-RENDITION-REPORT #' + t, s.attributes, e)
                                        },
                                        'part-inf': function () {
                                            ;(this.manifest.partInf = cr(s.attributes)),
                                                this.warnOnMissingAttributes_('#EXT-X-PART-INF', s.attributes, ['PART-TARGET']),
                                                this.manifest.partInf.partTarget && (this.manifest.partTargetDuration = this.manifest.partInf.partTarget),
                                                dr.call(this, this.manifest)
                                        },
                                    }[s.tagType] || function () {}
                                ).call(a))
                            },
                            uri: function () {
                                ;(u.uri = s.uri),
                                    o.push(u),
                                    !this.manifest.targetDuration ||
                                        'duration' in u ||
                                        (this.trigger('warn', { message: 'defaulting segment duration to the target duration' }), (u.duration = this.manifest.targetDuration)),
                                    r && (u.key = r),
                                    (u.timeline = d),
                                    n && (u.map = n),
                                    (p = 0),
                                    (u = {})
                            },
                            comment: function () {},
                            custom: function () {
                                s.segment
                                    ? ((u.custom = u.custom || {}), (u.custom[s.customType] = s.data))
                                    : ((this.manifest.custom = this.manifest.custom || {}), (this.manifest.custom[s.customType] = s.data))
                            },
                        }[s.type].call(a))
                    }),
                    e
                )
            }
            mt(e, t)
            var i = e.prototype
            return (
                (i.warnOnMissingAttributes_ = function (e, t, i) {
                    var n = []
                    i.forEach(function (e) {
                        t.hasOwnProperty(e) || n.push(e)
                    }),
                        n.length && this.trigger('warn', { message: e + ' lacks required attribute(s): ' + n.join(', ') })
                }),
                (i.push = function (e) {
                    this.lineStream.push(e)
                }),
                (i.end = function () {
                    this.lineStream.push('\n'), this.trigger('end')
                }),
                (i.addParser = function (e) {
                    this.parseStream.addParser(e)
                }),
                (i.addTagMapper = function (e) {
                    this.parseStream.addTagMapper(e)
                }),
                e
            )
        })(ar),
        xr = {
            mp4: /^(av0?1|avc0?[1234]|vp0?9|flac|opus|mp3|mp4a|mp4v|stpp.ttml.im1t)/,
            webm: /^(vp0?[89]|av0?1|opus|vorbis)/,
            ogg: /^(vp0?[89]|theora|flac|opus|vorbis)/,
            video: /^(av0?1|avc0?[1234]|vp0?[89]|hvc1|hev1|theora|mp4v)/,
            audio: /^(mp4a|flac|vorbis|opus|ac-[34]|ec-3|alac|mp3|speex|aac)/,
            text: /^(stpp.ttml.im1t)/,
            muxerVideo: /^(avc0?1)/,
            muxerAudio: /^(mp4a)/,
            muxerText: /a^/,
        },
        Ar = ['video', 'audio', 'text'],
        Pr = ['Video', 'Audio', 'Text'],
        Lr = 'mp4a.40.2',
        Dr = /^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i,
        Or = /^application\/dash\+xml/i,
        Mr = _r,
        Rr = window.BigInt || Number,
        Nr = [Rr('0x1'), Rr('0x100'), Rr('0x10000'), Rr('0x1000000'), Rr('0x100000000'), Rr('0x10000000000'), Rr('0x1000000000000'), Rr('0x100000000000000'), Rr('0x10000000000000000')]
    function Ur(e, t) {
        return (t = void 0 === t ? Object : t) && 'function' == typeof t.freeze ? t.freeze(e) : e
    }
    var Br = Ur({
            HTML: 'text/html',
            isHTML: function (e) {
                return e === Br.HTML
            },
            XML_APPLICATION: 'application/xml',
            XML_TEXT: 'text/xml',
            XML_XHTML_APPLICATION: 'application/xhtml+xml',
            XML_SVG_IMAGE: 'image/svg+xml',
        }),
        Fr = Ur({
            HTML: 'http://www.w3.org/1999/xhtml',
            isHTML: function (e) {
                return e === Fr.HTML
            },
            SVG: 'http://www.w3.org/2000/svg',
            XML: 'http://www.w3.org/XML/1998/namespace',
            XMLNS: 'http://www.w3.org/2000/xmlns/',
        }),
        jr = { freeze: Ur, MIME_TYPE: Br, NAMESPACE: Fr },
        Hr = jr.NAMESPACE
    function qr(e) {
        return '' !== e
    }
    function Vr(e, t) {
        return e.hasOwnProperty(t) || (e[t] = !0), e
    }
    function Wr(e) {
        if (!e) return []
        e = (e = e) ? e.split(/[\t\n\f\r ]+/).filter(qr) : []
        return Object.keys(e.reduce(Vr, {}))
    }
    function Gr(e, t) {
        for (var i in e) t[i] = e[i]
    }
    function zr(e, t) {
        var i,
            n = e.prototype
        n instanceof t || (((i = function () {}).prototype = t.prototype), Gr(n, (i = new i())), (e.prototype = n = i)), n.constructor != e && (n.constructor = e)
    }
    var W = {},
        Xr = (W.ELEMENT_NODE = 1),
        Kr = (W.ATTRIBUTE_NODE = 2),
        Yr = (W.TEXT_NODE = 3),
        Qr = (W.CDATA_SECTION_NODE = 4),
        $r = (W.ENTITY_REFERENCE_NODE = 5),
        Jr = ((W.ENTITY_NODE = 6), (W.PROCESSING_INSTRUCTION_NODE = 7)),
        Zr = (W.COMMENT_NODE = 8),
        ea = (W.DOCUMENT_NODE = 9),
        ta = (W.DOCUMENT_TYPE_NODE = 10),
        ia = (W.DOCUMENT_FRAGMENT_NODE = 11),
        x = ((W.NOTATION_NODE = 12), {}),
        na = {}
    ;(x.INDEX_SIZE_ERR = ((na[1] = 'Index size error'), 1)), (x.DOMSTRING_SIZE_ERR = ((na[2] = 'DOMString size error'), 2))
    x.HIERARCHY_REQUEST_ERR = ((na[3] = 'Hierarchy request error'), 3)
    ;(x.WRONG_DOCUMENT_ERR = ((na[4] = 'Wrong document'), 4)),
        (x.INVALID_CHARACTER_ERR = ((na[5] = 'Invalid character'), 5)),
        (x.NO_DATA_ALLOWED_ERR = ((na[6] = 'No data allowed'), 6)),
        (x.NO_MODIFICATION_ALLOWED_ERR = ((na[7] = 'No modification allowed'), 7))
    x.NOT_FOUND_ERR = ((na[8] = 'Not found'), 8)
    x.NOT_SUPPORTED_ERR = ((na[9] = 'Not supported'), 9)
    var ra
    x.INUSE_ATTRIBUTE_ERR = ((na[10] = 'Attribute in use'), 10)
    function aa(e, t) {
        var i
        return (
            t instanceof Error ? (i = t) : ((i = this), Error.call(this, na[e]), (this.message = na[e]), Error.captureStackTrace && Error.captureStackTrace(this, aa)),
            (i.code = e),
            t && (this.message = this.message + ': ' + t),
            i
        )
    }
    function sa() {}
    function oa(e, t) {
        ;(this._node = e), (this._refresh = t), ua(this)
    }
    function ua(e) {
        var t,
            i = e._node._inc || e._node.ownerDocument._inc
        e._inc != i && ((t = e._refresh(e._node)), Fa(e, 'length', t.length), Gr(t, e), (e._inc = i))
    }
    function la() {}
    function ca(e, t) {
        for (var i = e.length; i--; ) if (e[i] === t) return i
    }
    function da(e, t, i, n) {
        n ? (t[ca(t, n)] = i) : (t[t.length++] = i),
            !e ||
                ((t = (i.ownerElement = e).ownerDocument) &&
                    (n && va(t, e, n), (e = e), (i = i), (t = t) && t._inc++, i.namespaceURI === Hr.XMLNS && (e._nsMap[i.prefix ? i.localName : ''] = i.value)))
    }
    function ha(e, t, i) {
        var n = ca(t, i)
        if (!(0 <= n)) throw aa(8, new Error(e.tagName + '@' + i))
        for (var r, a = t.length - 1; n < a; ) t[n] = t[++n]
        ;(t.length = a), !e || ((r = e.ownerDocument) && (va(r, e, i), (i.ownerElement = null)))
    }
    function pa() {}
    function fa() {}
    function ma(e) {
        return ('<' == e ? '&lt;' : '>' == e && '&gt;') || ('&' == e && '&amp;') || ('"' == e && '&quot;') || '&#' + e.charCodeAt() + ';'
    }
    function ga(e, t) {
        if (t(e)) return 1
        if ((e = e.firstChild))
            do {
                if (ga(e, t)) return 1
            } while ((e = e.nextSibling))
    }
    function ya() {}
    function va(e, t, i) {
        e && e._inc++, i.namespaceURI === Hr.XMLNS && delete t._nsMap[i.prefix ? i.localName : '']
    }
    function _a(e, t, i) {
        if (e && e._inc) {
            e._inc++
            var n = t.childNodes
            if (i) n[n.length++] = i
            else {
                for (var r = t.firstChild, a = 0; r; ) r = (n[a++] = r).nextSibling
                n.length = a
            }
        }
    }
    function ba(e, t) {
        var i = t.previousSibling,
            n = t.nextSibling
        return i ? (i.nextSibling = n) : (e.firstChild = n), n ? (n.previousSibling = i) : (e.lastChild = i), _a(e.ownerDocument, e), t
    }
    function Ta(e, t, i) {
        var n = t.parentNode
        if ((n && n.removeChild(t), t.nodeType === ia)) {
            var r = t.firstChild
            if (null == r) return t
            var a = t.lastChild
        } else r = a = t
        n = i ? i.previousSibling : e.lastChild
        for (
            r.previousSibling = n, a.nextSibling = i, n ? (n.nextSibling = r) : (e.firstChild = r), null == i ? (e.lastChild = a) : (i.previousSibling = a);
            (r.parentNode = e), r !== a && (r = r.nextSibling);

        );
        return _a(e.ownerDocument || e, e), t.nodeType == ia && (t.firstChild = t.lastChild = null), t
    }
    function Sa() {
        this._nsMap = {}
    }
    function wa() {}
    function Ea() {}
    function ka() {}
    function Ca() {}
    function Ia() {}
    function xa() {}
    function Aa() {}
    function Pa() {}
    function La() {}
    function Da() {}
    function Oa() {}
    function Ma() {}
    function Ra(e, t) {
        var i,
            n = [],
            r = (9 == this.nodeType && this.documentElement) || this,
            a = r.prefix,
            s = r.namespaceURI
        return Ba(this, n, e, t, (i = s && null == a && null == (a = r.lookupPrefix(s)) ? [{ namespace: s, prefix: null }] : i)), n.join('')
    }
    function Na(e, t, i) {
        var n = e.prefix || '',
            r = e.namespaceURI
        if (r && ('xml' !== n || r !== Hr.XML) && r !== Hr.XMLNS) {
            for (var a = i.length; a--; ) {
                var s = i[a]
                if (s.prefix === n) return s.namespace !== r
            }
            return 1
        }
    }
    function Ua(e, t, i) {
        e.push(' ', t, '="', i.replace(/[<&"]/g, ma), '"')
    }
    function Ba(e, t, i, n, r) {
        if (((r = r || []), n)) {
            if (!(e = n(e))) return
            if ('string' == typeof e) return void t.push(e)
        }
        switch (e.nodeType) {
            case Xr:
                var a = e.attributes,
                    s = a.length,
                    o = e.firstChild,
                    u = e.tagName,
                    l = u
                if (!(i = Hr.isHTML(e.namespaceURI) || i) && !e.prefix && e.namespaceURI) {
                    for (var c, d = 0; d < a.length; d++)
                        if ('xmlns' === a.item(d).name) {
                            c = a.item(d).value
                            break
                        }
                    if (!c)
                        for (var h = r.length - 1; 0 <= h; h--)
                            if ('' === (p = r[h]).prefix && p.namespace === e.namespaceURI) {
                                c = p.namespace
                                break
                            }
                    if (c !== e.namespaceURI)
                        for (var p, h = r.length - 1; 0 <= h; h--)
                            if ((p = r[h]).namespace === e.namespaceURI) {
                                p.prefix && (l = p.prefix + ':' + u)
                                break
                            }
                }
                t.push('<', l)
                for (var f = 0; f < s; f++)
                    'xmlns' == (m = a.item(f)).prefix ? r.push({ prefix: m.localName, namespace: m.value }) : 'xmlns' == m.nodeName && r.push({ prefix: '', namespace: m.value })
                for (var m, g, y, f = 0; f < s; f++)
                    Na((m = a.item(f)), 0, r) && (Ua(t, (g = m.prefix || '') ? 'xmlns:' + g : 'xmlns', (y = m.namespaceURI)), r.push({ prefix: g, namespace: y })), Ba(m, t, i, n, r)
                if (
                    (u === l && Na(e, 0, r) && (Ua(t, (g = e.prefix || '') ? 'xmlns:' + g : 'xmlns', (y = e.namespaceURI)), r.push({ prefix: g, namespace: y })),
                    o || (i && !/^(?:meta|link|img|br|hr|input)$/i.test(u)))
                ) {
                    if ((t.push('>'), i && /^script$/i.test(u))) for (; o; ) o.data ? t.push(o.data) : Ba(o, t, i, n, r.slice()), (o = o.nextSibling)
                    else for (; o; ) Ba(o, t, i, n, r.slice()), (o = o.nextSibling)
                    t.push('</', l, '>')
                } else t.push('/>')
                return
            case ea:
            case ia:
                for (o = e.firstChild; o; ) Ba(o, t, i, n, r.slice()), (o = o.nextSibling)
                return
            case Kr:
                return Ua(t, e.name, e.value), 0
            case Yr:
                return t.push(e.data.replace(/[<&]/g, ma).replace(/]]>/g, ']]&gt;'))
            case Qr:
                return t.push('<![CDATA[', e.data, ']]>')
            case Zr:
                return t.push('\x3c!--', e.data, '--\x3e')
            case ta:
                var v = e.publicId,
                    _ = e.systemId
                return (
                    t.push('<!DOCTYPE ', e.name),
                    void (v
                        ? (t.push(' PUBLIC ', v), _ && '.' != _ && t.push(' ', _), t.push('>'))
                        : _ && '.' != _
                        ? t.push(' SYSTEM ', _, '>')
                        : ((_ = e.internalSubset) && t.push(' [', _, ']'), t.push('>')))
                )
            case Jr:
                return t.push('<?', e.target, ' ', e.data, '?>')
            case $r:
                return t.push('&', e.nodeName, ';')
            default:
                t.push('??', e.nodeName)
        }
    }
    function Fa(e, t, i) {
        e[t] = i
    }
    ;(x.INVALID_STATE_ERR = ((na[11] = 'Invalid state'), 11)),
        (x.SYNTAX_ERR = ((na[12] = 'Syntax error'), 12)),
        (x.INVALID_MODIFICATION_ERR = ((na[13] = 'Invalid modification'), 13)),
        (x.NAMESPACE_ERR = ((na[14] = 'Invalid namespace'), 14)),
        (x.INVALID_ACCESS_ERR = ((na[15] = 'Invalid access'), 15)),
        (aa.prototype = Error.prototype),
        Gr(x, aa),
        (sa.prototype = {
            length: 0,
            item: function (e) {
                return this[e] || null
            },
            toString: function (e, t) {
                for (var i = [], n = 0; n < this.length; n++) Ba(this[n], i, e, t)
                return i.join('')
            },
        }),
        (oa.prototype.item = function (e) {
            return ua(this), this[e]
        }),
        zr(oa, sa),
        (la.prototype = {
            length: 0,
            item: sa.prototype.item,
            getNamedItem: function (e) {
                for (var t = this.length; t--; ) {
                    var i = this[t]
                    if (i.nodeName == e) return i
                }
            },
            setNamedItem: function (e) {
                var t = e.ownerElement
                if (t && t != this._ownerElement) throw new aa(10)
                t = this.getNamedItem(e.nodeName)
                return da(this._ownerElement, this, e, t), t
            },
            setNamedItemNS: function (e) {
                var t = e.ownerElement
                if (t && t != this._ownerElement) throw new aa(10)
                return (t = this.getNamedItemNS(e.namespaceURI, e.localName)), da(this._ownerElement, this, e, t), t
            },
            removeNamedItem: function (e) {
                e = this.getNamedItem(e)
                return ha(this._ownerElement, this, e), e
            },
            removeNamedItemNS: function (e, t) {
                t = this.getNamedItemNS(e, t)
                return ha(this._ownerElement, this, t), t
            },
            getNamedItemNS: function (e, t) {
                for (var i = this.length; i--; ) {
                    var n = this[i]
                    if (n.localName == t && n.namespaceURI == e) return n
                }
                return null
            },
        }),
        (pa.prototype = {
            hasFeature: function (e, t) {
                return !0
            },
            createDocument: function (e, t, i) {
                var n = new ya()
                return (n.implementation = this), (n.childNodes = new sa()), (n.doctype = i || null), i && n.appendChild(i), t && ((t = n.createElementNS(e, t)), n.appendChild(t)), n
            },
            createDocumentType: function (e, t, i) {
                var n = new xa()
                return (n.name = e), (n.nodeName = e), (n.publicId = t || ''), (n.systemId = i || ''), n
            },
        }),
        (fa.prototype = {
            firstChild: null,
            lastChild: null,
            previousSibling: null,
            nextSibling: null,
            attributes: null,
            parentNode: null,
            childNodes: null,
            ownerDocument: null,
            nodeValue: null,
            namespaceURI: null,
            prefix: null,
            localName: null,
            insertBefore: function (e, t) {
                return Ta(this, e, t)
            },
            replaceChild: function (e, t) {
                this.insertBefore(e, t), t && this.removeChild(t)
            },
            removeChild: function (e) {
                return ba(this, e)
            },
            appendChild: function (e) {
                return this.insertBefore(e, null)
            },
            hasChildNodes: function () {
                return null != this.firstChild
            },
            cloneNode: function (e) {
                return (function e(t, i, n) {
                    var r = new i.constructor()
                    for (var a in i) {
                        var s = i[a]
                        'object' != typeof s && s != r[a] && (r[a] = s)
                    }
                    i.childNodes && (r.childNodes = new sa())
                    r.ownerDocument = t
                    switch (r.nodeType) {
                        case Xr:
                            var o = i.attributes,
                                u = (r.attributes = new la()),
                                l = o.length
                            u._ownerElement = r
                            for (var c = 0; c < l; c++) r.setAttributeNode(e(t, o.item(c), !0))
                            break
                        case Kr:
                            n = !0
                    }
                    if (n) for (var d = i.firstChild; d; ) r.appendChild(e(t, d, n)), (d = d.nextSibling)
                    return r
                })(this.ownerDocument || this, this, e)
            },
            normalize: function () {
                for (var e = this.firstChild; e; ) {
                    var t = e.nextSibling
                    t && t.nodeType == Yr && e.nodeType == Yr ? (this.removeChild(t), e.appendData(t.data)) : (e.normalize(), (e = t))
                }
            },
            isSupported: function (e, t) {
                return this.ownerDocument.implementation.hasFeature(e, t)
            },
            hasAttributes: function () {
                return 0 < this.attributes.length
            },
            lookupPrefix: function (e) {
                for (var t = this; t; ) {
                    var i = t._nsMap
                    if (i) for (var n in i) if (i[n] == e) return n
                    t = t.nodeType == Kr ? t.ownerDocument : t.parentNode
                }
                return null
            },
            lookupNamespaceURI: function (e) {
                for (var t = this; t; ) {
                    var i = t._nsMap
                    if (i && e in i) return i[e]
                    t = t.nodeType == Kr ? t.ownerDocument : t.parentNode
                }
                return null
            },
            isDefaultNamespace: function (e) {
                return null == this.lookupPrefix(e)
            },
        }),
        Gr(W, fa),
        Gr(W, fa.prototype),
        (ya.prototype = {
            nodeName: '#document',
            nodeType: ea,
            doctype: null,
            documentElement: null,
            _inc: 1,
            insertBefore: function (e, t) {
                if (e.nodeType != ia) return null == this.documentElement && e.nodeType == Xr && (this.documentElement = e), Ta(this, e, t), (e.ownerDocument = this), e
                for (var i = e.firstChild; i; ) {
                    var n = i.nextSibling
                    this.insertBefore(i, t), (i = n)
                }
                return e
            },
            removeChild: function (e) {
                return this.documentElement == e && (this.documentElement = null), ba(this, e)
            },
            importNode: function (e, t) {
                return (function e(t, i, n) {
                    var r
                    switch (i.nodeType) {
                        case Xr:
                            ;(r = i.cloneNode(!1)).ownerDocument = t
                        case ia:
                            break
                        case Kr:
                            n = !0
                    }
                    r = r || i.cloneNode(!1)
                    r.ownerDocument = t
                    r.parentNode = null
                    if (n) for (var a = i.firstChild; a; ) r.appendChild(e(t, a, n)), (a = a.nextSibling)
                    return r
                })(this, e, t)
            },
            getElementById: function (t) {
                var i = null
                return (
                    ga(this.documentElement, function (e) {
                        if (e.nodeType == Xr && e.getAttribute('id') == t) return (i = e), !0
                    }),
                    i
                )
            },
            getElementsByClassName: function (s) {
                var o = Wr(s)
                return new oa(this, function (r) {
                    var a = []
                    return (
                        0 < o.length &&
                            ga(r.documentElement, function (e) {
                                var t, i, n
                                e === r ||
                                    e.nodeType !== Xr ||
                                    ((t = e.getAttribute('class')) &&
                                        ((i = s === t) ||
                                            ((t = Wr(t)),
                                            (i = o.every(
                                                ((n = t),
                                                function (e) {
                                                    return n && -1 !== n.indexOf(e)
                                                })
                                            ))),
                                        i && a.push(e)))
                            }),
                        a
                    )
                })
            },
            createElement: function (e) {
                var t = new Sa()
                return (t.ownerDocument = this), (t.nodeName = e), (t.tagName = e), (t.localName = e), (t.childNodes = new sa()), ((t.attributes = new la())._ownerElement = t)
            },
            createDocumentFragment: function () {
                var e = new Da()
                return (e.ownerDocument = this), (e.childNodes = new sa()), e
            },
            createTextNode: function (e) {
                var t = new ka()
                return (t.ownerDocument = this), t.appendData(e), t
            },
            createComment: function (e) {
                var t = new Ca()
                return (t.ownerDocument = this), t.appendData(e), t
            },
            createCDATASection: function (e) {
                var t = new Ia()
                return (t.ownerDocument = this), t.appendData(e), t
            },
            createProcessingInstruction: function (e, t) {
                var i = new Oa()
                return (i.ownerDocument = this), (i.tagName = i.target = e), (i.nodeValue = i.data = t), i
            },
            createAttribute: function (e) {
                var t = new wa()
                return (t.ownerDocument = this), (t.name = e), (t.nodeName = e), (t.localName = e), (t.specified = !0), t
            },
            createEntityReference: function (e) {
                var t = new La()
                return (t.ownerDocument = this), (t.nodeName = e), t
            },
            createElementNS: function (e, t) {
                var i = new Sa(),
                    n = t.split(':'),
                    r = (i.attributes = new la())
                return (
                    (i.childNodes = new sa()),
                    (i.ownerDocument = this),
                    (i.nodeName = t),
                    (i.tagName = t),
                    (i.namespaceURI = e),
                    2 == n.length ? ((i.prefix = n[0]), (i.localName = n[1])) : (i.localName = t),
                    (r._ownerElement = i)
                )
            },
            createAttributeNS: function (e, t) {
                var i = new wa(),
                    n = t.split(':')
                return (
                    (i.ownerDocument = this), (i.nodeName = t), (i.name = t), (i.namespaceURI = e), (i.specified = !0), 2 == n.length ? ((i.prefix = n[0]), (i.localName = n[1])) : (i.localName = t), i
                )
            },
        }),
        zr(ya, fa),
        (ya.prototype.getElementsByTagName = (Sa.prototype = {
            nodeType: Xr,
            hasAttribute: function (e) {
                return null != this.getAttributeNode(e)
            },
            getAttribute: function (e) {
                e = this.getAttributeNode(e)
                return (e && e.value) || ''
            },
            getAttributeNode: function (e) {
                return this.attributes.getNamedItem(e)
            },
            setAttribute: function (e, t) {
                e = this.ownerDocument.createAttribute(e)
                ;(e.value = e.nodeValue = '' + t), this.setAttributeNode(e)
            },
            removeAttribute: function (e) {
                e = this.getAttributeNode(e)
                e && this.removeAttributeNode(e)
            },
            appendChild: function (e) {
                return e.nodeType === ia
                    ? this.insertBefore(e, null)
                    : (function (e, t) {
                          var i = t.parentNode
                          i && ((n = e.lastChild), i.removeChild(t), (n = e.lastChild))
                          var n = e.lastChild
                          return (t.parentNode = e), (t.previousSibling = n), (t.nextSibling = null), n ? (n.nextSibling = t) : (e.firstChild = t), (e.lastChild = t), _a(e.ownerDocument, e, t), t
                      })(this, e)
            },
            setAttributeNode: function (e) {
                return this.attributes.setNamedItem(e)
            },
            setAttributeNodeNS: function (e) {
                return this.attributes.setNamedItemNS(e)
            },
            removeAttributeNode: function (e) {
                return this.attributes.removeNamedItem(e.nodeName)
            },
            removeAttributeNS: function (e, t) {
                t = this.getAttributeNodeNS(e, t)
                t && this.removeAttributeNode(t)
            },
            hasAttributeNS: function (e, t) {
                return null != this.getAttributeNodeNS(e, t)
            },
            getAttributeNS: function (e, t) {
                t = this.getAttributeNodeNS(e, t)
                return (t && t.value) || ''
            },
            setAttributeNS: function (e, t, i) {
                t = this.ownerDocument.createAttributeNS(e, t)
                ;(t.value = t.nodeValue = '' + i), this.setAttributeNode(t)
            },
            getAttributeNodeNS: function (e, t) {
                return this.attributes.getNamedItemNS(e, t)
            },
            getElementsByTagName: function (n) {
                return new oa(this, function (t) {
                    var i = []
                    return (
                        ga(t, function (e) {
                            e === t || e.nodeType != Xr || ('*' !== n && e.tagName != n) || i.push(e)
                        }),
                        i
                    )
                })
            },
            getElementsByTagNameNS: function (n, r) {
                return new oa(this, function (t) {
                    var i = []
                    return (
                        ga(t, function (e) {
                            e === t || e.nodeType !== Xr || ('*' !== n && e.namespaceURI !== n) || ('*' !== r && e.localName != r) || i.push(e)
                        }),
                        i
                    )
                })
            },
        }).getElementsByTagName),
        (ya.prototype.getElementsByTagNameNS = Sa.prototype.getElementsByTagNameNS),
        zr(Sa, fa),
        (wa.prototype.nodeType = Kr),
        zr(wa, fa),
        (Ea.prototype = {
            data: '',
            substringData: function (e, t) {
                return this.data.substring(e, e + t)
            },
            appendData: function (e) {
                ;(e = this.data + e), (this.nodeValue = this.data = e), (this.length = e.length)
            },
            insertData: function (e, t) {
                this.replaceData(e, 0, t)
            },
            appendChild: function (e) {
                throw new Error(na[3])
            },
            deleteData: function (e, t) {
                this.replaceData(e, t, '')
            },
            replaceData: function (e, t, i) {
                var n = this.data.substring(0, e),
                    t = this.data.substring(e + t)
                ;(this.nodeValue = this.data = i = n + i + t), (this.length = i.length)
            },
        }),
        zr(Ea, fa),
        (ka.prototype = {
            nodeName: '#text',
            nodeType: Yr,
            splitText: function (e) {
                var t = (i = this.data).substring(e),
                    i = i.substring(0, e)
                ;(this.data = this.nodeValue = i), (this.length = i.length)
                t = this.ownerDocument.createTextNode(t)
                return this.parentNode && this.parentNode.insertBefore(t, this.nextSibling), t
            },
        }),
        zr(ka, Ea),
        (Ca.prototype = { nodeName: '#comment', nodeType: Zr }),
        zr(Ca, Ea),
        (Ia.prototype = { nodeName: '#cdata-section', nodeType: Qr }),
        zr(Ia, Ea),
        (xa.prototype.nodeType = ta),
        zr(xa, fa),
        (Aa.prototype.nodeType = 12),
        zr(Aa, fa),
        (Pa.prototype.nodeType = 6),
        zr(Pa, fa),
        (La.prototype.nodeType = $r),
        zr(La, fa),
        (Da.prototype.nodeName = '#document-fragment'),
        (Da.prototype.nodeType = ia),
        zr(Da, fa),
        (Oa.prototype.nodeType = Jr),
        zr(Oa, fa),
        (Ma.prototype.serializeToString = function (e, t, i) {
            return Ra.call(e, t, i)
        }),
        (fa.prototype.toString = Ra)
    try {
        Object.defineProperty &&
            ((ra = function e(t) {
                switch (t.nodeType) {
                    case Xr:
                    case ia:
                        var i = []
                        for (t = t.firstChild; t; ) 7 !== t.nodeType && 8 !== t.nodeType && i.push(e(t)), (t = t.nextSibling)
                        return i.join('')
                    default:
                        return t.nodeValue
                }
            }),
            Object.defineProperty(oa.prototype, 'length', {
                get: function () {
                    return ua(this), this.$$length
                },
            }),
            Object.defineProperty(fa.prototype, 'textContent', {
                get: function () {
                    return ra(this)
                },
                set: function (e) {
                    switch (this.nodeType) {
                        case Xr:
                        case ia:
                            for (; this.firstChild; ) this.removeChild(this.firstChild)
                            ;(e || String(e)) && this.appendChild(this.ownerDocument.createTextNode(e))
                            break
                        default:
                            ;(this.data = e), (this.value = e), (this.nodeValue = e)
                    }
                },
            }),
            (Fa = function (e, t, i) {
                e['$$' + t] = i
            }))
    } catch (e) {}
    var U = { DocumentType: xa, DOMException: aa, DOMImplementation: pa, Element: Sa, Node: fa, NodeList: sa, XMLSerializer: Ma },
        ja = m(function (e, t) {
            var i = jr.freeze
            ;(t.XML_ENTITIES = i({ amp: '&', apos: "'", gt: '>', lt: '<', quot: '"' })),
                (t.HTML_ENTITIES = i({
                    lt: '<',
                    gt: '>',
                    amp: '&',
                    quot: '"',
                    apos: "'",
                    Agrave: 'À',
                    Aacute: 'Á',
                    Acirc: 'Â',
                    Atilde: 'Ã',
                    Auml: 'Ä',
                    Aring: 'Å',
                    AElig: 'Æ',
                    Ccedil: 'Ç',
                    Egrave: 'È',
                    Eacute: 'É',
                    Ecirc: 'Ê',
                    Euml: 'Ë',
                    Igrave: 'Ì',
                    Iacute: 'Í',
                    Icirc: 'Î',
                    Iuml: 'Ï',
                    ETH: 'Ð',
                    Ntilde: 'Ñ',
                    Ograve: 'Ò',
                    Oacute: 'Ó',
                    Ocirc: 'Ô',
                    Otilde: 'Õ',
                    Ouml: 'Ö',
                    Oslash: 'Ø',
                    Ugrave: 'Ù',
                    Uacute: 'Ú',
                    Ucirc: 'Û',
                    Uuml: 'Ü',
                    Yacute: 'Ý',
                    THORN: 'Þ',
                    szlig: 'ß',
                    agrave: 'à',
                    aacute: 'á',
                    acirc: 'â',
                    atilde: 'ã',
                    auml: 'ä',
                    aring: 'å',
                    aelig: 'æ',
                    ccedil: 'ç',
                    egrave: 'è',
                    eacute: 'é',
                    ecirc: 'ê',
                    euml: 'ë',
                    igrave: 'ì',
                    iacute: 'í',
                    icirc: 'î',
                    iuml: 'ï',
                    eth: 'ð',
                    ntilde: 'ñ',
                    ograve: 'ò',
                    oacute: 'ó',
                    ocirc: 'ô',
                    otilde: 'õ',
                    ouml: 'ö',
                    oslash: 'ø',
                    ugrave: 'ù',
                    uacute: 'ú',
                    ucirc: 'û',
                    uuml: 'ü',
                    yacute: 'ý',
                    thorn: 'þ',
                    yuml: 'ÿ',
                    nbsp: ' ',
                    iexcl: '¡',
                    cent: '¢',
                    pound: '£',
                    curren: '¤',
                    yen: '¥',
                    brvbar: '¦',
                    sect: '§',
                    uml: '¨',
                    copy: '©',
                    ordf: 'ª',
                    laquo: '«',
                    not: '¬',
                    shy: '­­',
                    reg: '®',
                    macr: '¯',
                    deg: '°',
                    plusmn: '±',
                    sup2: '²',
                    sup3: '³',
                    acute: '´',
                    micro: 'µ',
                    para: '¶',
                    middot: '·',
                    cedil: '¸',
                    sup1: '¹',
                    ordm: 'º',
                    raquo: '»',
                    frac14: '¼',
                    frac12: '½',
                    frac34: '¾',
                    iquest: '¿',
                    times: '×',
                    divide: '÷',
                    forall: '∀',
                    part: '∂',
                    exist: '∃',
                    empty: '∅',
                    nabla: '∇',
                    isin: '∈',
                    notin: '∉',
                    ni: '∋',
                    prod: '∏',
                    sum: '∑',
                    minus: '−',
                    lowast: '∗',
                    radic: '√',
                    prop: '∝',
                    infin: '∞',
                    ang: '∠',
                    and: '∧',
                    or: '∨',
                    cap: '∩',
                    cup: '∪',
                    int: '∫',
                    there4: '∴',
                    sim: '∼',
                    cong: '≅',
                    asymp: '≈',
                    ne: '≠',
                    equiv: '≡',
                    le: '≤',
                    ge: '≥',
                    sub: '⊂',
                    sup: '⊃',
                    nsub: '⊄',
                    sube: '⊆',
                    supe: '⊇',
                    oplus: '⊕',
                    otimes: '⊗',
                    perp: '⊥',
                    sdot: '⋅',
                    Alpha: 'Α',
                    Beta: 'Β',
                    Gamma: 'Γ',
                    Delta: 'Δ',
                    Epsilon: 'Ε',
                    Zeta: 'Ζ',
                    Eta: 'Η',
                    Theta: 'Θ',
                    Iota: 'Ι',
                    Kappa: 'Κ',
                    Lambda: 'Λ',
                    Mu: 'Μ',
                    Nu: 'Ν',
                    Xi: 'Ξ',
                    Omicron: 'Ο',
                    Pi: 'Π',
                    Rho: 'Ρ',
                    Sigma: 'Σ',
                    Tau: 'Τ',
                    Upsilon: 'Υ',
                    Phi: 'Φ',
                    Chi: 'Χ',
                    Psi: 'Ψ',
                    Omega: 'Ω',
                    alpha: 'α',
                    beta: 'β',
                    gamma: 'γ',
                    delta: 'δ',
                    epsilon: 'ε',
                    zeta: 'ζ',
                    eta: 'η',
                    theta: 'θ',
                    iota: 'ι',
                    kappa: 'κ',
                    lambda: 'λ',
                    mu: 'μ',
                    nu: 'ν',
                    xi: 'ξ',
                    omicron: 'ο',
                    pi: 'π',
                    rho: 'ρ',
                    sigmaf: 'ς',
                    sigma: 'σ',
                    tau: 'τ',
                    upsilon: 'υ',
                    phi: 'φ',
                    chi: 'χ',
                    psi: 'ψ',
                    omega: 'ω',
                    thetasym: 'ϑ',
                    upsih: 'ϒ',
                    piv: 'ϖ',
                    OElig: 'Œ',
                    oelig: 'œ',
                    Scaron: 'Š',
                    scaron: 'š',
                    Yuml: 'Ÿ',
                    fnof: 'ƒ',
                    circ: 'ˆ',
                    tilde: '˜',
                    ensp: ' ',
                    emsp: ' ',
                    thinsp: ' ',
                    zwnj: '‌',
                    zwj: '‍',
                    lrm: '‎',
                    rlm: '‏',
                    ndash: '–',
                    mdash: '—',
                    lsquo: '‘',
                    rsquo: '’',
                    sbquo: '‚',
                    ldquo: '“',
                    rdquo: '”',
                    bdquo: '„',
                    dagger: '†',
                    Dagger: '‡',
                    bull: '•',
                    hellip: '…',
                    permil: '‰',
                    prime: '′',
                    Prime: '″',
                    lsaquo: '‹',
                    rsaquo: '›',
                    oline: '‾',
                    euro: '€',
                    trade: '™',
                    larr: '←',
                    uarr: '↑',
                    rarr: '→',
                    darr: '↓',
                    harr: '↔',
                    crarr: '↵',
                    lceil: '⌈',
                    rceil: '⌉',
                    lfloor: '⌊',
                    rfloor: '⌋',
                    loz: '◊',
                    spades: '♠',
                    clubs: '♣',
                    hearts: '♥',
                    diams: '♦',
                })),
                (t.entityMap = t.HTML_ENTITIES)
        })
    ja.XML_ENTITIES, ja.HTML_ENTITIES, ja.entityMap
    var Ha = jr.NAMESPACE,
        zt = /[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,
        ar = new RegExp('[\\-\\.0-9' + zt.source.slice(1, -1) + '\\u00B7\\u0300-\\u036F\\u203F-\\u2040]'),
        qa = new RegExp('^' + zt.source + ar.source + '*(?::' + zt.source + ar.source + '*)?$'),
        Va = 0,
        Wa = 1,
        Ga = 2,
        za = 3,
        Xa = 4,
        Ka = 5,
        Ya = 6,
        Qa = 7
    function $a(e, t) {
        ;(this.message = e), (this.locator = t), Error.captureStackTrace && Error.captureStackTrace(this, $a)
    }
    function Ja() {}
    function Za(e, t) {
        return (t.lineNumber = e.lineNumber), (t.columnNumber = e.columnNumber), t
    }
    function es(e, t, i) {
        for (var n = e.tagName, r = null, a = e.length; a--; ) {
            var s = e[a],
                o = s.qName,
                u = s.value,
                o = 0 < (c = o.indexOf(':')) ? ((l = s.prefix = o.slice(0, c)), (d = o.slice(c + 1)), 'xmlns' === l && d) : ((l = null), 'xmlns' === (d = o) && '')
            ;(s.localName = d), !1 !== o && (null == r && ((r = {}), ts(i, (i = {}))), (i[o] = r[o] = u), (s.uri = Ha.XMLNS), t.startPrefixMapping(o, u))
        }
        for (var l, a = e.length; a--; ) (l = (s = e[a]).prefix) && ('xml' === l && (s.uri = Ha.XML), 'xmlns' !== l && (s.uri = i[l || '']))
        var c,
            d = 0 < (c = n.indexOf(':')) ? ((l = e.prefix = n.slice(0, c)), (e.localName = n.slice(c + 1))) : ((l = null), (e.localName = n)),
            h = (e.uri = i[l || ''])
        if ((t.startElement(h, d, n, e), !e.closed)) return (e.currentNSMap = i), (e.localNSMap = r), 1
        if ((t.endElement(h, d, n), r)) for (l in r) t.endPrefixMapping(l)
    }
    function ts(e, t) {
        for (var i in e) t[i] = e[i]
    }
    function is() {
        this.attributeNames = {}
    }
    ;(($a.prototype = new Error()).name = $a.name),
        (Ja.prototype = {
            parse: function (e, t, i) {
                var n = this.domBuilder
                n.startDocument(),
                    ts(t, (t = {})),
                    (function (i, e, n, r, a) {
                        function s(e) {
                            var t = e.slice(1, -1)
                            return t in n
                                ? n[t]
                                : '#' === t.charAt(0)
                                ? 65535 < (t = parseInt(t.substr(1).replace('x', '0x')))
                                    ? ((t -= 65536), String.fromCharCode(55296 + (t >> 10), 56320 + (1023 & t)))
                                    : String.fromCharCode(t)
                                : (a.error('entity not found:' + e), e)
                        }
                        function t(e) {
                            var t
                            f < e && ((t = i.substring(f, e).replace(/&#?\w+;/g, s)), d && o(f), r.characters(t, 0, e - f), (f = e))
                        }
                        function o(e, t) {
                            for (; l <= e && (t = c.exec(i)); ) (u = t.index), (l = u + t[0].length), d.lineNumber++
                            d.columnNumber = e - u + 1
                        }
                        var u = 0,
                            l = 0,
                            c = /.*(?:\r\n?|\n)|.*$/g,
                            d = r.locator,
                            h = [{ currentNSMap: e }],
                            p = {},
                            f = 0
                        for (;;) {
                            try {
                                var m,
                                    g,
                                    y = i.indexOf('<', f)
                                if (y < 0) return i.substr(f).match(/^\s*$/) || ((m = r.doc), (g = m.createTextNode(i.substr(f))), m.appendChild(g), (r.currentElement = g))
                                switch ((f < y && t(y), i.charAt(y + 1))) {
                                    case '/':
                                        var v = i.indexOf('>', y + 3),
                                            _ = i.substring(y + 2, v).replace(/[ \t\n\r]+$/g, ''),
                                            b = h.pop()
                                        v < 0
                                            ? ((_ = i.substring(y + 2).replace(/[\s<].*/, '')), a.error('end tag name: ' + _ + ' is not complete:' + b.tagName), (v = y + 1 + _.length))
                                            : _.match(/\s</) && ((_ = _.replace(/[\s<].*/, '')), a.error('end tag name: ' + _ + ' maybe not complete'), (v = y + 1 + _.length))
                                        var T = b.localNSMap,
                                            S = b.tagName == _
                                        if (S || (b.tagName && b.tagName.toLowerCase() == _.toLowerCase())) {
                                            if ((r.endElement(b.uri, b.localName, _), T)) for (var w in T) r.endPrefixMapping(w)
                                            S || a.fatalError('end tag name: ' + _ + ' is not match the current start tagName:' + b.tagName)
                                        } else h.push(b)
                                        v++
                                        break
                                    case '?':
                                        d && o(y),
                                            (v = (function (e, t, i) {
                                                var n = e.indexOf('?>', t)
                                                if (n) {
                                                    t = e.substring(t, n).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/)
                                                    return t ? (t[0].length, i.processingInstruction(t[1], t[2]), n + 2) : -1
                                                }
                                                return -1
                                            })(i, y, r))
                                        break
                                    case '!':
                                        d && o(y),
                                            (v = (function (e, t, i, n) {
                                                {
                                                    if ('-' === e.charAt(t + 2)) {
                                                        if ('-' !== e.charAt(t + 3)) return -1
                                                        var r = e.indexOf('--\x3e', t + 4)
                                                        return t < r ? (i.comment(e, t + 4, r - t - 4), r + 3) : (n.error('Unclosed comment'), -1)
                                                    }
                                                    if ('CDATA[' == e.substr(t + 3, 6)) {
                                                        r = e.indexOf(']]>', t + 9)
                                                        return i.startCDATA(), i.characters(e, t + 9, r - t - 9), i.endCDATA(), r + 3
                                                    }
                                                    var a = (function (e, t) {
                                                            var i,
                                                                n = [],
                                                                r = /'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g
                                                            ;(r.lastIndex = t), r.exec(e)
                                                            for (; (i = r.exec(e)); ) if ((n.push(i), i[1])) return n
                                                        })(e, t),
                                                        n = a.length
                                                    if (1 < n && /!doctype/i.test(a[0][0])) {
                                                        ;(r = a[1][0]), (e = !1), (t = !1)
                                                        3 < n && (/^public$/i.test(a[2][0]) ? ((e = a[3][0]), (t = 4 < n && a[4][0])) : /^system$/i.test(a[2][0]) && (t = a[3][0]))
                                                        n = a[n - 1]
                                                        return i.startDTD(r, e, t), i.endDTD(), n.index + n[0].length
                                                    }
                                                }
                                                return -1
                                            })(i, y, r, a))
                                        break
                                    default:
                                        d && o(y)
                                        var E = new is(),
                                            k = h[h.length - 1].currentNSMap,
                                            v = (function (e, t, n, i, r, a) {
                                                function s(e, t, i) {
                                                    n.attributeNames.hasOwnProperty(e) && a.fatalError('Attribute ' + e + ' redefined'), n.addValue(e, t, i)
                                                }
                                                var o,
                                                    u = ++t,
                                                    l = Va
                                                for (;;) {
                                                    var c = e.charAt(u)
                                                    switch (c) {
                                                        case '=':
                                                            if (l === Wa) (o = e.slice(t, u)), (l = za)
                                                            else {
                                                                if (l !== Ga) throw new Error('attribute equal must after attrName')
                                                                l = za
                                                            }
                                                            break
                                                        case "'":
                                                        case '"':
                                                            if (l === za || l === Wa) {
                                                                if ((l === Wa && (a.warning('attribute value must after "="'), (o = e.slice(t, u))), (t = u + 1), !(0 < (u = e.indexOf(c, t)))))
                                                                    throw new Error("attribute value no end '" + c + "' match")
                                                                ;(d = e.slice(t, u).replace(/&#?\w+;/g, r)), s(o, d, t - 1), (l = Ka)
                                                            } else {
                                                                if (l != Xa) throw new Error('attribute value must after "="')
                                                                ;(d = e.slice(t, u).replace(/&#?\w+;/g, r)),
                                                                    s(o, d, t),
                                                                    a.warning('attribute "' + o + '" missed start quot(' + c + ')!!'),
                                                                    (t = u + 1),
                                                                    (l = Ka)
                                                            }
                                                            break
                                                        case '/':
                                                            switch (l) {
                                                                case Va:
                                                                    n.setTagName(e.slice(t, u))
                                                                case Ka:
                                                                case Ya:
                                                                case Qa:
                                                                    ;(l = Qa), (n.closed = !0)
                                                                case Xa:
                                                                case Wa:
                                                                case Ga:
                                                                    break
                                                                default:
                                                                    throw new Error("attribute invalid close char('/')")
                                                            }
                                                            break
                                                        case '':
                                                            return a.error('unexpected end of input'), l == Va && n.setTagName(e.slice(t, u)), u
                                                        case '>':
                                                            switch (l) {
                                                                case Va:
                                                                    n.setTagName(e.slice(t, u))
                                                                case Ka:
                                                                case Ya:
                                                                case Qa:
                                                                    break
                                                                case Xa:
                                                                case Wa:
                                                                    '/' === (d = e.slice(t, u)).slice(-1) && ((n.closed = !0), (d = d.slice(0, -1)))
                                                                case Ga:
                                                                    l === Ga && (d = o),
                                                                        l == Xa
                                                                            ? (a.warning('attribute "' + d + '" missed quot(")!'), s(o, d.replace(/&#?\w+;/g, r), t))
                                                                            : ((Ha.isHTML(i['']) && d.match(/^(?:disabled|checked|selected)$/i)) ||
                                                                                  a.warning('attribute "' + d + '" missed value!! "' + d + '" instead!!'),
                                                                              s(d, d, t))
                                                                    break
                                                                case za:
                                                                    throw new Error('attribute value missed!!')
                                                            }
                                                            return u
                                                        case '':
                                                            c = ' '
                                                        default:
                                                            if (c <= ' ')
                                                                switch (l) {
                                                                    case Va:
                                                                        n.setTagName(e.slice(t, u)), (l = Ya)
                                                                        break
                                                                    case Wa:
                                                                        ;(o = e.slice(t, u)), (l = Ga)
                                                                        break
                                                                    case Xa:
                                                                        var d = e.slice(t, u).replace(/&#?\w+;/g, r)
                                                                        a.warning('attribute "' + d + '" missed quot(")!!'), s(o, d, t)
                                                                    case Ka:
                                                                        l = Ya
                                                                }
                                                            else
                                                                switch (l) {
                                                                    case Ga:
                                                                        n.tagName,
                                                                            (Ha.isHTML(i['']) && o.match(/^(?:disabled|checked|selected)$/i)) ||
                                                                                a.warning('attribute "' + o + '" missed value!! "' + o + '" instead2!!'),
                                                                            s(o, o, t),
                                                                            (t = u),
                                                                            (l = Wa)
                                                                        break
                                                                    case Ka:
                                                                        a.warning('attribute space is required"' + o + '"!!')
                                                                    case Ya:
                                                                        ;(l = Wa), (t = u)
                                                                        break
                                                                    case za:
                                                                        ;(l = Xa), (t = u)
                                                                        break
                                                                    case Qa:
                                                                        throw new Error("elements closed character '/' and '>' must be connected to")
                                                                }
                                                    }
                                                    u++
                                                }
                                            })(i, y, E, k, s, a),
                                            C = E.length
                                        if (
                                            (!E.closed &&
                                                (function (e, t, i, n) {
                                                    var r = n[i]
                                                    null == r && ((r = e.lastIndexOf('</' + i + '>')) < t && (r = e.lastIndexOf('</' + i)), (n[i] = r))
                                                    return r < t
                                                })(i, v, E.tagName, p) &&
                                                ((E.closed = !0), n.nbsp || a.warning('unclosed xml attribute')),
                                            d && C)
                                        ) {
                                            for (var I = Za(d, {}), x = 0; x < C; x++) {
                                                var A = E[x]
                                                o(A.offset), (A.locator = Za(d, {}))
                                            }
                                            ;(r.locator = I), es(E, r, k) && h.push(E), (r.locator = d)
                                        } else es(E, r, k) && h.push(E)
                                        Ha.isHTML(E.uri) && !E.closed
                                            ? (v = (function (e, t, i, n, r) {
                                                  if (/^(?:script|textarea)$/i.test(i)) {
                                                      var a = e.indexOf('</' + i + '>', t),
                                                          e = e.substring(t + 1, a)
                                                      if (/[&<]/.test(e)) return /^script$/i.test(i) || (e = e.replace(/&#?\w+;/g, n)), r.characters(e, 0, e.length), a
                                                  }
                                                  return t + 1
                                              })(i, v, E.tagName, s, r))
                                            : v++
                                }
                            } catch (e) {
                                if (e instanceof $a) throw e
                                a.error('element parse error: ' + e), (v = -1)
                            }
                            f < v ? (f = v) : t(Math.max(y, f) + 1)
                        }
                    })(e, t, i, n, this.errorHandler),
                    n.endDocument()
            },
        }),
        (is.prototype = {
            setTagName: function (e) {
                if (!qa.test(e)) throw new Error('invalid tagName:' + e)
                this.tagName = e
            },
            addValue: function (e, t, i) {
                if (!qa.test(e)) throw new Error('invalid attribute:' + e)
                ;(this.attributeNames[e] = this.length), (this[this.length++] = { qName: e, value: t, offset: i })
            },
            length: 0,
            getLocalName: function (e) {
                return this[e].localName
            },
            getLocator: function (e) {
                return this[e].locator
            },
            getQName: function (e) {
                return this[e].qName
            },
            getURI: function (e) {
                return this[e].uri
            },
            getValue: function (e) {
                return this[e].value
            },
        })
    var x = { XMLReader: Ja, ParseError: $a },
        ns = U.DOMImplementation,
        rs = jr.NAMESPACE,
        as = x.ParseError,
        ss = x.XMLReader
    function os(e) {
        this.options = e || { locator: {} }
    }
    function us() {
        this.cdata = !1
    }
    function ls(e, t) {
        ;(t.lineNumber = e.lineNumber), (t.columnNumber = e.columnNumber)
    }
    function cs(e) {
        if (e) return '\n@' + (e.systemId || '') + '#[line:' + e.lineNumber + ',col:' + e.columnNumber + ']'
    }
    function ds(e, t, i) {
        return 'string' == typeof e ? e.substr(t, i) : e.length >= t + i || t ? new java.lang.String(e, t, i) + '' : e
    }
    function hs(e, t) {
        ;(e.currentElement || e.doc).appendChild(t)
    }
    ;(os.prototype.parseFromString = function (e, t) {
        var i = this.options,
            n = new ss(),
            r = i.domBuilder || new us(),
            a = i.errorHandler,
            s = i.locator,
            o = i.xmlns || {},
            u = /\/x?html?$/.test(t),
            t = u ? ja.HTML_ENTITIES : ja.XML_ENTITIES
        return (
            s && r.setDocumentLocator(s),
            (n.errorHandler = (function (n, e, r) {
                if (!n) {
                    if (e instanceof us) return e
                    n = e
                }
                var a = {},
                    s = n instanceof Function
                function t(t) {
                    var i = n[t]
                    !i &&
                        s &&
                        (i =
                            2 == n.length
                                ? function (e) {
                                      n(t, e)
                                  }
                                : n),
                        (a[t] = i
                            ? function (e) {
                                  i('[xmldom ' + t + ']\t' + e + cs(r))
                              }
                            : function () {})
                }
                return (r = r || {}), t('warning'), t('error'), t('fatalError'), a
            })(a, r, s)),
            (n.domBuilder = i.domBuilder || r),
            u && (o[''] = rs.HTML),
            (o.xml = o.xml || rs.XML),
            e && 'string' == typeof e ? n.parse(e, o, t) : n.errorHandler.error('invalid doc source'),
            r.doc
        )
    }),
        (us.prototype = {
            startDocument: function () {
                ;(this.doc = new ns().createDocument(null, null, null)), this.locator && (this.doc.documentURI = this.locator.systemId)
            },
            startElement: function (e, t, i, n) {
                var r = this.doc,
                    a = r.createElementNS(e, i || t),
                    s = n.length
                hs(this, a), (this.currentElement = a), this.locator && ls(this.locator, a)
                for (var o = 0; o < s; o++) {
                    var e = n.getURI(o),
                        u = n.getValue(o),
                        i = n.getQName(o),
                        l = r.createAttributeNS(e, i)
                    this.locator && ls(n.getLocator(o), l), (l.value = l.nodeValue = u), a.setAttributeNode(l)
                }
            },
            endElement: function (e, t, i) {
                var n = this.currentElement
                n.tagName, (this.currentElement = n.parentNode)
            },
            startPrefixMapping: function (e, t) {},
            endPrefixMapping: function (e) {},
            processingInstruction: function (e, t) {
                t = this.doc.createProcessingInstruction(e, t)
                this.locator && ls(this.locator, t), hs(this, t)
            },
            ignorableWhitespace: function (e, t, i) {},
            characters: function (e, t, i) {
                var n
                ;(e = ds.apply(this, arguments)) &&
                    ((n = this.cdata ? this.doc.createCDATASection(e) : this.doc.createTextNode(e)),
                    this.currentElement ? this.currentElement.appendChild(n) : /^\s*$/.test(e) && this.doc.appendChild(n),
                    this.locator && ls(this.locator, n))
            },
            skippedEntity: function (e) {},
            endDocument: function () {
                this.doc.normalize()
            },
            setDocumentLocator: function (e) {
                ;(this.locator = e) && (e.lineNumber = 0)
            },
            comment: function (e, t, i) {
                e = ds.apply(this, arguments)
                e = this.doc.createComment(e)
                this.locator && ls(this.locator, e), hs(this, e)
            },
            startCDATA: function () {
                this.cdata = !0
            },
            endCDATA: function () {
                this.cdata = !1
            },
            startDTD: function (e, t, i) {
                var n = this.doc.implementation
                n && n.createDocumentType && ((i = n.createDocumentType(e, t, i)), this.locator && ls(this.locator, i), hs(this, i), (this.doc.doctype = i))
            },
            warning: function (e) {},
            error: function (e) {},
            fatalError: function (e) {
                throw new as(e, this.locator)
            },
        }),
        'endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl'.replace(/\w+/g, function (e) {
            us.prototype[e] = function () {
                return null
            }
        })
    function ps(e) {
        return !!e && 'object' == typeof e
    }
    function fs() {
        for (var e = arguments.length, t = new Array(e), i = 0; i < e; i++) t[i] = arguments[i]
        return t.reduce(function (t, i) {
            return (
                'object' != typeof i ||
                    Object.keys(i).forEach(function (e) {
                        Array.isArray(t[e]) && Array.isArray(i[e]) ? (t[e] = t[e].concat(i[e])) : ps(t[e]) && ps(i[e]) ? (t[e] = fs(t[e], i[e])) : (t[e] = i[e])
                    }),
                t
            )
        }, {})
    }
    function ms(t) {
        return Object.keys(t).map(function (e) {
            return t[e]
        })
    }
    function gs(e) {
        return e.reduce(function (e, t) {
            return e.concat(t)
        }, [])
    }
    function ys(e) {
        if (!e.length) return []
        for (var t = [], i = 0; i < e.length; i++) t.push(e[i])
        return t
    }
    function vs(e, t) {
        for (var i = 0; i < e.length; i++) if (t(e[i])) return i
        return -1
    }
    function _s(e) {
        var t = e.baseUrl,
            i = void 0 === (n = e.source) ? '' : n,
            n = void 0 === (n = e.range) ? '' : n,
            e = void 0 === (e = e.indexRange) ? '' : e,
            i = { uri: i, resolvedUri: ir((void 0 === t ? '' : t) || '', i) }
        return (
            (n || e) &&
                ((n = (n || e).split('-')),
                (e = window.BigInt ? window.BigInt(n[0]) : parseInt(n[0], 10)),
                (n = window.BigInt ? window.BigInt(n[1]) : parseInt(n[1], 10)),
                e < Number.MAX_SAFE_INTEGER && 'bigint' == typeof e && (e = Number(e)),
                'bigint' ==
                    typeof (n =
                        'bigint' == typeof (n = n < Number.MAX_SAFE_INTEGER && 'bigint' == typeof n ? Number(n) : n) || 'bigint' == typeof e
                            ? window.BigInt(n) - window.BigInt(e) + window.BigInt(1)
                            : n - e + 1) &&
                    n < Number.MAX_SAFE_INTEGER &&
                    (n = Number(n)),
                (i.byterange = { length: n, offset: e })),
            i
        )
    }
    function bs(e) {
        return e && 'number' != typeof e && (e = parseInt(e, 10)), isNaN(e) ? null : e
    }
    function Ts(e) {
        var a,
            t = e.type,
            i = e.duration,
            n = e.timescale,
            r = void 0 === n ? 1 : n,
            s = e.periodDuration,
            o = e.sourceDuration,
            e = (function (e, t) {
                for (var i = [], n = e; n < t; n++) i.push(n)
                return i
            })((n = go[t](e)).start, n.end).map(
                ((a = e),
                function (e) {
                    var t = a.duration,
                        i = a.timescale,
                        n = a.periodStart,
                        r = a.startNumber
                    return { number: (void 0 === r ? 1 : r) + e, duration: t / (void 0 === i ? 1 : i), timeline: n, time: e * t }
                })
            )
        return 'static' === t && (e[(t = e.length - 1)].duration = ('number' == typeof s ? s : o) - (i / r) * t), e
    }
    function Ss(e) {
        var t = e.baseUrl,
            i = void 0 === (u = e.initialization) ? {} : u,
            n = e.sourceDuration,
            r = void 0 === (o = e.indexRange) ? '' : o,
            a = e.periodStart,
            s = e.presentationTime,
            o = void 0 === (u = e.number) ? 0 : u,
            u = e.duration
        if (!t) throw new Error(po)
        return (
            (i = _s({ baseUrl: t, source: i.sourceURL, range: i.range })),
            ((r = _s({ baseUrl: t, source: t, indexRange: r })).map = i),
            u ? (e = Ts(e)).length && ((r.duration = e[0].duration), (r.timeline = e[0].timeline)) : n && ((r.duration = n), (r.timeline = a)),
            (r.presentationTime = s || a),
            (r.number = o),
            [r]
        )
    }
    function ws(e, t, i) {
        for (
            var n = e.sidx.map || null,
                r = e.sidx.duration,
                a = e.timeline || 0,
                s = (s = e.sidx.byterange).offset + s.length,
                o = t.timescale,
                u = t.references.filter(function (e) {
                    return 1 !== e.referenceType
                }),
                l = [],
                c = e.endList ? 'static' : 'dynamic',
                d = e.sidx.timeline,
                h = d,
                p = e.mediaSequence || 0,
                f = 'bigint' == typeof t.firstOffset ? window.BigInt(s) + t.firstOffset : s + t.firstOffset,
                m = 0;
            m < u.length;
            m++
        ) {
            var g = t.references[m],
                y = g.referencedSize,
                v = g.subsegmentDuration,
                g = void 0,
                g = 'bigint' == typeof f ? f + window.BigInt(y) - window.BigInt(1) : f + y - 1,
                g = Ss({ baseUrl: i, timescale: o, timeline: a, periodStart: d, presentationTime: h, number: p, duration: v, sourceDuration: r, indexRange: f + '-' + g, type: c })[0]
            n && (g.map = n), l.push(g), (f += 'bigint' == typeof f ? window.BigInt(y) : y), (h += v / o), p++
        }
        return (e.segments = l), e
    }
    function Es(e) {
        return (
            (i = function (e) {
                return e.timeline
            }),
            ms(
                e.reduce(function (t, e) {
                    return (
                        e.forEach(function (e) {
                            t[i(e)] = e
                        }),
                        t
                    )
                }, {})
            ).sort(function (e, t) {
                return e.timeline > t.timeline ? 1 : -1
            })
        )
        var i
    }
    function ks(e) {
        var r,
            a,
            s = []
        return (
            (r = e),
            (a = function (e, t, i, n) {
                s = s.concat(e.playlists || [])
            }),
            yo.forEach(function (e) {
                for (var t in r.mediaGroups[e])
                    for (var i in r.mediaGroups[e][t]) {
                        var n = r.mediaGroups[e][t][i]
                        a(n, e, t, i)
                    }
            }),
            s
        )
    }
    function Cs(e) {
        var i = e.playlist,
            e = e.mediaSequence
        ;(i.mediaSequence = e),
            i.segments.forEach(function (e, t) {
                e.number = i.mediaSequence + t
            })
    }
    function Is(e) {
        var r,
            a,
            t = e.oldManifest,
            i = e.newManifest,
            n = t.playlists.concat(ks(t)),
            e = i.playlists.concat(ks(i))
        return (
            (i.timelineStarts = Es([t.timelineStarts, i.timelineStarts])),
            (n = { oldPlaylists: n, newPlaylists: e, timelineStarts: i.timelineStarts }),
            (r = n.oldPlaylists),
            (e = n.newPlaylists),
            (a = n.timelineStarts),
            e.forEach(function (t) {
                t.discontinuitySequence = vs(a, function (e) {
                    return e.timeline === t.timeline
                })
                var e = (function (e, t) {
                    for (var i = 0; i < e.length; i++) if (e[i].attributes.NAME === t) return e[i]
                    return null
                })(r, t.attributes.NAME)
                if (e && !t.sidx) {
                    var i = t.segments[0],
                        n = vs(e.segments, function (e) {
                            return Math.abs(e.presentationTime - i.presentationTime) < 1 / 60
                        })
                    if (-1 === n)
                        return (
                            Cs({ playlist: t, mediaSequence: e.mediaSequence + e.segments.length }),
                            (t.segments[0].discontinuity = !0),
                            t.discontinuityStarts.unshift(0),
                            void (((!e.segments.length && t.timeline > e.timeline) || (e.segments.length && t.timeline > e.segments[e.segments.length - 1].timeline)) && t.discontinuitySequence--)
                        )
                    e.segments[n].discontinuity && !i.discontinuity && ((i.discontinuity = !0), t.discontinuityStarts.unshift(0), t.discontinuitySequence--),
                        Cs({ playlist: t, mediaSequence: e.segments[n].number })
                }
            }),
            i
        )
    }
    function xs(e) {
        return (
            e &&
            e.uri +
                '-' +
                ((t = e.byterange),
                (e = 'bigint' == typeof t.offset || 'bigint' == typeof t.length ? window.BigInt(t.offset) + window.BigInt(t.length) - window.BigInt(1) : t.offset + t.length - 1),
                t.offset + '-' + e)
        )
        var t
    }
    function As(e) {
        return ms(
            e.reduce(function (e, t) {
                var i,
                    n = t.attributes.id + (t.attributes.lang || '')
                return (
                    e[n]
                        ? (t.segments && (t.segments[0] && (t.segments[0].discontinuity = !0), (i = e[n].segments).push.apply(i, t.segments)),
                          t.attributes.contentProtection && (e[n].attributes.contentProtection = t.attributes.contentProtection))
                        : ((e[n] = t), (e[n].attributes.timelineStarts = [])),
                    e[n].attributes.timelineStarts.push({ start: t.attributes.periodStart, timeline: t.attributes.periodStart }),
                    e
                )
            }, {})
        ).map(function (e) {
            var t, n
            return (
                (e.discontinuityStarts =
                    ((t = e.segments || []),
                    (n = 'discontinuity'),
                    t.reduce(function (e, t, i) {
                        return t[n] && e.push(i), e
                    }, []))),
                e
            )
        })
    }
    function Ps(e, t) {
        var i = xs(e.sidx)
        return (i = i && t[i] && t[i].sidx) && ws(e, i, e.sidx.resolvedUri), e
    }
    function Ls(e, h, p) {
        var f
        return (
            void 0 === h && (h = {}),
            void 0 === p && (p = !1),
            (e = e.reduce(function (e, t) {
                var i = (t.attributes.role && t.attributes.role.value) || '',
                    n = t.attributes.lang || '',
                    r = t.attributes.label || 'main'
                e[(r = n && !t.attributes.label ? t.attributes.lang + (i ? ' (' + i + ')' : '') : r)] || (e[r] = { language: n, autoselect: !0, default: 'main' === i, playlists: [], uri: '' })
                var a,
                    s,
                    o,
                    u,
                    l,
                    c,
                    d,
                    u = Ps(
                        ((s = p),
                        (o = (a = t).attributes),
                        (u = a.segments),
                        (l = a.sidx),
                        (c = a.mediaSequence),
                        (d = a.discontinuitySequence),
                        (n = a.discontinuityStarts),
                        (u = {
                            attributes: (((a = { NAME: o.id, BANDWIDTH: o.bandwidth, CODECS: o.codecs })['PROGRAM-ID'] = 1), a),
                            uri: '',
                            endList: 'static' === o.type,
                            timeline: o.periodStart,
                            resolvedUri: '',
                            targetDuration: o.duration,
                            discontinuitySequence: d,
                            discontinuityStarts: n,
                            timelineStarts: o.timelineStarts,
                            mediaSequence: c,
                            segments: u,
                        }),
                        o.contentProtection && (u.contentProtection = o.contentProtection),
                        l && (u.sidx = l),
                        s && ((u.attributes.AUDIO = 'audio'), (u.attributes.SUBTITLES = 'subs')),
                        u),
                        h
                    )
                return e[r].playlists.push(u), 'undefined' == typeof f && 'main' === i && ((f = t).default = !0), e
            }, {})),
            f || (e[Object.keys(e)[0]].default = !0),
            e
        )
    }
    function Ds(e) {
        var t = e.attributes,
            i = e.segments,
            n = e.sidx,
            r = e.discontinuityStarts,
            i = {
                attributes:
                    (((e = { NAME: t.id, AUDIO: 'audio', SUBTITLES: 'subs', RESOLUTION: { width: t.width, height: t.height }, CODECS: t.codecs, BANDWIDTH: t.bandwidth })['PROGRAM-ID'] = 1), e),
                uri: '',
                endList: 'static' === t.type,
                timeline: t.periodStart,
                resolvedUri: '',
                targetDuration: t.duration,
                discontinuityStarts: r,
                timelineStarts: t.timelineStarts,
                segments: i,
            }
        return t.contentProtection && (i.contentProtection = t.contentProtection), n && (i.sidx = n), i
    }
    function Os(e) {
        return 'video/mp4' === (e = e.attributes).mimeType || 'video/webm' === e.mimeType || 'video' === e.contentType
    }
    function Ms(e) {
        return 'audio/mp4' === (e = e.attributes).mimeType || 'audio/webm' === e.mimeType || 'audio' === e.contentType
    }
    function Rs(e) {
        return 'text/vtt' === (e = e.attributes).mimeType || 'text' === e.contentType
    }
    function Ns(i) {
        return i
            ? Object.keys(i).reduce(function (e, t) {
                  t = i[t]
                  return e.concat(t.playlists)
              }, [])
            : []
    }
    function Us(e) {
        var t = e.dashPlaylists,
            i = e.locations,
            n = void 0 === (c = e.sidxMapping) ? {} : c,
            r = e.previousManifest
        if (!t.length) return {}
        var a = (d = t[0].attributes).sourceDuration,
            s = d.type,
            o = d.suggestedPresentationDelay,
            u = d.minimumUpdatePeriod,
            l = As(t.filter(Os)).map(Ds),
            c = As(t.filter(Ms)),
            e = As(t.filter(Rs)),
            d = t
                .map(function (e) {
                    return e.attributes.captionServices
                })
                .filter(Boolean),
            a = {
                allowCache: !0,
                discontinuityStarts: [],
                segments: [],
                endList: !0,
                mediaGroups: (((t = { AUDIO: {}, VIDEO: {} })['CLOSED-CAPTIONS'] = {}), (t.SUBTITLES = {}), t),
                uri: '',
                duration: a,
                playlists: (function (e, t) {
                    if ((void 0 === t && (t = {}), !Object.keys(t).length)) return e
                    for (var i in e) e[i] = Ps(e[i], t)
                    return e
                })(l, n),
            }
        0 <= u && (a.minimumUpdatePeriod = 1e3 * u), i && (a.locations = i), 'dynamic' === s && (a.suggestedPresentationDelay = o)
        var h,
            p,
            o = 0 === a.playlists.length,
            o = c.length ? Ls(c, n, o) : null,
            n = e.length
                ? (void 0 === (h = n) && (h = {}),
                  e.reduce(function (e, t) {
                      var i = t.attributes.lang || 'text'
                      return (
                          e[i] || (e[i] = { language: i, default: !1, autoselect: !1, playlists: [], uri: '' }),
                          e[i].playlists.push(
                              Ps(
                                  (function (e) {
                                      var t = e.attributes,
                                          i = e.segments,
                                          n = e.mediaSequence,
                                          r = e.discontinuityStarts,
                                          a = e.discontinuitySequence
                                      'undefined' == typeof i &&
                                          ((i = [{ uri: t.baseUrl, timeline: t.periodStart, resolvedUri: t.baseUrl || '', duration: t.sourceDuration, number: 0 }]), (t.duration = t.sourceDuration))
                                      ;(e = { NAME: t.id, BANDWIDTH: t.bandwidth })['PROGRAM-ID'] = 1
                                      return (
                                          t.codecs && (e.CODECS = t.codecs),
                                          {
                                              attributes: e,
                                              uri: '',
                                              endList: 'static' === t.type,
                                              timeline: t.periodStart,
                                              resolvedUri: t.baseUrl || '',
                                              targetDuration: t.duration,
                                              timelineStarts: t.timelineStarts,
                                              discontinuityStarts: r,
                                              discontinuitySequence: a,
                                              mediaSequence: n,
                                              segments: i,
                                          }
                                      )
                                  })(t),
                                  h
                              )
                          ),
                          e
                      )
                  }, {}))
                : null,
            l = (e = l.concat(Ns(o), Ns(n))).map(function (e) {
                return e.timelineStarts
            })
        return (
            (a.timelineStarts = Es(l)),
            (e = e),
            (p = a.timelineStarts),
            e.forEach(function (t) {
                ;(t.mediaSequence = 0),
                    (t.discontinuitySequence = vs(p, function (e) {
                        return e.timeline === t.timeline
                    })),
                    t.segments &&
                        t.segments.forEach(function (e, t) {
                            e.number = t
                        })
            }),
            o && (a.mediaGroups.AUDIO.audio = o),
            n && (a.mediaGroups.SUBTITLES.subs = n),
            d.length &&
                (a.mediaGroups['CLOSED-CAPTIONS'].cc = d.reduce(function (n, e) {
                    return (
                        e &&
                            e.forEach(function (e) {
                                var t = e.channel,
                                    i = e.language
                                ;(n[i] = { autoselect: !1, default: !1, instreamId: t, language: i }),
                                    e.hasOwnProperty('aspectRatio') && (n[i].aspectRatio = e.aspectRatio),
                                    e.hasOwnProperty('easyReader') && (n[i].easyReader = e.easyReader),
                                    e.hasOwnProperty('3D') && (n[i]['3D'] = e['3D'])
                            }),
                        n
                    )
                }, {})),
            r ? Is({ oldManifest: r, newManifest: a }) : a
        )
    }
    function Bs(e, t) {
        for (
            var i,
                n,
                r,
                a,
                s,
                o,
                u = e.type,
                l = e.minimumUpdatePeriod,
                c = void 0 === l ? 0 : l,
                d = void 0 === (l = e.media) ? '' : l,
                h = e.sourceDuration,
                p = void 0 === (l = e.timescale) ? 1 : l,
                f = void 0 === (l = e.startNumber) ? 1 : l,
                m = e.periodStart,
                g = [],
                y = -1,
                v = 0;
            v < t.length;
            v++
        ) {
            var _ = t[v],
                b = _.d,
                T = _.r || 0,
                S = _.t || 0
            y < 0 && (y = S), S && y < S && (y = S)
            var w,
                E = void 0
            E =
                T < 0
                    ? (w = v + 1) === t.length
                        ? 'dynamic' === u && 0 < c && 0 < d.indexOf('$Number$')
                            ? ((i = y),
                              (n = b),
                              (_ = o = s = a = r = void 0),
                              (r = (S = e).NOW),
                              (a = S.clientOffset),
                              (s = S.availabilityStartTime),
                              (o = S.timescale),
                              (_ = S.periodStart),
                              (S = S.minimumUpdatePeriod),
                              Math.ceil((((r + a) / 1e3 + (void 0 === S ? 0 : S) - (s + (void 0 === _ ? 0 : _))) * (void 0 === o ? 1 : o) - i) / n))
                            : (h * p - y) / b
                        : (t[w].t - y) / b
                    : T + 1
            for (var k = f + g.length + E, C = f + g.length; C < k; ) g.push({ number: C, duration: b / p, time: y, timeline: m }), (y += b), C++
        }
        return g
    }
    function Fs(e, t) {
        return e.replace(
            vo,
            ((r = t),
            function (e, t, i, n) {
                if ('$$' === e) return '$'
                if ('undefined' == typeof r[t]) return e
                e = '' + r[t]
                return 'RepresentationID' === t || (n = i ? parseInt(n, 10) : 1) <= e.length ? e : new Array(n - e.length + 1).join('0') + e
            })
        )
        var r
    }
    function js(r, e) {
        var a = { RepresentationID: r.id, Bandwidth: r.bandwidth || 0 },
            t = void 0 === (t = r.initialization) ? { sourceURL: '', range: '' } : t,
            s = _s({ baseUrl: r.baseUrl, source: Fs(t.sourceURL, a), range: t.range })
        return ((t = e), (e = r).duration || t ? (e.duration ? Ts(e) : Bs(e, t)) : [{ number: e.startNumber || 1, duration: e.sourceDuration, time: 0, timeline: e.periodStart }]).map(function (e) {
            ;(a.Number = e.number), (a.Time = e.time)
            var t = Fs(r.media || '', a),
                i = r.timescale || 1,
                n = r.presentationTimeOffset || 0,
                i = r.periodStart + (e.time - n) / i
            return { uri: t, timeline: e.timeline, duration: e.duration, resolvedUri: ir(r.baseUrl || '', t), map: s, number: e.number, presentationTime: i }
        })
    }
    function Hs(r, e) {
        var t = r.duration,
            i = void 0 === (i = r.segmentUrls) ? [] : i,
            a = r.periodStart
        if ((!t && !e) || (t && e)) throw new Error(fo)
        var n,
            s = i.map(function (e) {
                return (
                    (i = e),
                    (e = (t = r).baseUrl),
                    (t = t.initialization),
                    (t = _s({ baseUrl: e, source: (t = void 0 === t ? {} : t).sourceURL, range: t.range })),
                    ((i = _s({ baseUrl: e, source: i.media, range: i.mediaRange })).map = t),
                    i
                )
                var t, i
            })
        return (
            t && (n = Ts(r)),
            (n = e ? Bs(r, e) : n)
                .map(function (e, t) {
                    if (s[t]) {
                        var i = s[t],
                            n = r.timescale || 1,
                            t = r.presentationTimeOffset || 0
                        return (i.timeline = e.timeline), (i.duration = e.duration), (i.number = e.number), (i.presentationTime = a + (e.time - t) / n), i
                    }
                })
                .filter(function (e) {
                    return e
                })
        )
    }
    function qs(e) {
        var t,
            i = e.attributes,
            n = e.segmentInfo
        n.template ? ((a = js), (t = fs(i, n.template))) : n.base ? ((a = Ss), (t = fs(i, n.base))) : n.list && ((a = Hs), (t = fs(i, n.list)))
        var r = { attributes: i }
        if (!a) return r
        var a,
            e = a(t, n.segmentTimeline)
        return (
            t.duration
                ? ((i = t.duration), (a = t.timescale), (t.duration = i / (void 0 === a ? 1 : a)))
                : e.length
                ? (t.duration = e.reduce(function (e, t) {
                      return Math.max(e, Math.ceil(t.duration))
                  }, 0))
                : (t.duration = 0),
            (r.attributes = t),
            (r.segments = e),
            n.base && t.indexRange && ((r.sidx = e[0]), (r.segments = [])),
            r
        )
    }
    function Vs(e, t) {
        return ys(e.childNodes).filter(function (e) {
            return e.tagName === t
        })
    }
    function Ws(e) {
        return e.textContent.trim()
    }
    function Gs(e) {
        if (!(r = /P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:([\d.]*)S)?)?/.exec(e))) return 0
        var t = (a = r.slice(1))[0],
            i = a[1],
            n = a[2],
            e = a[3],
            r = a[4],
            a = a[5]
        return 31536e3 * parseFloat(t || 0) + 2592e3 * parseFloat(i || 0) + 86400 * parseFloat(n || 0) + 3600 * parseFloat(e || 0) + 60 * parseFloat(r || 0) + parseFloat(a || 0)
    }
    function zs(e) {
        return e && e.attributes
            ? ys(e.attributes).reduce(function (e, t) {
                  var i = _o[t.name] || _o.DEFAULT
                  return (e[t.name] = i(t.value)), e
              }, {})
            : {}
    }
    function Xs(e, i) {
        return i.length
            ? gs(
                  e.map(function (t) {
                      return i.map(function (e) {
                          return ir(t, Ws(e))
                      })
                  })
              )
            : e
    }
    function Ks(e) {
        var t = Vs(e, 'SegmentTemplate')[0],
            i = Vs(e, 'SegmentList')[0],
            n =
                i &&
                Vs(i, 'SegmentURL').map(function (e) {
                    return fs({ tag: 'SegmentURL' }, zs(e))
                }),
            r = Vs(e, 'SegmentBase')[0],
            e = (a = i || t) && Vs(a, 'SegmentTimeline')[0],
            a = (a = i || r || t) && Vs(a, 'Initialization')[0]
        ;(t = t && zs(t)) && a ? (t.initialization = a && zs(a)) : t && t.initialization && (t.initialization = { sourceURL: t.initialization })
        var s = { template: t, segmentTimeline: e && Vs(e, 'S').map(zs), list: i && fs(zs(i), { segmentUrls: n, initialization: zs(a) }), base: r && fs(zs(r), { initialization: zs(a) }) }
        return (
            Object.keys(s).forEach(function (e) {
                s[e] || delete s[e]
            }),
            s
        )
    }
    function Ys(u, l, c) {
        return function (e) {
            var t = zs(e),
                i = Xs(l, Vs(e, 'BaseURL')),
                n = Vs(e, 'Role')[0],
                n = { role: zs(n) },
                t = fs(u, t, n),
                n = Vs(e, 'Accessibility')[0],
                n =
                    'urn:scte:dash:cc:cea-608:2015' === (n = zs(n)).schemeIdUri
                        ? ('string' != typeof n.value ? [] : n.value.split(';')).map(function (e) {
                              var t, i, n
                              return /^CC\d=/.test((n = e)) ? ((i = (t = e.split('='))[0]), (n = t[1])) : /^CC\d$/.test(e) && (i = e), { channel: i, language: n }
                          })
                        : 'urn:scte:dash:cc:cea-708:2015' === n.schemeIdUri
                        ? ('string' != typeof n.value ? [] : n.value.split(';')).map(function (e) {
                              var t,
                                  i,
                                  n = { channel: void 0, language: void 0, aspectRatio: 1, easyReader: 0, '3D': 0 }
                              return (
                                  /=/.test(e)
                                      ? ((t = (i = e.split('='))[0]),
                                        (i = void 0 === (i = i[1]) ? '' : i),
                                        (n.channel = t),
                                        (n.language = e),
                                        i.split(',').forEach(function (e) {
                                            var t = e.split(':'),
                                                e = t[0],
                                                t = t[1]
                                            'lang' === e ? (n.language = t) : 'er' === e ? (n.easyReader = Number(t)) : 'war' === e ? (n.aspectRatio = Number(t)) : '3D' === e && (n['3D'] = Number(t))
                                        }))
                                      : (n.language = e),
                                  n.channel && (n.channel = 'SERVICE' + n.channel),
                                  n
                              )
                          })
                        : void 0
            n && (t = fs(t, { captionServices: n }))
            n = Vs(e, 'Label')[0]
            n && n.childNodes.length && ((r = n.childNodes[0].nodeValue.trim()), (t = fs(t, { label: r })))
            var r = Vs(e, 'ContentProtection').reduce(function (e, t) {
                var i = zs(t)
                i.schemeIdUri && (i.schemeIdUri = i.schemeIdUri.toLowerCase())
                var n = bo[i.schemeIdUri]
                return n && ((e[n] = { attributes: i }), (t = Vs(t, 'cenc:pssh')[0]) && ((t = Ws(t)), (e[n].pssh = t && or(t)))), e
            }, {})
            Object.keys(r).length && (t = fs(t, { contentProtection: r }))
            var a,
                s,
                o,
                r = Ks(e),
                e = Vs(e, 'Representation'),
                r = fs(c, r)
            return gs(
                e.map(
                    ((a = t),
                    (s = i),
                    (o = r),
                    function (e) {
                        var t = Vs(e, 'BaseURL'),
                            t = Xs(s, t),
                            i = fs(a, zs(e)),
                            n = Ks(e)
                        return t.map(function (e) {
                            return { segmentInfo: fs(o, n), attributes: fs(i, { baseUrl: e }) }
                        })
                    })
                )
            )
        }
    }
    function Qs(e, t) {
        var i = (t = void 0 === t ? {} : t),
            n = void 0 === (a = i.manifestUri) ? '' : a,
            t = void 0 === (r = i.NOW) ? Date.now() : r,
            r = void 0 === (a = i.clientOffset) ? 0 : a
        if (!(i = Vs(e, 'Period')).length) throw new Error(lo)
        var a = Vs(e, 'Location'),
            s = zs(e),
            e = Xs([n], Vs(e, 'BaseURL'))
        ;(s.type = s.type || 'static'), (s.sourceDuration = s.mediaPresentationDuration || 0), (s.NOW = t), (s.clientOffset = r), a.length && (s.locations = a.map(Ws))
        var o,
            u,
            l = []
        return (
            i.forEach(function (e, t) {
                var i,
                    n = zs(e),
                    r = l[t - 1]
                ;(n.start =
                    ((i = { attributes: n, priorPeriodAttributes: r ? r.attributes : null, mpdType: s.type }),
                    (t = i.attributes),
                    (r = i.priorPeriodAttributes),
                    (i = i.mpdType),
                    'number' == typeof t.start ? t.start : r && 'number' == typeof r.start && 'number' == typeof r.duration ? r.start + r.duration : r || 'static' !== i ? null : 0)),
                    l.push({ node: e, attributes: n })
            }),
            {
                locations: s.locations,
                representationInfo: gs(
                    l.map(
                        ((o = s),
                        (u = e),
                        function (e, t) {
                            var i = Xs(u, Vs(e.node, 'BaseURL')),
                                n = fs(o, { periodStart: e.attributes.start })
                            'number' == typeof e.attributes.duration && (n.periodDuration = e.attributes.duration)
                            var r = Vs(e.node, 'AdaptationSet'),
                                e = Ks(e.node)
                            return gs(r.map(Ys(n, i, e)))
                        })
                    )
                ),
            }
        )
    }
    function $s(e) {
        if ('' === e) throw new Error(co)
        var t,
            i,
            n = new uo()
        try {
            i = (t = n.parseFromString(e, 'application/xml')) && 'MPD' === t.documentElement.tagName ? t.documentElement : null
        } catch (e) {}
        if (!i || (i && 0 < i.getElementsByTagName('parsererror').length)) throw new Error(ho)
        return i
    }
    function Js(e, t) {
        void 0 === t && (t = {})
        var i = Qs($s(e), t),
            e = i.representationInfo.map(qs)
        return Us({ dashPlaylists: e, locations: i.locations, sidxMapping: t.sidxMapping, previousManifest: t.previousManifest })
    }
    function Zs(e) {
        return (function (e) {
            e = Vs(e, 'UTCTiming')[0]
            if (!e) return null
            var t = zs(e)
            switch (t.schemeIdUri) {
                case 'urn:mpeg:dash:utc:http-head:2014':
                case 'urn:mpeg:dash:utc:http-head:2012':
                    t.method = 'HEAD'
                    break
                case 'urn:mpeg:dash:utc:http-xsdate:2014':
                case 'urn:mpeg:dash:utc:http-iso:2014':
                case 'urn:mpeg:dash:utc:http-xsdate:2012':
                case 'urn:mpeg:dash:utc:http-iso:2012':
                    t.method = 'GET'
                    break
                case 'urn:mpeg:dash:utc:direct:2014':
                case 'urn:mpeg:dash:utc:direct:2012':
                    ;(t.method = 'DIRECT'), (t.value = Date.parse(t.value))
                    break
                case 'urn:mpeg:dash:utc:http-ntp:2014':
                case 'urn:mpeg:dash:utc:ntp:2014':
                case 'urn:mpeg:dash:utc:sntp:2014':
                default:
                    throw new Error(mo)
            }
            return t
        })($s(e))
    }
    function eo(e, t) {
        return (
            void 0 === t && (t = 0),
            (e = br(e)).length - t < 10 || !wr(e, Eo, { offset: t })
                ? t
                : eo(
                      e,
                      (t += (function (e, t) {
                          void 0 === t && (t = 0)
                          var i = (e = br(e))[t + 5],
                              t = (e[t + 6] << 21) | (e[t + 7] << 14) | (e[t + 8] << 7) | e[t + 9]
                          return (16 & i) >> 4 ? 20 + t : 10 + t
                      })(e, t))
                  )
        )
    }
    function to(e) {
        return 'string' == typeof e ? Sr(e) : e
    }
    function io(e, t, i) {
        var n
        void 0 === i && (i = !1), (n = t), (t = Array.isArray(n) ? n.map(to) : [to(n)]), (e = br(e))
        var r = []
        if (!t.length) return r
        for (var a = 0; a < e.length; ) {
            var s = ((e[a] << 24) | (e[a + 1] << 16) | (e[a + 2] << 8) | e[a + 3]) >>> 0,
                o = e.subarray(a + 4, a + 8)
            if (0 == s) break
            var u = a + s
            if (u > e.length) {
                if (i) break
                u = e.length
            }
            s = e.subarray(a + 8, u)
            wr(o, t[0]) && (1 === t.length ? r.push(s) : r.push.apply(r, io(s, t.slice(1), i))), (a = u)
        }
        return r
    }
    function no(e, t, i, n) {
        void 0 === i && (i = !0), void 0 === n && (n = !1)
        var r = (function (e) {
                for (var t = 1, i = 0; i < Co.length && !(e & Co[i]); i++) t++
                return t
            })(e[t]),
            a = e.subarray(t, t + r)
        return (
            i && ((a = Array.prototype.slice.call(e, t, t + r))[0] ^= Co[r - 1]),
            {
                length: r,
                value: (function (n, e) {
                    var t = void 0 === e ? {} : e,
                        e = t.signed,
                        e = void 0 !== e && e,
                        t = t.le,
                        r = void 0 !== t && t
                    n = br(n)
                    ;(t = r ? 'reduce' : 'reduceRight'),
                        (t = (n[t] || Array.prototype[t]).call(
                            n,
                            function (e, t, i) {
                                i = r ? i : Math.abs(i + 1 - n.length)
                                return e + Rr(t) * Nr[i]
                            },
                            Rr(0)
                        ))
                    return !e || ((e = Nr[n.length] / Rr(2) - Rr(1)) < (t = Rr(t)) && ((t -= e), (t -= e), (t -= Rr(2)))), Number(t)
                })(a, { signed: n }),
                bytes: a,
            }
        )
    }
    function ro(e) {
        return 'string' == typeof e ? e.match(/.{1,2}/g).map(ro) : 'number' == typeof e ? Tr(e) : e
    }
    function ao(e, t, i) {
        if (i >= t.length) return t.length
        var n = no(t, i, !1)
        if (wr(e.bytes, n.bytes)) return i
        var r = no(t, i + n.length)
        return ao(e, t, i + r.length + r.value + n.length)
    }
    function so(e, t) {
        var i
        ;(i = t), (t = Array.isArray(i) ? i.map(ro) : [ro(i)]), (e = br(e))
        var n = []
        if (!t.length) return n
        for (var r = 0; r < e.length; ) {
            var a = no(e, r, !1),
                s = no(e, r + a.length),
                o = r + a.length + s.length
            127 === s.value && ((s.value = ao(a, e, o)), s.value !== e.length && (s.value -= o))
            var u = o + s.value > e.length ? e.length : o + s.value,
                u = e.subarray(o, u)
            wr(t[0], a.bytes) && (1 === t.length ? n.push(u) : (n = n.concat(so(u, t.slice(1))))), (r += a.length + s.length + u.length)
        }
        return n
    }
    function oo(e, t, i, n) {
        void 0 === n && (n = 1 / 0), (e = br(e)), (i = [].concat(i))
        for (var r, a = 0, s = 0; a < e.length && (s < n || r); ) {
            var o = void 0
            if ((wr(e.subarray(a), Io) ? (o = 4) : wr(e.subarray(a), xo) && (o = 3), o)) {
                if ((s++, r))
                    return (function (e) {
                        for (var t = [], i = 1; i < e.length - 2; ) wr(e.subarray(i, i + 3), Ao) && (t.push(i + 2), i++), i++
                        if (0 === t.length) return e
                        for (var n = e.length - t.length, r = new Uint8Array(n), a = 0, i = 0; i < n; a++, i++) a === t[0] && (a++, t.shift()), (r[i] = e[a])
                        return r
                    })(e.subarray(r, a))
                var u = void 0
                'h264' === t ? (u = 31 & e[a + o]) : 'h265' === t && (u = (e[a + o] >> 1) & 63), -1 !== i.indexOf(u) && (r = a + o), (a += o + ('h264' === t ? 1 : 2))
            } else a++
        }
        return e.subarray(0, 0)
    }
    var uo = { __DOMHandler: us, DOMParser: os, DOMImplementation: U.DOMImplementation, XMLSerializer: U.XMLSerializer }.DOMParser,
        lo = 'INVALID_NUMBER_OF_PERIOD',
        co = 'DASH_EMPTY_MANIFEST',
        ho = 'DASH_INVALID_XML',
        po = 'NO_BASE_URL',
        fo = 'SEGMENT_TIME_UNSPECIFIED',
        mo = 'UNSUPPORTED_UTC_TIMING_SCHEME',
        go = {
            static: function (e) {
                var t = e.duration,
                    i = e.timescale,
                    n = void 0 === i ? 1 : i,
                    r = e.sourceDuration,
                    i = e.periodDuration,
                    e = bs(e.endNumber),
                    n = t / n
                return 'number' == typeof e ? { start: 0, end: e } : 'number' == typeof i ? { start: 0, end: i / n } : { start: 0, end: r / n }
            },
            dynamic: function (e) {
                var t = e.NOW,
                    i = e.clientOffset,
                    n = e.availabilityStartTime,
                    r = e.timescale,
                    a = void 0 === r ? 1 : r,
                    s = e.duration,
                    o = e.periodStart,
                    u = void 0 === o ? 0 : o,
                    r = e.minimumUpdatePeriod,
                    o = void 0 === r ? 0 : r,
                    r = e.timeShiftBufferDepth,
                    r = void 0 === r ? 1 / 0 : r,
                    e = bs(e.endNumber),
                    i = (t + i) / 1e3,
                    u = n + u,
                    o = Math.ceil(((i + o - u) * a) / s),
                    r = Math.floor(((i - u - r) * a) / s),
                    s = Math.floor(((i - u) * a) / s)
                return { start: Math.max(0, r), end: 'number' == typeof e ? e : Math.min(o, s) }
            },
        },
        yo = ['AUDIO', 'SUBTITLES'],
        vo = /\$([A-z]*)(?:(%0)([0-9]+)d)?\$/g,
        _o = {
            mediaPresentationDuration: Gs,
            availabilityStartTime: function (e) {
                return /^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test((e = e)) && (e += 'Z'), Date.parse(e) / 1e3
            },
            minimumUpdatePeriod: Gs,
            suggestedPresentationDelay: Gs,
            type: function (e) {
                return e
            },
            timeShiftBufferDepth: Gs,
            start: Gs,
            width: function (e) {
                return parseInt(e, 10)
            },
            height: function (e) {
                return parseInt(e, 10)
            },
            bandwidth: function (e) {
                return parseInt(e, 10)
            },
            startNumber: function (e) {
                return parseInt(e, 10)
            },
            timescale: function (e) {
                return parseInt(e, 10)
            },
            presentationTimeOffset: function (e) {
                return parseInt(e, 10)
            },
            duration: function (e) {
                var t = parseInt(e, 10)
                return isNaN(t) ? Gs(e) : t
            },
            d: function (e) {
                return parseInt(e, 10)
            },
            t: function (e) {
                return parseInt(e, 10)
            },
            r: function (e) {
                return parseInt(e, 10)
            },
            DEFAULT: function (e) {
                return e
            },
        },
        bo = {
            'urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b': 'org.w3.clearkey',
            'urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed': 'com.widevine.alpha',
            'urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95': 'com.microsoft.playready',
            'urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb': 'com.adobe.primetime',
        },
        To = Math.pow(2, 32),
        So = function (e) {
            var t = new DataView(e.buffer, e.byteOffset, e.byteLength)
            return t.getBigUint64 ? ((e = t.getBigUint64(0)) < Number.MAX_SAFE_INTEGER ? Number(e) : e) : t.getUint32(0) * To + t.getUint32(4)
        },
        wo = function (e) {
            var t = new DataView(e.buffer, e.byteOffset, e.byteLength),
                i = { version: e[0], flags: new Uint8Array(e.subarray(1, 4)), references: [], referenceId: t.getUint32(4), timescale: t.getUint32(8) },
                n = 12
            0 === i.version
                ? ((i.earliestPresentationTime = t.getUint32(n)), (i.firstOffset = t.getUint32(n + 4)), (n += 8))
                : ((i.earliestPresentationTime = So(e.subarray(n))), (i.firstOffset = So(e.subarray(n + 8))), (n += 16))
            var r = t.getUint16((n += 2))
            for (n += 2; 0 < r; n += 12, r--)
                i.references.push({
                    referenceType: (128 & e[n]) >>> 7,
                    referencedSize: 2147483647 & t.getUint32(n),
                    subsegmentDuration: t.getUint32(n + 4),
                    startsWithSap: !!(128 & e[n + 8]),
                    sapType: (112 & e[n + 8]) >>> 4,
                    sapDeltaTime: 268435455 & t.getUint32(n + 8),
                })
            return i
        },
        Eo = br([73, 68, 51]),
        ko = {
            EBML: br([26, 69, 223, 163]),
            DocType: br([66, 130]),
            Segment: br([24, 83, 128, 103]),
            SegmentInfo: br([21, 73, 169, 102]),
            Tracks: br([22, 84, 174, 107]),
            Track: br([174]),
            TrackNumber: br([215]),
            DefaultDuration: br([35, 227, 131]),
            TrackEntry: br([174]),
            TrackType: br([131]),
            FlagDefault: br([136]),
            CodecID: br([134]),
            CodecPrivate: br([99, 162]),
            VideoTrack: br([224]),
            AudioTrack: br([225]),
            Cluster: br([31, 67, 182, 117]),
            Timestamp: br([231]),
            TimestampScale: br([42, 215, 177]),
            BlockGroup: br([160]),
            BlockDuration: br([155]),
            Block: br([161]),
            SimpleBlock: br([163]),
        },
        Co = [128, 64, 32, 16, 8, 4, 2, 1],
        Io = br([0, 0, 0, 1]),
        xo = br([0, 0, 1]),
        Ao = br([0, 0, 3]),
        Po = {
            webm: br([119, 101, 98, 109]),
            matroska: br([109, 97, 116, 114, 111, 115, 107, 97]),
            flac: br([102, 76, 97, 67]),
            ogg: br([79, 103, 103, 83]),
            ac3: br([11, 119]),
            riff: br([82, 73, 70, 70]),
            avi: br([65, 86, 73]),
            wav: br([87, 65, 86, 69]),
            '3gp': br([102, 116, 121, 112, 51, 103]),
            mp4: br([102, 116, 121, 112]),
            fmp4: br([115, 116, 121, 112]),
            mov: br([102, 116, 121, 112, 113, 116]),
            moov: br([109, 111, 111, 118]),
            moof: br([109, 111, 111, 102]),
        },
        Lo = {
            aac: function (e) {
                var t = eo(e)
                return wr(e, [255, 16], { offset: t, mask: [255, 22] })
            },
            mp3: function (e) {
                var t = eo(e)
                return wr(e, [255, 2], { offset: t, mask: [255, 6] })
            },
            webm: function (e) {
                e = so(e, [ko.EBML, ko.DocType])[0]
                return wr(e, Po.webm)
            },
            mkv: function (e) {
                e = so(e, [ko.EBML, ko.DocType])[0]
                return wr(e, Po.matroska)
            },
            mp4: function (e) {
                return (
                    !Lo['3gp'](e) && !Lo.mov(e) && (!(!wr(e, Po.mp4, { offset: 4 }) && !wr(e, Po.fmp4, { offset: 4 })) || !(!wr(e, Po.moof, { offset: 4 }) && !wr(e, Po.moov, { offset: 4 })) || void 0)
                )
            },
            mov: function (e) {
                return wr(e, Po.mov, { offset: 4 })
            },
            '3gp': function (e) {
                return wr(e, Po['3gp'], { offset: 4 })
            },
            ac3: function (e) {
                var t = eo(e)
                return wr(e, Po.ac3, { offset: t })
            },
            ts: function (e) {
                if (e.length < 189 && 1 <= e.length) return 71 === e[0]
                for (var t = 0; t + 188 < e.length && t < 188; ) {
                    if (71 === e[t] && 71 === e[t + 188]) return !0
                    t += 1
                }
                return !1
            },
            flac: function (e) {
                var t = eo(e)
                return wr(e, Po.flac, { offset: t })
            },
            ogg: function (e) {
                return wr(e, Po.ogg)
            },
            avi: function (e) {
                return wr(e, Po.riff) && wr(e, Po.avi, { offset: 8 })
            },
            wav: function (e) {
                return wr(e, Po.riff) && wr(e, Po.wav, { offset: 8 })
            },
            h264: function (e) {
                return oo(e, 'h264', 7, 3).length
            },
            h265: function (e) {
                return oo(e, 'h265', [32, 33], 3).length
            },
        },
        Do = Object.keys(Lo)
            .filter(function (e) {
                return 'ts' !== e && 'h264' !== e && 'h265' !== e
            })
            .concat(['ts', 'h264', 'h265'])
    Do.forEach(function (e) {
        var t = Lo[e]
        Lo[e] = function (e) {
            return t(br(e))
        }
    })
    function Oo(e) {
        e = br(e)
        for (var t = 0; t < Do.length; t++) {
            var i = Do[t]
            if (dl[i](e)) return i
        }
        return ''
    }
    function Mo(e, t, i) {
        return e && i && i.responseURL && t !== i.responseURL ? i.responseURL : t
    }
    function Ro(e) {
        return tr.log.debug ? tr.log.debug.bind(tr, 'VHS:', e + ' >') : function () {}
    }
    function No(e, t) {
        var i,
            n = []
        if (e && e.length) for (i = 0; i < e.length; i++) t(e.start(i), e.end(i)) && n.push([e.start(i), e.end(i)])
        return tr.createTimeRanges(n)
    }
    function Uo(e, i) {
        return No(e, function (e, t) {
            return e - 0.1 <= i && i <= t + 0.1
        })
    }
    function Bo(e, t) {
        return No(e, function (e) {
            return t <= e - fl
        })
    }
    function Fo(e) {
        var t = []
        if (!e || !e.length) return ''
        for (var i = 0; i < e.length; i++) t.push(e.start(i) + ' => ' + e.end(i))
        return t.join(', ')
    }
    function jo(e) {
        for (var t = [], i = 0; i < e.length; i++) t.push({ start: e.start(i), end: e.end(i) })
        return t
    }
    function Ho(e) {
        if (e && e.length && e.end) return e.end(e.length - 1)
    }
    function qo(e, t) {
        var i = 0
        if (!e || !e.length) return i
        for (var n = 0; n < e.length; n++) {
            var r = e.start(n),
                a = e.end(n)
            a < t || (i += r < t && t <= a ? a - t : a - r)
        }
        return i
    }
    function Vo(t, e) {
        if (!e.preload) return e.duration
        var i = 0
        return (
            (e.parts || []).forEach(function (e) {
                i += e.duration
            }),
            (e.preloadHints || []).forEach(function (e) {
                'PART' === e.type && (i += t.partTargetDuration)
            }),
            i
        )
    }
    function Wo(e) {
        return (e.segments || []).reduce(function (i, n, r) {
            return (
                n.parts
                    ? n.parts.forEach(function (e, t) {
                          i.push({ duration: e.duration, segmentIndex: r, partIndex: t, part: e, segment: n })
                      })
                    : i.push({ duration: n.duration, segmentIndex: r, partIndex: null, segment: n, part: null }),
                i
            )
        }, [])
    }
    function Go(e) {
        return ((e = e.segments && e.segments.length && e.segments[e.segments.length - 1]) && e.parts) || []
    }
    function zo(e) {
        var t = e.preloadSegment
        if (t) {
            ;(e = t.parts),
                (t = (t.preloadHints || []).reduce(function (e, t) {
                    return e + ('PART' === t.type ? 1 : 0)
                }, 0))
            return (t += e && e.length ? e.length : 0)
        }
    }
    function Xo(e, t) {
        return t.endList
            ? 0
            : e && e.suggestedPresentationDelay
            ? e.suggestedPresentationDelay
            : (e = 0 < Go(t).length) && t.serverControl && t.serverControl.partHoldBack
            ? t.serverControl.partHoldBack
            : e && t.partTargetDuration
            ? 3 * t.partTargetDuration
            : t.serverControl && t.serverControl.holdBack
            ? t.serverControl.holdBack
            : t.targetDuration
            ? 3 * t.targetDuration
            : 0
    }
    function Ko(e, t, i) {
        if ((t = 'undefined' == typeof t ? e.mediaSequence + e.segments.length : t) < e.mediaSequence) return 0
        var n = (function (e, t) {
            var i = 0,
                n = t - e.mediaSequence,
                r = e.segments[n]
            if (r) {
                if ('undefined' != typeof r.start) return { result: r.start, precise: !0 }
                if ('undefined' != typeof r.end) return { result: r.end - r.duration, precise: !0 }
            }
            for (; n--; ) {
                if ('undefined' != typeof (r = e.segments[n]).end) return { result: i + r.end, precise: !0 }
                if (((i += Vo(e, r)), 'undefined' != typeof r.start)) return { result: i + r.start, precise: !0 }
            }
            return { result: i, precise: !1 }
        })(e, t)
        return n.precise
            ? n.result
            : (t = (function (e, t) {
                  for (var i, n = 0, r = t - e.mediaSequence; r < e.segments.length; r++) {
                      if ('undefined' != typeof (i = e.segments[r]).start) return { result: i.start - n, precise: !0 }
                      if (((n += Vo(e, i)), 'undefined' != typeof i.end)) return { result: i.end - n, precise: !0 }
                  }
                  return { result: -1, precise: !1 }
              })(e, t)).precise
            ? t.result
            : n.result + i
    }
    function Yo(e, t, i) {
        if (!e) return 0
        if (('number' != typeof i && (i = 0), 'undefined' == typeof t)) {
            if (e.totalDuration) return e.totalDuration
            if (!e.endList) return window.Infinity
        }
        return Ko(e, t, i)
    }
    function Qo(e) {
        var t = e.defaultDuration,
            i = e.durationList,
            n = e.startIndex,
            r = e.endIndex,
            a = 0
        if ((r < n && ((n = (e = [r, n])[0]), (r = e[1])), n < 0)) {
            for (var s = n; s < Math.min(0, r); s++) a += t
            n = 0
        }
        for (var o = n; o < r; o++) a += i[o].duration
        return a
    }
    function $o(e, t, i, n) {
        return e && e.segments
            ? e.endList
                ? Yo(e)
                : null === t
                ? null
                : ((t = Ko(e, e.mediaSequence + e.segments.length, (t = t || 0))), i && (t -= n = 'number' == typeof n ? n : Xo(null, e)), Math.max(0, t))
            : null
    }
    function Jo(e) {
        return e.excludeUntil && e.excludeUntil > Date.now()
    }
    function Zo(e) {
        return e.excludeUntil && e.excludeUntil === 1 / 0
    }
    function eu(e) {
        var t = Jo(e)
        return !e.disabled && !t
    }
    function tu(e, t) {
        return t.attributes && t.attributes[e]
    }
    function iu(e, t) {
        if (1 === e.playlists.length) return !0
        var i = t.attributes.BANDWIDTH || Number.MAX_VALUE
        return (
            0 ===
            e.playlists.filter(function (e) {
                return !!eu(e) && (e.attributes.BANDWIDTH || 0) < i
            }).length
        )
    }
    function nu(e, t) {
        return (
            !((!e && !t) || (!e && t) || (e && !t)) &&
            (e === t || !(!e.id || !t.id || e.id !== t.id) || !(!e.resolvedUri || !t.resolvedUri || e.resolvedUri !== t.resolvedUri) || !(!e.uri || !t.uri || e.uri !== t.uri))
        )
    }
    function ru(e, t) {
        var i,
            n = (e && e.mediaGroups && e.mediaGroups.AUDIO) || {},
            r = !1
        for (i in n) {
            for (var a in n[i]) if ((r = t(n[i][a]))) break
            if (r) break
        }
        return !!r
    }
    function au(i) {
        if (!i || !i.playlists || !i.playlists.length)
            return ru(i, function (e) {
                return (e.playlists && e.playlists.length) || e.uri
            })
        for (var e = 0; e < i.playlists.length; e++) {
            var t = (function (e) {
                var t = i.playlists[e],
                    e = t.attributes && t.attributes.CODECS
                return (e && e.split(',').every(fr)) ||
                    ru(i, function (e) {
                        return nu(t, e)
                    })
                    ? 'continue'
                    : { v: !1 }
            })(e)
            if ('continue' !== t && 'object' == typeof t) return t.v
        }
        return !0
    }
    function su(e, t) {
        return e + '-' + t
    }
    function ou(r, a) {
        r.mediaGroups &&
            ['AUDIO', 'SUBTITLES'].forEach(function (e) {
                if (r.mediaGroups[e])
                    for (var t in r.mediaGroups[e])
                        for (var i in r.mediaGroups[e][t]) {
                            var n = r.mediaGroups[e][t][i]
                            a(n, e, t, i)
                        }
            })
    }
    function uu(e) {
        var t = e.playlist,
            i = e.uri,
            e = e.id
        ;(t.id = e), (t.playlistErrors_ = 0), i && (t.uri = i), (t.attributes = t.attributes || {})
    }
    function lu(o, e) {
        o.uri = e
        for (var t = 0; t < o.playlists.length; t++) o.playlists[t].uri || (o.playlists[t].uri = 'placeholder-uri-' + t)
        var i,
            u = au(o)
        ou(o, function (e, t, i, n) {
            var r = 'placeholder-uri-' + t + '-' + i + '-' + n
            if (!e.playlists || !e.playlists.length) {
                if (u && 'AUDIO' === t && !e.uri)
                    for (var a = 0; a < o.playlists.length; a++) {
                        var s = o.playlists[a]
                        if (s.attributes && s.attributes.AUDIO && s.attributes.AUDIO === i) return
                    }
                e.playlists = [g({}, e)]
            }
            e.playlists.forEach(function (e, t) {
                var i = su(t, r)
                e.uri ? (e.resolvedUri = e.resolvedUri || pl(o.uri, e.uri)) : ((e.uri = 0 === t ? r : i), (e.resolvedUri = e.uri)),
                    (e.id = e.id || i),
                    (e.attributes = e.attributes || {}),
                    (o.playlists[e.id] = e),
                    (o.playlists[e.uri] = e)
            })
        }),
            (function (e) {
                for (var t = e.playlists.length; t--; ) {
                    var i = e.playlists[t]
                    uu({ playlist: i, id: su(t, i.uri) }),
                        (i.resolvedUri = pl(e.uri, i.uri)),
                        (e.playlists[i.id] = i),
                        (e.playlists[i.uri] = i).attributes.BANDWIDTH || yl.warn('Invalid playlist STREAM-INF detected. Missing BANDWIDTH attribute.')
                }
            })(o),
            ou((i = o), function (e) {
                e.uri && (e.resolvedUri = pl(i.uri, e.uri))
            })
    }
    function cu(e, t, i) {
        var n = e.slice(),
            r = t.slice()
        i = i || 0
        for (var a, s = [], o = 0; o < r.length; o++) {
            var u = n[o + i],
                l = r[o]
            u
                ? ((a = u.map || a),
                  s.push(
                      (function (e, t) {
                          if (!e) return t
                          var i = vl(e, t)
                          if ((e.preloadHints && !t.preloadHints && delete i.preloadHints, e.parts && !t.parts)) delete i.parts
                          else if (e.parts && t.parts) for (var n = 0; n < t.parts.length; n++) e.parts && e.parts[n] && (i.parts[n] = vl(e.parts[n], t.parts[n]))
                          return !e.skipped && t.skipped && (i.skipped = !1), e.preload && !t.preload && (i.preload = !1), i
                      })(u, l)
                  ))
                : (a && !l.map && (l.map = a), s.push(l))
        }
        return s
    }
    function du(e, t) {
        !e.resolvedUri && e.uri && (e.resolvedUri = pl(t, e.uri)),
            e.key && !e.key.resolvedUri && (e.key.resolvedUri = pl(t, e.key.uri)),
            e.map && !e.map.resolvedUri && (e.map.resolvedUri = pl(t, e.map.uri)),
            e.map && e.map.key && !e.map.key.resolvedUri && (e.map.key.resolvedUri = pl(t, e.map.key.uri)),
            e.parts &&
                e.parts.length &&
                e.parts.forEach(function (e) {
                    e.resolvedUri || (e.resolvedUri = pl(t, e.uri))
                }),
            e.preloadHints &&
                e.preloadHints.length &&
                e.preloadHints.forEach(function (e) {
                    e.resolvedUri || (e.resolvedUri = pl(t, e.uri))
                })
    }
    function hu(e) {
        var t = e.segments || [],
            i = e.preloadSegment
        if (i && i.parts && i.parts.length) {
            if (i.preloadHints) for (var n = 0; n < i.preloadHints.length; n++) if ('MAP' === i.preloadHints[n].type) return t
            ;(i.duration = e.targetDuration), (i.preload = !0), t.push(i)
        }
        return t
    }
    function pu(e, t) {
        return (
            e === t || (e.segments && t.segments && e.segments.length === t.segments.length && e.endList === t.endList && e.mediaSequence === t.mediaSequence && e.preloadSegment === t.preloadSegment)
        )
    }
    function fu(e, a, t) {
        void 0 === t && (t = pu)
        var i = vl(e, {}),
            n = i.playlists[a.id]
        if (!n) return null
        if (t(n, a)) return null
        a.segments = hu(a)
        var s = vl(n, a)
        if ((s.preloadSegment && !a.preloadSegment && delete s.preloadSegment, n.segments)) {
            if (a.skip) {
                a.segments = a.segments || []
                for (var r = 0; r < a.skip.skippedSegments; r++) a.segments.unshift({ skipped: !0 })
            }
            s.segments = cu(n.segments, a.segments, a.mediaSequence - n.mediaSequence)
        }
        s.segments.forEach(function (e) {
            du(e, s.resolvedUri)
        })
        for (var o = 0; o < i.playlists.length; o++) i.playlists[o].id === a.id && (i.playlists[o] = s)
        return (
            (i.playlists[a.id] = s),
            (i.playlists[a.uri] = s),
            ou(e, function (e, t, i, n) {
                if (e.playlists) for (var r = 0; r < e.playlists.length; r++) a.id === e.playlists[r].id && (e.playlists[r] = s)
            }),
            i
        )
    }
    function mu(e, t) {
        var i = e.segments || [],
            n = i[i.length - 1],
            n = ((i = n && n.parts && n.parts[n.parts.length - 1]) && i.duration) || (n && n.duration)
        return t && n ? 1e3 * n : 500 * (e.partTargetDuration || e.targetDuration || 10)
    }
    function gu(e, t, i, n) {
        var r = 'arraybuffer' === e.responseType ? e.response : e.responseText
        !t &&
            r &&
            ((e.responseTime = Date.now()),
            (e.roundTripTime = e.responseTime - e.requestTime),
            (e.bytesReceived = r.byteLength || r.length),
            e.bandwidth || (e.bandwidth = Math.floor((e.bytesReceived / e.roundTripTime) * 8 * 1e3))),
            i.headers && (e.responseHeaders = i.headers),
            t && 'ETIMEDOUT' === t.code && (e.timedout = !0),
            n((t = !t && !e.aborted && 200 !== i.statusCode && 206 !== i.statusCode && 0 !== i.statusCode ? new Error('XHR Failed with a response of: ' + (e && (r || e.responseText))) : t), e)
    }
    function yu() {
        function a(e, i) {
            e = Tl({ timeout: 45e3 }, e)
            var t = a.beforeRequest || tr.Vhs.xhr.beforeRequest
            !t || 'function' != typeof t || ((t = t(e)) && (e = t))
            var n = (!0 === tr.Vhs.xhr.original ? bl : tr.Vhs.xhr)(e, function (e, t) {
                    return gu(n, e, t, i)
                }),
                r = n.abort
            return (
                (n.abort = function () {
                    return (n.aborted = !0), r.apply(n, arguments)
                }),
                (n.uri = e.uri),
                (n.requestTime = Date.now()),
                n
            )
        }
        return (a.original = !0), a
    }
    function vu(e) {
        var t,
            i = {}
        return (
            e.byterange &&
                (i.Range =
                    ((t = e.byterange),
                    (e = t.offset),
                    (t = 'bigint' == typeof t.offset || 'bigint' == typeof t.length ? window.BigInt(t.offset) + window.BigInt(t.length) - window.BigInt(1) : t.offset + t.length - 1),
                    'bytes=' + e + '-' + t)),
            i
        )
    }
    function _u(e, t) {
        return (e = e.toString(16)), '00'.substring(0, 2 - e.length) + e + (t % 2 ? ' ' : '')
    }
    function bu(e) {
        return 32 <= e && e < 126 ? String.fromCharCode(e) : '.'
    }
    function Tu(i) {
        var n = {}
        return (
            Object.keys(i).forEach(function (e) {
                var t = i[e]
                _r(t) ? (n[e] = { bytes: t.buffer, byteOffset: t.byteOffset, byteLength: t.byteLength }) : (n[e] = t)
            }),
            n
        )
    }
    function Su(e) {
        var t = e.byterange || { length: 1 / 0, offset: 0 }
        return [t.length, t.offset, e.resolvedUri].join(',')
    }
    function wu(e) {
        return e.resolvedUri
    }
    function Eu(e) {
        for (var t = Array.prototype.slice.call(e), i = '', n = 0; n < t.length / 16; n++)
            i +=
                t
                    .slice(16 * n, 16 * n + 16)
                    .map(_u)
                    .join('') +
                ' ' +
                t
                    .slice(16 * n, 16 * n + 16)
                    .map(bu)
                    .join('') +
                '\n'
        return i
    }
    function ku(e) {
        var t = e.playlist,
            i = e.time,
            n = void 0 === i ? void 0 : i
        if (!(i = e.callback)) throw new Error('getProgramTime: callback must be provided')
        return t && void 0 !== n
            ? (e = (function (e, t) {
                  if (!t || !t.segments || 0 === t.segments.length) return null
                  for (var i, n = 0, r = 0; r < t.segments.length && !(e <= (n = (i = t.segments[r]).videoTimingInfo ? i.videoTimingInfo.transmuxedPresentationEnd : n + i.duration)); r++);
                  var a = t.segments[t.segments.length - 1]
                  if (a.videoTimingInfo && a.videoTimingInfo.transmuxedPresentationEnd < e) return null
                  if (n < e) {
                      if (e > n + 0.25 * a.duration) return null
                      i = a
                  }
                  return { segment: i, estimatedStart: i.videoTimingInfo ? i.videoTimingInfo.transmuxedPresentationStart : n - i.duration, type: i.videoTimingInfo ? 'accurate' : 'estimate' }
              })(n, t))
                ? 'estimate' === e.type
                    ? i({ message: 'Accurate programTime could not be determined. Please seek to e.seekTime and try again', seekTime: e.estimatedStart })
                    : ((t = { mediaSeconds: n }),
                      (e = (function (e, t) {
                          if (!t.dateTimeObject) return null
                          var i = t.videoTimingInfo.transmuxerPrependedSeconds,
                              i = e - (t.videoTimingInfo.transmuxedPresentationStart + i)
                          return new Date(t.dateTimeObject.getTime() + 1e3 * i)
                      })(n, e.segment)) && (t.programDateTime = e.toISOString()),
                      i(null, t))
                : i({ message: 'valid programTime was not found' })
            : i({ message: 'getProgramTime: playlist and time must be provided' })
    }
    function Cu(e) {
        var t = e.programTime,
            i = e.playlist,
            n = e.retryCount,
            r = void 0 === n ? 2 : n,
            a = e.seekTo,
            s = e.pauseAfterSeek,
            o = void 0 === s || s,
            u = e.tech,
            l = e.callback
        if (!l) throw new Error('seekToProgramTime: callback must be provided')
        return 'undefined' != typeof t && i && a
            ? i.endList || u.hasStarted_
                ? (function (e) {
                      if (!e.segments || 0 === e.segments.length) return !1
                      for (var t = 0; t < e.segments.length; t++) if (!e.segments[t].dateTimeObject) return !1
                      return !0
                  })(i)
                    ? (n = (function (e, t) {
                          var i
                          try {
                              i = new Date(e)
                          } catch (e) {
                              return null
                          }
                          if (!t || !t.segments || 0 === t.segments.length) return null
                          if (i < (r = t.segments[0]).dateTimeObject) return null
                          for (var n = 0; n < t.segments.length - 1; n++) {
                              var r = t.segments[n]
                              if (i < t.segments[n + 1].dateTimeObject) break
                          }
                          var a,
                              s = t.segments[t.segments.length - 1],
                              e = s.dateTimeObject,
                              a = s.videoTimingInfo ? (a = s.videoTimingInfo).transmuxedPresentationEnd - a.transmuxedPresentationStart - a.transmuxerPrependedSeconds : s.duration + 0.25 * s.duration
                          return new Date(e.getTime() + 1e3 * a) < i
                              ? null
                              : {
                                    segment: (r = e < i ? s : r),
                                    estimatedStart: r.videoTimingInfo ? r.videoTimingInfo.transmuxedPresentationStart : gl.duration(t, t.mediaSequence + t.segments.indexOf(r)),
                                    type: r.videoTimingInfo ? 'accurate' : 'estimate',
                                }
                      })(t, i))
                        ? ((s = n.segment),
                          (e = (function (e, t) {
                              var i
                              try {
                                  ;(n = new Date(e)), (i = new Date(t))
                              } catch (e) {}
                              var n = n.getTime()
                              return (i.getTime() - n) / 1e3
                          })(s.dateTimeObject, t)),
                          'estimate' === n.type
                              ? 0 === r
                                  ? l({ message: t + ' is not buffered yet. Try again' })
                                  : (a(n.estimatedStart + e),
                                    void u.one('seeked', function () {
                                        Cu({ programTime: t, playlist: i, retryCount: r - 1, seekTo: a, pauseAfterSeek: o, tech: u, callback: l })
                                    }))
                              : ((e = s.start + e),
                                u.one('seeked', function () {
                                    return l(null, u.currentTime())
                                }),
                                o && u.pause(),
                                void a(e)))
                        : l({ message: t + ' was not found in the stream' })
                    : l({ message: 'programDateTime tags must be provided in the manifest ' + i.resolvedUri })
                : l({ message: 'player must be playing a live stream to start buffering' })
            : l({ message: 'seekToProgramTime: programTime, seekTo and playlist must be provided' })
    }
    function Iu(e, t) {
        if (4 === e.readyState) return t()
    }
    function xu(e, t, r) {
        function n(e, t, i, n) {
            return t.abort(), (o = !0), r(e, t, i, n)
        }
        function i(e, t) {
            if (!o) {
                if (e) return n(e, t, '', s)
                var i = t.responseText.substring((s && s.byteLength) || 0, t.responseText.length)
                if (
                    ((s = (function () {
                        for (var e = arguments.length, t = new Array(e), i = 0; i < e; i++) t[i] = arguments[i]
                        if (
                            (t = t.filter(function (e) {
                                return e && (e.byteLength || e.length) && 'string' != typeof e
                            })).length <= 1
                        )
                            return br(t[0])
                        var n = t.reduce(function (e, t, i) {
                                return e + (t.byteLength || t.length)
                            }, 0),
                            r = new Uint8Array(n),
                            a = 0
                        return (
                            t.forEach(function (e) {
                                ;(e = br(e)), r.set(e, a), (a += e.byteLength)
                            }),
                            r
                        )
                    })(s, Sr(i, !0))),
                    (a = a || eo(s)),
                    s.length < 10 || (a && s.length < a + 2))
                )
                    return Iu(t, function () {
                        return n(e, t, '', s)
                    })
                i = Oo(s)
                return ('ts' === i && s.length < 188) || (!i && s.length < 376)
                    ? Iu(t, function () {
                          return n(e, t, '', s)
                      })
                    : n(null, t, i, s)
            }
        }
        var a,
            s = [],
            o = !1,
            u = t(
                {
                    uri: e,
                    beforeSend: function (t) {
                        t.overrideMimeType('text/plain; charset=x-user-defined'),
                            t.addEventListener('progress', function (e) {
                                return e.total, e.loaded, gu(t, null, { statusCode: t.status }, i)
                            })
                    },
                },
                function (e, t) {
                    return gu(u, e, t, i)
                }
            )
        return u
    }
    function Au(e, t) {
        if (!pu(e, t)) return !1
        if (e.sidx && t.sidx && (e.sidx.offset !== t.sidx.offset || e.sidx.length !== t.sidx.length)) return !1
        if ((!e.sidx && t.sidx) || (e.sidx && !t.sidx)) return !1
        if ((e.segments && !t.segments) || (!e.segments && t.segments)) return !1
        if (!e.segments && !t.segments) return !0
        for (var i = 0; i < e.segments.length; i++) {
            var n = e.segments[i],
                r = t.segments[i]
            if (n.uri !== r.uri) return !1
            if (n.byterange || r.byterange) {
                ;(n = n.byterange), (r = r.byterange)
                if ((n && !r) || (!n && r)) return !1
                if (n.offset !== r.offset || n.length !== r.length) return !1
            }
        }
        return !0
    }
    function Pu(e, t) {
        var i,
            n = {}
        for (i in e) {
            var r = e[i].sidx
            if (r) {
                var a = xs(r)
                if (!t[a]) break
                var s = t[a].sidxInfo
                ;(s = s),
                    (r = r),
                    (Boolean(!s.map && !r.map) || Boolean(s.map && r.map && s.map.byterange.offset === r.map.byterange.offset && s.map.byterange.length === r.map.byterange.length)) &&
                        s.uri === r.uri &&
                        s.byterange.offset === r.byterange.offset &&
                        s.byterange.length === r.byterange.length &&
                        (n[a] = t[a])
            }
        }
        return n
    }
    function Lu(e) {
        return (e.on = e.addEventListener), (e.off = e.removeEventListener), e
    }
    function Du(i) {
        var n = i.transmuxer,
            e = i.bytes,
            t = i.audioAppendStart,
            r = i.gopsToAlignWith,
            a = i.remux,
            s = i.onData,
            o = i.onTrackInfo,
            u = i.onAudioTimingInfo,
            l = i.onVideoTimingInfo,
            c = i.onVideoSegmentTimingInfo,
            d = i.onAudioSegmentTimingInfo,
            h = i.onId3,
            p = i.onCaptions,
            f = i.onDone,
            m = i.onEndedTimeline,
            g = i.onTransmuxerLog,
            y = i.isEndOfTimeline,
            v = { buffer: [] },
            _ = y
        ;(n.onmessage = function (e) {
            var t
            n.currentTransmux === i &&
                ('data' === e.data.action &&
                    (function (e, t, i) {
                        var n = e.data.segment,
                            r = n.type,
                            a = n.initSegment,
                            s = n.captions,
                            o = n.captionStreams,
                            u = n.metadata,
                            l = n.videoFrameDtsTime,
                            n = n.videoFramePtsTime
                        t.buffer.push({ captions: s, captionStreams: o, metadata: u })
                        ;(e = e.data.segment.boxes || { data: e.data.segment.data }),
                            (a = { type: r, data: new Uint8Array(e.data, e.data.byteOffset, e.data.byteLength), initSegment: new Uint8Array(a.data, a.byteOffset, a.byteLength) })
                        'undefined' != typeof l && (a.videoFrameDtsTime = l), 'undefined' != typeof n && (a.videoFramePtsTime = n), i(a)
                    })(e, v, s),
                'trackinfo' === e.data.action && o(e.data.trackInfo),
                'gopInfo' === e.data.action && (v.gopInfo = e.data.gopInfo),
                'audioTimingInfo' === e.data.action && u(e.data.audioTimingInfo),
                'videoTimingInfo' === e.data.action && l(e.data.videoTimingInfo),
                'videoSegmentTimingInfo' === e.data.action && c(e.data.videoSegmentTimingInfo),
                'audioSegmentTimingInfo' === e.data.action && d(e.data.audioSegmentTimingInfo),
                'id3Frame' === e.data.action && h([e.data.id3Frame], e.data.id3Frame.dispatchType),
                'caption' === e.data.action && p(e.data.caption),
                'endedtimeline' === e.data.action && ((_ = !1), m()),
                'log' === e.data.action && g(e.data.log),
                'transmuxed' === e.data.type && (_ || ((n.onmessage = null), (e = (t = { transmuxedData: v, callback: f }).transmuxedData), (t = t.callback), (e.buffer = []), t(e), Cl(n))))
        }),
            t && n.postMessage({ action: 'setAudioAppendStart', appendStart: t }),
            Array.isArray(r) && n.postMessage({ action: 'alignGopsWith', gopsToAlignWith: r }),
            'undefined' != typeof a && n.postMessage({ action: 'setRemux', remux: a }),
            e.byteLength &&
                ((r = e instanceof ArrayBuffer ? e : e.buffer),
                (a = e instanceof ArrayBuffer ? 0 : e.byteOffset),
                n.postMessage({ action: 'push', data: r, byteOffset: a, byteLength: e.byteLength }, [r])),
            y && n.postMessage({ action: 'endTimeline' }),
            n.postMessage({ action: 'flush' })
    }
    function Ou(e, t) {
        e.postMessage({ action: t }), Cl(e)
    }
    function Mu(e, t) {
        if (!t.currentTransmux) return (t.currentTransmux = e), Ou(t, e), 0
        t.transmuxQueue.push(Ou.bind(null, t, e))
    }
    function Ru(e) {
        if (!e.transmuxer.currentTransmux) return (e.transmuxer.currentTransmux = e), void Du(e)
        e.transmuxer.transmuxQueue.push(e)
    }
    function Nu(i) {
        var n = i.transmuxer,
            r = i.endAction || i.action,
            a = i.callback,
            e = g({}, i, { endAction: null, transmuxer: null, callback: null }),
            t = function e(t) {
                t.data.action === r &&
                    (n.removeEventListener('message', e),
                    t.data.data && ((t.data.data = new Uint8Array(t.data.data, i.byteOffset || 0, i.byteLength || t.data.data.byteLength)), i.data && (i.data = t.data.data)),
                    a(t.data))
            }
        n.addEventListener('message', t),
            i.data
                ? ((t = i.data instanceof ArrayBuffer), (e.byteOffset = t ? 0 : i.data.byteOffset), (e.byteLength = i.data.byteLength), (t = [t ? i.data : i.data.buffer]), n.postMessage(e, t))
                : n.postMessage(e)
    }
    function Uu(e) {
        e.forEach(function (e) {
            e.abort()
        })
    }
    function Bu(e, t) {
        return t.timedout
            ? { status: t.status, message: 'HLS request timed-out at URL: ' + t.uri, code: Pl, xhr: t }
            : t.aborted
            ? { status: t.status, message: 'HLS request aborted at URL: ' + t.uri, code: Ll, xhr: t }
            : e
            ? { status: t.status, message: 'HLS request errored at URL: ' + t.uri, code: Al, xhr: t }
            : 'arraybuffer' === t.responseType && 0 === t.response.byteLength
            ? { status: t.status, message: 'Empty HLS response at URL: ' + t.uri, code: Al, xhr: t }
            : null
    }
    function Fu(a, s, o) {
        return function (e, t) {
            var i = t.response,
                e = Bu(e, t)
            if (e) return o(e, a)
            if (16 !== i.byteLength) return o({ status: t.status, message: 'Invalid HLS key at URL: ' + t.uri, code: Al, xhr: t }, a)
            for (var i = new DataView(i), n = new Uint32Array([i.getUint32(0), i.getUint32(4), i.getUint32(8), i.getUint32(12)]), r = 0; r < s.length; r++) s[r].bytes = n
            return o(null, a)
        }
    }
    function ju(i, n) {
        var e = Oo(i.map.bytes)
        if ('mp4' !== e) {
            var t = i.map.resolvedUri || i.map.uri
            return n({ internal: !0, message: 'Found unsupported ' + (e || 'unknown') + ' container for initialization segment at URL: ' + t, code: Al })
        }
        Nu({
            action: 'probeMp4Tracks',
            data: i.map.bytes,
            transmuxer: i.transmuxer,
            callback: function (e) {
                var t = e.tracks,
                    e = e.data
                return (
                    (i.map.bytes = e),
                    t.forEach(function (e) {
                        ;(i.map.tracks = i.map.tracks || {}),
                            i.map.tracks[e.type] ||
                                ('number' == typeof (i.map.tracks[e.type] = e).id && e.timescale && ((i.map.timescales = i.map.timescales || {}), (i.map.timescales[e.id] = e.timescale)))
                    }),
                    n(null)
                )
            },
        })
    }
    function Hu(e) {
        var i = e.segment,
            n = e.finishProcessingFn,
            r = e.responseType
        return function (e, t) {
            e = Bu(e, t)
            if (e) return n(e, i)
            e =
                'arraybuffer' !== r && t.responseText
                    ? (function (e) {
                          for (var t = new Uint8Array(new ArrayBuffer(e.length)), i = 0; i < e.length; i++) t[i] = e.charCodeAt(i)
                          return t.buffer
                      })(t.responseText.substring(i.lastReachedChar || 0))
                    : t.response
            return (
                (i.stats = { bandwidth: (t = t).bandwidth, bytesReceived: t.bytesReceived || 0, roundTripTime: t.roundTripTime || 0 }),
                i.key ? (i.encryptedBytes = new Uint8Array(e)) : (i.bytes = new Uint8Array(e)),
                n(null, i)
            )
        }
    }
    function qu(e) {
        var i = e.segment,
            t = e.bytes,
            n = e.trackInfoFn,
            r = e.timingInfoFn,
            a = e.videoSegmentTimingInfoFn,
            s = e.audioSegmentTimingInfoFn,
            o = e.id3Fn,
            u = e.captionsFn,
            l = e.isEndOfTimeline,
            c = e.endedTimelineFn,
            d = e.dataFn,
            h = e.doneFn,
            p = e.onTransmuxerLog,
            e = (i.map && i.map.tracks) || {},
            f = Boolean(e.audio && e.video),
            m = r.bind(null, i, 'audio', 'start'),
            g = r.bind(null, i, 'audio', 'end'),
            y = r.bind(null, i, 'video', 'start'),
            v = r.bind(null, i, 'video', 'end')
        Nu({
            action: 'probeTs',
            transmuxer: i.transmuxer,
            data: t,
            baseStartTime: i.baseStartTime,
            callback: function (e) {
                i.bytes = t = e.data
                e = e.result
                e && (n(i, { hasAudio: e.hasAudio, hasVideo: e.hasVideo, isMuxed: f }), (n = null), e.hasAudio && !f && m(e.audioStart), e.hasVideo && y(e.videoStart), (y = m = null)),
                    Ru({
                        bytes: t,
                        transmuxer: i.transmuxer,
                        audioAppendStart: i.audioAppendStart,
                        gopsToAlignWith: i.gopsToAlignWith,
                        remux: f,
                        onData: function (e) {
                            ;(e.type = 'combined' === e.type ? 'video' : e.type), d(i, e)
                        },
                        onTrackInfo: function (e) {
                            n && (f && (e.isMuxed = !0), n(i, e))
                        },
                        onAudioTimingInfo: function (e) {
                            m && 'undefined' != typeof e.start && (m(e.start), (m = null)), g && 'undefined' != typeof e.end && g(e.end)
                        },
                        onVideoTimingInfo: function (e) {
                            y && 'undefined' != typeof e.start && (y(e.start), (y = null)), v && 'undefined' != typeof e.end && v(e.end)
                        },
                        onVideoSegmentTimingInfo: function (e) {
                            a(e)
                        },
                        onAudioSegmentTimingInfo: function (e) {
                            s(e)
                        },
                        onId3: function (e, t) {
                            o(i, e, t)
                        },
                        onCaptions: function (e) {
                            u(i, [e])
                        },
                        isEndOfTimeline: l,
                        onEndedTimeline: function () {
                            c()
                        },
                        onTransmuxerLog: p,
                        onDone: function (e) {
                            h && ((e.type = 'combined' === e.type ? 'video' : e.type), h(null, i, e))
                        },
                    })
            },
        })
    }
    function Vu(e) {
        var i = e.segment,
            n = e.bytes,
            t = e.trackInfoFn,
            r = e.timingInfoFn,
            a = e.videoSegmentTimingInfoFn,
            s = e.audioSegmentTimingInfoFn,
            o = e.id3Fn,
            u = e.captionsFn,
            l = e.isEndOfTimeline,
            c = e.endedTimelineFn,
            d = e.dataFn,
            h = e.doneFn,
            p = e.onTransmuxerLog,
            f = new Uint8Array(n)
        if (0 < io(f, ['moof']).length) {
            i.isFmp4 = !0
            var m = i.map.tracks,
                g = { isFmp4: !0, hasVideo: !!m.video, hasAudio: !!m.audio }
            m.audio && m.audio.codec && 'enca' !== m.audio.codec && (g.audioCodec = m.audio.codec),
                m.video && m.video.codec && 'encv' !== m.video.codec && (g.videoCodec = m.video.codec),
                m.video && m.audio && (g.isMuxed = !0),
                t(i, g)
            var y = function (e) {
                d(i, { data: f, type: g.hasAudio && !g.isMuxed ? 'audio' : 'video' }), e && e.length && u(i, e), h(null, i, {})
            }
            Nu({
                action: 'probeMp4StartTime',
                timescales: i.map.timescales,
                data: f,
                transmuxer: i.transmuxer,
                callback: function (e) {
                    var t = e.data,
                        e = e.startTime
                    ;(n = t.buffer),
                        (i.bytes = f = t),
                        g.hasAudio && !g.isMuxed && r(i, 'audio', 'start', e),
                        g.hasVideo && r(i, 'video', 'start', e),
                        m.video && t.byteLength && i.transmuxer
                            ? Nu({
                                  action: 'pushMp4Captions',
                                  endAction: 'mp4Captions',
                                  transmuxer: i.transmuxer,
                                  data: f,
                                  timescales: i.map.timescales,
                                  trackIds: [m.video.id],
                                  callback: function (e) {
                                      ;(n = e.data.buffer),
                                          (i.bytes = f = e.data),
                                          e.logs.forEach(function (e) {
                                              p(tr.mergeOptions(e, { stream: 'mp4CaptionParser' }))
                                          }),
                                          y(e.captions)
                                  },
                              })
                            : y()
                },
            })
        } else if (i.transmuxer) {
            if (('undefined' == typeof i.container && (i.container = Oo(f)), 'ts' !== i.container && 'aac' !== i.container)) return t(i, { hasAudio: !1, hasVideo: !1 }), h(null, i, {}), 0
            qu({
                segment: i,
                bytes: n,
                trackInfoFn: t,
                timingInfoFn: r,
                videoSegmentTimingInfoFn: a,
                audioSegmentTimingInfoFn: s,
                id3Fn: o,
                captionsFn: u,
                isEndOfTimeline: l,
                endedTimelineFn: c,
                dataFn: d,
                doneFn: h,
                onTransmuxerLog: p,
            })
        } else h(null, i, {})
    }
    function Wu(e, i) {
        var n = e.id,
            t = e.key,
            r = e.encryptedBytes,
            a = e.decryptionWorker,
            e = function e(t) {
                t.data.source === n && (a.removeEventListener('message', e), (t = t.data.decrypted), i(new Uint8Array(t.bytes, t.byteOffset, t.byteLength)))
            }
        a.addEventListener('message', e),
            (e = t.bytes.slice ? t.bytes.slice() : new Uint32Array(Array.prototype.slice.call(t.bytes))),
            a.postMessage(Tu({ source: n, encrypted: r, key: e, iv: t.iv }), [r.buffer, e.buffer])
    }
    function Gu(e) {
        var i = e.activeXhrs,
            m = e.decryptionWorker,
            g = e.trackInfoFn,
            y = e.timingInfoFn,
            v = e.videoSegmentTimingInfoFn,
            _ = e.audioSegmentTimingInfoFn,
            b = e.id3Fn,
            T = e.captionsFn,
            S = e.isEndOfTimeline,
            w = e.endedTimelineFn,
            E = e.dataFn,
            k = e.doneFn,
            C = e.onTransmuxerLog,
            n = 0,
            r = !1
        return function (e, f) {
            if (!r) {
                if (e) return (r = !0), Uu(i), k(e, f)
                if ((n += 1) === i.length) {
                    var t = function () {
                        if (f.encryptedBytes)
                            return (
                                (t = (e = {
                                    decryptionWorker: m,
                                    segment: f,
                                    trackInfoFn: g,
                                    timingInfoFn: y,
                                    videoSegmentTimingInfoFn: v,
                                    audioSegmentTimingInfoFn: _,
                                    id3Fn: b,
                                    captionsFn: T,
                                    isEndOfTimeline: S,
                                    endedTimelineFn: w,
                                    dataFn: E,
                                    doneFn: k,
                                    onTransmuxerLog: C,
                                }).decryptionWorker),
                                (i = e.segment),
                                (n = e.trackInfoFn),
                                (r = e.timingInfoFn),
                                (a = e.videoSegmentTimingInfoFn),
                                (s = e.audioSegmentTimingInfoFn),
                                (o = e.id3Fn),
                                (u = e.captionsFn),
                                (l = e.isEndOfTimeline),
                                (c = e.endedTimelineFn),
                                (d = e.dataFn),
                                (h = e.doneFn),
                                (p = e.onTransmuxerLog),
                                void Wu({ id: i.requestId, key: i.key, encryptedBytes: i.encryptedBytes, decryptionWorker: t }, function (e) {
                                    ;(i.bytes = e),
                                        Vu({
                                            segment: i,
                                            bytes: i.bytes,
                                            trackInfoFn: n,
                                            timingInfoFn: r,
                                            videoSegmentTimingInfoFn: a,
                                            audioSegmentTimingInfoFn: s,
                                            id3Fn: o,
                                            captionsFn: u,
                                            isEndOfTimeline: l,
                                            endedTimelineFn: c,
                                            dataFn: d,
                                            doneFn: h,
                                            onTransmuxerLog: p,
                                        })
                                })
                            )
                        var e, t, i, n, r, a, s, o, u, l, c, d, h, p
                        Vu({
                            segment: f,
                            bytes: f.bytes,
                            trackInfoFn: g,
                            timingInfoFn: y,
                            videoSegmentTimingInfoFn: v,
                            audioSegmentTimingInfoFn: _,
                            id3Fn: b,
                            captionsFn: T,
                            isEndOfTimeline: S,
                            endedTimelineFn: w,
                            dataFn: E,
                            doneFn: k,
                            onTransmuxerLog: C,
                        })
                    }
                    if (((f.endOfAllRequests = Date.now()), f.map && f.map.encryptedBytes && !f.map.bytes))
                        return Wu({ decryptionWorker: m, id: f.requestId + '-init', encryptedBytes: f.map.encryptedBytes, key: f.map.key }, function (e) {
                            ;(f.map.bytes = e),
                                ju(f, function (e) {
                                    return e ? (Uu(i), k(e, f)) : void t()
                                })
                        })
                    t()
                }
            }
        }
    }
    function zu(e) {
        var n = e.segment,
            r = e.progressFn
        return (
            e.trackInfoFn,
            e.timingInfoFn,
            e.videoSegmentTimingInfoFn,
            e.audioSegmentTimingInfoFn,
            e.id3Fn,
            e.captionsFn,
            e.isEndOfTimeline,
            e.endedTimelineFn,
            e.dataFn,
            function (e) {
                var t,
                    i = e.target
                if (!i.aborted)
                    return (
                        (n.stats = tr.mergeOptions(
                            n.stats,
                            ((i = (t = e).target),
                            ((i = { bandwidth: 1 / 0, bytesReceived: 0, roundTripTime: Date.now() - i.requestTime || 0 }).bytesReceived = t.loaded),
                            (i.bandwidth = Math.floor((i.bytesReceived / i.roundTripTime) * 8 * 1e3)),
                            i)
                        )),
                        !n.stats.firstBytesReceivedAt && n.stats.bytesReceived && (n.stats.firstBytesReceivedAt = Date.now()),
                        r(e, n)
                    )
            }
        )
    }
    function Xu(e) {
        var t,
            i,
            n,
            r = e.xhr,
            a = e.xhrOptions,
            s = e.decryptionWorker,
            o = e.segment,
            u = e.abortFn,
            l = e.progressFn,
            c = e.trackInfoFn,
            d = e.timingInfoFn,
            h = e.videoSegmentTimingInfoFn,
            p = e.audioSegmentTimingInfoFn,
            f = e.id3Fn,
            m = e.captionsFn,
            g = e.isEndOfTimeline,
            y = e.endedTimelineFn,
            v = e.dataFn,
            _ = e.doneFn,
            e = e.onTransmuxerLog,
            b = [],
            _ = Gu({
                activeXhrs: b,
                decryptionWorker: s,
                trackInfoFn: c,
                timingInfoFn: d,
                videoSegmentTimingInfoFn: h,
                audioSegmentTimingInfoFn: p,
                id3Fn: f,
                captionsFn: m,
                isEndOfTimeline: g,
                endedTimelineFn: y,
                dataFn: v,
                doneFn: _,
                onTransmuxerLog: e,
            })
        o.key &&
            !o.key.bytes &&
            ((e = [o.key]),
            o.map && !o.map.bytes && o.map.key && o.map.key.resolvedUri === o.key.resolvedUri && e.push(o.map.key),
            (e = r(tr.mergeOptions(a, { uri: o.key.resolvedUri, responseType: 'arraybuffer' }), Fu(o, e, _))),
            b.push(e)),
            o.map &&
                !o.map.bytes &&
                (!o.map.key ||
                    (o.key && o.key.resolvedUri === o.map.key.resolvedUri) ||
                    ((t = r(tr.mergeOptions(a, { uri: o.map.key.resolvedUri, responseType: 'arraybuffer' }), Fu(o, [o.map.key], _))), b.push(t)),
                (t = r(
                    tr.mergeOptions(a, { uri: o.map.resolvedUri, responseType: 'arraybuffer', headers: vu(o.map) }),
                    ((i = (t = { segment: o, finishProcessingFn: _ }).segment),
                    (n = t.finishProcessingFn),
                    function (e, t) {
                        e = Bu(e, t)
                        if (e) return n(e, i)
                        e = new Uint8Array(t.response)
                        if (i.map.key) return (i.map.encryptedBytes = e), n(null, i)
                        ;(i.map.bytes = e),
                            ju(i, function (e) {
                                return e ? ((e.xhr = t), (e.status = t.status), n(e, i)) : void n(null, i)
                            })
                    })
                )),
                b.push(t)),
            (a = tr.mergeOptions(a, { uri: (o.part && o.part.resolvedUri) || o.resolvedUri, responseType: 'arraybuffer', headers: vu(o) })),
            (a = r(a, Hu({ segment: o, finishProcessingFn: _, responseType: a.responseType }))).addEventListener(
                'progress',
                zu({
                    segment: o,
                    progressFn: l,
                    trackInfoFn: c,
                    timingInfoFn: d,
                    videoSegmentTimingInfoFn: h,
                    audioSegmentTimingInfoFn: p,
                    id3Fn: f,
                    captionsFn: m,
                    isEndOfTimeline: g,
                    endedTimelineFn: y,
                    dataFn: v,
                })
            ),
            b.push(a)
        var T = {}
        return (
            b.forEach(function (e) {
                var t, i
                e.addEventListener(
                    'loadend',
                    ((t = (e = { loadendState: T, abortFn: u }).loadendState),
                    (i = e.abortFn),
                    function (e) {
                        e.target.aborted && i && !t.calledAbortFn && (i(), (t.calledAbortFn = !0))
                    })
                )
            }),
            function () {
                return Uu(b)
            }
        )
    }
    function Ku(e, t) {
        return (t = t.attributes || {}), e && e.mediaGroups && e.mediaGroups.AUDIO && t.AUDIO && e.mediaGroups.AUDIO[t.AUDIO]
    }
    function Yu(e) {
        var n = {}
        return (
            e.forEach(function (e) {
                var t = e.mediaType,
                    i = e.type,
                    e = e.details
                ;(n[t] = n[t] || []), n[t].push(hr('' + i + e))
            }),
            Object.keys(n).forEach(function (e) {
                return 1 < n[e].length
                    ? (Dl('multiple ' + e + ' codecs found as attributes: ' + n[e].join(', ') + '. Setting playlist codecs to null so that we wait for mux.js to probe segments for real codecs.'),
                      void (n[e] = null))
                    : void (n[e] = n[e][0])
            }),
            n
        )
    }
    function Qu(e) {
        var t = 0
        return e.audio && t++, e.video && t++, t
    }
    function $u(e, t) {
        var i,
            n = t.attributes || {},
            r = Yu(
                (function (e) {
                    e = e.attributes || {}
                    if (e.CODECS) return pr(e.CODECS)
                })(t) || []
            )
        return (
            Ku(e, t) &&
                !r.audio &&
                !(function (e, t) {
                    if (!Ku(e, t)) return !0
                    var i,
                        t = t.attributes || {},
                        n = e.mediaGroups.AUDIO[t.AUDIO]
                    for (i in n) if (!n[i].uri && !n[i].playlists) return !0
                    return !1
                })(e, t) &&
                (i = Yu(
                    (function (e, t) {
                        if (!e.mediaGroups.AUDIO || !t) return null
                        var i,
                            n = e.mediaGroups.AUDIO[t]
                        if (!n) return null
                        for (i in n) {
                            var r = n[i]
                            if (r.default && r.playlists) return pr(r.playlists[0].attributes.CODECS)
                        }
                        return null
                    })(e, n.AUDIO) || []
                )).audio &&
                (r.audio = i.audio),
            r
        )
    }
    function Ju(e) {
        if (e && e.playlist) {
            var t = e.playlist
            return JSON.stringify({ id: t.id, bandwidth: e.bandwidth, width: e.width, height: e.height, codecs: (t.attributes && t.attributes.CODECS) || '' })
        }
    }
    function Zu(e, t) {
        return (e = e && window.getComputedStyle(e)) ? e[t] : ''
    }
    function el(e, n) {
        var r = e.slice()
        e.sort(function (e, t) {
            var i = n(e, t)
            return 0 === i ? r.indexOf(e) - r.indexOf(t) : i
        })
    }
    function tl(e, t) {
        var i, n
        return (i = (i = e.attributes.BANDWIDTH ? e.attributes.BANDWIDTH : i) || window.Number.MAX_VALUE) - (n = (n = t.attributes.BANDWIDTH ? t.attributes.BANDWIDTH : n) || window.Number.MAX_VALUE)
    }
    function il(e, t, i, n, r, a) {
        if (e) {
            var s = { bandwidth: t, width: i, height: n, limitRenditionByPlayerDimensions: r },
                o = e.playlists
            gl.isAudioOnly(e) && ((o = a.getAudioTrackPlaylists_()), (s.audioOnly = !0))
            var u = o.map(function (e) {
                var t = e.attributes && e.attributes.RESOLUTION && e.attributes.RESOLUTION.width,
                    i = e.attributes && e.attributes.RESOLUTION && e.attributes.RESOLUTION.height,
                    n = e.attributes && e.attributes.BANDWIDTH
                return { bandwidth: n || window.Number.MAX_VALUE, width: t, height: i, playlist: e }
            })
            el(u, function (e, t) {
                return e.bandwidth - t.bandwidth
            })
            var l = (u = u.filter(function (e) {
                    return !gl.isIncompatible(e.playlist)
                })).filter(function (e) {
                    return gl.isEnabled(e.playlist)
                }),
                e = (l = !l.length
                    ? u.filter(function (e) {
                          return !gl.isDisabled(e.playlist)
                      })
                    : l).filter(function (e) {
                    return e.bandwidth * El.BANDWIDTH_VARIANCE < t
                }),
                c = e[e.length - 1],
                o = e.filter(function (e) {
                    return e.bandwidth === c.bandwidth
                })[0]
            if (!1 === r) {
                var d = o || l[0] || u[0]
                if (d && d.playlist) {
                    r = o ? 'bandwidthBestRep' : 'sortedPlaylistReps'
                    return l[0] && (r = 'enabledPlaylistReps'), Ol('choosing ' + Ju(d) + ' using ' + r + ' with options', s), d.playlist
                }
                return Ol('could not choose a playlist with options', s), null
            }
            d = e.filter(function (e) {
                return e.width && e.height
            })
            el(d, function (e, t) {
                return e.width - t.width
            })
            var h,
                p,
                f,
                e = d.filter(function (e) {
                    return e.width === i && e.height === n
                }),
                c = e[e.length - 1],
                e = e.filter(function (e) {
                    return e.bandwidth === c.bandwidth
                })[0]
            e ||
                ((p = (h = d.filter(function (e) {
                    return e.width > i || e.height > n
                })).filter(function (e) {
                    return e.width === h[0].width && e.height === h[0].height
                })),
                (c = p[p.length - 1]),
                (p = p.filter(function (e) {
                    return e.bandwidth === c.bandwidth
                })[0])),
                a.experimentalLeastPixelDiffSelector &&
                    ((m = d.map(function (e) {
                        return (e.pixelDiff = Math.abs(e.width - i) + Math.abs(e.height - n)), e
                    })),
                    el(m, function (e, t) {
                        return e.pixelDiff === t.pixelDiff ? t.bandwidth - e.bandwidth : e.pixelDiff - t.pixelDiff
                    }),
                    (f = m[0]))
            var m = f || p || e || o || l[0] || u[0]
            if (m && m.playlist) {
                u = 'sortedPlaylistReps'
                return (
                    f ? (u = 'leastPixelDiffRep') : p ? (u = 'resolutionPlusOneRep') : e ? (u = 'resolutionBestRep') : o ? (u = 'bandwidthBestRep') : l[0] && (u = 'enabledPlaylistReps'),
                    Ol('choosing ' + Ju(m) + ' using ' + u + ' with options', s),
                    m.playlist
                )
            }
            return Ol('could not choose a playlist with options', s), null
        }
    }
    function nl(e) {
        var t = e.inbandTextTracks,
            i = e.metadataArray,
            r = e.timestampOffset,
            n = e.videoDuration
        if (i) {
            var a = window.WebKitDataCue || window.VTTCue,
                s = t.metadataTrack_
            if (
                s &&
                (i.forEach(function (e) {
                    var n = e.cueTime + r
                    !('number' != typeof n || window.isNaN(n) || n < 0) &&
                        n < 1 / 0 &&
                        e.frames.forEach(function (e) {
                            var t,
                                i = new a(n, n, e.value || e.url || e.data || '')
                            ;(i.frame = e),
                                (i.value = e),
                                (t = i),
                                Object.defineProperties(t.frame, {
                                    id: {
                                        get: function () {
                                            return tr.log.warn('cue.frame.id is deprecated. Use cue.value.key instead.'), t.value.key
                                        },
                                    },
                                    value: {
                                        get: function () {
                                            return tr.log.warn('cue.frame.value is deprecated. Use cue.value.data instead.'), t.value.data
                                        },
                                    },
                                    privateData: {
                                        get: function () {
                                            return tr.log.warn('cue.frame.privateData is deprecated. Use cue.value.data instead.'), t.value.data
                                        },
                                    },
                                }),
                                s.addCue(i)
                        })
                }),
                s.cues && s.cues.length)
            ) {
                for (var o = s.cues, u = [], l = 0; l < o.length; l++) o[l] && u.push(o[l])
                var c = u.reduce(function (e, t) {
                        var i = e[t.startTime] || []
                        return i.push(t), (e[t.startTime] = i), e
                    }, {}),
                    d = Object.keys(c).sort(function (e, t) {
                        return Number(e) - Number(t)
                    })
                d.forEach(function (e, t) {
                    var e = c[e],
                        i = Number(d[t + 1]) || n
                    e.forEach(function (e) {
                        e.endTime = i
                    })
                })
            }
        }
    }
    function rl(e, t, i) {
        var n, r
        if (i && i.cues) for (n = i.cues.length; n--; ) (r = i.cues[n]).startTime >= e && r.endTime <= t && i.removeCue(r)
    }
    function al(e) {
        return 'number' == typeof e && isFinite(e)
    }
    function sl(e) {
        var t = e.startOfSegment,
            i = e.duration,
            n = e.segment,
            r = e.part,
            a = e.playlist,
            s = a.mediaSequence,
            o = a.id,
            u = a.segments,
            l = e.mediaIndex,
            c = e.partIndex,
            d = e.timeline,
            h = (void 0 === u ? [] : u).length - 1,
            p = 'mediaIndex/partIndex increment'
        return (
            e.getMediaInfoForTime ? (p = 'getMediaInfoForTime (' + e.getMediaInfoForTime + ')') : e.isSyncRequest && (p = 'getSyncSegmentCandidate (isSyncRequest)'),
            e.independent && (p += ' with independent ' + e.independent),
            (a = 'number' == typeof c),
            (u = e.segment.uri ? 'segment' : 'pre-segment'),
            (e = a ? zo({ preloadSegment: n }) - 1 : 0),
            u +
                ' [' +
                (s + l) +
                '/' +
                (s + h) +
                ']' +
                (a ? ' part [' + c + '/' + e + ']' : '') +
                ' segment start/end [' +
                n.start +
                ' => ' +
                n.end +
                ']' +
                (a ? ' part start/end [' + r.start + ' => ' + r.end + ']' : '') +
                ' startOfSegment [' +
                t +
                '] duration [' +
                i +
                '] timeline [' +
                d +
                '] selected by [' +
                p +
                '] playlist [' +
                o +
                ']'
        )
    }
    function ol(e) {
        return e + 'TimingInfo'
    }
    function ul(e) {
        var t = e.timelineChangeController,
            i = e.currentTimeline,
            n = e.segmentTimeline,
            r = e.loaderType,
            e = e.audioDisabled
        if (i !== n) {
            if ('audio' === r) {
                i = t.lastTimelineChange({ type: 'main' })
                return !i || i.to !== n
            }
            if ('main' === r && e) {
                t = t.pendingTimelineChange({ type: 'audio' })
                return t && t.to === n ? !1 : !0
            }
        }
    }
    function ll(e) {
        var t = e.segmentDuration,
            e = e.maxDuration
        return !!t && Math.round(t) > e + fl
    }
    function cl(e, t) {
        if ('hls' !== t) return null
        var n,
            r,
            i =
                ((n = { audioTimingInfo: e.audioTimingInfo, videoTimingInfo: e.videoTimingInfo }),
                (r = 0),
                ['video', 'audio'].forEach(function (e) {
                    var t,
                        i = n[e + 'TimingInfo']
                    i &&
                        ((e = i.start),
                        (i = i.end),
                        'bigint' == typeof e || 'bigint' == typeof i ? (t = window.BigInt(i) - window.BigInt(e)) : 'number' == typeof e && 'number' == typeof i && (t = i - e),
                        'undefined' != typeof t && r < t && (r = t))
                }),
                (r = 'bigint' == typeof r && r < Number.MAX_SAFE_INTEGER ? Number(r) : r))
        if (!i) return null
        var a = e.playlist.targetDuration,
            s = ll({ segmentDuration: i, maxDuration: 2 * a }),
            t = ll({ segmentDuration: i, maxDuration: a }),
            a =
                'Segment with index ' +
                e.mediaIndex +
                ' from playlist ' +
                e.playlist.id +
                ' has a duration of ' +
                i +
                ' when the reported duration is ' +
                e.duration +
                ' and the target duration is ' +
                a +
                '. For HLS content, a duration in excess of the target duration may result in playback issues. See the HLS specification section on EXT-X-TARGETDURATION for more details: https://tools.ietf.org/html/draft-pantos-http-live-streaming-23#section-4.3.3.1'
        return s || t ? { severity: s ? 'warn' : 'info', message: a } : null
    }
    var dl = Lo,
        hl = 9e4,
        pl = ir,
        fl = 1 / 30,
        ml = tr.createTimeRange,
        gl = {
            liveEdgeDelay: Xo,
            duration: Yo,
            seekable: function (e, t, i) {
                var n = t || 0,
                    i = $o(e, t, !0, i)
                return null === i ? ml() : ml(n, i)
            },
            getMediaInfoForTime: function (e) {
                for (
                    var t = e.playlist,
                        i = e.currentTime,
                        n = e.startingSegmentIndex,
                        r = e.startingPartIndex,
                        a = e.startTime,
                        s = e.experimentalExactManifestTimings,
                        o = i - a,
                        u = Wo(t),
                        l = 0,
                        c = 0;
                    c < u.length;
                    c++
                ) {
                    var d = u[c]
                    if (n === d.segmentIndex && ('number' != typeof r || 'number' != typeof d.partIndex || r === d.partIndex)) {
                        l = c
                        break
                    }
                }
                if (o < 0) {
                    if (0 < l)
                        for (var h = l - 1; 0 <= h; h--) {
                            var p = u[h]
                            if (((o += p.duration), s)) {
                                if (o < 0) continue
                            } else if (o + fl <= 0) continue
                            return { partIndex: p.partIndex, segmentIndex: p.segmentIndex, startTime: a - Qo({ defaultDuration: t.targetDuration, durationList: u, startIndex: l, endIndex: h }) }
                        }
                    return { partIndex: (u[0] && u[0].partIndex) || null, segmentIndex: (u[0] && u[0].segmentIndex) || 0, startTime: i }
                }
                if (l < 0) {
                    for (var f = l; f < 0; f++) if ((o -= t.targetDuration) < 0) return { partIndex: (u[0] && u[0].partIndex) || null, segmentIndex: (u[0] && u[0].segmentIndex) || 0, startTime: i }
                    l = 0
                }
                for (var m = l; m < u.length; m++) {
                    var g = u[m]
                    if (((o -= g.duration), s)) {
                        if (0 < o) continue
                    } else if (0 <= o - fl) continue
                    return { partIndex: g.partIndex, segmentIndex: g.segmentIndex, startTime: a + Qo({ defaultDuration: t.targetDuration, durationList: u, startIndex: l, endIndex: m }) }
                }
                return { segmentIndex: u[u.length - 1].segmentIndex, partIndex: u[u.length - 1].partIndex, startTime: i }
            },
            isEnabled: eu,
            isDisabled: function (e) {
                return e.disabled
            },
            isBlacklisted: Jo,
            isIncompatible: Zo,
            playlistEnd: $o,
            isAes: function (e) {
                for (var t = 0; t < e.segments.length; t++) if (e.segments[t].key) return !0
                return !1
            },
            hasAttribute: tu,
            estimateSegmentRequestTime: function (e, t, i, n) {
                return tu('BANDWIDTH', i) ? (e * i.attributes.BANDWIDTH - 8 * (n = void 0 === n ? 0 : n)) / t : NaN
            },
            isLowestEnabledRendition: iu,
            isAudioOnly: au,
            playlistMatch: nu,
            segmentDurationWithParts: Vo,
        },
        yl = tr.log,
        vl = tr.mergeOptions,
        W = tr.EventTarget,
        _l = (function (a) {
            function e(e, t, i) {
                var n
                if ((void 0 === i && (i = {}), (n = a.call(this) || this), !e)) throw new Error('A non-empty playlist URL or object is required')
                n.logger_ = Ro('PlaylistLoader')
                var r = i.withCredentials,
                    r = void 0 !== r && r,
                    i = i.handleManifestRedirects,
                    i = void 0 !== i && i
                ;(n.src = e), (n.vhs_ = t), (n.withCredentials = r), (n.handleManifestRedirects = i)
                t = t.options_
                return (
                    (n.customTagParsers = (t && t.customTagParsers) || []),
                    (n.customTagMappers = (t && t.customTagMappers) || []),
                    (n.experimentalLLHLS = (t && t.experimentalLLHLS) || !1),
                    tr.browser.IE_VERSION && (n.experimentalLLHLS = !1),
                    (n.state = 'HAVE_NOTHING'),
                    (n.handleMediaupdatetimeout_ = n.handleMediaupdatetimeout_.bind(ft(n))),
                    n.on('mediaupdatetimeout', n.handleMediaupdatetimeout_),
                    n
                )
            }
            mt(e, a)
            var t = e.prototype
            return (
                (t.handleMediaupdatetimeout_ = function () {
                    var e,
                        t,
                        i = this
                    'HAVE_METADATA' === this.state &&
                        ((e = this.media()),
                        (t = pl(this.master.uri, e.uri)),
                        this.experimentalLLHLS &&
                            (t = (function (e, t) {
                                if (t.endList || !t.serverControl) return e
                                var i,
                                    n,
                                    r,
                                    a,
                                    s = {}
                                return (
                                    t.serverControl.canBlockReload &&
                                        ((r = t.preloadSegment),
                                        (i = t.mediaSequence + t.segments.length),
                                        r && ((n = r.parts || []), -1 < (r = zo(t) - 1) && r != n.length - 1 && (s._HLS_part = r), (-1 < r || n.length) && i--),
                                        (s._HLS_msn = i)),
                                    t.serverControl && t.serverControl.canSkipUntil && (s._HLS_skip = t.serverControl.canSkipDateranges ? 'v2' : 'YES'),
                                    Object.keys(s).length &&
                                        ((a = new window.URL(e)),
                                        ['_HLS_skip', '_HLS_msn', '_HLS_part'].forEach(function (e) {
                                            s.hasOwnProperty(e) && a.searchParams.set(e, s[e])
                                        }),
                                        (e = a.toString())),
                                    e
                                )
                            })(t, e)),
                        (this.state = 'HAVE_CURRENT_METADATA'),
                        (this.request = this.vhs_.xhr({ uri: t, withCredentials: this.withCredentials }, function (e, t) {
                            if (i.request)
                                return e
                                    ? i.playlistRequestError(i.request, i.media(), 'HAVE_METADATA')
                                    : void i.haveMetadata({ playlistString: i.request.responseText, url: i.media().uri, id: i.media().id })
                        })))
                }),
                (t.playlistRequestError = function (e, t, i) {
                    var n = t.uri,
                        t = t.id
                    ;(this.request = null),
                        i && (this.state = i),
                        (this.error = {
                            playlist: this.master.playlists[t],
                            status: e.status,
                            message: 'HLS playlist request error at URL: ' + n + '.',
                            responseText: e.responseText,
                            code: 500 <= e.status ? 4 : 2,
                        }),
                        this.trigger('error')
                }),
                (t.parseManifest_ = function (e) {
                    var t = this,
                        i = e.url
                    return (function (e) {
                        var t = e.onwarn,
                            i = e.oninfo,
                            n = e.manifestString,
                            r = e.customTagParsers,
                            a = void 0 === r ? [] : r,
                            r = e.customTagMappers,
                            r = void 0 === r ? [] : r,
                            e = e.experimentalLLHLS,
                            s = new Ir()
                        t && s.on('warn', t),
                            i && s.on('info', i),
                            a.forEach(function (e) {
                                return s.addParser(e)
                            }),
                            r.forEach(function (e) {
                                return s.addTagMapper(e)
                            }),
                            s.push(n),
                            s.end()
                        var o = s.manifest
                        e ||
                            (['preloadSegment', 'skip', 'serverControl', 'renditionReports', 'partInf', 'partTargetDuration'].forEach(function (e) {
                                o.hasOwnProperty(e) && delete o[e]
                            }),
                            o.segments &&
                                o.segments.forEach(function (t) {
                                    ;['parts', 'preloadHints'].forEach(function (e) {
                                        t.hasOwnProperty(e) && delete t[e]
                                    })
                                })),
                            o.targetDuration ||
                                ((u = 10),
                                o.segments &&
                                    o.segments.length &&
                                    (u = o.segments.reduce(function (e, t) {
                                        return Math.max(e, t.duration)
                                    }, 0)),
                                t && t('manifest has no targetDuration defaulting to ' + u),
                                (o.targetDuration = u))
                        var u = Go(o)
                        return (
                            u.length &&
                                !o.partTargetDuration &&
                                ((u = u.reduce(function (e, t) {
                                    return Math.max(e, t.duration)
                                }, 0)),
                                t &&
                                    (t('manifest has no partTargetDuration defaulting to ' + u),
                                    yl.error(
                                        'LL-HLS manifest has parts but lacks required #EXT-X-PART-INF:PART-TARGET value. See https://datatracker.ietf.org/doc/html/draft-pantos-hls-rfc8216bis-09#section-4.4.3.7. Playback is not guaranteed.'
                                    )),
                                (o.partTargetDuration = u)),
                            o
                        )
                    })({
                        onwarn: function (e) {
                            e = e.message
                            return t.logger_('m3u8-parser warn for ' + i + ': ' + e)
                        },
                        oninfo: function (e) {
                            e = e.message
                            return t.logger_('m3u8-parser info for ' + i + ': ' + e)
                        },
                        manifestString: e.manifestString,
                        customTagParsers: this.customTagParsers,
                        customTagMappers: this.customTagMappers,
                        experimentalLLHLS: this.experimentalLLHLS,
                    })
                }),
                (t.haveMetadata = function (e) {
                    var t = e.playlistString,
                        i = e.playlistObject,
                        n = e.url,
                        e = e.id
                    ;(this.request = null), (this.state = 'HAVE_METADATA')
                    t = i || this.parseManifest_({ url: n, manifestString: t })
                    ;(t.lastRequest = Date.now()), uu({ playlist: t, uri: n, id: e })
                    n = fu(this.master, t)
                    ;(this.targetDuration = t.partTargetDuration || t.targetDuration),
                        (this.pendingMedia_ = null),
                        n ? ((this.master = n), (this.media_ = this.master.playlists[e])) : this.trigger('playlistunchanged'),
                        this.updateMediaUpdateTimeout_(mu(this.media(), !!n)),
                        this.trigger('loadedplaylist')
                }),
                (t.dispose = function () {
                    this.trigger('dispose'), this.stopRequest(), window.clearTimeout(this.mediaUpdateTimeout), window.clearTimeout(this.finalRenditionTimeout), this.off()
                }),
                (t.stopRequest = function () {
                    var e
                    this.request && ((e = this.request), (this.request = null), (e.onreadystatechange = null), e.abort())
                }),
                (t.media = function (i, e) {
                    var n = this
                    if (!i) return this.media_
                    if ('HAVE_NOTHING' === this.state) throw new Error('Cannot switch media playlist from ' + this.state)
                    if ('string' == typeof i) {
                        if (!this.master.playlists[i]) throw new Error('Unknown playlist URI: ' + i)
                        i = this.master.playlists[i]
                    }
                    if ((window.clearTimeout(this.finalRenditionTimeout), e)) {
                        var t = ((i.partTargetDuration || i.targetDuration) / 2) * 1e3 || 5e3
                        this.finalRenditionTimeout = window.setTimeout(this.media.bind(this, i, !1), t)
                    } else {
                        var r = this.state,
                            e = !this.media_ || i.id !== this.media_.id,
                            t = this.master.playlists[i.id]
                        if ((t && t.endList) || (i.endList && i.segments.length))
                            return (
                                this.request && ((this.request.onreadystatechange = null), this.request.abort(), (this.request = null)),
                                (this.state = 'HAVE_METADATA'),
                                (this.media_ = i),
                                void (e && (this.trigger('mediachanging'), 'HAVE_MASTER' === r ? this.trigger('loadedmetadata') : this.trigger('mediachange')))
                            )
                        if ((this.updateMediaUpdateTimeout_(mu(i, !0)), e)) {
                            if (((this.state = 'SWITCHING_MEDIA'), this.request)) {
                                if (i.resolvedUri === this.request.url) return
                                ;(this.request.onreadystatechange = null), this.request.abort(), (this.request = null)
                            }
                            this.media_ && this.trigger('mediachanging'),
                                (this.pendingMedia_ = i),
                                (this.request = this.vhs_.xhr({ uri: i.resolvedUri, withCredentials: this.withCredentials }, function (e, t) {
                                    if (n.request) {
                                        if (((i.lastRequest = Date.now()), (i.resolvedUri = Mo(n.handleManifestRedirects, i.resolvedUri, t)), e)) return n.playlistRequestError(n.request, i, r)
                                        n.haveMetadata({ playlistString: t.responseText, url: i.uri, id: i.id }), 'HAVE_MASTER' === r ? n.trigger('loadedmetadata') : n.trigger('mediachange')
                                    }
                                }))
                        }
                    }
                }),
                (t.pause = function () {
                    this.mediaUpdateTimeout && (window.clearTimeout(this.mediaUpdateTimeout), (this.mediaUpdateTimeout = null)),
                        this.stopRequest(),
                        'HAVE_NOTHING' === this.state && (this.started = !1),
                        'SWITCHING_MEDIA' === this.state
                            ? this.media_
                                ? (this.state = 'HAVE_METADATA')
                                : (this.state = 'HAVE_MASTER')
                            : 'HAVE_CURRENT_METADATA' === this.state && (this.state = 'HAVE_METADATA')
                }),
                (t.load = function (e) {
                    var t = this
                    this.mediaUpdateTimeout && (window.clearTimeout(this.mediaUpdateTimeout), (this.mediaUpdateTimeout = null))
                    var i = this.media()
                    e
                        ? ((e = i ? ((i.partTargetDuration || i.targetDuration) / 2) * 1e3 : 5e3),
                          (this.mediaUpdateTimeout = window.setTimeout(function () {
                              ;(t.mediaUpdateTimeout = null), t.load()
                          }, e)))
                        : this.started
                        ? i && !i.endList
                            ? this.trigger('mediaupdatetimeout')
                            : this.trigger('loadedplaylist')
                        : this.start()
                }),
                (t.updateMediaUpdateTimeout_ = function (e) {
                    var t = this
                    this.mediaUpdateTimeout && (window.clearTimeout(this.mediaUpdateTimeout), (this.mediaUpdateTimeout = null)),
                        this.media() &&
                            !this.media().endList &&
                            (this.mediaUpdateTimeout = window.setTimeout(function () {
                                ;(t.mediaUpdateTimeout = null), t.trigger('mediaupdatetimeout'), t.updateMediaUpdateTimeout_(e)
                            }, e))
                }),
                (t.start = function () {
                    var i = this
                    if (((this.started = !0), 'object' == typeof this.src))
                        return (
                            this.src.uri || (this.src.uri = window.location.href),
                            (this.src.resolvedUri = this.src.uri),
                            void setTimeout(function () {
                                i.setupInitialPlaylist(i.src)
                            }, 0)
                        )
                    this.request = this.vhs_.xhr({ uri: this.src, withCredentials: this.withCredentials }, function (e, t) {
                        if (i.request) {
                            if (((i.request = null), e))
                                return (
                                    (i.error = { status: t.status, message: 'HLS playlist request error at URL: ' + i.src + '.', responseText: t.responseText, code: 2 }),
                                    'HAVE_NOTHING' === i.state && (i.started = !1),
                                    i.trigger('error')
                                )
                            i.src = Mo(i.handleManifestRedirects, i.src, t)
                            t = i.parseManifest_({ manifestString: t.responseText, url: i.src })
                            i.setupInitialPlaylist(t)
                        }
                    })
                }),
                (t.srcUri = function () {
                    return 'string' == typeof this.src ? this.src : this.src.uri
                }),
                (t.setupInitialPlaylist = function (e) {
                    if (((this.state = 'HAVE_MASTER'), e.playlists))
                        return (
                            (this.master = e),
                            lu(this.master, this.srcUri()),
                            e.playlists.forEach(function (t) {
                                ;(t.segments = hu(t)),
                                    t.segments.forEach(function (e) {
                                        du(e, t.resolvedUri)
                                    })
                            }),
                            this.trigger('loadedplaylist'),
                            void (this.request || this.media(this.master.playlists[0]))
                        )
                    var t,
                        i,
                        n,
                        r = this.srcUri() || window.location.href
                    ;(this.master =
                        ((i = su(0, (t = r))),
                        ((n = {
                            mediaGroups: { AUDIO: {}, VIDEO: {}, 'CLOSED-CAPTIONS': {}, SUBTITLES: {} },
                            uri: window.location.href,
                            resolvedUri: window.location.href,
                            playlists: [{ uri: t, id: i, resolvedUri: t, attributes: {} }],
                        }).playlists[i] = n.playlists[0]),
                        (n.playlists[t] = n.playlists[0]),
                        n)),
                        this.haveMetadata({ playlistObject: e, url: r, id: this.master.playlists[0].id }),
                        this.trigger('loadedmetadata')
                }),
                e
            )
        })(W),
        bl = tr.xhr,
        Tl = tr.mergeOptions,
        zt = Object.freeze({
            __proto__: null,
            createTransferableMessage: Tu,
            initSegmentId: Su,
            segmentKeyId: wu,
            hexDump: Eu,
            tagDump: function (e) {
                e = e.bytes
                return Eu(e)
            },
            textRanges: function (e) {
                for (var t, i, n = '', r = 0; r < e.length; r++) n += ((i = r), (t = e).start(i) + '-' + t.end(i) + ' ')
                return n
            },
        }),
        ar = tr.EventTarget,
        Sl = tr.mergeOptions,
        wl = (function (a) {
            function e(e, t, i, n) {
                var r
                void 0 === i && (i = {}), ((r = a.call(this) || this).masterPlaylistLoader_ = n || ft(r)), n || (r.isMaster_ = !0)
                ;(n = i.withCredentials), (n = void 0 !== n && n), (i = i.handleManifestRedirects), (i = void 0 !== i && i)
                if (((r.vhs_ = t), (r.withCredentials = n), (r.handleManifestRedirects = i), !e)) throw new Error('A non-empty playlist URL or object is required')
                return (
                    r.on('minimumUpdatePeriod', function () {
                        r.refreshXml_()
                    }),
                    r.on('mediaupdatetimeout', function () {
                        r.refreshMedia_(r.media().id)
                    }),
                    (r.state = 'HAVE_NOTHING'),
                    (r.loadedPlaylists_ = {}),
                    (r.logger_ = Ro('DashPlaylistLoader')),
                    r.isMaster_ ? ((r.masterPlaylistLoader_.srcUrl = e), (r.masterPlaylistLoader_.sidxMapping_ = {})) : (r.childPlaylist_ = e),
                    r
                )
            }
            mt(e, a)
            var t = e.prototype
            return (
                (t.requestErrored_ = function (e, t, i) {
                    return (
                        !this.request ||
                        ((this.request = null),
                        e
                            ? ((this.error = 'object' != typeof e || e instanceof Error ? { status: t.status, message: 'DASH request error at URL: ' + t.uri, response: t.response, code: 2 } : e),
                              i && (this.state = i),
                              this.trigger('error'),
                              !0)
                            : void 0)
                    )
                }),
                (t.addSidxSegments_ = function (a, n, r) {
                    var s,
                        o,
                        u = this,
                        l = a.sidx && xs(a.sidx)
                    a.sidx && l && !this.masterPlaylistLoader_.sidxMapping_[l]
                        ? ((s = Mo(this.handleManifestRedirects, a.sidx.resolvedUri)),
                          (o = function (e, t) {
                              if (!u.requestErrored_(e, t, n)) {
                                  var i,
                                      e = u.masterPlaylistLoader_.sidxMapping_
                                  try {
                                      i = wo(br(t.response).subarray(8))
                                  } catch (e) {
                                      return void u.requestErrored_(e, t, n)
                                  }
                                  return (e[l] = { sidxInfo: a.sidx, sidx: i }), ws(a, i, a.sidx.resolvedUri), r(!0)
                              }
                          }),
                          (this.request = xu(s, this.vhs_.xhr, function (e, t, i, n) {
                              if (e) return o(e, t)
                              if (!i || 'mp4' !== i)
                                  return o(
                                      {
                                          status: t.status,
                                          message: 'Unsupported ' + (i || 'unknown') + ' container type for sidx segment at URL: ' + s,
                                          response: '',
                                          playlist: a,
                                          internal: !0,
                                          blacklistDuration: 1 / 0,
                                          code: 2,
                                      },
                                      t
                                  )
                              var r = a.sidx.byterange,
                                  i = r.offset,
                                  r = r.length
                              if (n.length >= r + i) return o(e, { response: n.subarray(i, i + r), status: t.status, uri: t.uri })
                              u.request = u.vhs_.xhr({ uri: s, responseType: 'arraybuffer', headers: vu({ byterange: a.sidx.byterange }) }, o)
                          })))
                        : (this.mediaRequest_ = window.setTimeout(function () {
                              return r(!1)
                          }, 0))
                }),
                (t.dispose = function () {
                    this.trigger('dispose'),
                        this.stopRequest(),
                        (this.loadedPlaylists_ = {}),
                        window.clearTimeout(this.minimumUpdatePeriodTimeout_),
                        window.clearTimeout(this.mediaRequest_),
                        window.clearTimeout(this.mediaUpdateTimeout),
                        (this.mediaUpdateTimeout = null),
                        (this.mediaRequest_ = null),
                        (this.minimumUpdatePeriodTimeout_ = null),
                        this.masterPlaylistLoader_.createMupOnMedia_ &&
                            (this.off('loadedmetadata', this.masterPlaylistLoader_.createMupOnMedia_), (this.masterPlaylistLoader_.createMupOnMedia_ = null)),
                        this.off()
                }),
                (t.hasPendingRequest = function () {
                    return this.request || this.mediaRequest_
                }),
                (t.stopRequest = function () {
                    var e
                    this.request && ((e = this.request), (this.request = null), (e.onreadystatechange = null), e.abort())
                }),
                (t.media = function (t) {
                    var i = this
                    if (!t) return this.media_
                    if ('HAVE_NOTHING' === this.state) throw new Error('Cannot switch media playlist from ' + this.state)
                    var n = this.state
                    if ('string' == typeof t) {
                        if (!this.masterPlaylistLoader_.master.playlists[t]) throw new Error('Unknown playlist URI: ' + t)
                        t = this.masterPlaylistLoader_.master.playlists[t]
                    }
                    var e = !this.media_ || t.id !== this.media_.id
                    if (e && this.loadedPlaylists_[t.id] && this.loadedPlaylists_[t.id].endList)
                        return (this.state = 'HAVE_METADATA'), (this.media_ = t), void (e && (this.trigger('mediachanging'), this.trigger('mediachange')))
                    e &&
                        (this.media_ && this.trigger('mediachanging'),
                        this.addSidxSegments_(t, n, function (e) {
                            i.haveMetadata({ startingState: n, playlist: t })
                        }))
                }),
                (t.haveMetadata = function (e) {
                    var t = e.startingState,
                        e = e.playlist
                    ;(this.state = 'HAVE_METADATA'),
                        (this.loadedPlaylists_[e.id] = e),
                        (this.mediaRequest_ = null),
                        this.refreshMedia_(e.id),
                        'HAVE_MASTER' === t ? this.trigger('loadedmetadata') : this.trigger('mediachange')
                }),
                (t.pause = function () {
                    this.masterPlaylistLoader_.createMupOnMedia_ && (this.off('loadedmetadata', this.masterPlaylistLoader_.createMupOnMedia_), (this.masterPlaylistLoader_.createMupOnMedia_ = null)),
                        this.stopRequest(),
                        window.clearTimeout(this.mediaUpdateTimeout),
                        (this.mediaUpdateTimeout = null),
                        this.isMaster_ && (window.clearTimeout(this.masterPlaylistLoader_.minimumUpdatePeriodTimeout_), (this.masterPlaylistLoader_.minimumUpdatePeriodTimeout_ = null)),
                        'HAVE_NOTHING' === this.state && (this.started = !1)
                }),
                (t.load = function (e) {
                    var t = this
                    window.clearTimeout(this.mediaUpdateTimeout), (this.mediaUpdateTimeout = null)
                    var i = this.media()
                    e
                        ? ((e = i ? (i.targetDuration / 2) * 1e3 : 5e3),
                          (this.mediaUpdateTimeout = window.setTimeout(function () {
                              return t.load()
                          }, e)))
                        : this.started
                        ? i && !i.endList
                            ? (this.isMaster_ && !this.minimumUpdatePeriodTimeout_ && (this.trigger('minimumUpdatePeriod'), this.updateMinimumUpdatePeriodTimeout_()),
                              this.trigger('mediaupdatetimeout'))
                            : this.trigger('loadedplaylist')
                        : this.start()
                }),
                (t.start = function () {
                    var i = this
                    ;(this.started = !0),
                        this.isMaster_
                            ? this.requestMaster_(function (e, t) {
                                  i.haveMaster_(), i.hasPendingRequest() || i.media_ || i.media(i.masterPlaylistLoader_.master.playlists[0])
                              })
                            : (this.mediaRequest_ = window.setTimeout(function () {
                                  return i.haveMaster_()
                              }, 0))
                }),
                (t.requestMaster_ = function (n) {
                    var r = this
                    this.request = this.vhs_.xhr({ uri: this.masterPlaylistLoader_.srcUrl, withCredentials: this.withCredentials }, function (e, t) {
                        if (!r.requestErrored_(e, t)) {
                            var i = t.responseText !== r.masterPlaylistLoader_.masterXml_
                            return (
                                (r.masterPlaylistLoader_.masterXml_ = t.responseText),
                                t.responseHeaders && t.responseHeaders.date ? (r.masterLoaded_ = Date.parse(t.responseHeaders.date)) : (r.masterLoaded_ = Date.now()),
                                (r.masterPlaylistLoader_.srcUrl = Mo(r.handleManifestRedirects, r.masterPlaylistLoader_.srcUrl, t)),
                                i
                                    ? (r.handleMaster_(),
                                      void r.syncClientServerClock_(function () {
                                          return n(t, i)
                                      }))
                                    : n(t, i)
                            )
                        }
                        'HAVE_NOTHING' === r.state && (r.started = !1)
                    })
                }),
                (t.syncClientServerClock_ = function (i) {
                    var n = this,
                        r = Zs(this.masterPlaylistLoader_.masterXml_)
                    return null === r
                        ? ((this.masterPlaylistLoader_.clientOffset_ = this.masterLoaded_ - Date.now()), i())
                        : 'DIRECT' === r.method
                        ? ((this.masterPlaylistLoader_.clientOffset_ = r.value - Date.now()), i())
                        : void (this.request = this.vhs_.xhr({ uri: pl(this.masterPlaylistLoader_.srcUrl, r.value), method: r.method, withCredentials: this.withCredentials }, function (e, t) {
                              if (n.request) {
                                  if (e) return (n.masterPlaylistLoader_.clientOffset_ = n.masterLoaded_ - Date.now()), i()
                                  t = 'HEAD' === r.method ? (t.responseHeaders && t.responseHeaders.date ? Date.parse(t.responseHeaders.date) : n.masterLoaded_) : Date.parse(t.responseText)
                                  ;(n.masterPlaylistLoader_.clientOffset_ = t - Date.now()), i()
                              }
                          }))
                }),
                (t.haveMaster_ = function () {
                    ;(this.state = 'HAVE_MASTER'), this.isMaster_ ? this.trigger('loadedplaylist') : this.media_ || this.media(this.childPlaylist_)
                }),
                (t.handleMaster_ = function () {
                    this.mediaRequest_ = null
                    var e,
                        t,
                        i,
                        n,
                        r = this.masterPlaylistLoader_.master,
                        t =
                            ((a = {
                                masterXml: this.masterPlaylistLoader_.masterXml_,
                                srcUrl: this.masterPlaylistLoader_.srcUrl,
                                clientOffset: this.masterPlaylistLoader_.clientOffset_,
                                sidxMapping: this.masterPlaylistLoader_.sidxMapping_,
                                previousManifest: r,
                            }),
                            (e = a.masterXml),
                            (t = a.srcUrl),
                            (i = a.clientOffset),
                            (n = a.sidxMapping),
                            (a = a.previousManifest),
                            (a = Js(e, { manifestUri: t, clientOffset: i, sidxMapping: n, previousManifest: a })),
                            lu(a, t),
                            a)
                    r &&
                        (t = (function (e, t, i) {
                            for (var a = !0, s = Sl(e, { duration: t.duration, minimumUpdatePeriod: t.minimumUpdatePeriod, timelineStarts: t.timelineStarts }), n = 0; n < t.playlists.length; n++) {
                                var r,
                                    o = t.playlists[n]
                                o.sidx && ((r = xs(o.sidx)), i && i[r] && i[r].sidx && ws(o, i[r].sidx, o.sidx.resolvedUri))
                                o = fu(s, o, Au)
                                o && ((s = o), (a = !1))
                            }
                            return (
                                ou(t, function (e, t, i, n) {
                                    var r
                                    e.playlists &&
                                        e.playlists.length &&
                                        ((r = e.playlists[0].id), (e = fu(s, e.playlists[0], Au)) && (((s = e).mediaGroups[t][i][n].playlists[0] = s.playlists[r]), (a = !1)))
                                }),
                                (a = t.minimumUpdatePeriod === e.minimumUpdatePeriod && a) ? null : s
                            )
                        })(r, t, this.masterPlaylistLoader_.sidxMapping_)),
                        (this.masterPlaylistLoader_.master = t || r)
                    var a = this.masterPlaylistLoader_.master.locations && this.masterPlaylistLoader_.master.locations[0]
                    return (
                        a && a !== this.masterPlaylistLoader_.srcUrl && (this.masterPlaylistLoader_.srcUrl = a),
                        (!r || (t && t.minimumUpdatePeriod !== r.minimumUpdatePeriod)) && this.updateMinimumUpdatePeriodTimeout_(),
                        Boolean(t)
                    )
                }),
                (t.updateMinimumUpdatePeriodTimeout_ = function () {
                    var e = this.masterPlaylistLoader_
                    e.createMupOnMedia_ && (e.off('loadedmetadata', e.createMupOnMedia_), (e.createMupOnMedia_ = null)),
                        e.minimumUpdatePeriodTimeout_ && (window.clearTimeout(e.minimumUpdatePeriodTimeout_), (e.minimumUpdatePeriodTimeout_ = null))
                    var t = e.master && e.master.minimumUpdatePeriod
                    0 === t && (e.media() ? (t = 1e3 * e.media().targetDuration) : ((e.createMupOnMedia_ = e.updateMinimumUpdatePeriodTimeout_), e.one('loadedmetadata', e.createMupOnMedia_))),
                        'number' != typeof t || t <= 0 ? t < 0 && this.logger_('found invalid minimumUpdatePeriod of ' + t + ', not setting a timeout') : this.createMUPTimeout_(t)
                }),
                (t.createMUPTimeout_ = function (e) {
                    var t = this.masterPlaylistLoader_
                    t.minimumUpdatePeriodTimeout_ = window.setTimeout(function () {
                        ;(t.minimumUpdatePeriodTimeout_ = null), t.trigger('minimumUpdatePeriod'), t.createMUPTimeout_(e)
                    }, e)
                }),
                (t.refreshXml_ = function () {
                    var i = this
                    this.requestMaster_(function (e, t) {
                        var r, a
                        t &&
                            (i.media_ && (i.media_ = i.masterPlaylistLoader_.master.playlists[i.media_.id]),
                            (i.masterPlaylistLoader_.sidxMapping_ =
                                ((t = i.masterPlaylistLoader_.master),
                                (r = i.masterPlaylistLoader_.sidxMapping_),
                                (a = Pu(t.playlists, r)),
                                ou(t, function (e, t, i, n) {
                                    e.playlists && e.playlists.length && ((e = e.playlists), (a = Sl(a, Pu(e, r))))
                                }),
                                a)),
                            i.addSidxSegments_(i.media(), i.state, function (e) {
                                i.refreshMedia_(i.media().id)
                            }))
                    })
                }),
                (t.refreshMedia_ = function (e) {
                    var t = this
                    if (!e) throw new Error('refreshMedia_ must take a media id')
                    this.media_ && this.isMaster_ && this.handleMaster_()
                    var i = this.masterPlaylistLoader_.master.playlists,
                        n = !this.media_ || this.media_ !== i[e]
                    n ? (this.media_ = i[e]) : this.trigger('playlistunchanged'),
                        this.mediaUpdateTimeout ||
                            (function e() {
                                t.media().endList ||
                                    (t.mediaUpdateTimeout = window.setTimeout(function () {
                                        t.trigger('mediaupdatetimeout'), e()
                                    }, mu(t.media(), Boolean(n))))
                            })(),
                        this.trigger('loadedplaylist')
                }),
                e
            )
        })(ar),
        El = {
            GOAL_BUFFER_LENGTH: 30,
            MAX_GOAL_BUFFER_LENGTH: 60,
            BACK_BUFFER_LENGTH: 30,
            GOAL_BUFFER_LENGTH_RATE: 1,
            INITIAL_BANDWIDTH: 4194304,
            BANDWIDTH_VARIANCE: 1.2,
            BUFFER_LOW_WATER_LINE: 0,
            MAX_BUFFER_LOW_WATER_LINE: 30,
            EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE: 16,
            BUFFER_LOW_WATER_LINE_RATE: 1,
            BUFFER_HIGH_WATER_LINE: 30,
        },
        x = function (n) {
            return function () {
                var e = (function (t) {
                        try {
                            return URL.createObjectURL(new Blob([t], { type: 'application/javascript' }))
                        } catch (e) {
                            var i = new BlobBuilder()
                            return i.append(t), URL.createObjectURL(i.getBlob())
                        }
                    })(n),
                    t = Lu(new Worker(e))
                t.objURL = e
                var i = t.terminate
                return (
                    (t.on = t.addEventListener),
                    (t.off = t.removeEventListener),
                    (t.terminate = function () {
                        return URL.revokeObjectURL(e), i.call(this)
                    }),
                    t
                )
            }
        },
        U = function (e) {
            return 'var browserWorkerPolyFill = ' + Lu.toString() + ';\nbrowserWorkerPolyFill(self);\n' + e
        },
        W = function (e) {
            return e
                .toString()
                .replace(/^function.+?{/, '')
                .slice(0, -1)
        },
        kl = x(
            U(
                W(function () {
                    var e = function () {
                        this.init = function () {
                            var a = {}
                            ;(this.on = function (e, t) {
                                a[e] || (a[e] = []), (a[e] = a[e].concat(t))
                            }),
                                (this.off = function (e, t) {
                                    return !!a[e] && ((t = a[e].indexOf(t)), (a[e] = a[e].slice()), a[e].splice(t, 1), -1 < t)
                                }),
                                (this.trigger = function (e) {
                                    var t,
                                        i,
                                        n,
                                        r = a[e]
                                    if (r)
                                        if (2 === arguments.length) for (i = r.length, t = 0; t < i; ++t) r[t].call(this, arguments[1])
                                        else {
                                            for (n = [], t = arguments.length, t = 1; t < arguments.length; ++t) n.push(arguments[t])
                                            for (i = r.length, t = 0; t < i; ++t) r[t].apply(this, n)
                                        }
                                }),
                                (this.dispose = function () {
                                    a = {}
                                })
                        }
                    }
                    ;(e.prototype.pipe = function (t) {
                        return (
                            this.on('data', function (e) {
                                t.push(e)
                            }),
                            this.on('done', function (e) {
                                t.flush(e)
                            }),
                            this.on('partialdone', function (e) {
                                t.partialFlush(e)
                            }),
                            this.on('endedtimeline', function (e) {
                                t.endTimeline(e)
                            }),
                            this.on('reset', function (e) {
                                t.reset(e)
                            }),
                            t
                        )
                    }),
                        (e.prototype.push = function (e) {
                            this.trigger('data', e)
                        }),
                        (e.prototype.flush = function (e) {
                            this.trigger('done', e)
                        }),
                        (e.prototype.partialFlush = function (e) {
                            this.trigger('partialdone', e)
                        }),
                        (e.prototype.endTimeline = function (e) {
                            this.trigger('endedtimeline', e)
                        }),
                        (e.prototype.reset = function (e) {
                            this.trigger('reset', e)
                        })
                    var u,
                        t,
                        i,
                        n,
                        r,
                        a,
                        s,
                        o,
                        l,
                        c,
                        d,
                        h,
                        p,
                        f,
                        m,
                        g,
                        y,
                        v,
                        _,
                        b,
                        T,
                        S,
                        w,
                        E,
                        k,
                        C,
                        I,
                        x,
                        A,
                        P,
                        L,
                        D,
                        O,
                        M,
                        R,
                        N,
                        U,
                        B,
                        F,
                        j = e,
                        H = Math.pow(2, 32),
                        q = {
                            getUint64: function (e) {
                                var t = new DataView(e.buffer, e.byteOffset, e.byteLength)
                                return t.getBigUint64 ? ((e = t.getBigUint64(0)) < Number.MAX_SAFE_INTEGER ? Number(e) : e) : t.getUint32(0) * H + t.getUint32(4)
                            },
                            MAX_UINT32: H,
                        },
                        V = q.MAX_UINT32
                    !(function () {
                        if (
                            ((T = {
                                avc1: [],
                                avcC: [],
                                btrt: [],
                                dinf: [],
                                dref: [],
                                esds: [],
                                ftyp: [],
                                hdlr: [],
                                mdat: [],
                                mdhd: [],
                                mdia: [],
                                mfhd: [],
                                minf: [],
                                moof: [],
                                moov: [],
                                mp4a: [],
                                mvex: [],
                                mvhd: [],
                                pasp: [],
                                sdtp: [],
                                smhd: [],
                                stbl: [],
                                stco: [],
                                stsc: [],
                                stsd: [],
                                stsz: [],
                                stts: [],
                                styp: [],
                                tfdt: [],
                                tfhd: [],
                                traf: [],
                                trak: [],
                                trun: [],
                                trex: [],
                                tkhd: [],
                                vmhd: [],
                            }),
                            'undefined' != typeof Uint8Array)
                        ) {
                            for (var e in T) T.hasOwnProperty(e) && (T[e] = [e.charCodeAt(0), e.charCodeAt(1), e.charCodeAt(2), e.charCodeAt(3)])
                            ;(S = new Uint8Array(['i'.charCodeAt(0), 's'.charCodeAt(0), 'o'.charCodeAt(0), 'm'.charCodeAt(0)])),
                                (E = new Uint8Array(['a'.charCodeAt(0), 'v'.charCodeAt(0), 'c'.charCodeAt(0), '1'.charCodeAt(0)])),
                                (w = new Uint8Array([0, 0, 0, 1])),
                                (k = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 118, 105, 100, 101, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86, 105, 100, 101, 111, 72, 97, 110, 100, 108, 101, 114, 0])),
                                (C = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 115, 111, 117, 110, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 83, 111, 117, 110, 100, 72, 97, 110, 100, 108, 101, 114, 0])),
                                (I = { video: k, audio: C }),
                                (P = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 12, 117, 114, 108, 32, 0, 0, 0, 1])),
                                (A = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0])),
                                (L = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0])),
                                (D = L),
                                (O = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0])),
                                (M = L),
                                (x = new Uint8Array([0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0]))
                        }
                    })(),
                        (u = function (e) {
                            for (var t, i = [], n = 0, r = 1; r < arguments.length; r++) i.push(arguments[r])
                            for (r = i.length; r--; ) n += i[r].byteLength
                            for (t = new Uint8Array(n + 8), new DataView(t.buffer, t.byteOffset, t.byteLength).setUint32(0, t.byteLength), t.set(e, 4), r = 0, n = 8; r < i.length; r++)
                                t.set(i[r], n), (n += i[r].byteLength)
                            return t
                        }),
                        (t = function () {
                            return u(T.dinf, u(T.dref, P))
                        }),
                        (i = function (e) {
                            return u(
                                T.esds,
                                new Uint8Array([
                                    0,
                                    0,
                                    0,
                                    0,
                                    3,
                                    25,
                                    0,
                                    0,
                                    0,
                                    4,
                                    17,
                                    64,
                                    21,
                                    0,
                                    6,
                                    0,
                                    0,
                                    0,
                                    218,
                                    192,
                                    0,
                                    0,
                                    218,
                                    192,
                                    5,
                                    2,
                                    (e.audioobjecttype << 3) | (e.samplingfrequencyindex >>> 1),
                                    (e.samplingfrequencyindex << 7) | (e.channelcount << 3),
                                    6,
                                    1,
                                    2,
                                ])
                            )
                        }),
                        (f = function (e) {
                            return u(T.hdlr, I[e])
                        }),
                        (p = function (e) {
                            var t = new Uint8Array([
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                2,
                                0,
                                0,
                                0,
                                3,
                                0,
                                1,
                                95,
                                144,
                                (e.duration >>> 24) & 255,
                                (e.duration >>> 16) & 255,
                                (e.duration >>> 8) & 255,
                                255 & e.duration,
                                85,
                                196,
                                0,
                                0,
                            ])
                            return (
                                e.samplerate && ((t[12] = (e.samplerate >>> 24) & 255), (t[13] = (e.samplerate >>> 16) & 255), (t[14] = (e.samplerate >>> 8) & 255), (t[15] = 255 & e.samplerate)),
                                u(T.mdhd, t)
                            )
                        }),
                        (h = function (e) {
                            return u(T.mdia, p(e), f(e.type), a(e))
                        }),
                        (r = function (e) {
                            return u(T.mfhd, new Uint8Array([0, 0, 0, 0, (4278190080 & e) >> 24, (16711680 & e) >> 16, (65280 & e) >> 8, 255 & e]))
                        }),
                        (a = function (e) {
                            return u(T.minf, 'video' === e.type ? u(T.vmhd, x) : u(T.smhd, A), t(), g(e))
                        }),
                        (We = function (e, t) {
                            for (var i = [], n = t.length; n--; ) i[n] = v(t[n])
                            return u.apply(null, [T.moof, r(e)].concat(i))
                        }),
                        (s = function (e) {
                            for (var t = e.length, i = []; t--; ) i[t] = c(e[t])
                            return u.apply(null, [T.moov, l(4294967295)].concat(i).concat(o(e)))
                        }),
                        (o = function (e) {
                            for (var t = e.length, i = []; t--; ) i[t] = _(e[t])
                            return u.apply(null, [T.mvex].concat(i))
                        }),
                        (l = function (e) {
                            e = new Uint8Array([
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                1,
                                0,
                                0,
                                0,
                                2,
                                0,
                                1,
                                95,
                                144,
                                (4278190080 & e) >> 24,
                                (16711680 & e) >> 16,
                                (65280 & e) >> 8,
                                255 & e,
                                0,
                                1,
                                0,
                                0,
                                1,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                1,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                1,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                64,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                255,
                                255,
                                255,
                                255,
                            ])
                            return u(T.mvhd, e)
                        }),
                        (m = function (e) {
                            for (var t, i = e.samples || [], n = new Uint8Array(4 + i.length), r = 0; r < i.length; r++)
                                (t = i[r].flags), (n[r + 4] = (t.dependsOn << 4) | (t.isDependedOn << 2) | t.hasRedundancy)
                            return u(T.sdtp, n)
                        }),
                        (g = function (e) {
                            return u(T.stbl, y(e), u(T.stts, M), u(T.stsc, D), u(T.stsz, O), u(T.stco, L))
                        }),
                        (y = function (e) {
                            return u(T.stsd, new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1]), ('video' === e.type ? R : N)(e))
                        }),
                        (R = function (e) {
                            for (var t, i, n = e.sps || [], r = e.pps || [], a = [], s = [], o = 0; o < n.length; o++)
                                a.push((65280 & n[o].byteLength) >>> 8), a.push(255 & n[o].byteLength), (a = a.concat(Array.prototype.slice.call(n[o])))
                            for (o = 0; o < r.length; o++) s.push((65280 & r[o].byteLength) >>> 8), s.push(255 & r[o].byteLength), (s = s.concat(Array.prototype.slice.call(r[o])))
                            return (
                                (t = [
                                    T.avc1,
                                    new Uint8Array([
                                        0,
                                        0,
                                        0,
                                        0,
                                        0,
                                        0,
                                        0,
                                        1,
                                        0,
                                        0,
                                        0,
                                        0,
                                        0,
                                        0,
                                        0,
                                        0,
                                        0,
                                        0,
                                        0,
                                        0,
                                        0,
                                        0,
                                        0,
                                        0,
                                        (65280 & e.width) >> 8,
                                        255 & e.width,
                                        (65280 & e.height) >> 8,
                                        255 & e.height,
                                        0,
                                        72,
                                        0,
                                        0,
                                        0,
                                        72,
                                        0,
                                        0,
                                        0,
                                        0,
                                        0,
                                        0,
                                        0,
                                        1,
                                        19,
                                        118,
                                        105,
                                        100,
                                        101,
                                        111,
                                        106,
                                        115,
                                        45,
                                        99,
                                        111,
                                        110,
                                        116,
                                        114,
                                        105,
                                        98,
                                        45,
                                        104,
                                        108,
                                        115,
                                        0,
                                        0,
                                        0,
                                        0,
                                        0,
                                        0,
                                        0,
                                        0,
                                        0,
                                        0,
                                        0,
                                        0,
                                        0,
                                        24,
                                        17,
                                        17,
                                    ]),
                                    u(T.avcC, new Uint8Array([1, e.profileIdc, e.profileCompatibility, e.levelIdc, 255].concat([n.length], a, [r.length], s))),
                                    u(T.btrt, new Uint8Array([0, 28, 156, 128, 0, 45, 198, 192, 0, 45, 198, 192])),
                                ]),
                                e.sarRatio &&
                                    ((i = e.sarRatio[0]),
                                    (e = e.sarRatio[1]),
                                    t.push(
                                        u(
                                            T.pasp,
                                            new Uint8Array([
                                                (4278190080 & i) >> 24,
                                                (16711680 & i) >> 16,
                                                (65280 & i) >> 8,
                                                255 & i,
                                                (4278190080 & e) >> 24,
                                                (16711680 & e) >> 16,
                                                (65280 & e) >> 8,
                                                255 & e,
                                            ])
                                        )
                                    )),
                                u.apply(null, t)
                            )
                        }),
                        (N = function (e) {
                            return u(
                                T.mp4a,
                                new Uint8Array([
                                    0,
                                    0,
                                    0,
                                    0,
                                    0,
                                    0,
                                    0,
                                    1,
                                    0,
                                    0,
                                    0,
                                    0,
                                    0,
                                    0,
                                    0,
                                    0,
                                    (65280 & e.channelcount) >> 8,
                                    255 & e.channelcount,
                                    (65280 & e.samplesize) >> 8,
                                    255 & e.samplesize,
                                    0,
                                    0,
                                    0,
                                    0,
                                    (65280 & e.samplerate) >> 8,
                                    255 & e.samplerate,
                                    0,
                                    0,
                                ]),
                                i(e)
                            )
                        }),
                        (d = function (e) {
                            e = new Uint8Array([
                                0,
                                0,
                                0,
                                7,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                (4278190080 & e.id) >> 24,
                                (16711680 & e.id) >> 16,
                                (65280 & e.id) >> 8,
                                255 & e.id,
                                0,
                                0,
                                0,
                                0,
                                (4278190080 & e.duration) >> 24,
                                (16711680 & e.duration) >> 16,
                                (65280 & e.duration) >> 8,
                                255 & e.duration,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                1,
                                0,
                                0,
                                0,
                                0,
                                1,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                1,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                64,
                                0,
                                0,
                                0,
                                (65280 & e.width) >> 8,
                                255 & e.width,
                                0,
                                0,
                                (65280 & e.height) >> 8,
                                255 & e.height,
                                0,
                                0,
                            ])
                            return u(T.tkhd, e)
                        }),
                        (v = function (e) {
                            var t,
                                i = u(
                                    T.tfhd,
                                    new Uint8Array([0, 0, 0, 58, (4278190080 & e.id) >> 24, (16711680 & e.id) >> 16, (65280 & e.id) >> 8, 255 & e.id, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0])
                                ),
                                n = Math.floor(e.baseMediaDecodeTime / V),
                                r = Math.floor(e.baseMediaDecodeTime % V),
                                n = u(T.tfdt, new Uint8Array([1, 0, 0, 0, (n >>> 24) & 255, (n >>> 16) & 255, (n >>> 8) & 255, 255 & n, (r >>> 24) & 255, (r >>> 16) & 255, (r >>> 8) & 255, 255 & r]))
                            return 'audio' === e.type ? ((t = b(e, 92)), u(T.traf, i, n, t)) : ((r = m(e)), (t = b(e, r.length + 92)), u(T.traf, i, n, t, r))
                        }),
                        (c = function (e) {
                            return (e.duration = e.duration || 4294967295), u(T.trak, d(e), h(e))
                        }),
                        (_ = function (e) {
                            var t = new Uint8Array([0, 0, 0, 0, (4278190080 & e.id) >> 24, (16711680 & e.id) >> 16, (65280 & e.id) >> 8, 255 & e.id, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1])
                            return 'video' !== e.type && (t[t.length - 1] = 0), u(T.trex, t)
                        }),
                        (U = function (e, t) {
                            var i = 0,
                                n = 0,
                                r = 0,
                                a = 0
                            return (
                                e.length && (void 0 !== e[0].duration && (i = 1), void 0 !== e[0].size && (n = 2), void 0 !== e[0].flags && (r = 4), void 0 !== e[0].compositionTimeOffset && (a = 8)),
                                [
                                    0,
                                    0,
                                    i | n | r | a,
                                    1,
                                    (4278190080 & e.length) >>> 24,
                                    (16711680 & e.length) >>> 16,
                                    (65280 & e.length) >>> 8,
                                    255 & e.length,
                                    (4278190080 & t) >>> 24,
                                    (16711680 & t) >>> 16,
                                    (65280 & t) >>> 8,
                                    255 & t,
                                ]
                            )
                        }),
                        (B = function (e, t) {
                            var i,
                                n,
                                r,
                                a,
                                s = e.samples || []
                            for (t += 20 + 16 * s.length, t = U(s, t), (n = new Uint8Array(t.length + 16 * s.length)).set(t), i = t.length, a = 0; a < s.length; a++)
                                (r = s[a]),
                                    (n[i++] = (4278190080 & r.duration) >>> 24),
                                    (n[i++] = (16711680 & r.duration) >>> 16),
                                    (n[i++] = (65280 & r.duration) >>> 8),
                                    (n[i++] = 255 & r.duration),
                                    (n[i++] = (4278190080 & r.size) >>> 24),
                                    (n[i++] = (16711680 & r.size) >>> 16),
                                    (n[i++] = (65280 & r.size) >>> 8),
                                    (n[i++] = 255 & r.size),
                                    (n[i++] = (r.flags.isLeading << 2) | r.flags.dependsOn),
                                    (n[i++] = (r.flags.isDependedOn << 6) | (r.flags.hasRedundancy << 4) | (r.flags.paddingValue << 1) | r.flags.isNonSyncSample),
                                    (n[i++] = 61440 & r.flags.degradationPriority),
                                    (n[i++] = 15 & r.flags.degradationPriority),
                                    (n[i++] = (4278190080 & r.compositionTimeOffset) >>> 24),
                                    (n[i++] = (16711680 & r.compositionTimeOffset) >>> 16),
                                    (n[i++] = (65280 & r.compositionTimeOffset) >>> 8),
                                    (n[i++] = 255 & r.compositionTimeOffset)
                            return u(T.trun, n)
                        }),
                        (F = function (e, t) {
                            var i,
                                n,
                                r,
                                a,
                                s = e.samples || []
                            for (t += 20 + 8 * s.length, t = U(s, t), (i = new Uint8Array(t.length + 8 * s.length)).set(t), n = t.length, a = 0; a < s.length; a++)
                                (r = s[a]),
                                    (i[n++] = (4278190080 & r.duration) >>> 24),
                                    (i[n++] = (16711680 & r.duration) >>> 16),
                                    (i[n++] = (65280 & r.duration) >>> 8),
                                    (i[n++] = 255 & r.duration),
                                    (i[n++] = (4278190080 & r.size) >>> 24),
                                    (i[n++] = (16711680 & r.size) >>> 16),
                                    (i[n++] = (65280 & r.size) >>> 8),
                                    (i[n++] = 255 & r.size)
                            return u(T.trun, i)
                        }),
                        (b = function (e, t) {
                            return ('audio' === e.type ? F : B)(e, t)
                        })
                    n = function () {
                        return u(T.ftyp, S, w, S, E)
                    }
                    function W(e, t) {
                        var i = { size: 0, flags: { isLeading: 0, dependsOn: 1, isDependedOn: 0, hasRedundancy: 0, degradationPriority: 0, isNonSyncSample: 1 } }
                        return (
                            (i.dataOffset = t),
                            (i.compositionTimeOffset = e.pts - e.dts),
                            (i.duration = e.duration),
                            (i.size = 4 * e.length),
                            (i.size += e.byteLength),
                            e.keyFrame && ((i.flags.dependsOn = 2), (i.flags.isNonSyncSample = 0)),
                            i
                        )
                    }
                    function G(e) {
                        for (var t = []; e--; ) t.push(0)
                        return t
                    }
                    function z() {
                        var e, i
                        return (
                            X ||
                                ((e = {
                                    96e3: [ie, [227, 64], G(154), [56]],
                                    88200: [ie, [231], G(170), [56]],
                                    64e3: [ie, [248, 192], G(240), [56]],
                                    48e3: [ie, [255, 192], G(268), [55, 148, 128], G(54), [112]],
                                    44100: [ie, [255, 192], G(268), [55, 163, 128], G(84), [112]],
                                    32e3: [ie, [255, 192], G(268), [55, 234], G(226), [112]],
                                    24e3: [ie, [255, 192], G(268), [55, 255, 128], G(268), [111, 112], G(126), [224]],
                                    16e3: [ie, [255, 192], G(268), [55, 255, 128], G(268), [111, 255], G(269), [223, 108], G(195), [1, 192]],
                                    12e3: [ne, G(268), [3, 127, 248], G(268), [6, 255, 240], G(268), [13, 255, 224], G(268), [27, 253, 128], G(259), [56]],
                                    11025: [ne, G(268), [3, 127, 248], G(268), [6, 255, 240], G(268), [13, 255, 224], G(268), [27, 255, 192], G(268), [55, 175, 128], G(108), [112]],
                                    8e3: [ne, G(268), [3, 121, 16], G(47), [7]],
                                }),
                                (i = e),
                                (X = Object.keys(i).reduce(function (e, t) {
                                    return (
                                        (e[t] = new Uint8Array(
                                            i[t].reduce(function (e, t) {
                                                return e.concat(t)
                                            }, [])
                                        )),
                                        e
                                    )
                                }, {}))),
                            X
                        )
                    }
                    var X,
                        K = function (e) {
                            return u(T.mdat, e)
                        },
                        Y = We,
                        Q = function (e) {
                            var t = n(),
                                i = s(e),
                                e = new Uint8Array(t.byteLength + i.byteLength)
                            return e.set(t), e.set(i, t.byteLength), e
                        },
                        $ = function (e) {
                            var t,
                                i,
                                n = [],
                                r = []
                            for (r.byteLength = 0, r.nalCount = 0, r.duration = 0, t = n.byteLength = 0; t < e.length; t++)
                                'access_unit_delimiter_rbsp' === (i = e[t]).nalUnitType
                                    ? (n.length && ((n.duration = i.dts - n.dts), (r.byteLength += n.byteLength), (r.nalCount += n.length), (r.duration += n.duration), r.push(n)),
                                      ((n = [i]).byteLength = i.data.byteLength),
                                      (n.pts = i.pts),
                                      (n.dts = i.dts))
                                    : ('slice_layer_without_partitioning_rbsp_idr' === i.nalUnitType && (n.keyFrame = !0), (n.duration = i.dts - n.dts), (n.byteLength += i.data.byteLength), n.push(i))
                            return (
                                r.length && (!n.duration || n.duration <= 0) && (n.duration = r[r.length - 1].duration),
                                (r.byteLength += n.byteLength),
                                (r.nalCount += n.length),
                                (r.duration += n.duration),
                                r.push(n),
                                r
                            )
                        },
                        J = function (e) {
                            var t,
                                i,
                                n = [],
                                r = []
                            for (
                                n.byteLength = 0,
                                    n.nalCount = 0,
                                    n.duration = 0,
                                    n.pts = e[0].pts,
                                    n.dts = e[0].dts,
                                    r.byteLength = 0,
                                    r.nalCount = 0,
                                    r.duration = 0,
                                    r.pts = e[0].pts,
                                    r.dts = e[0].dts,
                                    t = 0;
                                t < e.length;
                                t++
                            )
                                (i = e[t]).keyFrame
                                    ? (n.length && (r.push(n), (r.byteLength += n.byteLength), (r.nalCount += n.nalCount), (r.duration += n.duration)),
                                      ((n = [i]).nalCount = i.length),
                                      (n.byteLength = i.byteLength),
                                      (n.pts = i.pts),
                                      (n.dts = i.dts),
                                      (n.duration = i.duration))
                                    : ((n.duration += i.duration), (n.nalCount += i.length), (n.byteLength += i.byteLength), n.push(i))
                            return (
                                r.length && n.duration <= 0 && (n.duration = r[r.length - 1].duration),
                                (r.byteLength += n.byteLength),
                                (r.nalCount += n.nalCount),
                                (r.duration += n.duration),
                                r.push(n),
                                r
                            )
                        },
                        Z = function (e) {
                            var t
                            return (
                                !e[0][0].keyFrame &&
                                    1 < e.length &&
                                    ((t = e.shift()), (e.byteLength -= t.byteLength), (e.nalCount -= t.nalCount), (e[0][0].dts = t.dts), (e[0][0].pts = t.pts), (e[0][0].duration += t.duration)),
                                e
                            )
                        },
                        ee = function (e, t) {
                            for (var i, n, r, a = t || 0, s = [], o = 0; o < e.length; o++) for (n = e[o], i = 0; i < n.length; i++) (r = n[i]), (a += (r = W(r, a)).size), s.push(r)
                            return s
                        },
                        te = function (e) {
                            for (var t, i, n, r, a, s = 0, o = e.byteLength, u = e.nalCount, l = new Uint8Array(o + 4 * u), c = new DataView(l.buffer), d = 0; d < e.length; d++)
                                for (n = e[d], t = 0; t < n.length; t++)
                                    for (r = n[t], i = 0; i < r.length; i++) (a = r[i]), c.setUint32(s, a.data.byteLength), l.set(a.data, (s += 4)), (s += a.data.byteLength)
                            return l
                        },
                        ie = [33, 16, 5, 32, 164, 27],
                        ne = [33, 65, 108, 84, 1, 2, 4, 8, 168, 2, 4, 8, 17, 191, 252],
                        re = function (e) {
                            return 9e4 * e
                        },
                        ae = function (e, t) {
                            return e * t
                        },
                        se = function (e) {
                            return e / 9e4
                        },
                        oe = function (e, t) {
                            return e / t
                        },
                        ue = 9e4,
                        le = re,
                        ce = se,
                        de = function (e, t) {
                            return re(oe(e, t))
                        },
                        he = function (e, t) {
                            return ae(se(e), t)
                        },
                        pe = function (e, t, i) {
                            return se(i ? e : e - t)
                        },
                        fe = function (e, t, i, n) {
                            var r,
                                a,
                                s,
                                o,
                                u,
                                l,
                                c = 0,
                                d = 0
                            if (
                                t.length &&
                                ((r = de(e.baseMediaDecodeTime, e.samplerate)),
                                (a = Math.ceil(ue / (e.samplerate / 1024))),
                                i && n && ((s = r - Math.max(i, n)), (d = (c = Math.floor(s / a)) * a)),
                                !(c < 1 || ue / 2 < d))
                            ) {
                                for (o = (o = z()[e.samplerate]) || t[0].data, u = 0; u < c; u++) (l = t[0]), t.splice(0, 0, { data: o, dts: l.dts - a, pts: l.pts - a })
                                return (e.baseMediaDecodeTime -= Math.floor(he(d, e.samplerate))), d
                            }
                        },
                        me = function (e, t, i) {
                            return t.minSegmentDts >= i
                                ? e
                                : ((t.minSegmentDts = 1 / 0),
                                  e.filter(function (e) {
                                      return e.dts >= i && ((t.minSegmentDts = Math.min(t.minSegmentDts, e.dts)), (t.minSegmentPts = t.minSegmentDts), !0)
                                  }))
                        },
                        ge = function (e) {
                            for (var t, i = [], n = 0; n < e.length; n++) (t = e[n]), i.push({ size: t.data.byteLength, duration: 1024 })
                            return i
                        },
                        ye = function (e) {
                            for (
                                var t,
                                    i = 0,
                                    n = new Uint8Array(
                                        (function (e) {
                                            for (var t = 0, i = 0; i < e.length; i++) t += e[i].data.byteLength
                                            return t
                                        })(e)
                                    ),
                                    r = 0;
                                r < e.length;
                                r++
                            )
                                (t = e[r]), n.set(t.data, i), (i += t.data.byteLength)
                            return n
                        },
                        ve = ue,
                        _e = function (e) {
                            delete e.minSegmentDts, delete e.maxSegmentDts, delete e.minSegmentPts, delete e.maxSegmentPts
                        },
                        be = function (e, t) {
                            var i = e.minSegmentDts
                            return (
                                t || (i -= e.timelineStartInfo.dts),
                                (t = e.timelineStartInfo.baseMediaDecodeTime),
                                (t += i),
                                (t = Math.max(0, t)),
                                'audio' === e.type && ((t *= e.samplerate / ve), (t = Math.floor(t))),
                                t
                            )
                        },
                        Te = function (e, t) {
                            'number' == typeof t.pts &&
                                (void 0 === e.timelineStartInfo.pts && (e.timelineStartInfo.pts = t.pts),
                                void 0 === e.minSegmentPts ? (e.minSegmentPts = t.pts) : (e.minSegmentPts = Math.min(e.minSegmentPts, t.pts)),
                                void 0 === e.maxSegmentPts ? (e.maxSegmentPts = t.pts) : (e.maxSegmentPts = Math.max(e.maxSegmentPts, t.pts))),
                                'number' == typeof t.dts &&
                                    (void 0 === e.timelineStartInfo.dts && (e.timelineStartInfo.dts = t.dts),
                                    void 0 === e.minSegmentDts ? (e.minSegmentDts = t.dts) : (e.minSegmentDts = Math.min(e.minSegmentDts, t.dts)),
                                    void 0 === e.maxSegmentDts ? (e.maxSegmentDts = t.dts) : (e.maxSegmentDts = Math.max(e.maxSegmentDts, t.dts)))
                        },
                        Se = function (e) {
                            for (var t = 0, i = { payloadType: -1, payloadSize: 0 }, n = 0, r = 0; t < e.byteLength && 128 !== e[t]; ) {
                                for (; 255 === e[t]; ) (n += 255), t++
                                for (n += e[t++]; 255 === e[t]; ) (r += 255), t++
                                if (((r += e[t++]), !i.payload && 4 === n)) {
                                    if ('GA94' === String.fromCharCode(e[t + 3], e[t + 4], e[t + 5], e[t + 6])) {
                                        ;(i.payloadType = n), (i.payloadSize = r), (i.payload = e.subarray(t, t + r))
                                        break
                                    }
                                    i.payload = void 0
                                }
                                ;(t += r), (r = n = 0)
                            }
                            return i
                        },
                        we = function (e) {
                            return 181 !== e.payload[0] ||
                                49 != ((e.payload[1] << 8) | e.payload[2]) ||
                                'GA94' !== String.fromCharCode(e.payload[3], e.payload[4], e.payload[5], e.payload[6]) ||
                                3 !== e.payload[7]
                                ? null
                                : e.payload.subarray(8, e.payload.length - 1)
                        },
                        Ee = function (e, t) {
                            var i,
                                n,
                                r,
                                a,
                                s = []
                            if (!(64 & t[0])) return s
                            for (n = 31 & t[0], i = 0; i < n; i++) (a = { type: 3 & t[2 + (r = 3 * i)], pts: e }), 4 & t[2 + r] && ((a.ccData = (t[3 + r] << 8) | t[4 + r]), s.push(a))
                            return s
                        },
                        ke = function (e) {
                            for (var t = e.byteLength, i = [], n = 1; n < t - 2; ) 0 === e[n] && 0 === e[n + 1] && 3 === e[n + 2] ? (i.push(n + 2), (n += 2)) : n++
                            if (0 === i.length) return e
                            for (var r = t - i.length, a = new Uint8Array(r), s = 0, n = 0; n < r; s++, n++) s === i[0] && (s++, i.shift()), (a[n] = e[s])
                            return a
                        },
                        Ce = 4,
                        Ie = function e(t) {
                            ;(t = t || {}),
                                e.prototype.init.call(this),
                                (this.parse708captions_ = 'boolean' != typeof t.parse708captions || t.parse708captions),
                                (this.captionPackets_ = []),
                                (this.ccStreams_ = [new Ue(0, 0), new Ue(0, 1), new Ue(1, 0), new Ue(1, 1)]),
                                this.parse708captions_ && (this.cc708Stream_ = new De({ captionServices: t.captionServices })),
                                this.reset(),
                                this.ccStreams_.forEach(function (e) {
                                    e.on('data', this.trigger.bind(this, 'data')), e.on('partialdone', this.trigger.bind(this, 'partialdone')), e.on('done', this.trigger.bind(this, 'done'))
                                }, this),
                                this.parse708captions_ &&
                                    (this.cc708Stream_.on('data', this.trigger.bind(this, 'data')),
                                    this.cc708Stream_.on('partialdone', this.trigger.bind(this, 'partialdone')),
                                    this.cc708Stream_.on('done', this.trigger.bind(this, 'done')))
                        }
                    ;((Ie.prototype = new j()).push = function (e) {
                        var t, i
                        if ('sei_rbsp' === e.nalUnitType && (t = Se(e.escapedRBSP)).payload && t.payloadType === Ce && (i = we(t)))
                            if (e.dts < this.latestDts_) this.ignoreNextEqualDts_ = !0
                            else {
                                if (e.dts === this.latestDts_ && this.ignoreNextEqualDts_) return this.numSameDts_--, void (this.numSameDts_ || (this.ignoreNextEqualDts_ = !1))
                                ;(i = Ee(e.pts, i)),
                                    (this.captionPackets_ = this.captionPackets_.concat(i)),
                                    this.latestDts_ !== e.dts && (this.numSameDts_ = 0),
                                    this.numSameDts_++,
                                    (this.latestDts_ = e.dts)
                            }
                    }),
                        (Ie.prototype.flushCCStreams = function (t) {
                            this.ccStreams_.forEach(function (e) {
                                return 'flush' === t ? e.flush() : e.partialFlush()
                            }, this)
                        }),
                        (Ie.prototype.flushStream = function (e) {
                            this.captionPackets_.length &&
                                (this.captionPackets_.forEach(function (e, t) {
                                    e.presortIndex = t
                                }),
                                this.captionPackets_.sort(function (e, t) {
                                    return e.pts === t.pts ? e.presortIndex - t.presortIndex : e.pts - t.pts
                                }),
                                this.captionPackets_.forEach(function (e) {
                                    e.type < 2 ? this.dispatchCea608Packet(e) : this.dispatchCea708Packet(e)
                                }, this),
                                (this.captionPackets_.length = 0)),
                                this.flushCCStreams(e)
                        }),
                        (Ie.prototype.flush = function () {
                            return this.flushStream('flush')
                        }),
                        (Ie.prototype.partialFlush = function () {
                            return this.flushStream('partialFlush')
                        }),
                        (Ie.prototype.reset = function () {
                            ;(this.latestDts_ = null),
                                (this.ignoreNextEqualDts_ = !1),
                                (this.numSameDts_ = 0),
                                (this.activeCea608Channel_ = [null, null]),
                                this.ccStreams_.forEach(function (e) {
                                    e.reset()
                                })
                        }),
                        (Ie.prototype.dispatchCea608Packet = function (e) {
                            this.setsTextOrXDSActive(e)
                                ? (this.activeCea608Channel_[e.type] = null)
                                : this.setsChannel1Active(e)
                                ? (this.activeCea608Channel_[e.type] = 0)
                                : this.setsChannel2Active(e) && (this.activeCea608Channel_[e.type] = 1),
                                null !== this.activeCea608Channel_[e.type] && this.ccStreams_[(e.type << 1) + this.activeCea608Channel_[e.type]].push(e)
                        }),
                        (Ie.prototype.setsChannel1Active = function (e) {
                            return 4096 == (30720 & e.ccData)
                        }),
                        (Ie.prototype.setsChannel2Active = function (e) {
                            return 6144 == (30720 & e.ccData)
                        }),
                        (Ie.prototype.setsTextOrXDSActive = function (e) {
                            return 256 == (28928 & e.ccData) || 4138 == (30974 & e.ccData) || 6186 == (30974 & e.ccData)
                        }),
                        (Ie.prototype.dispatchCea708Packet = function (e) {
                            this.parse708captions_ && this.cc708Stream_.push(e)
                        })
                    function xe(e) {
                        return (32 <= e && e <= 127) || (160 <= e && e <= 255)
                    }
                    function Ae(e) {
                        ;(this.windowNum = e), this.reset()
                    }
                    var Pe = {
                        127: 9834,
                        4128: 32,
                        4129: 160,
                        4133: 8230,
                        4138: 352,
                        4140: 338,
                        4144: 9608,
                        4145: 8216,
                        4146: 8217,
                        4147: 8220,
                        4148: 8221,
                        4149: 8226,
                        4153: 8482,
                        4154: 353,
                        4156: 339,
                        4157: 8480,
                        4159: 376,
                        4214: 8539,
                        4215: 8540,
                        4216: 8541,
                        4217: 8542,
                        4218: 9168,
                        4219: 9124,
                        4220: 9123,
                        4221: 9135,
                        4222: 9126,
                        4223: 9121,
                        4256: 12600,
                    }
                    ;(Ae.prototype.reset = function () {
                        this.clearText(),
                            (this.pendingNewLine = !1),
                            (this.winAttr = {}),
                            (this.penAttr = {}),
                            (this.penLoc = {}),
                            (this.penColor = {}),
                            (this.visible = 0),
                            (this.rowLock = 0),
                            (this.columnLock = 0),
                            (this.priority = 0),
                            (this.relativePositioning = 0),
                            (this.anchorVertical = 0),
                            (this.anchorHorizontal = 0),
                            (this.anchorPoint = 0),
                            (this.rowCount = 1),
                            (this.virtualRowCount = this.rowCount + 1),
                            (this.columnCount = 41),
                            (this.windowStyle = 0),
                            (this.penStyle = 0)
                    }),
                        (Ae.prototype.getText = function () {
                            return this.rows.join('\n')
                        }),
                        (Ae.prototype.clearText = function () {
                            ;(this.rows = ['']), (this.rowIdx = 0)
                        }),
                        (Ae.prototype.newLine = function (e) {
                            for (
                                this.rows.length >= this.virtualRowCount && 'function' == typeof this.beforeRowOverflow && this.beforeRowOverflow(e),
                                    0 < this.rows.length && (this.rows.push(''), this.rowIdx++);
                                this.rows.length > this.virtualRowCount;

                            )
                                this.rows.shift(), this.rowIdx--
                        }),
                        (Ae.prototype.isEmpty = function () {
                            return 0 === this.rows.length || (1 === this.rows.length && '' === this.rows[0])
                        }),
                        (Ae.prototype.addText = function (e) {
                            this.rows[this.rowIdx] += e
                        }),
                        (Ae.prototype.backspace = function () {
                            var e
                            this.isEmpty() || ((e = this.rows[this.rowIdx]), (this.rows[this.rowIdx] = e.substr(0, e.length - 1)))
                        })
                    function Le(e, t, i) {
                        ;(this.serviceNum = e), (this.text = ''), (this.currentWindow = new Ae(-1)), (this.windows = []), (this.stream = i), 'string' == typeof t && this.createTextDecoder(t)
                    }
                    ;(Le.prototype.init = function (e, t) {
                        this.startPts = e
                        for (var i = 0; i < 8; i++) (this.windows[i] = new Ae(i)), 'function' == typeof t && (this.windows[i].beforeRowOverflow = t)
                    }),
                        (Le.prototype.setCurrentWindow = function (e) {
                            this.currentWindow = this.windows[e]
                        }),
                        (Le.prototype.createTextDecoder = function (t) {
                            if ('undefined' == typeof TextDecoder) this.stream.trigger('log', { level: 'warn', message: 'The `encoding` option is unsupported without TextDecoder support' })
                            else
                                try {
                                    this.textDecoder_ = new TextDecoder(t)
                                } catch (e) {
                                    this.stream.trigger('log', { level: 'warn', message: 'TextDecoder could not be created with ' + t + ' encoding. ' + e })
                                }
                        })
                    var De = function e(t) {
                        ;(t = t || {}), e.prototype.init.call(this)
                        var i,
                            n = this,
                            r = t.captionServices || {},
                            a = {}
                        Object.keys(r).forEach(function (e) {
                            ;(i = r[e]), /^SERVICE/.test(e) && (a[e] = i.encoding)
                        }),
                            (this.serviceEncodings = a),
                            (this.current708Packet = null),
                            (this.services = {}),
                            (this.push = function (e) {
                                ;(3 === e.type || null === n.current708Packet) && n.new708Packet(), n.add708Bytes(e)
                            })
                    }
                    ;(De.prototype = new j()),
                        (De.prototype.new708Packet = function () {
                            null !== this.current708Packet && this.push708Packet(), (this.current708Packet = { data: [], ptsVals: [] })
                        }),
                        (De.prototype.add708Bytes = function (e) {
                            var t = e.ccData,
                                i = t >>> 8,
                                t = 255 & t
                            this.current708Packet.ptsVals.push(e.pts), this.current708Packet.data.push(i), this.current708Packet.data.push(t)
                        }),
                        (De.prototype.push708Packet = function () {
                            var e,
                                t = this.current708Packet,
                                i = t.data,
                                n = null,
                                r = 0,
                                a = i[r++]
                            for (t.seq = a >> 6, t.sizeCode = 63 & a; r < i.length; r++)
                                (e = 31 & (a = i[r++])), 7 === (n = a >> 5) && 0 < e && (n = i[r++]), this.pushServiceBlock(n, r, e), 0 < e && (r += e - 1)
                        }),
                        (De.prototype.pushServiceBlock = function (e, t, i) {
                            for (var n, r = t, a = this.current708Packet.data, s = (s = this.services[e]) || this.initService(e, r); r < t + i && r < a.length; r++)
                                (n = a[r]),
                                    xe(n)
                                        ? (r = this.handleText(r, s))
                                        : 24 === n
                                        ? (r = this.multiByteCharacter(r, s))
                                        : 16 === n
                                        ? (r = this.extendedCommands(r, s))
                                        : 128 <= n && n <= 135
                                        ? (r = this.setCurrentWindow(r, s))
                                        : 152 <= n && n <= 159
                                        ? (r = this.defineWindow(r, s))
                                        : 136 === n
                                        ? (r = this.clearWindows(r, s))
                                        : 140 === n
                                        ? (r = this.deleteWindows(r, s))
                                        : 137 === n
                                        ? (r = this.displayWindows(r, s))
                                        : 138 === n
                                        ? (r = this.hideWindows(r, s))
                                        : 139 === n
                                        ? (r = this.toggleWindows(r, s))
                                        : 151 === n
                                        ? (r = this.setWindowAttributes(r, s))
                                        : 144 === n
                                        ? (r = this.setPenAttributes(r, s))
                                        : 145 === n
                                        ? (r = this.setPenColor(r, s))
                                        : 146 === n
                                        ? (r = this.setPenLocation(r, s))
                                        : 143 === n
                                        ? (s = this.reset(r, s))
                                        : 8 === n
                                        ? s.currentWindow.backspace()
                                        : 12 === n
                                        ? s.currentWindow.clearText()
                                        : 13 === n
                                        ? (s.currentWindow.pendingNewLine = !0)
                                        : 14 === n
                                        ? s.currentWindow.clearText()
                                        : 141 === n && r++
                        }),
                        (De.prototype.extendedCommands = function (e, t) {
                            var i = this.current708Packet.data[++e]
                            return (e = xe(i) ? this.handleText(e, t, { isExtended: !0 }) : e)
                        }),
                        (De.prototype.getPts = function (e) {
                            return this.current708Packet.ptsVals[Math.floor(e / 2)]
                        }),
                        (De.prototype.initService = function (t, e) {
                            var i,
                                n = 'SERVICE' + t,
                                r = this
                            return (
                                n in this.serviceEncodings && (i = this.serviceEncodings[n]),
                                (this.services[t] = new Le(t, i, r)),
                                this.services[t].init(this.getPts(e), function (e) {
                                    r.flushDisplayed(e, r.services[t])
                                }),
                                this.services[t]
                            )
                        }),
                        (De.prototype.handleText = function (e, t, i) {
                            var n,
                                r = i && i.isExtended,
                                a = i && i.isMultiByte,
                                s = this.current708Packet.data,
                                o = r ? 4096 : 0,
                                u = s[e],
                                i = s[e + 1],
                                s = t.currentWindow,
                                l =
                                    t.textDecoder_ && !r
                                        ? (a ? ((n = [u, i]), e++) : (n = [u]), t.textDecoder_.decode(new Uint8Array(n)))
                                        : ((l = Pe[(u = o | u)] || u), 4096 & u && u === l ? '' : String.fromCharCode(l))
                            return s.pendingNewLine && !s.isEmpty() && s.newLine(this.getPts(e)), (s.pendingNewLine = !1), s.addText(l), e
                        }),
                        (De.prototype.multiByteCharacter = function (e, t) {
                            var i = this.current708Packet.data,
                                n = i[e + 1],
                                i = i[e + 2]
                            return (e = xe(n) && xe(i) ? this.handleText(++e, t, { isMultiByte: !0 }) : e)
                        }),
                        (De.prototype.setCurrentWindow = function (e, t) {
                            var i = this.current708Packet.data[e]
                            return t.setCurrentWindow(7 & i), e
                        }),
                        (De.prototype.defineWindow = function (e, t) {
                            var i = this.current708Packet.data,
                                n = i[e]
                            t.setCurrentWindow(7 & n)
                            ;(t = t.currentWindow), (n = i[++e])
                            return (
                                (t.visible = (32 & n) >> 5),
                                (t.rowLock = (16 & n) >> 4),
                                (t.columnLock = (8 & n) >> 3),
                                (t.priority = 7 & n),
                                (n = i[++e]),
                                (t.relativePositioning = (128 & n) >> 7),
                                (t.anchorVertical = 127 & n),
                                (n = i[++e]),
                                (t.anchorHorizontal = n),
                                (n = i[++e]),
                                (t.anchorPoint = (240 & n) >> 4),
                                (t.rowCount = 15 & n),
                                (n = i[++e]),
                                (t.columnCount = 63 & n),
                                (n = i[++e]),
                                (t.windowStyle = (56 & n) >> 3),
                                (t.penStyle = 7 & n),
                                (t.virtualRowCount = t.rowCount + 1),
                                e
                            )
                        }),
                        (De.prototype.setWindowAttributes = function (e, t) {
                            var i = this.current708Packet.data,
                                n = i[e],
                                t = t.currentWindow.winAttr,
                                n = i[++e]
                            return (
                                (t.fillOpacity = (192 & n) >> 6),
                                (t.fillRed = (48 & n) >> 4),
                                (t.fillGreen = (12 & n) >> 2),
                                (t.fillBlue = 3 & n),
                                (n = i[++e]),
                                (t.borderType = (192 & n) >> 6),
                                (t.borderRed = (48 & n) >> 4),
                                (t.borderGreen = (12 & n) >> 2),
                                (t.borderBlue = 3 & n),
                                (n = i[++e]),
                                (t.borderType += (128 & n) >> 5),
                                (t.wordWrap = (64 & n) >> 6),
                                (t.printDirection = (48 & n) >> 4),
                                (t.scrollDirection = (12 & n) >> 2),
                                (t.justify = 3 & n),
                                (n = i[++e]),
                                (t.effectSpeed = (240 & n) >> 4),
                                (t.effectDirection = (12 & n) >> 2),
                                (t.displayEffect = 3 & n),
                                e
                            )
                        }),
                        (De.prototype.flushDisplayed = function (e, t) {
                            for (var i = [], n = 0; n < 8; n++) t.windows[n].visible && !t.windows[n].isEmpty() && i.push(t.windows[n].getText())
                            ;(t.endPts = e), (t.text = i.join('\n\n')), this.pushCaption(t), (t.startPts = e)
                        }),
                        (De.prototype.pushCaption = function (e) {
                            '' !== e.text && (this.trigger('data', { startPts: e.startPts, endPts: e.endPts, text: e.text, stream: 'cc708_' + e.serviceNum }), (e.text = ''), (e.startPts = e.endPts))
                        }),
                        (De.prototype.displayWindows = function (e, t) {
                            var i = this.current708Packet.data[++e],
                                n = this.getPts(e)
                            this.flushDisplayed(n, t)
                            for (var r = 0; r < 8; r++) i & (1 << r) && (t.windows[r].visible = 1)
                            return e
                        }),
                        (De.prototype.hideWindows = function (e, t) {
                            var i = this.current708Packet.data[++e],
                                n = this.getPts(e)
                            this.flushDisplayed(n, t)
                            for (var r = 0; r < 8; r++) i & (1 << r) && (t.windows[r].visible = 0)
                            return e
                        }),
                        (De.prototype.toggleWindows = function (e, t) {
                            var i = this.current708Packet.data[++e],
                                n = this.getPts(e)
                            this.flushDisplayed(n, t)
                            for (var r = 0; r < 8; r++) i & (1 << r) && (t.windows[r].visible ^= 1)
                            return e
                        }),
                        (De.prototype.clearWindows = function (e, t) {
                            var i = this.current708Packet.data[++e],
                                n = this.getPts(e)
                            this.flushDisplayed(n, t)
                            for (var r = 0; r < 8; r++) i & (1 << r) && t.windows[r].clearText()
                            return e
                        }),
                        (De.prototype.deleteWindows = function (e, t) {
                            var i = this.current708Packet.data[++e],
                                n = this.getPts(e)
                            this.flushDisplayed(n, t)
                            for (var r = 0; r < 8; r++) i & (1 << r) && t.windows[r].reset()
                            return e
                        }),
                        (De.prototype.setPenAttributes = function (e, t) {
                            var i = this.current708Packet.data,
                                n = i[e],
                                t = t.currentWindow.penAttr,
                                n = i[++e]
                            return (
                                (t.textTag = (240 & n) >> 4),
                                (t.offset = (12 & n) >> 2),
                                (t.penSize = 3 & n),
                                (n = i[++e]),
                                (t.italics = (128 & n) >> 7),
                                (t.underline = (64 & n) >> 6),
                                (t.edgeType = (56 & n) >> 3),
                                (t.fontStyle = 7 & n),
                                e
                            )
                        }),
                        (De.prototype.setPenColor = function (e, t) {
                            var i = this.current708Packet.data,
                                n = i[e],
                                t = t.currentWindow.penColor,
                                n = i[++e]
                            return (
                                (t.fgOpacity = (192 & n) >> 6),
                                (t.fgRed = (48 & n) >> 4),
                                (t.fgGreen = (12 & n) >> 2),
                                (t.fgBlue = 3 & n),
                                (n = i[++e]),
                                (t.bgOpacity = (192 & n) >> 6),
                                (t.bgRed = (48 & n) >> 4),
                                (t.bgGreen = (12 & n) >> 2),
                                (t.bgBlue = 3 & n),
                                (n = i[++e]),
                                (t.edgeRed = (48 & n) >> 4),
                                (t.edgeGreen = (12 & n) >> 2),
                                (t.edgeBlue = 3 & n),
                                e
                            )
                        }),
                        (De.prototype.setPenLocation = function (e, t) {
                            var i = this.current708Packet.data,
                                n = i[e],
                                r = t.currentWindow.penLoc
                            return (t.currentWindow.pendingNewLine = !0), (n = i[++e]), (r.row = 15 & n), (n = i[++e]), (r.column = 63 & n), e
                        }),
                        (De.prototype.reset = function (e, t) {
                            var i = this.getPts(e)
                            return this.flushDisplayed(i, t), this.initService(t.serviceNum, e)
                        })
                    function Oe(e) {
                        return null === e ? '' : ((e = Re[e] || e), String.fromCharCode(e))
                    }
                    function Me() {
                        for (var e = [], t = 15; t--; ) e.push('')
                        return e
                    }
                    var Re = {
                            42: 225,
                            92: 233,
                            94: 237,
                            95: 243,
                            96: 250,
                            123: 231,
                            124: 247,
                            125: 209,
                            126: 241,
                            127: 9608,
                            304: 174,
                            305: 176,
                            306: 189,
                            307: 191,
                            308: 8482,
                            309: 162,
                            310: 163,
                            311: 9834,
                            312: 224,
                            313: 160,
                            314: 232,
                            315: 226,
                            316: 234,
                            317: 238,
                            318: 244,
                            319: 251,
                            544: 193,
                            545: 201,
                            546: 211,
                            547: 218,
                            548: 220,
                            549: 252,
                            550: 8216,
                            551: 161,
                            552: 42,
                            553: 39,
                            554: 8212,
                            555: 169,
                            556: 8480,
                            557: 8226,
                            558: 8220,
                            559: 8221,
                            560: 192,
                            561: 194,
                            562: 199,
                            563: 200,
                            564: 202,
                            565: 203,
                            566: 235,
                            567: 206,
                            568: 207,
                            569: 239,
                            570: 212,
                            571: 217,
                            572: 249,
                            573: 219,
                            574: 171,
                            575: 187,
                            800: 195,
                            801: 227,
                            802: 205,
                            803: 204,
                            804: 236,
                            805: 210,
                            806: 242,
                            807: 213,
                            808: 245,
                            809: 123,
                            810: 125,
                            811: 92,
                            812: 94,
                            813: 95,
                            814: 124,
                            815: 126,
                            816: 196,
                            817: 228,
                            818: 214,
                            819: 246,
                            820: 223,
                            821: 165,
                            822: 164,
                            823: 9474,
                            824: 197,
                            825: 229,
                            826: 216,
                            827: 248,
                            828: 9484,
                            829: 9488,
                            830: 9492,
                            831: 9496,
                        },
                        Ne = [4352, 4384, 4608, 4640, 5376, 5408, 5632, 5664, 5888, 5920, 4096, 4864, 4896, 5120, 5152],
                        Ue = function e(t, i) {
                            e.prototype.init.call(this),
                                (this.field_ = t || 0),
                                (this.dataChannel_ = i || 0),
                                (this.name_ = 'CC' + (1 + ((this.field_ << 1) | this.dataChannel_))),
                                this.setConstants(),
                                this.reset(),
                                (this.push = function (e) {
                                    var t,
                                        i,
                                        n,
                                        r,
                                        a = 32639 & e.ccData
                                    a !== this.lastControlCode_
                                        ? (4096 == (61440 & a) ? (this.lastControlCode_ = a) : a !== this.PADDING_ && (this.lastControlCode_ = null),
                                          (t = a >>> 8),
                                          (i = 255 & a),
                                          a === this.PADDING_ ||
                                              (a === this.RESUME_CAPTION_LOADING_
                                                  ? (this.mode_ = 'popOn')
                                                  : a === this.END_OF_CAPTION_
                                                  ? ((this.mode_ = 'popOn'),
                                                    this.clearFormatting(e.pts),
                                                    this.flushDisplayed(e.pts),
                                                    (r = this.displayed_),
                                                    (this.displayed_ = this.nonDisplayed_),
                                                    (this.nonDisplayed_ = r),
                                                    (this.startPts_ = e.pts))
                                                  : a === this.ROLL_UP_2_ROWS_
                                                  ? ((this.rollUpRows_ = 2), this.setRollUp(e.pts))
                                                  : a === this.ROLL_UP_3_ROWS_
                                                  ? ((this.rollUpRows_ = 3), this.setRollUp(e.pts))
                                                  : a === this.ROLL_UP_4_ROWS_
                                                  ? ((this.rollUpRows_ = 4), this.setRollUp(e.pts))
                                                  : a === this.CARRIAGE_RETURN_
                                                  ? (this.clearFormatting(e.pts), this.flushDisplayed(e.pts), this.shiftRowsUp_(), (this.startPts_ = e.pts))
                                                  : a === this.BACKSPACE_
                                                  ? 'popOn' === this.mode_
                                                      ? (this.nonDisplayed_[this.row_] = this.nonDisplayed_[this.row_].slice(0, -1))
                                                      : (this.displayed_[this.row_] = this.displayed_[this.row_].slice(0, -1))
                                                  : a === this.ERASE_DISPLAYED_MEMORY_
                                                  ? (this.flushDisplayed(e.pts), (this.displayed_ = Me()))
                                                  : a === this.ERASE_NON_DISPLAYED_MEMORY_
                                                  ? (this.nonDisplayed_ = Me())
                                                  : a === this.RESUME_DIRECT_CAPTIONING_
                                                  ? ('paintOn' !== this.mode_ && (this.flushDisplayed(e.pts), (this.displayed_ = Me())), (this.mode_ = 'paintOn'), (this.startPts_ = e.pts))
                                                  : this.isSpecialCharacter(t, i)
                                                  ? ((n = Oe((t = (3 & t) << 8) | i)), this[this.mode_](e.pts, n), this.column_++)
                                                  : this.isExtCharacter(t, i)
                                                  ? ('popOn' === this.mode_
                                                        ? (this.nonDisplayed_[this.row_] = this.nonDisplayed_[this.row_].slice(0, -1))
                                                        : (this.displayed_[this.row_] = this.displayed_[this.row_].slice(0, -1)),
                                                    (n = Oe((t = (3 & t) << 8) | i)),
                                                    this[this.mode_](e.pts, n),
                                                    this.column_++)
                                                  : this.isMidRowCode(t, i)
                                                  ? (this.clearFormatting(e.pts),
                                                    this[this.mode_](e.pts, ' '),
                                                    this.column_++,
                                                    14 == (14 & i) && this.addFormatting(e.pts, ['i']),
                                                    1 == (1 & i) && this.addFormatting(e.pts, ['u']))
                                                  : this.isOffsetControlCode(t, i)
                                                  ? (this.column_ += 3 & i)
                                                  : this.isPAC(t, i)
                                                  ? ((r = Ne.indexOf(7968 & a)),
                                                    'rollUp' === this.mode_ && (r - this.rollUpRows_ + 1 < 0 && (r = this.rollUpRows_ - 1), this.setRollUp(e.pts, r)),
                                                    r !== this.row_ && (this.clearFormatting(e.pts), (this.row_ = r)),
                                                    1 & i && -1 === this.formatting_.indexOf('u') && this.addFormatting(e.pts, ['u']),
                                                    16 == (16 & a) && (this.column_ = 4 * ((14 & a) >> 1)),
                                                    this.isColorPAC(i) && 14 == (14 & i) && this.addFormatting(e.pts, ['i']))
                                                  : this.isNormalChar(t) && (0 === i && (i = null), (n = Oe(t)), (n += Oe(i)), this[this.mode_](e.pts, n), (this.column_ += n.length))))
                                        : (this.lastControlCode_ = null)
                                })
                        }
                    ;(Ue.prototype = new j()),
                        (Ue.prototype.flushDisplayed = function (e) {
                            var t = this.displayed_
                                .map(function (e, t) {
                                    try {
                                        return e.trim()
                                    } catch (e) {
                                        return this.trigger('log', { level: 'warn', message: 'Skipping a malformed 608 caption at index ' + t + '.' }), ''
                                    }
                                }, this)
                                .join('\n')
                                .replace(/^\n+|\n+$/g, '')
                            t.length && this.trigger('data', { startPts: this.startPts_, endPts: e, text: t, stream: this.name_ })
                        }),
                        (Ue.prototype.reset = function () {
                            ;(this.mode_ = 'popOn'),
                                (this.topRow_ = 0),
                                (this.startPts_ = 0),
                                (this.displayed_ = Me()),
                                (this.nonDisplayed_ = Me()),
                                (this.lastControlCode_ = null),
                                (this.column_ = 0),
                                (this.row_ = 14),
                                (this.rollUpRows_ = 2),
                                (this.formatting_ = [])
                        }),
                        (Ue.prototype.setConstants = function () {
                            0 === this.dataChannel_
                                ? ((this.BASE_ = 16), (this.EXT_ = 17), (this.CONTROL_ = (20 | this.field_) << 8), (this.OFFSET_ = 23))
                                : 1 === this.dataChannel_ && ((this.BASE_ = 24), (this.EXT_ = 25), (this.CONTROL_ = (28 | this.field_) << 8), (this.OFFSET_ = 31)),
                                (this.PADDING_ = 0),
                                (this.RESUME_CAPTION_LOADING_ = 32 | this.CONTROL_),
                                (this.END_OF_CAPTION_ = 47 | this.CONTROL_),
                                (this.ROLL_UP_2_ROWS_ = 37 | this.CONTROL_),
                                (this.ROLL_UP_3_ROWS_ = 38 | this.CONTROL_),
                                (this.ROLL_UP_4_ROWS_ = 39 | this.CONTROL_),
                                (this.CARRIAGE_RETURN_ = 45 | this.CONTROL_),
                                (this.RESUME_DIRECT_CAPTIONING_ = 41 | this.CONTROL_),
                                (this.BACKSPACE_ = 33 | this.CONTROL_),
                                (this.ERASE_DISPLAYED_MEMORY_ = 44 | this.CONTROL_),
                                (this.ERASE_NON_DISPLAYED_MEMORY_ = 46 | this.CONTROL_)
                        }),
                        (Ue.prototype.isSpecialCharacter = function (e, t) {
                            return e === this.EXT_ && 48 <= t && t <= 63
                        }),
                        (Ue.prototype.isExtCharacter = function (e, t) {
                            return (e === this.EXT_ + 1 || e === this.EXT_ + 2) && 32 <= t && t <= 63
                        }),
                        (Ue.prototype.isMidRowCode = function (e, t) {
                            return e === this.EXT_ && 32 <= t && t <= 47
                        }),
                        (Ue.prototype.isOffsetControlCode = function (e, t) {
                            return e === this.OFFSET_ && 33 <= t && t <= 35
                        }),
                        (Ue.prototype.isPAC = function (e, t) {
                            return e >= this.BASE_ && e < this.BASE_ + 8 && 64 <= t && t <= 127
                        }),
                        (Ue.prototype.isColorPAC = function (e) {
                            return (64 <= e && e <= 79) || (96 <= e && e <= 127)
                        }),
                        (Ue.prototype.isNormalChar = function (e) {
                            return 32 <= e && e <= 127
                        }),
                        (Ue.prototype.setRollUp = function (e, t) {
                            if (
                                ('rollUp' !== this.mode_ && ((this.row_ = 14), (this.mode_ = 'rollUp'), this.flushDisplayed(e), (this.nonDisplayed_ = Me()), (this.displayed_ = Me())),
                                void 0 !== t && t !== this.row_)
                            )
                                for (var i = 0; i < this.rollUpRows_; i++) (this.displayed_[t - i] = this.displayed_[this.row_ - i]), (this.displayed_[this.row_ - i] = '')
                            void 0 === t && (t = this.row_), (this.topRow_ = t - this.rollUpRows_ + 1)
                        }),
                        (Ue.prototype.addFormatting = function (e, t) {
                            this.formatting_ = this.formatting_.concat(t)
                            t = t.reduce(function (e, t) {
                                return e + '<' + t + '>'
                            }, '')
                            this[this.mode_](e, t)
                        }),
                        (Ue.prototype.clearFormatting = function (e) {
                            var t
                            this.formatting_.length &&
                                ((t = this.formatting_.reverse().reduce(function (e, t) {
                                    return e + '</' + t + '>'
                                }, '')),
                                (this.formatting_ = []),
                                this[this.mode_](e, t))
                        }),
                        (Ue.prototype.popOn = function (e, t) {
                            var i = this.nonDisplayed_[this.row_]
                            this.nonDisplayed_[this.row_] = i += t
                        }),
                        (Ue.prototype.rollUp = function (e, t) {
                            var i = this.displayed_[this.row_]
                            this.displayed_[this.row_] = i += t
                        }),
                        (Ue.prototype.shiftRowsUp_ = function () {
                            for (var e = 0; e < this.topRow_; e++) this.displayed_[e] = ''
                            for (e = this.row_ + 1; e < 15; e++) this.displayed_[e] = ''
                            for (e = this.topRow_; e < this.row_; e++) this.displayed_[e] = this.displayed_[e + 1]
                            this.displayed_[this.row_] = ''
                        }),
                        (Ue.prototype.paintOn = function (e, t) {
                            var i = this.displayed_[this.row_]
                            this.displayed_[this.row_] = i += t
                        })
                    function Be(e, t) {
                        var i = 1
                        for (t < e && (i = -1); 4294967296 < Math.abs(t - e); ) e += 8589934592 * i
                        return e
                    }
                    var Fe = { CaptionStream: Ie, Cea608Stream: Ue, Cea708Stream: De },
                        je = { H264_STREAM_TYPE: 27, ADTS_STREAM_TYPE: 15, METADATA_STREAM_TYPE: 21 },
                        e = function e(t) {
                            var i, n
                            e.prototype.init.call(this),
                                (this.type_ = t || 'shared'),
                                (this.push = function (e) {
                                    ;('shared' !== this.type_ && e.type !== this.type_) ||
                                        (void 0 === n && (n = e.dts), (e.dts = Be(e.dts, n)), (e.pts = Be(e.pts, n)), (i = e.dts), this.trigger('data', e))
                                }),
                                (this.flush = function () {
                                    ;(n = i), this.trigger('done')
                                }),
                                (this.endTimeline = function () {
                                    this.flush(), this.trigger('endedtimeline')
                                }),
                                (this.discontinuity = function () {
                                    i = n = void 0
                                }),
                                (this.reset = function () {
                                    this.discontinuity(), this.trigger('reset')
                                })
                        }
                    e.prototype = new j()
                    function He(e, t, i) {
                        for (var n = '', r = t; r < i; r++) n += '%' + ('00' + e[r].toString(16)).slice(-2)
                        return n
                    }
                    function qe(e, t, i) {
                        return decodeURIComponent(He(e, t, i))
                    }
                    function Ve(e) {
                        return (e[0] << 21) | (e[1] << 14) | (e[2] << 7) | e[3]
                    }
                    var We = e,
                        Ie = Be,
                        Ge = {
                            TXXX: function (e) {
                                var t
                                if (3 === e.data[0]) {
                                    for (t = 1; t < e.data.length; t++)
                                        if (0 === e.data[t]) {
                                            ;(e.description = qe(e.data, 1, t)), (e.value = qe(e.data, t + 1, e.data.length).replace(/\0*$/, ''))
                                            break
                                        }
                                    e.data = e.value
                                }
                            },
                            WXXX: function (e) {
                                var t
                                if (3 === e.data[0])
                                    for (t = 1; t < e.data.length; t++)
                                        if (0 === e.data[t]) {
                                            ;(e.description = qe(e.data, 1, t)), (e.url = qe(e.data, t + 1, e.data.length))
                                            break
                                        }
                            },
                            PRIV: function (e) {
                                for (var t, i = 0; i < e.data.length; i++)
                                    if (0 === e.data[i]) {
                                        e.owner = ((t = e.data), unescape(He(t, 0, i)))
                                        break
                                    }
                                ;(e.privateData = e.data.subarray(i + 1)), (e.data = e.privateData)
                            },
                        },
                        ze = function (e) {
                            var t,
                                i = { descriptor: e && e.descriptor },
                                u = 0,
                                l = [],
                                c = 0
                            if ((ze.prototype.init.call(this), (this.dispatchType = je.METADATA_STREAM_TYPE.toString(16)), i.descriptor))
                                for (t = 0; t < i.descriptor.length; t++) this.dispatchType += ('00' + i.descriptor[t].toString(16)).slice(-2)
                            this.push = function (e) {
                                var t, i, n, r, a, s, o
                                if ('timed-metadata' === e.type)
                                    if (
                                        (e.dataAlignmentIndicator && ((c = 0), (l.length = 0)),
                                        0 === l.length && (e.data.length < 10 || e.data[0] !== 'I'.charCodeAt(0) || e.data[1] !== 'D'.charCodeAt(0) || e.data[2] !== '3'.charCodeAt(0)))
                                    )
                                        this.trigger('log', { level: 'warn', message: 'Skipping unrecognized metadata packet' })
                                    else if ((l.push(e), (c += e.data.byteLength), 1 === l.length && ((u = Ve(e.data.subarray(6, 10))), (u += 10)), !(c < u))) {
                                        for (t = { data: new Uint8Array(u), frames: [], pts: l[0].pts, dts: l[0].dts }, r = 0; r < u; )
                                            t.data.set(l[0].data.subarray(0, u - r), r), (r += l[0].data.byteLength), (c -= l[0].data.byteLength), l.shift()
                                        ;(i = 10), 64 & t.data[5] && ((i += 4), (i += Ve(t.data.subarray(10, 14))), (u -= Ve(t.data.subarray(16, 20))))
                                        do {
                                            if ((n = Ve(t.data.subarray(i + 4, i + 8))) < 1)
                                                return void this.trigger('log', { level: 'warn', message: 'Malformed ID3 frame encountered. Skipping metadata parsing.' })
                                        } while (
                                            (((o = { id: String.fromCharCode(t.data[i], t.data[i + 1], t.data[i + 2], t.data[i + 3]), data: t.data.subarray(i + 10, i + n + 10) }).key = o.id),
                                            Ge[o.id] &&
                                                (Ge[o.id](o),
                                                'com.apple.streaming.transportStreamTimestamp' === o.owner &&
                                                    ((s = ((1 & (a = o.data)[3]) << 30) | (a[4] << 22) | (a[5] << 14) | (a[6] << 6) | (a[7] >>> 2)),
                                                    (s *= 4),
                                                    (s += 3 & a[7]),
                                                    (o.timeStamp = s),
                                                    void 0 === t.pts && void 0 === t.dts && ((t.pts = o.timeStamp), (t.dts = o.timeStamp)),
                                                    this.trigger('timestamp', o))),
                                            t.frames.push(o),
                                            (i += 10),
                                            (i += n) < u)
                                        )
                                        this.trigger('data', t)
                                    }
                            }
                        }
                    ze.prototype = new j()
                    var Xe,
                        Ke,
                        e = ze,
                        We = We,
                        Ye = function () {
                            var r = new Uint8Array(188),
                                a = 0
                            Ye.prototype.init.call(this),
                                (this.push = function (e) {
                                    var t,
                                        i = 0,
                                        n = 188
                                    for (a ? ((t = new Uint8Array(e.byteLength + a)).set(r.subarray(0, a)), t.set(e, a), (a = 0)) : (t = e); n < t.byteLength; )
                                        71 !== t[i] || 71 !== t[n] ? (i++, n++) : (this.trigger('data', t.subarray(i, n)), (i += 188), (n += 188))
                                    i < t.byteLength && (r.set(t.subarray(i), 0), (a = t.byteLength - i))
                                }),
                                (this.flush = function () {
                                    188 === a && 71 === r[0] && (this.trigger('data', r), (a = 0)), this.trigger('done')
                                }),
                                (this.endTimeline = function () {
                                    this.flush(), this.trigger('endedtimeline')
                                }),
                                (this.reset = function () {
                                    ;(a = 0), this.trigger('reset')
                                })
                        }
                    ;(Ye.prototype = new j()),
                        ((Xe = function () {
                            var n, r, a, s
                            Xe.prototype.init.call(this),
                                ((s = this).packetsWaitingForPmt = []),
                                (this.programMapTable = void 0),
                                (n = function (e, t) {
                                    var i = 0
                                    t.payloadUnitStartIndicator && (i += e[i] + 1), ('pat' === t.type ? r : a)(e.subarray(i), t)
                                }),
                                (r = function (e, t) {
                                    ;(t.section_number = e[7]), (t.last_section_number = e[8]), (s.pmtPid = ((31 & e[10]) << 8) | e[11]), (t.pmtPid = s.pmtPid)
                                }),
                                (a = function (e, t) {
                                    var i, n
                                    if (1 & e[5]) {
                                        for (
                                            s.programMapTable = { video: null, audio: null, 'timed-metadata': {} }, i = 3 + (((15 & e[1]) << 8) | e[2]) - 4, n = 12 + (((15 & e[10]) << 8) | e[11]);
                                            n < i;

                                        ) {
                                            var r = e[n],
                                                a = ((31 & e[n + 1]) << 8) | e[n + 2]
                                            r === je.H264_STREAM_TYPE && null === s.programMapTable.video
                                                ? (s.programMapTable.video = a)
                                                : r === je.ADTS_STREAM_TYPE && null === s.programMapTable.audio
                                                ? (s.programMapTable.audio = a)
                                                : r === je.METADATA_STREAM_TYPE && (s.programMapTable['timed-metadata'][a] = r),
                                                (n += 5 + (((15 & e[n + 3]) << 8) | e[n + 4]))
                                        }
                                        t.programMapTable = s.programMapTable
                                    }
                                }),
                                (this.push = function (e) {
                                    var t = {},
                                        i = 4
                                    if (((t.payloadUnitStartIndicator = !!(64 & e[1])), (t.pid = 31 & e[1]), (t.pid <<= 8), (t.pid |= e[2]), 1 < (48 & e[3]) >>> 4 && (i += e[i] + 1), 0 === t.pid))
                                        (t.type = 'pat'), n(e.subarray(i), t), this.trigger('data', t)
                                    else if (t.pid === this.pmtPid)
                                        for (t.type = 'pmt', n(e.subarray(i), t), this.trigger('data', t); this.packetsWaitingForPmt.length; )
                                            this.processPes_.apply(this, this.packetsWaitingForPmt.shift())
                                    else void 0 === this.programMapTable ? this.packetsWaitingForPmt.push([e, i, t]) : this.processPes_(e, i, t)
                                }),
                                (this.processPes_ = function (e, t, i) {
                                    i.pid === this.programMapTable.video
                                        ? (i.streamType = je.H264_STREAM_TYPE)
                                        : i.pid === this.programMapTable.audio
                                        ? (i.streamType = je.ADTS_STREAM_TYPE)
                                        : (i.streamType = this.programMapTable['timed-metadata'][i.pid]),
                                        (i.type = 'pes'),
                                        (i.data = e.subarray(t)),
                                        this.trigger('data', i)
                                })
                        }).prototype = new j()),
                        (Xe.STREAM_TYPES = { h264: 27, adts: 15 }),
                        ((Ke = function () {
                            function n(e, t, i) {
                                var n,
                                    r,
                                    a,
                                    s,
                                    o = new Uint8Array(e.size),
                                    u = { type: t },
                                    l = 0,
                                    c = 0
                                if (e.data.length && !(e.size < 9)) {
                                    for (u.trackId = e.data[0].pid, l = 0; l < e.data.length; l++) (n = e.data[l]), o.set(n.data, c), (c += n.data.byteLength)
                                    ;(a = u),
                                        (s = ((r = o)[0] << 16) | (r[1] << 8) | r[2]),
                                        (a.data = new Uint8Array()),
                                        1 == s &&
                                            ((a.packetLength = 6 + ((r[4] << 8) | r[5])),
                                            (a.dataAlignmentIndicator = 0 != (4 & r[6])),
                                            192 & (s = r[7]) &&
                                                ((a.pts = ((14 & r[9]) << 27) | ((255 & r[10]) << 20) | ((254 & r[11]) << 12) | ((255 & r[12]) << 5) | ((254 & r[13]) >>> 3)),
                                                (a.pts *= 4),
                                                (a.pts += (6 & r[13]) >>> 1),
                                                (a.dts = a.pts),
                                                64 & s &&
                                                    ((a.dts = ((14 & r[14]) << 27) | ((255 & r[15]) << 20) | ((254 & r[16]) << 12) | ((255 & r[17]) << 5) | ((254 & r[18]) >>> 3)),
                                                    (a.dts *= 4),
                                                    (a.dts += (6 & r[18]) >>> 1))),
                                            (a.data = r.subarray(9 + r[8]))),
                                        (t = 'video' === t || u.packetLength <= e.size),
                                        (i || t) && ((e.size = 0), (e.data.length = 0)),
                                        t && d.trigger('data', u)
                                }
                            }
                            var t,
                                d = this,
                                r = !1,
                                a = { data: [], size: 0 },
                                s = { data: [], size: 0 },
                                o = { data: [], size: 0 }
                            Ke.prototype.init.call(this),
                                (this.push = function (i) {
                                    ;({
                                        pat: function () {},
                                        pes: function () {
                                            var e, t
                                            switch (i.streamType) {
                                                case je.H264_STREAM_TYPE:
                                                    ;(e = a), (t = 'video')
                                                    break
                                                case je.ADTS_STREAM_TYPE:
                                                    ;(e = s), (t = 'audio')
                                                    break
                                                case je.METADATA_STREAM_TYPE:
                                                    ;(e = o), (t = 'timed-metadata')
                                                    break
                                                default:
                                                    return
                                            }
                                            i.payloadUnitStartIndicator && n(e, t, !0), e.data.push(i), (e.size += i.data.byteLength)
                                        },
                                        pmt: function () {
                                            var e = { type: 'metadata', tracks: [] }
                                            null !== (t = i.programMapTable).video && e.tracks.push({ timelineStartInfo: { baseMediaDecodeTime: 0 }, id: +t.video, codec: 'avc', type: 'video' }),
                                                null !== t.audio && e.tracks.push({ timelineStartInfo: { baseMediaDecodeTime: 0 }, id: +t.audio, codec: 'adts', type: 'audio' }),
                                                (r = !0),
                                                d.trigger('data', e)
                                        },
                                    }[i.type]())
                                }),
                                (this.reset = function () {
                                    ;(a.size = 0), (a.data.length = 0), (s.size = 0), (s.data.length = 0), this.trigger('reset')
                                }),
                                (this.flushStreams_ = function () {
                                    n(a, 'video'), n(s, 'audio'), n(o, 'timed-metadata')
                                }),
                                (this.flush = function () {
                                    var e
                                    !r &&
                                        t &&
                                        ((e = { type: 'metadata', tracks: [] }),
                                        null !== t.video && e.tracks.push({ timelineStartInfo: { baseMediaDecodeTime: 0 }, id: +t.video, codec: 'avc', type: 'video' }),
                                        null !== t.audio && e.tracks.push({ timelineStartInfo: { baseMediaDecodeTime: 0 }, id: +t.audio, codec: 'adts', type: 'audio' }),
                                        d.trigger('data', e)),
                                        (r = !1),
                                        this.flushStreams_(),
                                        this.trigger('done')
                                })
                        }).prototype = new j())
                    var Qe,
                        $e = {
                            PAT_PID: 0,
                            MP2T_PACKET_LENGTH: 188,
                            TransportPacketStream: Ye,
                            TransportParseStream: Xe,
                            ElementaryStream: Ke,
                            TimestampRolloverStream: We,
                            CaptionStream: Fe.CaptionStream,
                            Cea608Stream: Fe.Cea608Stream,
                            Cea708Stream: Fe.Cea708Stream,
                            MetadataStream: e,
                        }
                    for (Qe in je) je.hasOwnProperty(Qe) && ($e[Qe] = je[Qe])
                    var Je = $e,
                        Ze = ue,
                        et = [96e3, 88200, 64e3, 48e3, 44100, 32e3, 24e3, 22050, 16e3, 12e3, 11025, 8e3, 7350],
                        tt = function (u) {
                            var l,
                                c = 0
                            tt.prototype.init.call(this),
                                (this.skipWarn_ = function (e, t) {
                                    this.trigger('log', { level: 'warn', message: 'adts skiping bytes ' + e + ' to ' + t + ' in frame ' + c + ' outside syncword' })
                                }),
                                (this.push = function (e) {
                                    var t,
                                        i,
                                        n,
                                        r,
                                        a,
                                        s,
                                        o = 0
                                    if ((u || (c = 0), 'audio' === e.type)) {
                                        for (l && l.length ? ((n = l), (l = new Uint8Array(n.byteLength + e.data.byteLength)).set(n), l.set(e.data, n.byteLength)) : (l = e.data); o + 7 < l.length; )
                                            if (255 === l[o] && 240 == (246 & l[o + 1])) {
                                                if (
                                                    ('number' == typeof s && (this.skipWarn_(s, o), (s = null)),
                                                    (i = 2 * (1 & ~l[o + 1])),
                                                    (t = ((3 & l[o + 3]) << 11) | (l[o + 4] << 3) | ((224 & l[o + 5]) >> 5)),
                                                    (a = ((r = 1024 * (1 + (3 & l[o + 6]))) * Ze) / et[(60 & l[o + 2]) >>> 2]),
                                                    l.byteLength - o < t)
                                                )
                                                    break
                                                this.trigger('data', {
                                                    pts: e.pts + c * a,
                                                    dts: e.dts + c * a,
                                                    sampleCount: r,
                                                    audioobjecttype: 1 + ((l[o + 2] >>> 6) & 3),
                                                    channelcount: ((1 & l[o + 2]) << 2) | ((192 & l[o + 3]) >>> 6),
                                                    samplerate: et[(60 & l[o + 2]) >>> 2],
                                                    samplingfrequencyindex: (60 & l[o + 2]) >>> 2,
                                                    samplesize: 16,
                                                    data: l.subarray(o + 7 + i, o + t),
                                                }),
                                                    c++,
                                                    (o += t)
                                            } else 'number' != typeof s && (s = o), o++
                                        'number' == typeof s && (this.skipWarn_(s, o), (s = null)), (l = l.subarray(o))
                                    }
                                }),
                                (this.flush = function () {
                                    ;(c = 0), this.trigger('done')
                                }),
                                (this.reset = function () {
                                    ;(l = void 0), this.trigger('reset')
                                }),
                                (this.endTimeline = function () {
                                    ;(l = void 0), this.trigger('endedtimeline')
                                })
                        }
                    tt.prototype = new j()
                    var it,
                        nt,
                        rt = tt,
                        at = function (n) {
                            var r = n.byteLength,
                                a = 0,
                                s = 0
                            ;(this.length = function () {
                                return 8 * r
                            }),
                                (this.bitsAvailable = function () {
                                    return 8 * r + s
                                }),
                                (this.loadWord = function () {
                                    var e = n.byteLength - r,
                                        t = new Uint8Array(4),
                                        i = Math.min(4, r)
                                    if (0 === i) throw new Error('no bytes available')
                                    t.set(n.subarray(e, e + i)), (a = new DataView(t.buffer).getUint32(0)), (s = 8 * i), (r -= i)
                                }),
                                (this.skipBits = function (e) {
                                    var t
                                    e < s || ((e -= s), (e -= 8 * (t = Math.floor(e / 8))), (r -= t), this.loadWord()), (a <<= e), (s -= e)
                                }),
                                (this.readBits = function (e) {
                                    var t = Math.min(s, e),
                                        i = a >>> (32 - t)
                                    return 0 < (s -= t) ? (a <<= t) : 0 < r && this.loadWord(), 0 < (t = e - t) ? (i << t) | this.readBits(t) : i
                                }),
                                (this.skipLeadingZeros = function () {
                                    for (var e = 0; e < s; ++e) if (0 != (a & (2147483648 >>> e))) return (a <<= e), (s -= e), e
                                    return this.loadWord(), e + this.skipLeadingZeros()
                                }),
                                (this.skipUnsignedExpGolomb = function () {
                                    this.skipBits(1 + this.skipLeadingZeros())
                                }),
                                (this.skipExpGolomb = function () {
                                    this.skipBits(1 + this.skipLeadingZeros())
                                }),
                                (this.readUnsignedExpGolomb = function () {
                                    var e = this.skipLeadingZeros()
                                    return this.readBits(e + 1) - 1
                                }),
                                (this.readExpGolomb = function () {
                                    var e = this.readUnsignedExpGolomb()
                                    return 1 & e ? (1 + e) >>> 1 : -1 * (e >>> 1)
                                }),
                                (this.readBoolean = function () {
                                    return 1 === this.readBits(1)
                                }),
                                (this.readUnsignedByte = function () {
                                    return this.readBits(8)
                                }),
                                this.loadWord()
                        },
                        st = function () {
                            var n,
                                r,
                                a = 0
                            st.prototype.init.call(this),
                                (this.push = function (e) {
                                    for (var t, i = (r = r ? ((t = new Uint8Array(r.byteLength + e.data.byteLength)).set(r), t.set(e.data, r.byteLength), t) : e.data).byteLength; a < i - 3; a++)
                                        if (1 === r[a + 2]) {
                                            n = a + 5
                                            break
                                        }
                                    for (; n < i; )
                                        switch (r[n]) {
                                            case 0:
                                                if (0 !== r[n - 1]) {
                                                    n += 2
                                                    break
                                                }
                                                if (0 !== r[n - 2]) {
                                                    n++
                                                    break
                                                }
                                                for (a + 3 !== n - 2 && this.trigger('data', r.subarray(a + 3, n - 2)); 1 !== r[++n] && n < i; );
                                                ;(a = n - 2), (n += 3)
                                                break
                                            case 1:
                                                if (0 !== r[n - 1] || 0 !== r[n - 2]) {
                                                    n += 3
                                                    break
                                                }
                                                this.trigger('data', r.subarray(a + 3, n - 2)), (a = n - 2), (n += 3)
                                                break
                                            default:
                                                n += 3
                                        }
                                    ;(r = r.subarray(a)), (n -= a), (a = 0)
                                }),
                                (this.reset = function () {
                                    ;(r = null), (a = 0), this.trigger('reset')
                                }),
                                (this.flush = function () {
                                    r && 3 < r.byteLength && this.trigger('data', r.subarray(a + 3)), (r = null), (a = 0), this.trigger('done')
                                }),
                                (this.endTimeline = function () {
                                    this.flush(), this.trigger('endedtimeline')
                                })
                        }
                    ;(st.prototype = new j()),
                        (nt = { 100: !0, 110: !0, 122: !0, 244: !0, 44: !0, 83: !0, 86: !0, 118: !0, 128: !0, 138: !0, 139: !0, 134: !0 }),
                        ((it = function () {
                            var i,
                                n,
                                r,
                                a,
                                s,
                                o,
                                m,
                                t = new st()
                            it.prototype.init.call(this),
                                ((i = this).push = function (e) {
                                    'video' === e.type && ((n = e.trackId), (r = e.pts), (a = e.dts), t.push(e))
                                }),
                                t.on('data', function (e) {
                                    var t = { trackId: n, pts: r, dts: a, data: e, nalUnitTypeCode: 31 & e[0] }
                                    switch (t.nalUnitTypeCode) {
                                        case 5:
                                            t.nalUnitType = 'slice_layer_without_partitioning_rbsp_idr'
                                            break
                                        case 6:
                                            ;(t.nalUnitType = 'sei_rbsp'), (t.escapedRBSP = s(e.subarray(1)))
                                            break
                                        case 7:
                                            ;(t.nalUnitType = 'seq_parameter_set_rbsp'), (t.escapedRBSP = s(e.subarray(1))), (t.config = o(t.escapedRBSP))
                                            break
                                        case 8:
                                            t.nalUnitType = 'pic_parameter_set_rbsp'
                                            break
                                        case 9:
                                            t.nalUnitType = 'access_unit_delimiter_rbsp'
                                    }
                                    i.trigger('data', t)
                                }),
                                t.on('done', function () {
                                    i.trigger('done')
                                }),
                                t.on('partialdone', function () {
                                    i.trigger('partialdone')
                                }),
                                t.on('reset', function () {
                                    i.trigger('reset')
                                }),
                                t.on('endedtimeline', function () {
                                    i.trigger('endedtimeline')
                                }),
                                (this.flush = function () {
                                    t.flush()
                                }),
                                (this.partialFlush = function () {
                                    t.partialFlush()
                                }),
                                (this.reset = function () {
                                    t.reset()
                                }),
                                (this.endTimeline = function () {
                                    t.endTimeline()
                                }),
                                (m = function (e, t) {
                                    for (var i = 8, n = 8, r = 0; r < e; r++) i = 0 === (n = 0 !== n ? (i + t.readExpGolomb() + 256) % 256 : n) ? i : n
                                }),
                                (s = function (e) {
                                    for (var t = e.byteLength, i = [], n = 1; n < t - 2; ) 0 === e[n] && 0 === e[n + 1] && 3 === e[n + 2] ? (i.push(n + 2), (n += 2)) : n++
                                    if (0 === i.length) return e
                                    for (var r = t - i.length, a = new Uint8Array(r), s = 0, n = 0; n < r; s++, n++) s === i[0] && (s++, i.shift()), (a[n] = e[s])
                                    return a
                                }),
                                (o = function (e) {
                                    var t,
                                        i,
                                        n,
                                        r,
                                        a,
                                        s = 0,
                                        o = 0,
                                        u = 0,
                                        l = 0,
                                        c = [1, 1],
                                        d = new at(e),
                                        h = d.readUnsignedByte(),
                                        p = d.readUnsignedByte(),
                                        f = d.readUnsignedByte()
                                    if (
                                        (d.skipUnsignedExpGolomb(),
                                        nt[h] && (3 === (i = d.readUnsignedExpGolomb()) && d.skipBits(1), d.skipUnsignedExpGolomb(), d.skipUnsignedExpGolomb(), d.skipBits(1), d.readBoolean()))
                                    )
                                        for (r = 3 !== i ? 8 : 12, a = 0; a < r; a++) d.readBoolean() && m(a < 6 ? 16 : 64, d)
                                    if ((d.skipUnsignedExpGolomb(), 0 === (n = d.readUnsignedExpGolomb()))) d.readUnsignedExpGolomb()
                                    else if (1 === n) for (d.skipBits(1), d.skipExpGolomb(), d.skipExpGolomb(), t = d.readUnsignedExpGolomb(), a = 0; a < t; a++) d.skipExpGolomb()
                                    if (
                                        (d.skipUnsignedExpGolomb(),
                                        d.skipBits(1),
                                        (e = d.readUnsignedExpGolomb()),
                                        (i = d.readUnsignedExpGolomb()),
                                        0 === (n = d.readBits(1)) && d.skipBits(1),
                                        d.skipBits(1),
                                        d.readBoolean() && ((s = d.readUnsignedExpGolomb()), (o = d.readUnsignedExpGolomb()), (u = d.readUnsignedExpGolomb()), (l = d.readUnsignedExpGolomb())),
                                        d.readBoolean() && d.readBoolean())
                                    ) {
                                        switch (d.readUnsignedByte()) {
                                            case 1:
                                                c = [1, 1]
                                                break
                                            case 2:
                                                c = [12, 11]
                                                break
                                            case 3:
                                                c = [10, 11]
                                                break
                                            case 4:
                                                c = [16, 11]
                                                break
                                            case 5:
                                                c = [40, 33]
                                                break
                                            case 6:
                                                c = [24, 11]
                                                break
                                            case 7:
                                                c = [20, 11]
                                                break
                                            case 8:
                                                c = [32, 11]
                                                break
                                            case 9:
                                                c = [80, 33]
                                                break
                                            case 10:
                                                c = [18, 11]
                                                break
                                            case 11:
                                                c = [15, 11]
                                                break
                                            case 12:
                                                c = [64, 33]
                                                break
                                            case 13:
                                                c = [160, 99]
                                                break
                                            case 14:
                                                c = [4, 3]
                                                break
                                            case 15:
                                                c = [3, 2]
                                                break
                                            case 16:
                                                c = [2, 1]
                                                break
                                            case 255:
                                                c = [(d.readUnsignedByte() << 8) | d.readUnsignedByte(), (d.readUnsignedByte() << 8) | d.readUnsignedByte()]
                                        }
                                        c && (c[0], c[1])
                                    }
                                    return { profileIdc: h, levelIdc: f, profileCompatibility: p, width: 16 * (e + 1) - 2 * s - 2 * o, height: (2 - n) * (i + 1) * 16 - 2 * u - 2 * l, sarRatio: c }
                                })
                        }).prototype = new j())
                    function ot(e, t) {
                        var i = 0 <= (i = (e[t + 6] << 21) | (e[t + 7] << 14) | (e[t + 8] << 7) | e[t + 9]) ? i : 0
                        return (16 & e[t + 5]) >> 4 ? i + 20 : i + 10
                    }
                    function ut(e, t) {
                        return e.length - t < 10 || e[t] !== 'I'.charCodeAt(0) || e[t + 1] !== 'D'.charCodeAt(0) || e[t + 2] !== '3'.charCodeAt(0) ? t : ut(e, (t += ot(e, t)))
                    }
                    function lt(e) {
                        return (e[0] << 21) | (e[1] << 14) | (e[2] << 7) | e[3]
                    }
                    var e = { H264Stream: it, NalByteStream: st },
                        ct = [96e3, 88200, 64e3, 48e3, 44100, 32e3, 24e3, 22050, 16e3, 12e3, 11025, 8e3, 7350],
                        dt = {
                            isLikelyAacData: function (e) {
                                var t = ut(e, 0)
                                return e.length >= t + 2 && 255 == (255 & e[t]) && 240 == (240 & e[t + 1]) && 16 == (22 & e[t + 1])
                            },
                            parseId3TagSize: ot,
                            parseAdtsSize: function (e, t) {
                                var i = (224 & e[t + 5]) >> 5,
                                    n = e[t + 4] << 3
                                return (6144 & e[t + 3]) | n | i
                            },
                            parseType: function (e, t) {
                                return e[t] === 'I'.charCodeAt(0) && e[t + 1] === 'D'.charCodeAt(0) && e[t + 2] === '3'.charCodeAt(0)
                                    ? 'timed-metadata'
                                    : !0 & e[t] && 240 == (240 & e[t + 1])
                                    ? 'audio'
                                    : null
                            },
                            parseSampleRate: function (e) {
                                for (var t = 0; t + 5 < e.length; ) {
                                    if (255 === e[t] && 240 == (246 & e[t + 1])) return ct[(60 & e[t + 2]) >>> 2]
                                    t++
                                }
                                return null
                            },
                            parseAacTimestamp: function (e) {
                                var t,
                                    i = 10
                                64 & e[5] && ((i += 4), (i += lt(e.subarray(10, 14))))
                                do {
                                    if ((t = lt(e.subarray(i + 4, i + 8))) < 1) return null
                                    if ('PRIV' === String.fromCharCode(e[i], e[i + 1], e[i + 2], e[i + 3]))
                                        for (var n = e.subarray(i + 10, i + t + 10), r = 0; r < n.byteLength; r++)
                                            if (0 === n[r]) {
                                                if (
                                                    'com.apple.streaming.transportStreamTimestamp' !==
                                                    unescape(
                                                        (function (e, t, i) {
                                                            for (var n = '', r = t; r < i; r++) n += '%' + ('00' + e[r].toString(16)).slice(-2)
                                                            return n
                                                        })(n, 0, r)
                                                    )
                                                )
                                                    break
                                                var a = n.subarray(r + 1),
                                                    s = ((1 & a[3]) << 30) | (a[4] << 22) | (a[5] << 14) | (a[6] << 6) | (a[7] >>> 2)
                                                return (s *= 4), (s += 3 & a[7])
                                            }
                                } while (((i += 10), (i += t) < e.byteLength))
                                return null
                            },
                        },
                        ht = function () {
                            var a = new Uint8Array(),
                                s = 0
                            ht.prototype.init.call(this),
                                (this.setTimestamp = function (e) {
                                    s = e
                                }),
                                (this.push = function (e) {
                                    var t,
                                        i,
                                        n = 0,
                                        r = 0
                                    for (a.length ? ((i = a.length), (a = new Uint8Array(e.byteLength + i)).set(a.subarray(0, i)), a.set(e, i)) : (a = e); 3 <= a.length - r; )
                                        if (a[r] !== 'I'.charCodeAt(0) || a[r + 1] !== 'D'.charCodeAt(0) || a[r + 2] !== '3'.charCodeAt(0))
                                            if (255 != (255 & a[r]) || 240 != (240 & a[r + 1])) r++
                                            else {
                                                if (a.length - r < 7) break
                                                if (r + (n = dt.parseAdtsSize(a, r)) > a.length) break
                                                ;(t = { type: 'audio', data: a.subarray(r, r + n), pts: s, dts: s }), this.trigger('data', t), (r += n)
                                            }
                                        else {
                                            if (a.length - r < 10) break
                                            if (r + (n = dt.parseId3TagSize(a, r)) > a.length) break
                                            ;(t = { type: 'timed-metadata', data: a.subarray(r, r + n) }), this.trigger('data', t), (r += n)
                                        }
                                    ;(e = a.length - r), (a = 0 < e ? a.subarray(r) : new Uint8Array())
                                }),
                                (this.reset = function () {
                                    ;(a = new Uint8Array()), this.trigger('reset')
                                }),
                                (this.endTimeline = function () {
                                    ;(a = new Uint8Array()), this.trigger('endedtimeline')
                                })
                        }
                    ht.prototype = new j()
                    function pt(e, t) {
                        ;(t.stream = e), this.trigger('log', t)
                    }
                    function ft(e, t) {
                        for (var i = Object.keys(t), n = 0; n < i.length; n++) {
                            var r = i[n]
                            'headOfPipeline' !== r && t[r].on && t[r].on('log', pt.bind(e, r))
                        }
                    }
                    function mt(e, t) {
                        var i
                        if (e.length === t.length) {
                            for (i = 0; i < e.length; i++) if (e[i] !== t[i]) return
                            return 1
                        }
                    }
                    function gt(e, t, i, n, r, a) {
                        return { start: { dts: e, pts: e + (i - t) }, end: { dts: e + (n - t), pts: e + (r - i) }, prependedContentDuration: a, baseMediaDecodeTime: e }
                    }
                    var yt,
                        vt,
                        _t,
                        bt = ht,
                        Tt = ['audioobjecttype', 'channelcount', 'samplerate', 'samplingfrequencyindex', 'samplesize'],
                        St = ['width', 'height', 'profileIdc', 'levelIdc', 'profileCompatibility', 'sarRatio'],
                        wt = e.H264Stream,
                        Et = dt.isLikelyAacData,
                        kt = ue,
                        Ct = function (a, s) {
                            var o = [],
                                u = 0,
                                l = 0,
                                c = 1 / 0,
                                d = (s = s || {}).firstSequenceNumber || 0
                            Ct.prototype.init.call(this),
                                (this.push = function (t) {
                                    Te(a, t),
                                        a &&
                                            Tt.forEach(function (e) {
                                                a[e] = t[e]
                                            }),
                                        o.push(t)
                                }),
                                (this.setEarliestDts = function (e) {
                                    u = e
                                }),
                                (this.setVideoBaseMediaDecodeTime = function (e) {
                                    c = e
                                }),
                                (this.setAudioAppendStart = function (e) {
                                    l = e
                                }),
                                (this.flush = function () {
                                    var e, t, i, n, r
                                    0 !== o.length &&
                                        ((e = me(o, a, u)),
                                        (a.baseMediaDecodeTime = be(a, s.keepOriginalTimestamps)),
                                        (r = fe(a, e, l, c)),
                                        (a.samples = ge(e)),
                                        (t = K(ye(e))),
                                        (o = []),
                                        (n = Y(d, [a])),
                                        (i = new Uint8Array(n.byteLength + t.byteLength)),
                                        d++,
                                        i.set(n),
                                        i.set(t, n.byteLength),
                                        _e(a),
                                        (n = Math.ceil((1024 * kt) / a.samplerate)),
                                        e.length &&
                                            ((n = e.length * n),
                                            this.trigger('segmentTimingInfo', gt(de(a.baseMediaDecodeTime, a.samplerate), e[0].dts, e[0].pts, e[0].dts + n, e[0].pts + n, r || 0)),
                                            this.trigger('timingInfo', { start: e[0].pts, end: e[0].pts + n })),
                                        this.trigger('data', { track: a, boxes: i })),
                                        this.trigger('done', 'AudioSegmentStream')
                                }),
                                (this.reset = function () {
                                    _e(a), (o = []), this.trigger('reset')
                                })
                        }
                    ;(Ct.prototype = new j()),
                        ((yt = function (s, a) {
                            var t,
                                i,
                                o = [],
                                l = [],
                                u = (a = a || {}).firstSequenceNumber || 0
                            yt.prototype.init.call(this),
                                delete s.minPTS,
                                (this.gopCache_ = []),
                                (this.push = function (e) {
                                    Te(s, e),
                                        'seq_parameter_set_rbsp' !== e.nalUnitType ||
                                            t ||
                                            ((t = e.config),
                                            (s.sps = [e.data]),
                                            St.forEach(function (e) {
                                                s[e] = t[e]
                                            }, this)),
                                        'pic_parameter_set_rbsp' !== e.nalUnitType || i || ((i = e.data), (s.pps = [e.data])),
                                        o.push(e)
                                }),
                                (this.flush = function () {
                                    for (var e, t, i, n = 0; o.length && 'access_unit_delimiter_rbsp' !== o[0].nalUnitType; ) o.shift()
                                    if (0 === o.length) return this.resetStream_(), void this.trigger('done', 'VideoSegmentStream')
                                    if (
                                        ((e = $(o)),
                                        (t = J(e))[0][0].keyFrame ||
                                            ((i = this.getGopForFusion_(o[0], s))
                                                ? ((n = i.duration),
                                                  t.unshift(i),
                                                  (t.byteLength += i.byteLength),
                                                  (t.nalCount += i.nalCount),
                                                  (t.pts = i.pts),
                                                  (t.dts = i.dts),
                                                  (t.duration += i.duration))
                                                : (t = Z(t))),
                                        l.length)
                                    ) {
                                        var r = a.alignGopsAtEnd ? this.alignGopsAtEnd_(t) : this.alignGopsAtStart_(t)
                                        if (!r)
                                            return (
                                                this.gopCache_.unshift({ gop: t.pop(), pps: s.pps, sps: s.sps }),
                                                (this.gopCache_.length = Math.min(6, this.gopCache_.length)),
                                                (o = []),
                                                this.resetStream_(),
                                                void this.trigger('done', 'VideoSegmentStream')
                                            )
                                        _e(s), (t = r)
                                    }
                                    Te(s, t),
                                        (s.samples = ee(t)),
                                        (e = K(te(t))),
                                        (s.baseMediaDecodeTime = be(s, a.keepOriginalTimestamps)),
                                        this.trigger(
                                            'processedGopsInfo',
                                            t.map(function (e) {
                                                return { pts: e.pts, dts: e.dts, byteLength: e.byteLength }
                                            })
                                        ),
                                        (i = t[0]),
                                        (r = t[t.length - 1]),
                                        this.trigger('segmentTimingInfo', gt(s.baseMediaDecodeTime, i.dts, i.pts, r.dts + r.duration, r.pts + r.duration, n)),
                                        this.trigger('timingInfo', { start: t[0].pts, end: t[t.length - 1].pts + t[t.length - 1].duration }),
                                        this.gopCache_.unshift({ gop: t.pop(), pps: s.pps, sps: s.sps }),
                                        (this.gopCache_.length = Math.min(6, this.gopCache_.length)),
                                        (o = []),
                                        this.trigger('baseMediaDecodeTime', s.baseMediaDecodeTime),
                                        this.trigger('timelineStartInfo', s.timelineStartInfo),
                                        (n = Y(u, [s])),
                                        (t = new Uint8Array(n.byteLength + e.byteLength)),
                                        u++,
                                        t.set(n),
                                        t.set(e, n.byteLength),
                                        this.trigger('data', { track: s, boxes: t }),
                                        this.resetStream_(),
                                        this.trigger('done', 'VideoSegmentStream')
                                }),
                                (this.reset = function () {
                                    this.resetStream_(), (o = []), (this.gopCache_.length = 0), (l.length = 0), this.trigger('reset')
                                }),
                                (this.resetStream_ = function () {
                                    _e(s), (i = t = void 0)
                                }),
                                (this.getGopForFusion_ = function (e) {
                                    for (var t, i, n, r = 1 / 0, a = 0; a < this.gopCache_.length; a++)
                                        (i = (n = this.gopCache_[a]).gop),
                                            s.pps &&
                                                mt(s.pps[0], n.pps[0]) &&
                                                s.sps &&
                                                mt(s.sps[0], n.sps[0]) &&
                                                (i.dts < s.timelineStartInfo.dts || (-1e4 <= (i = e.dts - i.dts - i.duration) && i <= 45e3 && (!t || i < r) && ((t = n), (r = i))))
                                    return t ? t.gop : null
                                }),
                                (this.alignGopsAtStart_ = function (e) {
                                    for (var t, i, n, r, a = e.byteLength, s = e.nalCount, o = e.duration, u = (t = 0); u < l.length && t < e.length && ((i = l[u]), (n = e[t]), i.pts !== n.pts); )
                                        n.pts > i.pts ? u++ : (t++, (a -= n.byteLength), (s -= n.nalCount), (o -= n.duration))
                                    return 0 === t ? e : t === e.length ? null : (((r = e.slice(t)).byteLength = a), (r.duration = o), (r.nalCount = s), (r.pts = r[0].pts), (r.dts = r[0].dts), r)
                                }),
                                (this.alignGopsAtEnd_ = function (e) {
                                    for (var t, i, n = l.length - 1, r = e.length - 1, a = null, s = !1; 0 <= n && 0 <= r; ) {
                                        if (((t = l[n]), (i = e[r]), t.pts === i.pts)) {
                                            s = !0
                                            break
                                        }
                                        t.pts > i.pts ? n-- : (n === l.length - 1 && (a = r), r--)
                                    }
                                    if (!s && null === a) return null
                                    if (0 === (u = s ? r : a)) return e
                                    var o = e.slice(u),
                                        u = o.reduce(
                                            function (e, t) {
                                                return (e.byteLength += t.byteLength), (e.duration += t.duration), (e.nalCount += t.nalCount), e
                                            },
                                            { byteLength: 0, duration: 0, nalCount: 0 }
                                        )
                                    return (o.byteLength = u.byteLength), (o.duration = u.duration), (o.nalCount = u.nalCount), (o.pts = o[0].pts), (o.dts = o[0].dts), o
                                }),
                                (this.alignGopsWith = function (e) {
                                    l = e
                                })
                        }).prototype = new j()),
                        ((_t = function (e, t) {
                            ;(this.numberOfTracks = 0),
                                (this.metadataStream = t),
                                'undefined' != typeof (e = e || {}).remux ? (this.remuxTracks = !!e.remux) : (this.remuxTracks = !0),
                                'boolean' == typeof e.keepOriginalTimestamps ? (this.keepOriginalTimestamps = e.keepOriginalTimestamps) : (this.keepOriginalTimestamps = !1),
                                (this.pendingTracks = []),
                                (this.videoTrack = null),
                                (this.pendingBoxes = []),
                                (this.pendingCaptions = []),
                                (this.pendingMetadata = []),
                                (this.pendingBytes = 0),
                                (this.emittedTracks = 0),
                                _t.prototype.init.call(this),
                                (this.push = function (e) {
                                    return e.text
                                        ? this.pendingCaptions.push(e)
                                        : e.frames
                                        ? this.pendingMetadata.push(e)
                                        : (this.pendingTracks.push(e.track),
                                          (this.pendingBytes += e.boxes.byteLength),
                                          'video' === e.track.type && ((this.videoTrack = e.track), this.pendingBoxes.push(e.boxes)),
                                          void ('audio' === e.track.type && ((this.audioTrack = e.track), this.pendingBoxes.unshift(e.boxes))))
                                })
                        }).prototype = new j()),
                        (_t.prototype.flush = function (e) {
                            var t,
                                i,
                                n,
                                r = 0,
                                a = { captions: [], captionStreams: {}, metadata: [], info: {} },
                                s = 0
                            if (this.pendingTracks.length < this.numberOfTracks) {
                                if ('VideoSegmentStream' !== e && 'AudioSegmentStream' !== e) return
                                if (this.remuxTracks) return
                                if (0 === this.pendingTracks.length) return this.emittedTracks++, void (this.emittedTracks >= this.numberOfTracks && (this.trigger('done'), (this.emittedTracks = 0)))
                            }
                            if (
                                (this.videoTrack
                                    ? ((s = this.videoTrack.timelineStartInfo.pts),
                                      St.forEach(function (e) {
                                          a.info[e] = this.videoTrack[e]
                                      }, this))
                                    : this.audioTrack &&
                                      ((s = this.audioTrack.timelineStartInfo.pts),
                                      Tt.forEach(function (e) {
                                          a.info[e] = this.audioTrack[e]
                                      }, this)),
                                this.videoTrack || this.audioTrack)
                            ) {
                                for (
                                    1 === this.pendingTracks.length ? (a.type = this.pendingTracks[0].type) : (a.type = 'combined'),
                                        this.emittedTracks += this.pendingTracks.length,
                                        e = Q(this.pendingTracks),
                                        a.initSegment = new Uint8Array(e.byteLength),
                                        a.initSegment.set(e),
                                        a.data = new Uint8Array(this.pendingBytes),
                                        n = 0;
                                    n < this.pendingBoxes.length;
                                    n++
                                )
                                    a.data.set(this.pendingBoxes[n], r), (r += this.pendingBoxes[n].byteLength)
                                for (n = 0; n < this.pendingCaptions.length; n++)
                                    ((t = this.pendingCaptions[n]).startTime = pe(t.startPts, s, this.keepOriginalTimestamps)),
                                        (t.endTime = pe(t.endPts, s, this.keepOriginalTimestamps)),
                                        (a.captionStreams[t.stream] = !0),
                                        a.captions.push(t)
                                for (n = 0; n < this.pendingMetadata.length; n++) ((i = this.pendingMetadata[n]).cueTime = pe(i.pts, s, this.keepOriginalTimestamps)), a.metadata.push(i)
                                for (
                                    a.metadata.dispatchType = this.metadataStream.dispatchType,
                                        this.pendingTracks.length = 0,
                                        this.videoTrack = null,
                                        this.pendingBoxes.length = 0,
                                        this.pendingCaptions.length = 0,
                                        this.pendingBytes = 0,
                                        this.pendingMetadata.length = 0,
                                        this.trigger('data', a),
                                        n = 0;
                                    n < a.captions.length;
                                    n++
                                )
                                    (t = a.captions[n]), this.trigger('caption', t)
                                for (n = 0; n < a.metadata.length; n++) (i = a.metadata[n]), this.trigger('id3Frame', i)
                            }
                            this.emittedTracks >= this.numberOfTracks && (this.trigger('done'), (this.emittedTracks = 0))
                        }),
                        (_t.prototype.setRemux = function (e) {
                            this.remuxTracks = e
                        }),
                        ((vt = function (n) {
                            var r,
                                a,
                                s = this,
                                i = !0
                            vt.prototype.init.call(this),
                                (this.baseMediaDecodeTime = (n = n || {}).baseMediaDecodeTime || 0),
                                (this.transmuxPipeline_ = {}),
                                (this.setupAacPipeline = function () {
                                    var t = {}
                                    ;((this.transmuxPipeline_ = t).type = 'aac'),
                                        (t.metadataStream = new Je.MetadataStream()),
                                        (t.aacStream = new bt()),
                                        (t.audioTimestampRolloverStream = new Je.TimestampRolloverStream('audio')),
                                        (t.timedMetadataTimestampRolloverStream = new Je.TimestampRolloverStream('timed-metadata')),
                                        (t.adtsStream = new rt()),
                                        (t.coalesceStream = new _t(n, t.metadataStream)),
                                        (t.headOfPipeline = t.aacStream),
                                        t.aacStream.pipe(t.audioTimestampRolloverStream).pipe(t.adtsStream),
                                        t.aacStream.pipe(t.timedMetadataTimestampRolloverStream).pipe(t.metadataStream).pipe(t.coalesceStream),
                                        t.metadataStream.on('timestamp', function (e) {
                                            t.aacStream.setTimestamp(e.timeStamp)
                                        }),
                                        t.aacStream.on('data', function (e) {
                                            ;('timed-metadata' !== e.type && 'audio' !== e.type) ||
                                                t.audioSegmentStream ||
                                                ((a = a || { timelineStartInfo: { baseMediaDecodeTime: s.baseMediaDecodeTime }, codec: 'adts', type: 'audio' }),
                                                t.coalesceStream.numberOfTracks++,
                                                (t.audioSegmentStream = new Ct(a, n)),
                                                t.audioSegmentStream.on('log', s.getLogTrigger_('audioSegmentStream')),
                                                t.audioSegmentStream.on('timingInfo', s.trigger.bind(s, 'audioTimingInfo')),
                                                t.adtsStream.pipe(t.audioSegmentStream).pipe(t.coalesceStream),
                                                s.trigger('trackinfo', { hasAudio: !!a, hasVideo: !!r }))
                                        }),
                                        t.coalesceStream.on('data', this.trigger.bind(this, 'data')),
                                        t.coalesceStream.on('done', this.trigger.bind(this, 'done')),
                                        ft(this, t)
                                }),
                                (this.setupTsPipeline = function () {
                                    var i = {}
                                    ;((this.transmuxPipeline_ = i).type = 'ts'),
                                        (i.metadataStream = new Je.MetadataStream()),
                                        (i.packetStream = new Je.TransportPacketStream()),
                                        (i.parseStream = new Je.TransportParseStream()),
                                        (i.elementaryStream = new Je.ElementaryStream()),
                                        (i.timestampRolloverStream = new Je.TimestampRolloverStream()),
                                        (i.adtsStream = new rt()),
                                        (i.h264Stream = new wt()),
                                        (i.captionStream = new Je.CaptionStream(n)),
                                        (i.coalesceStream = new _t(n, i.metadataStream)),
                                        (i.headOfPipeline = i.packetStream),
                                        i.packetStream.pipe(i.parseStream).pipe(i.elementaryStream).pipe(i.timestampRolloverStream),
                                        i.timestampRolloverStream.pipe(i.h264Stream),
                                        i.timestampRolloverStream.pipe(i.adtsStream),
                                        i.timestampRolloverStream.pipe(i.metadataStream).pipe(i.coalesceStream),
                                        i.h264Stream.pipe(i.captionStream).pipe(i.coalesceStream),
                                        i.elementaryStream.on('data', function (e) {
                                            var t
                                            if ('metadata' === e.type) {
                                                for (t = e.tracks.length; t--; )
                                                    r || 'video' !== e.tracks[t].type
                                                        ? a || 'audio' !== e.tracks[t].type || ((a = e.tracks[t]).timelineStartInfo.baseMediaDecodeTime = s.baseMediaDecodeTime)
                                                        : ((r = e.tracks[t]).timelineStartInfo.baseMediaDecodeTime = s.baseMediaDecodeTime)
                                                r &&
                                                    !i.videoSegmentStream &&
                                                    (i.coalesceStream.numberOfTracks++,
                                                    (i.videoSegmentStream = new yt(r, n)),
                                                    i.videoSegmentStream.on('log', s.getLogTrigger_('videoSegmentStream')),
                                                    i.videoSegmentStream.on('timelineStartInfo', function (e) {
                                                        a && !n.keepOriginalTimestamps && ((a.timelineStartInfo = e), i.audioSegmentStream.setEarliestDts(e.dts - s.baseMediaDecodeTime))
                                                    }),
                                                    i.videoSegmentStream.on('processedGopsInfo', s.trigger.bind(s, 'gopInfo')),
                                                    i.videoSegmentStream.on('segmentTimingInfo', s.trigger.bind(s, 'videoSegmentTimingInfo')),
                                                    i.videoSegmentStream.on('baseMediaDecodeTime', function (e) {
                                                        a && i.audioSegmentStream.setVideoBaseMediaDecodeTime(e)
                                                    }),
                                                    i.videoSegmentStream.on('timingInfo', s.trigger.bind(s, 'videoTimingInfo')),
                                                    i.h264Stream.pipe(i.videoSegmentStream).pipe(i.coalesceStream)),
                                                    a &&
                                                        !i.audioSegmentStream &&
                                                        (i.coalesceStream.numberOfTracks++,
                                                        (i.audioSegmentStream = new Ct(a, n)),
                                                        i.audioSegmentStream.on('log', s.getLogTrigger_('audioSegmentStream')),
                                                        i.audioSegmentStream.on('timingInfo', s.trigger.bind(s, 'audioTimingInfo')),
                                                        i.audioSegmentStream.on('segmentTimingInfo', s.trigger.bind(s, 'audioSegmentTimingInfo')),
                                                        i.adtsStream.pipe(i.audioSegmentStream).pipe(i.coalesceStream)),
                                                    s.trigger('trackinfo', { hasAudio: !!a, hasVideo: !!r })
                                            }
                                        }),
                                        i.coalesceStream.on('data', this.trigger.bind(this, 'data')),
                                        i.coalesceStream.on('id3Frame', function (e) {
                                            ;(e.dispatchType = i.metadataStream.dispatchType), s.trigger('id3Frame', e)
                                        }),
                                        i.coalesceStream.on('caption', this.trigger.bind(this, 'caption')),
                                        i.coalesceStream.on('done', this.trigger.bind(this, 'done')),
                                        ft(this, i)
                                }),
                                (this.setBaseMediaDecodeTime = function (e) {
                                    var t = this.transmuxPipeline_
                                    n.keepOriginalTimestamps || (this.baseMediaDecodeTime = e),
                                        a &&
                                            ((a.timelineStartInfo.dts = void 0),
                                            (a.timelineStartInfo.pts = void 0),
                                            _e(a),
                                            t.audioTimestampRolloverStream && t.audioTimestampRolloverStream.discontinuity()),
                                        r &&
                                            (t.videoSegmentStream && (t.videoSegmentStream.gopCache_ = []),
                                            (r.timelineStartInfo.dts = void 0),
                                            (r.timelineStartInfo.pts = void 0),
                                            _e(r),
                                            t.captionStream.reset()),
                                        t.timestampRolloverStream && t.timestampRolloverStream.discontinuity()
                                }),
                                (this.setAudioAppendStart = function (e) {
                                    a && this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(e)
                                }),
                                (this.setRemux = function (e) {
                                    var t = this.transmuxPipeline_
                                    ;(n.remux = e), t && t.coalesceStream && t.coalesceStream.setRemux(e)
                                }),
                                (this.alignGopsWith = function (e) {
                                    r && this.transmuxPipeline_.videoSegmentStream && this.transmuxPipeline_.videoSegmentStream.alignGopsWith(e)
                                }),
                                (this.getLogTrigger_ = function (t) {
                                    var i = this
                                    return function (e) {
                                        ;(e.stream = t), i.trigger('log', e)
                                    }
                                }),
                                (this.push = function (e) {
                                    var t
                                    i &&
                                        ((t = Et(e)) && 'aac' !== this.transmuxPipeline_.type ? this.setupAacPipeline() : t || 'ts' === this.transmuxPipeline_.type || this.setupTsPipeline(),
                                        (i = !1)),
                                        this.transmuxPipeline_.headOfPipeline.push(e)
                                }),
                                (this.flush = function () {
                                    ;(i = !0), this.transmuxPipeline_.headOfPipeline.flush()
                                }),
                                (this.endTimeline = function () {
                                    this.transmuxPipeline_.headOfPipeline.endTimeline()
                                }),
                                (this.reset = function () {
                                    this.transmuxPipeline_.headOfPipeline && this.transmuxPipeline_.headOfPipeline.reset()
                                }),
                                (this.resetCaptions = function () {
                                    this.transmuxPipeline_.captionStream && this.transmuxPipeline_.captionStream.reset()
                                })
                        }).prototype = new j())
                    function It(e, c) {
                        var i = Rt(e, ['moof', 'traf']),
                            e = Rt(e, ['mdat']),
                            d = {},
                            n = []
                        return (
                            e.forEach(function (e, t) {
                                t = i[t]
                                n.push({ mdat: e, traf: t })
                            }),
                            n.forEach(function (e) {
                                var t,
                                    i,
                                    n,
                                    r,
                                    a,
                                    s = e.mdat,
                                    o = e.traf,
                                    u = Rt(o, ['tfhd']),
                                    l = Ht(u[0]),
                                    e = l.trackId,
                                    u = Rt(o, ['tfdt']),
                                    u = 0 < u.length ? Bt(u[0]).baseMediaDecodeTime : 0,
                                    o = Rt(o, ['trun'])
                                c === e &&
                                    0 < o.length &&
                                    ((o = o),
                                    (t = u),
                                    (i = (l = l).defaultSampleDuration || 0),
                                    (n = l.defaultSampleSize || 0),
                                    (r = l.trackId),
                                    (a = []),
                                    o.forEach(function (e) {
                                        e = jt(e).samples
                                        e.forEach(function (e) {
                                            void 0 === e.duration && (e.duration = i),
                                                void 0 === e.size && (e.size = n),
                                                (e.trackId = r),
                                                (e.dts = t),
                                                void 0 === e.compositionTimeOffset && (e.compositionTimeOffset = 0),
                                                'bigint' == typeof t
                                                    ? ((e.pts = t + qt.BigInt(e.compositionTimeOffset)), (t += qt.BigInt(e.duration)))
                                                    : ((e.pts = t + e.compositionTimeOffset), (t += e.duration))
                                        }),
                                            (a = a.concat(e))
                                    }),
                                    (s = (function (e, t, i) {
                                        for (var n, r, a = new DataView(e.buffer, e.byteOffset, e.byteLength), s = { logs: [], seiNals: [] }, o = 0; o + 4 < e.length; o += n)
                                            if (((n = a.getUint32(o)), (o += 4), !(n <= 0)))
                                                switch (31 & e[o]) {
                                                    case 6:
                                                        var u = e.subarray(o + 1, o + 1 + n),
                                                            l = (function (e, t) {
                                                                for (var i = e, n = 0; n < t.length; n++) {
                                                                    var r = t[n]
                                                                    if (i < r.size) return r
                                                                    i -= r.size
                                                                }
                                                                return null
                                                            })(o, t),
                                                            u = { nalUnitType: 'sei_rbsp', size: n, data: u, escapedRBSP: Vt(u), trackId: i }
                                                        if (l) (u.pts = l.pts), (u.dts = l.dts), (r = l)
                                                        else {
                                                            if (!r) {
                                                                s.logs.push({ level: 'warn', message: "We've encountered a nal unit without data at " + o + ' for trackId ' + i + '. See mux.js#223.' })
                                                                break
                                                            }
                                                            ;(u.pts = r.pts), (u.dts = r.dts)
                                                        }
                                                        s.seiNals.push(u)
                                                }
                                        return s
                                    })(s, a, e)),
                                    d[e] || (d[e] = { seiNals: [], logs: [] }),
                                    (d[e].seiNals = d[e].seiNals.concat(s.seiNals)),
                                    (d[e].logs = d[e].logs.concat(s.logs)))
                            }),
                            d
                        )
                    }
                    function xt(e) {
                        var t = 31 & e[1]
                        return (t <<= 8), (t |= e[2])
                    }
                    function At(e) {
                        return !!(64 & e[1])
                    }
                    function Pt(e) {
                        var t = 0
                        return 1 < (48 & e[3]) >>> 4 && (t += e[4] + 1), t
                    }
                    function Lt(e) {
                        switch (e) {
                            case 5:
                                return 'slice_layer_without_partitioning_rbsp_idr'
                            case 6:
                                return 'sei_rbsp'
                            case 7:
                                return 'seq_parameter_set_rbsp'
                            case 8:
                                return 'pic_parameter_set_rbsp'
                            case 9:
                                return 'access_unit_delimiter_rbsp'
                            default:
                                return null
                        }
                    }
                    var Dt = { Transmuxer: vt, VideoSegmentStream: yt, AudioSegmentStream: Ct, AUDIO_PROPERTIES: Tt, VIDEO_PROPERTIES: St, generateSegmentTimingInfo: gt },
                        e = function (e) {
                            return e >>> 0
                        },
                        Ot = function (e) {
                            var t = ''
                            return (t += String.fromCharCode(e[0])), (t += String.fromCharCode(e[1])), (t += String.fromCharCode(e[2])), (t += String.fromCharCode(e[3]))
                        },
                        Mt = e,
                        Rt = function e(t, i) {
                            var n,
                                r,
                                a,
                                s = []
                            if (!i.length) return null
                            for (n = 0; n < t.byteLength; )
                                (r = Mt((t[n] << 24) | (t[n + 1] << 16) | (t[n + 2] << 8) | t[n + 3])),
                                    (a = Ot(t.subarray(n + 4, n + 8))),
                                    (r = 1 < r ? n + r : t.byteLength),
                                    a === i[0] && (1 === i.length ? s.push(t.subarray(n + 8, r)) : (a = e(t.subarray(n + 8, r), i.slice(1))).length && (s = s.concat(a))),
                                    (n = r)
                            return s
                        },
                        Nt = e,
                        Ut = q.getUint64,
                        Bt = function (e) {
                            var t = { version: e[0], flags: new Uint8Array(e.subarray(1, 4)) }
                            return 1 === t.version ? (t.baseMediaDecodeTime = Ut(e.subarray(4))) : (t.baseMediaDecodeTime = Nt((e[4] << 24) | (e[5] << 16) | (e[6] << 8) | e[7])), t
                        },
                        Ft = function (e) {
                            return {
                                isLeading: (12 & e[0]) >>> 2,
                                dependsOn: 3 & e[0],
                                isDependedOn: (192 & e[1]) >>> 6,
                                hasRedundancy: (48 & e[1]) >>> 4,
                                paddingValue: (14 & e[1]) >>> 1,
                                isNonSyncSample: 1 & e[1],
                                degradationPriority: (e[2] << 8) | e[3],
                            }
                        },
                        jt = function (e) {
                            var t,
                                i = { version: e[0], flags: new Uint8Array(e.subarray(1, 4)), samples: [] },
                                n = new DataView(e.buffer, e.byteOffset, e.byteLength),
                                r = 1 & i.flags[2],
                                a = 4 & i.flags[2],
                                s = 1 & i.flags[1],
                                o = 2 & i.flags[1],
                                u = 4 & i.flags[1],
                                l = 8 & i.flags[1],
                                c = n.getUint32(4),
                                d = 8
                            for (
                                r && ((i.dataOffset = n.getInt32(d)), (d += 4)),
                                    a &&
                                        c &&
                                        ((t = { flags: Ft(e.subarray(d, d + 4)) }),
                                        (d += 4),
                                        s && ((t.duration = n.getUint32(d)), (d += 4)),
                                        o && ((t.size = n.getUint32(d)), (d += 4)),
                                        l && (1 === i.version ? (t.compositionTimeOffset = n.getInt32(d)) : (t.compositionTimeOffset = n.getUint32(d)), (d += 4)),
                                        i.samples.push(t),
                                        c--);
                                c--;

                            )
                                (t = {}),
                                    s && ((t.duration = n.getUint32(d)), (d += 4)),
                                    o && ((t.size = n.getUint32(d)), (d += 4)),
                                    u && ((t.flags = Ft(e.subarray(d, d + 4))), (d += 4)),
                                    l && (1 === i.version ? (t.compositionTimeOffset = n.getInt32(d)) : (t.compositionTimeOffset = n.getUint32(d)), (d += 4)),
                                    i.samples.push(t)
                            return i
                        },
                        Ht = function (e) {
                            var t = new DataView(e.buffer, e.byteOffset, e.byteLength),
                                i = { version: e[0], flags: new Uint8Array(e.subarray(1, 4)), trackId: t.getUint32(4) },
                                n = 1 & i.flags[2],
                                r = 2 & i.flags[2],
                                a = 8 & i.flags[2],
                                s = 16 & i.flags[2],
                                o = 32 & i.flags[2],
                                u = 65536 & i.flags[0],
                                l = 131072 & i.flags[0],
                                e = 8
                            return (
                                n && ((e += 4), (i.baseDataOffset = t.getUint32(12)), (e += 4)),
                                r && ((i.sampleDescriptionIndex = t.getUint32(e)), (e += 4)),
                                a && ((i.defaultSampleDuration = t.getUint32(e)), (e += 4)),
                                s && ((i.defaultSampleSize = t.getUint32(e)), (e += 4)),
                                o && (i.defaultSampleFlags = t.getUint32(e)),
                                u && (i.durationIsEmpty = !0),
                                !n && l && (i.baseDataOffsetIsMoof = !0),
                                i
                            )
                        },
                        j = 'undefined' != typeof globalThis ? globalThis : 'undefined' != typeof window ? window : 'undefined' != typeof global ? global : 'undefined' != typeof self ? self : {},
                        j = 'undefined' != typeof window ? window : 'undefined' != typeof j ? j : 'undefined' != typeof self ? self : {},
                        qt = j,
                        Vt = ke,
                        Wt = Fe.CaptionStream,
                        Gt = function () {
                            var t,
                                r,
                                a,
                                s,
                                o,
                                i,
                                n = !1
                            ;(this.isInitialized = function () {
                                return n
                            }),
                                (this.init = function (e) {
                                    ;(t = new Wt()),
                                        (n = !0),
                                        (i = !!e && e.isPartial),
                                        t.on('data', function (e) {
                                            ;(e.startTime = e.startPts / s), (e.endTime = e.endPts / s), o.captions.push(e), (o.captionStreams[e.stream] = !0)
                                        }),
                                        t.on('log', function (e) {
                                            o.logs.push(e)
                                        })
                                }),
                                (this.isNewInit = function (e, t) {
                                    return !((e && 0 === e.length) || (t && 'object' == typeof t && 0 === Object.keys(t).length)) && (a !== e[0] || s !== t[a])
                                }),
                                (this.parse = function (e, t, i) {
                                    if (!this.isInitialized()) return null
                                    if (!t || !i) return null
                                    if (this.isNewInit(t, i)) (a = t[0]), (s = i[a])
                                    else if (null === a || !s) return r.push(e), null
                                    for (; 0 < r.length; ) {
                                        var n = r.shift()
                                        this.parse(n, t, i)
                                    }
                                    return (
                                        (e = (function (e, t, i) {
                                            if (null === t) return null
                                            t = It(e, t)[t] || {}
                                            return { seiNals: t.seiNals, logs: t.logs, timescale: i }
                                        })(e, a, s)) &&
                                            e.logs &&
                                            (o.logs = o.logs.concat(e.logs)),
                                        null !== e && e.seiNals ? (this.pushNals(e.seiNals), this.flushStream(), o) : o.logs.length ? { logs: o.logs, captions: [], captionStreams: [] } : null
                                    )
                                }),
                                (this.pushNals = function (e) {
                                    if (!this.isInitialized() || !e || 0 === e.length) return null
                                    e.forEach(function (e) {
                                        t.push(e)
                                    })
                                }),
                                (this.flushStream = function () {
                                    if (!this.isInitialized()) return null
                                    i ? t.partialFlush() : t.flush()
                                }),
                                (this.clearParsedCaptions = function () {
                                    ;(o.captions = []), (o.captionStreams = {}), (o.logs = [])
                                }),
                                (this.resetCaptionStream = function () {
                                    if (!this.isInitialized()) return null
                                    t.reset()
                                }),
                                (this.clearAllCaptions = function () {
                                    this.clearParsedCaptions(), this.resetCaptionStream()
                                }),
                                (this.reset = function () {
                                    ;(r = []), (s = a = null), o ? this.clearParsedCaptions() : (o = { captions: [], captionStreams: {}, logs: [] }), this.resetCaptionStream()
                                }),
                                this.reset()
                        },
                        zt = e,
                        Xt = function (e) {
                            return ('00' + e.toString(16)).slice(-2)
                        },
                        Kt = q.getUint64,
                        j = function (e) {
                            return Rt(e, ['moov', 'trak']).reduce(function (e, t) {
                                var i,
                                    n,
                                    r = Rt(t, ['tkhd'])[0]
                                return r
                                    ? ((i = r[0]),
                                      (r = zt((r[(n = 0 === i ? 12 : 20)] << 24) | (r[1 + n] << 16) | (r[2 + n] << 8) | r[3 + n])),
                                      (t = Rt(t, ['mdia', 'mdhd'])[0]) ? ((i = t[0]), (e[r] = zt((t[(n = 0 === i ? 12 : 20)] << 24) | (t[1 + n] << 16) | (t[2 + n] << 8) | t[3 + n])), e) : null)
                                    : null
                            }, {})
                        },
                        ke = function (a, e) {
                            e = Rt(e, ['moof', 'traf']).reduce(function (e, t) {
                                var i,
                                    n = Rt(t, ['tfhd'])[0],
                                    r = zt((n[4] << 24) | (n[5] << 16) | (n[6] << 8) | n[7]),
                                    n = a[r] || 9e4,
                                    r = Rt(t, ['tfdt'])[0],
                                    t = new DataView(r.buffer, r.byteOffset, r.byteLength),
                                    t = 1 === r[0] ? Kt(r.subarray(4, 12)) : t.getUint32(4)
                                return (
                                    'bigint' == typeof t ? (i = t / qt.BigInt(n)) : 'number' != typeof t || isNaN(t) || (i = t / n), (e = (i = i < Number.MAX_SAFE_INTEGER ? Number(i) : i) < e ? i : e)
                                )
                            }, 1 / 0)
                            return 'bigint' == typeof e || isFinite(e) ? e : 0
                        },
                        e = function (e) {
                            var e = Rt(e, ['moov', 'trak']),
                                n = []
                            return (
                                e.forEach(function (e) {
                                    var t = Rt(e, ['mdia', 'hdlr']),
                                        i = Rt(e, ['tkhd'])
                                    t.forEach(function (e, t) {
                                        ;(e = Ot(e.subarray(8, 12))), (t = i[t])
                                        'vide' === e && ((t = 0 === (t = new DataView(t.buffer, t.byteOffset, t.byteLength)).getUint8(0) ? t.getUint32(12) : t.getUint32(20)), n.push(t))
                                    })
                                }),
                                n
                            )
                        },
                        Yt = function (e) {
                            var t = 0 === e[0] ? 12 : 20
                            return zt((e[t] << 24) | (e[1 + t] << 16) | (e[2 + t] << 8) | e[3 + t])
                        },
                        q = function (e) {
                            var e = Rt(e, ['moov', 'trak']),
                                s = []
                            return (
                                e.forEach(function (e) {
                                    var t = {},
                                        i = Rt(e, ['tkhd'])[0]
                                    i && ((i = (n = new DataView(i.buffer, i.byteOffset, i.byteLength)).getUint8(0)), (t.id = 0 === i ? n.getUint32(12) : n.getUint32(20)))
                                    var n = Rt(e, ['mdia', 'hdlr'])[0]
                                    n && ((a = Ot(n.subarray(8, 12))), (t.type = 'vide' === a ? 'video' : 'soun' === a ? 'audio' : a))
                                    var r,
                                        a = Rt(e, ['mdia', 'minf', 'stbl', 'stsd'])[0]
                                    a &&
                                        ((a = a.subarray(8)),
                                        (t.codec = Ot(a.subarray(4, 8))),
                                        (a = Rt(a, [t.codec])[0]) &&
                                            (/^[asm]vc[1-9]$/i.test(t.codec)
                                                ? ((r = a.subarray(78)),
                                                  'avcC' === Ot(r.subarray(4, 8)) && 11 < r.length
                                                      ? ((t.codec += '.'), (t.codec += Xt(r[9])), (t.codec += Xt(r[10])), (t.codec += Xt(r[11])))
                                                      : (t.codec = 'avc1.4d400d'))
                                                : /^mp4[a,v]$/i.test(t.codec)
                                                ? ((r = a.subarray(28)),
                                                  'esds' === Ot(r.subarray(4, 8)) && 20 < r.length && 0 !== r[19]
                                                      ? ((t.codec += '.' + Xt(r[19])), (t.codec += '.' + Xt((r[20] >>> 2) & 63).replace(/^0/, '')))
                                                      : (t.codec = 'mp4a.40.2'))
                                                : (t.codec = t.codec.toLowerCase())))
                                    e = Rt(e, ['mdia', 'mdhd'])[0]
                                    e && (t.timescale = Yt(e)), s.push(t)
                                }),
                                s
                            )
                        },
                        Qt = ke,
                        $t = q,
                        Jt = Ie,
                        Zt = {}
                    ;(Zt.ts = {
                        parseType: function (e, t) {
                            e = xt(e)
                            return 0 === e ? 'pat' : e === t ? 'pmt' : t ? 'pes' : null
                        },
                        parsePat: function (e) {
                            var t = At(e),
                                i = 4 + Pt(e)
                            return t && (i += e[i] + 1), ((31 & e[i + 10]) << 8) | e[i + 11]
                        },
                        parsePmt: function (e) {
                            var t = {},
                                i = At(e),
                                n = 4 + Pt(e)
                            if ((i && (n += e[n] + 1), 1 & e[n + 5])) {
                                for (var r = 3 + (((15 & e[n + 1]) << 8) | e[n + 2]) - 4, a = 12 + (((15 & e[n + 10]) << 8) | e[n + 11]); a < r; ) {
                                    var s = n + a
                                    ;(t[((31 & e[s + 1]) << 8) | e[s + 2]] = e[s]), (a += 5 + (((15 & e[s + 3]) << 8) | e[s + 4]))
                                }
                                return t
                            }
                        },
                        parsePayloadUnitStartIndicator: At,
                        parsePesType: function (e, t) {
                            switch (t[xt(e)]) {
                                case je.H264_STREAM_TYPE:
                                    return 'video'
                                case je.ADTS_STREAM_TYPE:
                                    return 'audio'
                                case je.METADATA_STREAM_TYPE:
                                    return 'timed-metadata'
                                default:
                                    return null
                            }
                        },
                        parsePesTime: function (e) {
                            if (!At(e)) return null
                            var t = 4 + Pt(e)
                            if (t >= e.byteLength) return null
                            var i = null,
                                n = e[t + 7]
                            return (
                                192 & n &&
                                    (((i = {}).pts = ((14 & e[t + 9]) << 27) | ((255 & e[t + 10]) << 20) | ((254 & e[t + 11]) << 12) | ((255 & e[t + 12]) << 5) | ((254 & e[t + 13]) >>> 3)),
                                    (i.pts *= 4),
                                    (i.pts += (6 & e[t + 13]) >>> 1),
                                    (i.dts = i.pts),
                                    64 & n &&
                                        ((i.dts = ((14 & e[t + 14]) << 27) | ((255 & e[t + 15]) << 20) | ((254 & e[t + 16]) << 12) | ((255 & e[t + 17]) << 5) | ((254 & e[t + 18]) >>> 3)),
                                        (i.dts *= 4),
                                        (i.dts += (6 & e[t + 18]) >>> 1))),
                                i
                            )
                        },
                        videoPacketContainsKeyFrame: function (e) {
                            for (var t = 4 + Pt(e), i = e.subarray(t), n = 0, r = 0, a = !1; r < i.byteLength - 3; r++)
                                if (1 === i[r + 2]) {
                                    n = r + 5
                                    break
                                }
                            for (; n < i.byteLength; )
                                switch (i[n]) {
                                    case 0:
                                        if (0 !== i[n - 1]) {
                                            n += 2
                                            break
                                        }
                                        if (0 !== i[n - 2]) {
                                            n++
                                            break
                                        }
                                        for (r + 3 !== n - 2 && 'slice_layer_without_partitioning_rbsp_idr' === Lt(31 & i[r + 3]) && (a = !0); 1 !== i[++n] && n < i.length; );
                                        ;(r = n - 2), (n += 3)
                                        break
                                    case 1:
                                        if (0 !== i[n - 1] || 0 !== i[n - 2]) {
                                            n += 3
                                            break
                                        }
                                        'slice_layer_without_partitioning_rbsp_idr' === Lt(31 & i[r + 3]) && (a = !0), (r = n - 2), (n += 3)
                                        break
                                    default:
                                        n += 3
                                }
                            return (i = i.subarray(r)), (n -= r), (r = 0), (a = i && 3 < i.byteLength && 'slice_layer_without_partitioning_rbsp_idr' === Lt(31 & i[r + 3]) ? !0 : a)
                        },
                    }),
                        (Zt.aac = dt)
                    function ei(e, t, i) {
                        for (var n, r, a, s, o = 0, u = 188, l = !1; u <= e.byteLength; )
                            if (71 !== e[o] || (71 !== e[u] && u !== e.byteLength)) o++, u++
                            else {
                                if (
                                    ((n = e.subarray(o, u)),
                                    'pes' === Zt.ts.parseType(n, t.pid) &&
                                        ((r = Zt.ts.parsePesType(n, t.table)),
                                        (a = Zt.ts.parsePayloadUnitStartIndicator(n)),
                                        'audio' === r && a && (s = Zt.ts.parsePesTime(n)) && ((s.type = 'audio'), i.audio.push(s), (l = !0))),
                                    l)
                                )
                                    break
                                ;(o += 188), (u += 188)
                            }
                        for (o = (u = e.byteLength) - 188, l = !1; 0 <= o; )
                            if (71 !== e[o] || (71 !== e[u] && u !== e.byteLength)) o--, u--
                            else {
                                if (
                                    ((n = e.subarray(o, u)),
                                    'pes' === Zt.ts.parseType(n, t.pid) &&
                                        ((r = Zt.ts.parsePesType(n, t.table)),
                                        (a = Zt.ts.parsePayloadUnitStartIndicator(n)),
                                        'audio' === r && a && (s = Zt.ts.parsePesTime(n)) && ((s.type = 'audio'), i.audio.push(s), (l = !0))),
                                    l)
                                )
                                    break
                                ;(o -= 188), (u -= 188)
                            }
                    }
                    function ti(e) {
                        var t,
                            i = { pid: null, table: null },
                            n = {}
                        for (t in (!(function (e, t) {
                            for (var i, n = 0, r = 188; r < e.byteLength; )
                                if (71 !== e[n] || 71 !== e[r]) n++, r++
                                else {
                                    switch (((i = e.subarray(n, r)), Zt.ts.parseType(i, t.pid))) {
                                        case 'pat':
                                            t.pid = Zt.ts.parsePat(i)
                                            break
                                        case 'pmt':
                                            var a = Zt.ts.parsePmt(i)
                                            ;(t.table = t.table || {}),
                                                Object.keys(a).forEach(function (e) {
                                                    t.table[e] = a[e]
                                                })
                                    }
                                    ;(n += 188), (r += 188)
                                }
                        })(e, i),
                        i.table))
                            if (i.table.hasOwnProperty(t))
                                switch (i.table[t]) {
                                    case je.H264_STREAM_TYPE:
                                        ;(n.video = []),
                                            (function (e, t, i) {
                                                for (var n, r, a, s, o, u, l, c, d = 0, h = 188, p = !1, f = { data: [], size: 0 }; h < e.byteLength; )
                                                    if (71 !== e[d] || 71 !== e[h]) d++, h++
                                                    else {
                                                        if (((n = e.subarray(d, h)), 'pes' === Zt.ts.parseType(n, t.pid)))
                                                            if (
                                                                ((r = Zt.ts.parsePesType(n, t.table)),
                                                                (a = Zt.ts.parsePayloadUnitStartIndicator(n)),
                                                                'video' === r && (a && !p && (s = Zt.ts.parsePesTime(n)) && ((s.type = 'video'), i.video.push(s), (p = !0)), !i.firstKeyFrame))
                                                            ) {
                                                                if (a && 0 !== f.size) {
                                                                    for (o = new Uint8Array(f.size), u = 0; f.data.length; ) (l = f.data.shift()), o.set(l, u), (u += l.byteLength)
                                                                    !Zt.ts.videoPacketContainsKeyFrame(o) || ((c = Zt.ts.parsePesTime(o)) && ((i.firstKeyFrame = c), (i.firstKeyFrame.type = 'video'))),
                                                                        (f.size = 0)
                                                                }
                                                                f.data.push(n), (f.size += n.byteLength)
                                                            }
                                                        if (p && i.firstKeyFrame) break
                                                        ;(d += 188), (h += 188)
                                                    }
                                                for (d = (h = e.byteLength) - 188, p = !1; 0 <= d; )
                                                    if (71 !== e[d] || 71 !== e[h]) d--, h--
                                                    else {
                                                        if (
                                                            ((n = e.subarray(d, h)),
                                                            'pes' === Zt.ts.parseType(n, t.pid) &&
                                                                ((r = Zt.ts.parsePesType(n, t.table)),
                                                                (a = Zt.ts.parsePayloadUnitStartIndicator(n)),
                                                                'video' === r && a && (s = Zt.ts.parsePesTime(n)) && ((s.type = 'video'), i.video.push(s), (p = !0))),
                                                            p)
                                                        )
                                                            break
                                                        ;(d -= 188), (h -= 188)
                                                    }
                                            })(e, i, n),
                                            0 === n.video.length && delete n.video
                                        break
                                    case je.ADTS_STREAM_TYPE:
                                        ;(n.audio = []), ei(e, i, n), 0 === n.audio.length && delete n.audio
                                }
                        return n
                    }
                    var ii = ue,
                        ni = function (e, t) {
                            var i,
                                n,
                                r = (
                                    Zt.aac.isLikelyAacData(e)
                                        ? function (e) {
                                              for (var t, i = !1, n = 0, r = null, a = null, s = 0, o = 0; 3 <= e.length - o; ) {
                                                  switch (Zt.aac.parseType(e, o)) {
                                                      case 'timed-metadata':
                                                          if (e.length - o < 10) {
                                                              i = !0
                                                              break
                                                          }
                                                          if ((s = Zt.aac.parseId3TagSize(e, o)) > e.length) {
                                                              i = !0
                                                              break
                                                          }
                                                          null === a && ((t = e.subarray(o, o + s)), (a = Zt.aac.parseAacTimestamp(t))), (o += s)
                                                          break
                                                      case 'audio':
                                                          if (e.length - o < 7) {
                                                              i = !0
                                                              break
                                                          }
                                                          if ((s = Zt.aac.parseAdtsSize(e, o)) > e.length) {
                                                              i = !0
                                                              break
                                                          }
                                                          null === r && ((t = e.subarray(o, o + s)), (r = Zt.aac.parseSampleRate(t))), n++, (o += s)
                                                          break
                                                      default:
                                                          o++
                                                  }
                                                  if (i) return null
                                              }
                                              if (null === r || null === a) return null
                                              var u = ii / r
                                              return {
                                                  audio: [
                                                      { type: 'audio', dts: a, pts: a },
                                                      { type: 'audio', dts: a + 1024 * n * u, pts: a + 1024 * n * u },
                                                  ],
                                              }
                                          }
                                        : ti
                                )(e)
                            return r && (r.audio || r.video)
                                ? ((e = t),
                                  (t = r).audio &&
                                      t.audio.length &&
                                      (('undefined' != typeof (i = e) && !isNaN(i)) || (i = t.audio[0].dts),
                                      t.audio.forEach(function (e) {
                                          ;(e.dts = Jt(e.dts, i)), (e.pts = Jt(e.pts, i)), (e.dtsTime = e.dts / ii), (e.ptsTime = e.pts / ii)
                                      })),
                                  t.video &&
                                      t.video.length &&
                                      (('undefined' != typeof (n = e) && !isNaN(n)) || (n = t.video[0].dts),
                                      t.video.forEach(function (e) {
                                          ;(e.dts = Jt(e.dts, n)), (e.pts = Jt(e.pts, n)), (e.dtsTime = e.dts / ii), (e.ptsTime = e.pts / ii)
                                      }),
                                      t.firstKeyFrame && (((t = t.firstKeyFrame).dts = Jt(t.dts, n)), (t.pts = Jt(t.pts, n)), (t.dtsTime = t.dts / ii), (t.ptsTime = t.pts / ii))),
                                  r)
                                : null
                        },
                        ri = (function () {
                            function e(e, t) {
                                ;(this.options = t || {}), (this.self = e), this.init()
                            }
                            var t = e.prototype
                            return (
                                (t.init = function () {
                                    var i, e
                                    this.transmuxer && this.transmuxer.dispose(),
                                        (this.transmuxer = new Dt.Transmuxer(this.options)),
                                        (i = this.self),
                                        (e = this.transmuxer).on('data', function (e) {
                                            var t = e.initSegment
                                            e.initSegment = { data: t.buffer, byteOffset: t.byteOffset, byteLength: t.byteLength }
                                            t = e.data
                                            ;(e.data = t.buffer), i.postMessage({ action: 'data', segment: e, byteOffset: t.byteOffset, byteLength: t.byteLength }, [e.data])
                                        }),
                                        e.on('done', function (e) {
                                            i.postMessage({ action: 'done' })
                                        }),
                                        e.on('gopInfo', function (e) {
                                            i.postMessage({ action: 'gopInfo', gopInfo: e })
                                        }),
                                        e.on('videoSegmentTimingInfo', function (e) {
                                            var t = {
                                                start: { decode: ce(e.start.dts), presentation: ce(e.start.pts) },
                                                end: { decode: ce(e.end.dts), presentation: ce(e.end.pts) },
                                                baseMediaDecodeTime: ce(e.baseMediaDecodeTime),
                                            }
                                            e.prependedContentDuration && (t.prependedContentDuration = ce(e.prependedContentDuration)),
                                                i.postMessage({ action: 'videoSegmentTimingInfo', videoSegmentTimingInfo: t })
                                        }),
                                        e.on('audioSegmentTimingInfo', function (e) {
                                            var t = {
                                                start: { decode: ce(e.start.dts), presentation: ce(e.start.pts) },
                                                end: { decode: ce(e.end.dts), presentation: ce(e.end.pts) },
                                                baseMediaDecodeTime: ce(e.baseMediaDecodeTime),
                                            }
                                            e.prependedContentDuration && (t.prependedContentDuration = ce(e.prependedContentDuration)),
                                                i.postMessage({ action: 'audioSegmentTimingInfo', audioSegmentTimingInfo: t })
                                        }),
                                        e.on('id3Frame', function (e) {
                                            i.postMessage({ action: 'id3Frame', id3Frame: e })
                                        }),
                                        e.on('caption', function (e) {
                                            i.postMessage({ action: 'caption', caption: e })
                                        }),
                                        e.on('trackinfo', function (e) {
                                            i.postMessage({ action: 'trackinfo', trackInfo: e })
                                        }),
                                        e.on('audioTimingInfo', function (e) {
                                            i.postMessage({ action: 'audioTimingInfo', audioTimingInfo: { start: ce(e.start), end: ce(e.end) } })
                                        }),
                                        e.on('videoTimingInfo', function (e) {
                                            i.postMessage({ action: 'videoTimingInfo', videoTimingInfo: { start: ce(e.start), end: ce(e.end) } })
                                        }),
                                        e.on('log', function (e) {
                                            i.postMessage({ action: 'log', log: e })
                                        })
                                }),
                                (t.pushMp4Captions = function (e) {
                                    this.captionParser || ((this.captionParser = new Gt()), this.captionParser.init())
                                    var t = new Uint8Array(e.data, e.byteOffset, e.byteLength),
                                        e = this.captionParser.parse(t, e.trackIds, e.timescales)
                                    this.self.postMessage({ action: 'mp4Captions', captions: (e && e.captions) || [], logs: (e && e.logs) || [], data: t.buffer }, [t.buffer])
                                }),
                                (t.probeMp4StartTime = function (e) {
                                    var t = e.timescales,
                                        e = e.data,
                                        t = Qt(t, e)
                                    this.self.postMessage({ action: 'probeMp4StartTime', startTime: t, data: e }, [e.buffer])
                                }),
                                (t.probeMp4Tracks = function (e) {
                                    var t = e.data,
                                        e = $t(t)
                                    this.self.postMessage({ action: 'probeMp4Tracks', tracks: e, data: t }, [t.buffer])
                                }),
                                (t.probeTs = function (e) {
                                    var t = e.data,
                                        i = e.baseStartTime,
                                        e = 'number' != typeof i || isNaN(i) ? void 0 : i * ue,
                                        i = ni(t, e),
                                        e = null
                                    i &&
                                        ((e = { hasVideo: (i.video && 2 === i.video.length) || !1, hasAudio: (i.audio && 2 === i.audio.length) || !1 }).hasVideo && (e.videoStart = i.video[0].ptsTime),
                                        e.hasAudio && (e.audioStart = i.audio[0].ptsTime)),
                                        this.self.postMessage({ action: 'probeTs', result: e, data: t }, [t.buffer])
                                }),
                                (t.clearAllMp4Captions = function () {
                                    this.captionParser && this.captionParser.clearAllCaptions()
                                }),
                                (t.clearParsedMp4Captions = function () {
                                    this.captionParser && this.captionParser.clearParsedCaptions()
                                }),
                                (t.push = function (e) {
                                    e = new Uint8Array(e.data, e.byteOffset, e.byteLength)
                                    this.transmuxer.push(e)
                                }),
                                (t.reset = function () {
                                    this.transmuxer.reset()
                                }),
                                (t.setTimestampOffset = function (e) {
                                    e = e.timestampOffset || 0
                                    this.transmuxer.setBaseMediaDecodeTime(Math.round(le(e)))
                                }),
                                (t.setAudioAppendStart = function (e) {
                                    this.transmuxer.setAudioAppendStart(Math.ceil(le(e.appendStart)))
                                }),
                                (t.setRemux = function (e) {
                                    this.transmuxer.setRemux(e.remux)
                                }),
                                (t.flush = function (e) {
                                    this.transmuxer.flush(), self.postMessage({ action: 'done', type: 'transmuxed' })
                                }),
                                (t.endTimeline = function () {
                                    this.transmuxer.endTimeline(), self.postMessage({ action: 'endedtimeline', type: 'transmuxed' })
                                }),
                                (t.alignGopsWith = function (e) {
                                    this.transmuxer.alignGopsWith(e.gopsToAlignWith.slice())
                                }),
                                e
                            )
                        })()
                    self.onmessage = function (e) {
                        'init' === e.data.action && e.data.options
                            ? (this.messageHandlers = new ri(self, e.data.options))
                            : (this.messageHandlers || (this.messageHandlers = new ri(self)),
                              e.data && e.data.action && 'init' !== e.data.action && this.messageHandlers[e.data.action] && this.messageHandlers[e.data.action](e.data))
                    }
                })
            )
        ),
        Cl = function (e) {
            ;(e.currentTransmux = null), e.transmuxQueue.length && ((e.currentTransmux = e.transmuxQueue.shift()), 'function' == typeof e.currentTransmux ? e.currentTransmux() : Du(e.currentTransmux))
        },
        Il = function (e) {
            Mu('reset', e)
        },
        xl = function (e) {
            var t = new kl()
            ;(t.currentTransmux = null), (t.transmuxQueue = [])
            var i = t.terminate
            return (
                (t.terminate = function () {
                    return (t.currentTransmux = null), (t.transmuxQueue.length = 0), i.call(t)
                }),
                t.postMessage({ action: 'init', options: e }),
                t
            )
        },
        Al = 2,
        Pl = -101,
        Ll = -102,
        Dl = Ro('CodecUtils'),
        Ol = Ro('PlaylistSelector'),
        ar = function () {
            var e = (this.useDevicePixelRatio && window.devicePixelRatio) || 1
            return il(
                this.playlists.master,
                this.systemBandwidth,
                parseInt(Zu(this.tech_.el(), 'width'), 10) * e,
                parseInt(Zu(this.tech_.el(), 'height'), 10) * e,
                this.limitRenditionByPlayerDimensions,
                this.masterPlaylistController_
            )
        },
        Ml = (function (n) {
            function e(e, t) {
                var i = n.call(this) || this
                if (!e) throw new TypeError('Initialization settings are required')
                if ('function' != typeof e.currentTime) throw new TypeError('No currentTime getter specified')
                if (!e.mediaSource) throw new TypeError('No MediaSource specified')
                return (
                    (i.bandwidth = e.bandwidth),
                    (i.throughput = { rate: 0, count: 0 }),
                    (i.roundTrip = NaN),
                    i.resetStats_(),
                    (i.mediaIndex = null),
                    (i.partIndex = null),
                    (i.hasPlayed_ = e.hasPlayed),
                    (i.currentTime_ = e.currentTime),
                    (i.seekable_ = e.seekable),
                    (i.seeking_ = e.seeking),
                    (i.duration_ = e.duration),
                    (i.mediaSource_ = e.mediaSource),
                    (i.vhs_ = e.vhs),
                    (i.loaderType_ = e.loaderType),
                    (i.currentMediaInfo_ = void 0),
                    (i.startingMediaInfo_ = void 0),
                    (i.segmentMetadataTrack_ = e.segmentMetadataTrack),
                    (i.goalBufferLength_ = e.goalBufferLength),
                    (i.sourceType_ = e.sourceType),
                    (i.sourceUpdater_ = e.sourceUpdater),
                    (i.inbandTextTracks_ = e.inbandTextTracks),
                    (i.state_ = 'INIT'),
                    (i.timelineChangeController_ = e.timelineChangeController),
                    (i.shouldSaveSegmentTimingInfo_ = !0),
                    (i.parse708captions_ = e.parse708captions),
                    (i.useDtsForTimestampOffset_ = e.useDtsForTimestampOffset),
                    (i.captionServices_ = e.captionServices),
                    (i.experimentalExactManifestTimings = e.experimentalExactManifestTimings),
                    (i.checkBufferTimeout_ = null),
                    (i.error_ = void 0),
                    (i.currentTimeline_ = -1),
                    (i.pendingSegment_ = null),
                    (i.xhrOptions_ = null),
                    (i.pendingSegments_ = []),
                    (i.audioDisabled_ = !1),
                    (i.isPendingTimestampOffset_ = !1),
                    (i.gopBuffer_ = []),
                    (i.timeMapping_ = 0),
                    (i.safeAppend_ = 11 <= tr.browser.IE_VERSION),
                    (i.appendInitSegment_ = { audio: !0, video: !0 }),
                    (i.playlistOfLastInitSegment_ = { audio: null, video: null }),
                    (i.callQueue_ = []),
                    (i.loadQueue_ = []),
                    (i.metadataQueue_ = { id3: [], caption: [] }),
                    (i.waitingOnRemove_ = !1),
                    (i.quotaExceededErrorRetryTimeout_ = null),
                    (i.activeInitSegmentId_ = null),
                    (i.initSegments_ = {}),
                    (i.cacheEncryptionKeys_ = e.cacheEncryptionKeys),
                    (i.keyCache_ = {}),
                    (i.decrypter_ = e.decrypter),
                    (i.syncController_ = e.syncController),
                    (i.syncPoint_ = { segmentIndex: 0, time: 0 }),
                    (i.transmuxer_ = i.createTransmuxer_()),
                    (i.triggerSyncInfoUpdate_ = function () {
                        return i.trigger('syncinfoupdate')
                    }),
                    i.syncController_.on('syncinfoupdate', i.triggerSyncInfoUpdate_),
                    i.mediaSource_.addEventListener('sourceopen', function () {
                        i.isEndOfStream_() || (i.ended_ = !1)
                    }),
                    (i.fetchAtBuffer_ = !1),
                    (i.logger_ = Ro('SegmentLoader[' + i.loaderType_ + ']')),
                    Object.defineProperty(ft(i), 'state', {
                        get: function () {
                            return this.state_
                        },
                        set: function (e) {
                            e !== this.state_ && (this.logger_(this.state_ + ' -> ' + e), (this.state_ = e), this.trigger('statechange'))
                        },
                    }),
                    i.sourceUpdater_.on('ready', function () {
                        i.hasEnoughInfoToAppend_() && i.processCallQueue_()
                    }),
                    'main' === i.loaderType_ &&
                        i.timelineChangeController_.on('pendingtimelinechange', function () {
                            i.hasEnoughInfoToAppend_() && i.processCallQueue_()
                        }),
                    'audio' === i.loaderType_ &&
                        i.timelineChangeController_.on('timelinechange', function () {
                            i.hasEnoughInfoToLoad_() && i.processLoadQueue_(), i.hasEnoughInfoToAppend_() && i.processCallQueue_()
                        }),
                    i
                )
            }
            mt(e, n)
            var t = e.prototype
            return (
                (t.createTransmuxer_ = function () {
                    return xl({ remux: !1, alignGopsAtEnd: this.safeAppend_, keepOriginalTimestamps: !0, parse708captions: this.parse708captions_, captionServices: this.captionServices_ })
                }),
                (t.resetStats_ = function () {
                    ;(this.mediaBytesTransferred = 0),
                        (this.mediaRequests = 0),
                        (this.mediaRequestsAborted = 0),
                        (this.mediaRequestsTimedout = 0),
                        (this.mediaRequestsErrored = 0),
                        (this.mediaTransferDuration = 0),
                        (this.mediaSecondsLoaded = 0),
                        (this.mediaAppends = 0)
                }),
                (t.dispose = function () {
                    this.trigger('dispose'),
                        (this.state = 'DISPOSED'),
                        this.pause(),
                        this.abort_(),
                        this.transmuxer_ && this.transmuxer_.terminate(),
                        this.resetStats_(),
                        this.checkBufferTimeout_ && window.clearTimeout(this.checkBufferTimeout_),
                        this.syncController_ && this.triggerSyncInfoUpdate_ && this.syncController_.off('syncinfoupdate', this.triggerSyncInfoUpdate_),
                        this.off()
                }),
                (t.setAudio = function (e) {
                    ;(this.audioDisabled_ = !e), e ? (this.appendInitSegment_.audio = !0) : this.sourceUpdater_.removeAudio(0, this.duration_())
                }),
                (t.abort = function () {
                    'WAITING' === this.state ? (this.abort_(), (this.state = 'READY'), this.paused() || this.monitorBuffer_()) : this.pendingSegment_ && (this.pendingSegment_ = null)
                }),
                (t.abort_ = function () {
                    this.pendingSegment_ && this.pendingSegment_.abortRequests && this.pendingSegment_.abortRequests(),
                        (this.pendingSegment_ = null),
                        (this.callQueue_ = []),
                        (this.loadQueue_ = []),
                        (this.metadataQueue_.id3 = []),
                        (this.metadataQueue_.caption = []),
                        this.timelineChangeController_.clearPendingTimelineChange(this.loaderType_),
                        (this.waitingOnRemove_ = !1),
                        window.clearTimeout(this.quotaExceededErrorRetryTimeout_),
                        (this.quotaExceededErrorRetryTimeout_ = null)
                }),
                (t.checkForAbort_ = function (e) {
                    return 'APPENDING' !== this.state || this.pendingSegment_ ? !this.pendingSegment_ || this.pendingSegment_.requestId !== e : ((this.state = 'READY'), !0)
                }),
                (t.error = function (e) {
                    return 'undefined' != typeof e && (this.logger_('error occurred:', e), (this.error_ = e)), (this.pendingSegment_ = null), this.error_
                }),
                (t.endOfStream = function () {
                    ;(this.ended_ = !0), this.transmuxer_ && Il(this.transmuxer_), (this.gopBuffer_.length = 0), this.pause(), this.trigger('ended')
                }),
                (t.buffered_ = function () {
                    var e = this.getMediaInfo_()
                    if (!this.sourceUpdater_ || !e) return tr.createTimeRanges()
                    if ('main' === this.loaderType_) {
                        var t = e.hasAudio,
                            i = e.hasVideo,
                            e = e.isMuxed
                        if (i && t && !this.audioDisabled_ && !e) return this.sourceUpdater_.buffered()
                        if (i) return this.sourceUpdater_.videoBuffered()
                    }
                    return this.sourceUpdater_.audioBuffered()
                }),
                (t.initSegmentForMap = function (e, t) {
                    if ((void 0 === t && (t = !1), !e)) return null
                    var i = Su(e),
                        n = this.initSegments_[i]
                    return (
                        t && !n && e.bytes && (this.initSegments_[i] = n = { resolvedUri: e.resolvedUri, byterange: e.byterange, bytes: e.bytes, tracks: e.tracks, timescales: e.timescales }), n || e
                    )
                }),
                (t.segmentKey = function (e, t) {
                    if ((void 0 === t && (t = !1), !e)) return null
                    var i = wu(e),
                        n = this.keyCache_[i]
                    this.cacheEncryptionKeys_ && t && !n && e.bytes && (this.keyCache_[i] = n = { resolvedUri: e.resolvedUri, bytes: e.bytes })
                    e = { resolvedUri: (n || e).resolvedUri }
                    return n && (e.bytes = n.bytes), e
                }),
                (t.couldBeginLoading_ = function () {
                    return this.playlist_ && !this.paused()
                }),
                (t.load = function () {
                    if ((this.monitorBuffer_(), this.playlist_))
                        return 'INIT' === this.state && this.couldBeginLoading_()
                            ? this.init_()
                            : void (!this.couldBeginLoading_() || ('READY' !== this.state && 'INIT' !== this.state) || (this.state = 'READY'))
                }),
                (t.init_ = function () {
                    return (this.state = 'READY'), this.resetEverything(), this.monitorBuffer_()
                }),
                (t.playlist = function (e, t) {
                    if ((void 0 === t && (t = {}), e)) {
                        var i = this.playlist_,
                            n = this.pendingSegment_
                        ;(this.playlist_ = e),
                            (this.xhrOptions_ = t),
                            'INIT' === this.state && ((e.syncInfo = { mediaSequence: e.mediaSequence, time: 0 }), 'main' === this.loaderType_ && this.syncController_.setDateTimeMappingForStart(e))
                        var r = null
                        if (
                            (i && (i.id ? (r = i.id) : i.uri && (r = i.uri)),
                            this.logger_('playlist update [' + r + ' => ' + (e.id || e.uri) + ']'),
                            this.trigger('syncinfoupdate'),
                            'INIT' === this.state && this.couldBeginLoading_())
                        )
                            return this.init_()
                        if (!i || i.uri !== e.uri)
                            return null !== this.mediaIndex && (e.endList ? this.resyncLoader() : this.resetLoader()), (this.currentMediaInfo_ = void 0), void this.trigger('playlistupdate')
                        t = e.mediaSequence - i.mediaSequence
                        this.logger_('live window shift [' + t + ']'),
                            null !== this.mediaIndex &&
                                ((this.mediaIndex -= t),
                                this.mediaIndex < 0
                                    ? ((this.mediaIndex = null), (this.partIndex = null))
                                    : ((r = this.playlist_.segments[this.mediaIndex]),
                                      !this.partIndex ||
                                          (r.parts && r.parts.length && r.parts[this.partIndex]) ||
                                          ((r = this.mediaIndex),
                                          this.logger_('currently processing part (index ' + this.partIndex + ') no longer exists.'),
                                          this.resetLoader(),
                                          (this.mediaIndex = r)))),
                            n &&
                                ((n.mediaIndex -= t),
                                n.mediaIndex < 0
                                    ? ((n.mediaIndex = null), (n.partIndex = null))
                                    : (0 <= n.mediaIndex && (n.segment = e.segments[n.mediaIndex]), 0 <= n.partIndex && n.segment.parts && (n.part = n.segment.parts[n.partIndex]))),
                            this.syncController_.saveExpiredSegmentInfo(i, e)
                    }
                }),
                (t.pause = function () {
                    this.checkBufferTimeout_ && (window.clearTimeout(this.checkBufferTimeout_), (this.checkBufferTimeout_ = null))
                }),
                (t.paused = function () {
                    return null === this.checkBufferTimeout_
                }),
                (t.resetEverything = function (e) {
                    ;(this.ended_ = !1),
                        (this.appendInitSegment_ = { audio: !0, video: !0 }),
                        this.resetLoader(),
                        this.remove(0, 1 / 0, e),
                        this.transmuxer_ && (this.transmuxer_.postMessage({ action: 'clearAllMp4Captions' }), this.transmuxer_.postMessage({ action: 'reset' }))
                }),
                (t.resetLoader = function () {
                    ;(this.fetchAtBuffer_ = !1), this.resyncLoader()
                }),
                (t.resyncLoader = function () {
                    this.transmuxer_ && Il(this.transmuxer_),
                        (this.mediaIndex = null),
                        (this.partIndex = null),
                        (this.syncPoint_ = null),
                        (this.isPendingTimestampOffset_ = !1),
                        (this.callQueue_ = []),
                        (this.loadQueue_ = []),
                        (this.metadataQueue_.id3 = []),
                        (this.metadataQueue_.caption = []),
                        this.abort(),
                        this.transmuxer_ && this.transmuxer_.postMessage({ action: 'clearParsedMp4Captions' })
                }),
                (t.remove = function (e, t, i, n) {
                    if ((void 0 === i && (i = function () {}), void 0 === n && (n = !1), (t = t === 1 / 0 ? this.duration_() : t) <= e))
                        this.logger_('skipping remove because end ${end} is <= start ${start}')
                    else if (this.sourceUpdater_ && this.getMediaInfo_()) {
                        var r,
                            a = 1,
                            s = function () {
                                0 === --a && i()
                            }
                        for (r in ((!n && this.audioDisabled_) || (a++, this.sourceUpdater_.removeAudio(e, t, s)),
                        (!n && 'main' !== this.loaderType_) ||
                            ((this.gopBuffer_ = (function (e, t, i, n) {
                                for (var r = Math.ceil((t - n) * hl), a = Math.ceil((i - n) * hl), n = e.slice(), s = e.length; s-- && !(e[s].pts <= a); );
                                if (-1 === s) return n
                                for (var o = s + 1; o-- && !(e[o].pts <= r); );
                                return (o = Math.max(o, 0)), n.splice(o, s - o + 1), n
                            })(this.gopBuffer_, e, t, this.timeMapping_)),
                            a++,
                            this.sourceUpdater_.removeVideo(e, t, s)),
                        this.inbandTextTracks_))
                            rl(e, t, this.inbandTextTracks_[r])
                        rl(e, t, this.segmentMetadataTrack_), s()
                    } else this.logger_('skipping remove because no source updater or starting media info')
                }),
                (t.monitorBuffer_ = function () {
                    this.checkBufferTimeout_ && window.clearTimeout(this.checkBufferTimeout_), (this.checkBufferTimeout_ = window.setTimeout(this.monitorBufferTick_.bind(this), 1))
                }),
                (t.monitorBufferTick_ = function () {
                    'READY' === this.state && this.fillBuffer_(),
                        this.checkBufferTimeout_ && window.clearTimeout(this.checkBufferTimeout_),
                        (this.checkBufferTimeout_ = window.setTimeout(this.monitorBufferTick_.bind(this), 500))
                }),
                (t.fillBuffer_ = function () {
                    var e
                    this.sourceUpdater_.updating() ||
                        ((e = this.chooseNextRequest_()) &&
                            ('number' == typeof e.timestampOffset &&
                                ((this.isPendingTimestampOffset_ = !1), this.timelineChangeController_.pendingTimelineChange({ type: this.loaderType_, from: this.currentTimeline_, to: e.timeline })),
                            this.loadSegment_(e)))
                }),
                (t.isEndOfStream_ = function (e, t, i) {
                    if ((void 0 === e && (e = this.mediaIndex), void 0 === t && (t = this.playlist_), void 0 === i && (i = this.partIndex), !t || !this.mediaSource_)) return !1
                    var n = 'number' == typeof e && t.segments[e],
                        e = e + 1 === t.segments.length,
                        n = !n || !n.parts || i + 1 === n.parts.length
                    return t.endList && 'open' === this.mediaSource_.readyState && e && n
                }),
                (t.chooseNextRequest_ = function () {
                    var e = this.buffered_(),
                        t = Ho(e) || 0,
                        i = qo(e, this.currentTime_()),
                        n = !this.hasPlayed_() && 1 <= i,
                        r = i >= this.goalBufferLength_(),
                        e = this.playlist_.segments
                    if (!e.length || n || r) return null
                    this.syncPoint_ = this.syncPoint_ || this.syncController_.getSyncPoint(this.playlist_, this.duration_(), this.currentTimeline_, this.currentTime_())
                    var a,
                        n = { partIndex: null, mediaIndex: null, startOfSegment: null, playlist: this.playlist_, isSyncRequest: Boolean(!this.syncPoint_) }
                    n.isSyncRequest
                        ? (n.mediaIndex = (function (e, t, i) {
                              t = t || []
                              for (var n = [], r = 0, a = 0; a < t.length; a++) {
                                  var s = t[a]
                                  if (e === s.timeline && (n.push(a), i < (r += s.duration))) return a
                              }
                              return 0 === n.length ? 0 : n[n.length - 1]
                          })(this.currentTimeline_, e, t))
                        : null !== this.mediaIndex
                        ? ((r = e[this.mediaIndex]),
                          (a = 'number' == typeof this.partIndex ? this.partIndex : -1),
                          (n.startOfSegment = r.end || t),
                          r.parts && r.parts[a + 1] ? ((n.mediaIndex = this.mediaIndex), (n.partIndex = a + 1)) : (n.mediaIndex = this.mediaIndex + 1))
                        : ((a = (o = gl.getMediaInfoForTime({
                              experimentalExactManifestTimings: this.experimentalExactManifestTimings,
                              playlist: this.playlist_,
                              currentTime: this.fetchAtBuffer_ ? t : this.currentTime_(),
                              startingPartIndex: this.syncPoint_.partIndex,
                              startingSegmentIndex: this.syncPoint_.segmentIndex,
                              startTime: this.syncPoint_.time,
                          })).segmentIndex),
                          (s = o.startTime),
                          (o = o.partIndex),
                          (n.getMediaInfoForTime = this.fetchAtBuffer_ ? 'bufferedEnd ' + t : 'currentTime ' + this.currentTime_()),
                          (n.mediaIndex = a),
                          (n.startOfSegment = s),
                          (n.partIndex = o))
                    var s = e[n.mediaIndex],
                        o = s && 'number' == typeof n.partIndex && s.parts && s.parts[n.partIndex]
                    if (!s || ('number' == typeof n.partIndex && !o)) return null
                    'number' != typeof n.partIndex && s.parts && ((n.partIndex = 0), (o = s.parts[0])),
                        i ||
                            !o ||
                            o.independent ||
                            (0 === n.partIndex
                                ? (o = (i = e[n.mediaIndex - 1]).parts && i.parts.length && i.parts[i.parts.length - 1]) &&
                                  o.independent &&
                                  (--n.mediaIndex, (n.partIndex = i.parts.length - 1), (n.independent = 'previous segment'))
                                : s.parts[n.partIndex - 1].independent && (--n.partIndex, (n.independent = 'previous part')))
                    s = this.mediaSource_ && 'ended' === this.mediaSource_.readyState
                    return n.mediaIndex >= e.length - 1 && s && !this.seeking_() ? null : this.generateSegmentInfo_(n)
                }),
                (t.generateSegmentInfo_ = function (e) {
                    var t = e.independent,
                        i = e.playlist,
                        n = e.mediaIndex,
                        r = e.startOfSegment,
                        a = e.isSyncRequest,
                        s = e.partIndex,
                        o = e.forceTimestampOffset,
                        u = e.getMediaInfoForTime,
                        l = i.segments[n],
                        e = 'number' == typeof s && l.parts[s],
                        t = {
                            requestId: 'segment-loader-' + Math.random(),
                            uri: (e && e.resolvedUri) || l.resolvedUri,
                            mediaIndex: n,
                            partIndex: e ? s : null,
                            isSyncRequest: a,
                            startOfSegment: r,
                            playlist: i,
                            bytes: null,
                            encryptedBytes: null,
                            timestampOffset: null,
                            timeline: l.timeline,
                            duration: (e && e.duration) || l.duration,
                            segment: l,
                            part: e,
                            byteLength: 0,
                            transmuxer: this.transmuxer_,
                            getMediaInfoForTime: u,
                            independent: t,
                        },
                        o = 'undefined' != typeof o ? o : this.isPendingTimestampOffset_
                    t.timestampOffset = this.timestampOffsetForSegment_({
                        segmentTimeline: l.timeline,
                        currentTimeline: this.currentTimeline_,
                        startOfSegment: r,
                        buffered: this.buffered_(),
                        overrideCheck: o,
                    })
                    o = Ho(this.sourceUpdater_.audioBuffered())
                    return (
                        'number' == typeof o && (t.audioAppendStart = o - this.sourceUpdater_.audioTimestampOffset()),
                        this.sourceUpdater_.videoBuffered().length &&
                            (t.gopsToAlignWith = (function (e, t, i) {
                                if ('undefined' == typeof t || null === t || !e.length) return []
                                for (var n = Math.ceil((t - i + 3) * hl), r = 0; r < e.length && !(e[r].pts > n); r++);
                                return e.slice(r)
                            })(this.gopBuffer_, this.currentTime_() - this.sourceUpdater_.videoTimestampOffset(), this.timeMapping_)),
                        t
                    )
                }),
                (t.timestampOffsetForSegment_ = function (e) {
                    return (
                        (i = (t = e).segmentTimeline),
                        (n = t.currentTimeline),
                        (r = t.startOfSegment),
                        (e = t.buffered),
                        t.overrideCheck || i !== n ? (!(i < n) && e.length ? e.end(e.length - 1) : r) : null
                    )
                    var t, i, n, r
                }),
                (t.earlyAbortWhenNeeded_ = function (e) {
                    var t, i, n, r, a, s, o, u, l, c, d, h, p
                    !this.vhs_.tech_.paused() &&
                        this.xhrOptions_.timeout &&
                        this.playlist_.attributes.BANDWIDTH &&
                        (Date.now() - (e.firstBytesReceivedAt || Date.now()) < 1e3 ||
                            ((t = this.currentTime_()),
                            (r = e.bandwidth),
                            (a = this.pendingSegment_.duration),
                            (p = gl.estimateSegmentRequestTime(a, r, this.playlist_, e.bytesReceived)),
                            (i = this.buffered_()),
                            (n = t),
                            void 0 === (e = this.vhs_.tech_.playbackRate()) && (e = 1),
                            p <= (e = ((i.length ? i.end(i.length - 1) : 0) - n) / e - 1) ||
                                ((r = {
                                    master: this.vhs_.playlists.master,
                                    currentTime: t,
                                    bandwidth: r,
                                    duration: this.duration_(),
                                    segmentDuration: a,
                                    timeUntilRebuffer: e,
                                    currentTimeline: this.currentTimeline_,
                                    syncController: this.syncController_,
                                }),
                                (a = r.master),
                                (s = r.currentTime),
                                (o = r.bandwidth),
                                (u = r.duration),
                                (l = r.segmentDuration),
                                (c = r.timeUntilRebuffer),
                                (d = r.currentTimeline),
                                (h = r.syncController),
                                (a = (r = (a = !(a = (r = a.playlists.filter(function (e) {
                                    return !gl.isIncompatible(e)
                                })).filter(gl.isEnabled)).length
                                    ? r.filter(function (e) {
                                          return !gl.isDisabled(e)
                                      })
                                    : a)
                                    .filter(gl.hasAttribute.bind(null, 'BANDWIDTH'))
                                    .map(function (e) {
                                        var t = h.getSyncPoint(e, u, d, s) ? 1 : 2
                                        return { playlist: e, rebufferingImpact: gl.estimateSegmentRequestTime(l, o, e) * t - c }
                                    })).filter(function (e) {
                                    return e.rebufferingImpact <= 0
                                })),
                                el(a, function (e, t) {
                                    return tl(t.playlist, e.playlist)
                                }),
                                (r = a.length
                                    ? a[0]
                                    : (el(r, function (e, t) {
                                          return e.rebufferingImpact - t.rebufferingImpact
                                      }),
                                      r[0] || null)) &&
                                    ((p = p - e - r.rebufferingImpact),
                                    !r.playlist ||
                                        r.playlist.uri === this.playlist_.uri ||
                                        p < (e <= fl ? 1 : 0.5) ||
                                        ((this.bandwidth = r.playlist.attributes.BANDWIDTH * El.BANDWIDTH_VARIANCE + 1), this.trigger('earlyabort'))))))
                }),
                (t.handleAbort_ = function (e) {
                    this.logger_('Aborting ' + sl(e)), (this.mediaRequestsAborted += 1)
                }),
                (t.handleProgress_ = function (e, t) {
                    this.earlyAbortWhenNeeded_(t.stats), this.checkForAbort_(t.requestId) || this.trigger('progress')
                }),
                (t.handleTrackInfo_ = function (e, t) {
                    this.earlyAbortWhenNeeded_(e.stats),
                        this.checkForAbort_(e.requestId) ||
                            this.checkForIllegalMediaSwitch(t) ||
                            ((function (e, t) {
                                if ((!e && !t) || (!e && t) || (e && !t)) return !1
                                if (e === t) return !0
                                var i = Object.keys(e).sort(),
                                    n = Object.keys(t).sort()
                                if (i.length !== n.length) return !1
                                for (var r = 0; r < i.length; r++) {
                                    var a = i[r]
                                    if (a !== n[r]) return !1
                                    if (e[a] !== t[a]) return !1
                                }
                                return !0
                            })(this.currentMediaInfo_, (t = t || {})) ||
                                ((this.appendInitSegment_ = { audio: !0, video: !0 }),
                                (this.startingMediaInfo_ = t),
                                (this.currentMediaInfo_ = t),
                                this.logger_('trackinfo update', t),
                                this.trigger('trackinfo')),
                            this.checkForAbort_(e.requestId) || ((this.pendingSegment_.trackInfo = t), this.hasEnoughInfoToAppend_() && this.processCallQueue_()))
                }),
                (t.handleTimingInfo_ = function (e, t, i, n) {
                    var r
                    this.earlyAbortWhenNeeded_(e.stats),
                        this.checkForAbort_(e.requestId) ||
                            (((r = this.pendingSegment_)[(e = ol(t))] = r[e] || {}),
                            (r[e][i] = n),
                            this.logger_('timinginfo: ' + t + ' - ' + i + ' - ' + n),
                            this.hasEnoughInfoToAppend_() && this.processCallQueue_())
                }),
                (t.handleCaptions_ = function (e, t) {
                    var g,
                        y,
                        v = this
                    this.earlyAbortWhenNeeded_(e.stats),
                        this.checkForAbort_(e.requestId) ||
                            (0 !== t.length
                                ? this.pendingSegment_.hasAppendedData_
                                    ? ((g = null === this.sourceUpdater_.videoTimestampOffset() ? this.sourceUpdater_.audioTimestampOffset() : this.sourceUpdater_.videoTimestampOffset()),
                                      (y = {}),
                                      t.forEach(function (e) {
                                          y[e.stream] = y[e.stream] || { startTime: 1 / 0, captions: [], endTime: 0 }
                                          var t = y[e.stream]
                                          ;(t.startTime = Math.min(t.startTime, e.startTime + g)), (t.endTime = Math.max(t.endTime, e.endTime + g)), t.captions.push(e)
                                      }),
                                      Object.keys(y).forEach(function (e) {
                                          var t,
                                              i,
                                              n,
                                              r,
                                              a,
                                              s,
                                              o,
                                              u,
                                              l,
                                              c,
                                              d = y[e],
                                              h = d.startTime,
                                              p = d.endTime,
                                              f = d.captions,
                                              m = v.inbandTextTracks_
                                          v.logger_('adding cues from ' + h + ' -> ' + p + ' for ' + e),
                                              (t = m),
                                              (i = v.vhs_.tech_),
                                              t[(n = e)] ||
                                                  (i.trigger({ type: 'usage', name: 'vhs-608' }),
                                                  i.trigger({ type: 'usage', name: 'hls-608' }),
                                                  /^cc708_/.test((r = n)) && (r = 'SERVICE' + n.split('_')[1]),
                                                  (o = i.textTracks().getTrackById(r))
                                                      ? (t[n] = o)
                                                      : ((s = a = n),
                                                        (d = !1),
                                                        (o = ((i.options_.vhs && i.options_.vhs.captionServices) || {})[r]) && ((a = o.label), (s = o.language), (d = o.default)),
                                                        (t[n] = i.addRemoteTextTrack({ kind: 'captions', id: r, default: d, label: a, language: s }, !1).track))),
                                              rl(h, p, m[e]),
                                              (l = (f = { captionArray: f, inbandTextTracks: m, timestampOffset: g }).inbandTextTracks),
                                              (m = f.captionArray),
                                              (c = f.timestampOffset),
                                              m &&
                                                  ((u = window.WebKitDataCue || window.VTTCue),
                                                  m.forEach(function (e) {
                                                      var t = e.stream
                                                      l[t].addCue(new u(e.startTime + c, e.endTime + c, e.text))
                                                  }))
                                      }),
                                      this.transmuxer_ && this.transmuxer_.postMessage({ action: 'clearParsedMp4Captions' }))
                                    : this.metadataQueue_.caption.push(this.handleCaptions_.bind(this, e, t))
                                : this.logger_('SegmentLoader received no captions from a caption event'))
                }),
                (t.handleId3_ = function (e, t, i) {
                    var n, r, a, s
                    this.earlyAbortWhenNeeded_(e.stats),
                        this.checkForAbort_(e.requestId) ||
                            (this.pendingSegment_.hasAppendedData_
                                ? ((n = null === this.sourceUpdater_.videoTimestampOffset() ? this.sourceUpdater_.audioTimestampOffset() : this.sourceUpdater_.videoTimestampOffset()),
                                  (r = this.inbandTextTracks_),
                                  (a = i),
                                  (s = this.vhs_.tech_),
                                  r.metadataTrack_ ||
                                      ((r.metadataTrack_ = s.addRemoteTextTrack({ kind: 'metadata', label: 'Timed Metadata' }, !1).track), (r.metadataTrack_.inBandMetadataTrackDispatchType = a)),
                                  nl({ inbandTextTracks: this.inbandTextTracks_, metadataArray: t, timestampOffset: n, videoDuration: this.duration_() }))
                                : this.metadataQueue_.id3.push(this.handleId3_.bind(this, e, t, i)))
                }),
                (t.processMetadataQueue_ = function () {
                    this.metadataQueue_.id3.forEach(function (e) {
                        return e()
                    }),
                        this.metadataQueue_.caption.forEach(function (e) {
                            return e()
                        }),
                        (this.metadataQueue_.id3 = []),
                        (this.metadataQueue_.caption = [])
                }),
                (t.processCallQueue_ = function () {
                    var e = this.callQueue_
                    ;(this.callQueue_ = []),
                        e.forEach(function (e) {
                            return e()
                        })
                }),
                (t.processLoadQueue_ = function () {
                    var e = this.loadQueue_
                    ;(this.loadQueue_ = []),
                        e.forEach(function (e) {
                            return e()
                        })
                }),
                (t.hasEnoughInfoToLoad_ = function () {
                    if ('audio' !== this.loaderType_) return !0
                    var e = this.pendingSegment_
                    return (
                        !!e &&
                        (!this.getCurrentMediaInfo_() ||
                            !ul({
                                timelineChangeController: this.timelineChangeController_,
                                currentTimeline: this.currentTimeline_,
                                segmentTimeline: e.timeline,
                                loaderType: this.loaderType_,
                                audioDisabled: this.audioDisabled_,
                            }))
                    )
                }),
                (t.getCurrentMediaInfo_ = function (e) {
                    return ((e = void 0 === e ? this.pendingSegment_ : e) && e.trackInfo) || this.currentMediaInfo_
                }),
                (t.getMediaInfo_ = function (e) {
                    return void 0 === e && (e = this.pendingSegment_), this.getCurrentMediaInfo_(e) || this.startingMediaInfo_
                }),
                (t.hasEnoughInfoToAppend_ = function () {
                    if (!this.sourceUpdater_.ready()) return !1
                    if (this.waitingOnRemove_ || this.quotaExceededErrorRetryTimeout_) return !1
                    var e = this.pendingSegment_,
                        t = this.getCurrentMediaInfo_()
                    if (!e || !t) return !1
                    var i = t.hasAudio,
                        n = t.hasVideo,
                        t = t.isMuxed
                    return (
                        !(n && !e.videoTimingInfo) &&
                        !(i && !this.audioDisabled_ && !t && !e.audioTimingInfo) &&
                        !ul({
                            timelineChangeController: this.timelineChangeController_,
                            currentTimeline: this.currentTimeline_,
                            segmentTimeline: e.timeline,
                            loaderType: this.loaderType_,
                            audioDisabled: this.audioDisabled_,
                        })
                    )
                }),
                (t.handleData_ = function (e, t) {
                    if ((this.earlyAbortWhenNeeded_(e.stats), !this.checkForAbort_(e.requestId)))
                        if (!this.callQueue_.length && this.hasEnoughInfoToAppend_()) {
                            var i,
                                n = this.pendingSegment_
                            if ((this.setTimeMapping_(n.timeline), this.updateMediaSecondsLoaded_(n.part || n.segment), 'closed' !== this.mediaSource_.readyState)) {
                                if (
                                    (e.map && ((e.map = this.initSegmentForMap(e.map, !0)), (n.segment.map = e.map)),
                                    e.key && this.segmentKey(e.key, !0),
                                    (n.isFmp4 = e.isFmp4),
                                    (n.timingInfo = n.timingInfo || {}),
                                    n.isFmp4
                                        ? (this.trigger('fmp4'), (n.timingInfo.start = n[ol(t.type)].start))
                                        : ((i = this.getCurrentMediaInfo_()),
                                          (i = 'main' === this.loaderType_ && i && i.hasVideo) && (r = n.videoTimingInfo.start),
                                          (n.timingInfo.start = this.trueSegmentStart_({
                                              currentStart: n.timingInfo.start,
                                              playlist: n.playlist,
                                              mediaIndex: n.mediaIndex,
                                              currentVideoTimestampOffset: this.sourceUpdater_.videoTimestampOffset(),
                                              useVideoTimingInfo: i,
                                              firstVideoFrameTimeForData: r,
                                              videoTimingInfo: n.videoTimingInfo,
                                              audioTimingInfo: n.audioTimingInfo,
                                          }))),
                                    this.updateAppendInitSegmentStatus(n, t.type),
                                    this.updateSourceBufferTimestampOffset_(n),
                                    n.isSyncRequest)
                                ) {
                                    this.updateTimingInfoEnd_(n), this.syncController_.saveSegmentTimingInfo({ segmentInfo: n, shouldSaveTimelineMapping: 'main' === this.loaderType_ })
                                    var r = this.chooseNextRequest_()
                                    if (r.mediaIndex !== n.mediaIndex || r.partIndex !== n.partIndex) return void this.logger_('sync segment was incorrect, not appending')
                                    this.logger_('sync segment was correct, appending')
                                }
                                ;(n.hasAppendedData_ = !0), this.processMetadataQueue_(), this.appendData_(n, t)
                            }
                        } else this.callQueue_.push(this.handleData_.bind(this, e, t))
                }),
                (t.updateAppendInitSegmentStatus = function (e, t) {
                    'main' !== this.loaderType_ || 'number' != typeof e.timestampOffset || e.changedTimestampOffset || (this.appendInitSegment_ = { audio: !0, video: !0 }),
                        this.playlistOfLastInitSegment_[t] !== e.playlist && (this.appendInitSegment_[t] = !0)
                }),
                (t.getInitSegmentAndUpdateState_ = function (e) {
                    var t = e.type,
                        i = e.initSegment,
                        n = e.map,
                        r = e.playlist
                    if (n) {
                        e = Su(n)
                        if (this.activeInitSegmentId_ === e) return null
                        ;(i = this.initSegmentForMap(n, !0).bytes), (this.activeInitSegmentId_ = e)
                    }
                    return i && this.appendInitSegment_[t] ? ((this.playlistOfLastInitSegment_[t] = r), (this.appendInitSegment_[t] = !1), (this.activeInitSegmentId_ = null), i) : null
                }),
                (t.handleQuotaExceededError_ = function (e, t) {
                    var i = this,
                        n = e.segmentInfo,
                        r = e.type,
                        a = e.bytes,
                        s = this.sourceUpdater_.audioBuffered(),
                        o = this.sourceUpdater_.videoBuffered()
                    1 < s.length && this.logger_('On QUOTA_EXCEEDED_ERR, found gaps in the audio buffer: ' + jo(s).join(', ')),
                        1 < o.length && this.logger_('On QUOTA_EXCEEDED_ERR, found gaps in the video buffer: ' + jo(o).join(', '))
                    var u = s.length ? s.start(0) : 0,
                        l = s.length ? s.end(s.length - 1) : 0,
                        c = o.length ? o.start(0) : 0,
                        e = o.length ? o.end(o.length - 1) : 0
                    if (l - u <= 1 && e - c <= 1)
                        return (
                            this.logger_(
                                'On QUOTA_EXCEEDED_ERR, single segment too large to append to buffer, triggering an error. Appended byte length: ' +
                                    a.byteLength +
                                    ', audio buffer: ' +
                                    jo(s).join(', ') +
                                    ', video buffer: ' +
                                    jo(o).join(', ') +
                                    ', '
                            ),
                            this.error({ message: 'Quota exceeded error with append of a single segment of content', excludeUntil: 1 / 0 }),
                            void this.trigger('error')
                        )
                    ;(this.waitingOnRemove_ = !0), this.callQueue_.push(this.appendToSourceBuffer_.bind(this, { segmentInfo: n, type: r, bytes: a }))
                    a = this.currentTime_() - 1
                    this.logger_('On QUOTA_EXCEEDED_ERR, removing audio/video from 0 to ' + a),
                        this.remove(
                            0,
                            a,
                            function () {
                                i.logger_('On QUOTA_EXCEEDED_ERR, retrying append in 1s'),
                                    (i.waitingOnRemove_ = !1),
                                    (i.quotaExceededErrorRetryTimeout_ = window.setTimeout(function () {
                                        i.logger_('On QUOTA_EXCEEDED_ERR, re-processing call queue'), (i.quotaExceededErrorRetryTimeout_ = null), i.processCallQueue_()
                                    }, 1e3))
                            },
                            !0
                        )
                }),
                (t.handleAppendError_ = function (e, t) {
                    var i = e.segmentInfo,
                        n = e.type,
                        e = e.bytes
                    t &&
                        (22 !== t.code
                            ? (this.logger_('Received non QUOTA_EXCEEDED_ERR on append', t),
                              this.error(n + ' append of ' + e.length + 'b failed for segment #' + i.mediaIndex + ' in playlist ' + i.playlist.id),
                              this.trigger('appenderror'))
                            : this.handleQuotaExceededError_({ segmentInfo: i, type: n, bytes: e }))
                }),
                (t.appendToSourceBuffer_ = function (e) {
                    var t,
                        i,
                        n = e.segmentInfo,
                        r = e.type,
                        a = e.initSegment,
                        s = e.data,
                        o = e.bytes
                    o ||
                        ((e = [s]),
                        (s = s.byteLength),
                        a && (e.unshift(a), (s += a.byteLength)),
                        (i = 0),
                        (e = { bytes: s, segments: e }).bytes &&
                            ((t = new Uint8Array(e.bytes)),
                            e.segments.forEach(function (e) {
                                t.set(e, i), (i += e.byteLength)
                            })),
                        (o = t)),
                        this.sourceUpdater_.appendBuffer({ segmentInfo: n, type: r, bytes: o }, this.handleAppendError_.bind(this, { segmentInfo: n, type: r, bytes: o }))
                }),
                (t.handleSegmentTimingInfo_ = function (e, t, i) {
                    this.pendingSegment_ &&
                        t === this.pendingSegment_.requestId &&
                        ((t = this.pendingSegment_.segment)[(e = e + 'TimingInfo')] || (t[e] = {}),
                        (t[e].transmuxerPrependedSeconds = i.prependedContentDuration || 0),
                        (t[e].transmuxedPresentationStart = i.start.presentation),
                        (t[e].transmuxedDecodeStart = i.start.decode),
                        (t[e].transmuxedPresentationEnd = i.end.presentation),
                        (t[e].transmuxedDecodeEnd = i.end.decode),
                        (t[e].baseMediaDecodeTime = i.baseMediaDecodeTime))
                }),
                (t.appendData_ = function (e, t) {
                    var i = t.type,
                        n = t.data
                    n &&
                        n.byteLength &&
                        (('audio' === i && this.audioDisabled_) ||
                            ((t = this.getInitSegmentAndUpdateState_({ type: i, initSegment: t.initSegment, playlist: e.playlist, map: e.isFmp4 ? e.segment.map : null })),
                            this.appendToSourceBuffer_({ segmentInfo: e, type: i, initSegment: t, data: n })))
                }),
                (t.loadSegment_ = function (t) {
                    var i = this
                    ;(this.state = 'WAITING'),
                        (this.pendingSegment_ = t),
                        this.trimBackBuffer_(t),
                        'number' == typeof t.timestampOffset && this.transmuxer_ && this.transmuxer_.postMessage({ action: 'clearAllMp4Captions' }),
                        this.hasEnoughInfoToLoad_()
                            ? this.updateTransmuxerAndRequestSegment_(t)
                            : this.loadQueue_.push(function () {
                                  var e = g({}, t, { forceTimestampOffset: !0 })
                                  g(t, i.generateSegmentInfo_(e)), (i.isPendingTimestampOffset_ = !1), i.updateTransmuxerAndRequestSegment_(t)
                              })
                }),
                (t.updateTransmuxerAndRequestSegment_ = function (n) {
                    var r = this
                    this.shouldUpdateTransmuxerTimestampOffset_(n.timestampOffset) &&
                        ((this.gopBuffer_.length = 0),
                        (n.gopsToAlignWith = []),
                        (this.timeMapping_ = 0),
                        this.transmuxer_.postMessage({ action: 'reset' }),
                        this.transmuxer_.postMessage({ action: 'setTimestampOffset', timestampOffset: n.timestampOffset }))
                    var e = this.createSimplifiedSegmentObj_(n),
                        t = this.isEndOfStream_(n.mediaIndex, n.playlist, n.partIndex),
                        i = null !== this.mediaIndex,
                        a = n.timeline !== this.currentTimeline_ && 0 < n.timeline,
                        a = t || (i && a)
                    this.logger_('Requesting ' + sl(n)),
                        e.map && !e.map.bytes && (this.logger_('going to request init segment.'), (this.appendInitSegment_ = { video: !0, audio: !0 })),
                        (n.abortRequests = Xu({
                            xhr: this.vhs_.xhr,
                            xhrOptions: this.xhrOptions_,
                            decryptionWorker: this.decrypter_,
                            segment: e,
                            abortFn: this.handleAbort_.bind(this, n),
                            progressFn: this.handleProgress_.bind(this),
                            trackInfoFn: this.handleTrackInfo_.bind(this),
                            timingInfoFn: this.handleTimingInfo_.bind(this),
                            videoSegmentTimingInfoFn: this.handleSegmentTimingInfo_.bind(this, 'video', n.requestId),
                            audioSegmentTimingInfoFn: this.handleSegmentTimingInfo_.bind(this, 'audio', n.requestId),
                            captionsFn: this.handleCaptions_.bind(this),
                            isEndOfTimeline: a,
                            endedTimelineFn: function () {
                                r.logger_('received endedtimeline callback')
                            },
                            id3Fn: this.handleId3_.bind(this),
                            dataFn: this.handleData_.bind(this),
                            doneFn: this.segmentRequestFinished_.bind(this),
                            onTransmuxerLog: function (e) {
                                var t = e.message,
                                    i = e.level,
                                    e = e.stream
                                r.logger_(sl(n) + ' logged from transmuxer stream ' + e + ' as a ' + i + ': ' + t)
                            },
                        }))
                }),
                (t.trimBackBuffer_ = function (e) {
                    var t,
                        i,
                        n,
                        r,
                        r =
                            ((t = this.seekable_()),
                            (i = this.currentTime_()),
                            (n = this.playlist_.targetDuration || 10),
                            (r = i - El.BACK_BUFFER_LENGTH),
                            t.length && (r = Math.max(r, t.start(0))),
                            Math.min(i - n, r))
                    0 < r && this.remove(0, r)
                }),
                (t.createSimplifiedSegmentObj_ = function (e) {
                    var t = e.segment,
                        i = e.part,
                        n = {
                            resolvedUri: (i || t).resolvedUri,
                            byterange: (i || t).byterange,
                            requestId: e.requestId,
                            transmuxer: e.transmuxer,
                            audioAppendStart: e.audioAppendStart,
                            gopsToAlignWith: e.gopsToAlignWith,
                            part: e.part,
                        },
                        i = e.playlist.segments[e.mediaIndex - 1]
                    return (
                        i &&
                            i.timeline === t.timeline &&
                            (i.videoTimingInfo ? (n.baseStartTime = i.videoTimingInfo.transmuxedDecodeEnd) : i.audioTimingInfo && (n.baseStartTime = i.audioTimingInfo.transmuxedDecodeEnd)),
                        t.key && ((e = t.key.iv || new Uint32Array([0, 0, 0, e.mediaIndex + e.playlist.mediaSequence])), (n.key = this.segmentKey(t.key)), (n.key.iv = e)),
                        t.map && (n.map = this.initSegmentForMap(t.map)),
                        n
                    )
                }),
                (t.saveTransferStats_ = function (e) {
                    ;(this.mediaRequests += 1), e && ((this.mediaBytesTransferred += e.bytesReceived), (this.mediaTransferDuration += e.roundTripTime))
                }),
                (t.saveBandwidthRelatedStats_ = function (e, t) {
                    ;(this.pendingSegment_.byteLength = t.bytesReceived),
                        e < 1 / 60
                            ? this.logger_("Ignoring segment's bandwidth because its duration of " + e + ' is less than the min to record ' + 1 / 60)
                            : ((this.bandwidth = t.bandwidth), (this.roundTrip = t.roundTripTime))
                }),
                (t.handleTimeout_ = function () {
                    ;(this.mediaRequestsTimedout += 1), (this.bandwidth = 1), (this.roundTrip = NaN), this.trigger('bandwidthupdate')
                }),
                (t.segmentRequestFinished_ = function (e, t, i) {
                    if (this.callQueue_.length) this.callQueue_.push(this.segmentRequestFinished_.bind(this, e, t, i))
                    else if ((this.saveTransferStats_(t.stats), this.pendingSegment_ && t.requestId === this.pendingSegment_.requestId)) {
                        if (e)
                            return (
                                (this.pendingSegment_ = null),
                                (this.state = 'READY'),
                                e.code === Ll ? void 0 : (this.pause(), e.code === Pl ? void this.handleTimeout_() : ((this.mediaRequestsErrored += 1), this.error(e), void this.trigger('error')))
                            )
                        e = this.pendingSegment_
                        this.saveBandwidthRelatedStats_(e.duration, t.stats),
                            (e.endOfAllRequests = t.endOfAllRequests),
                            i.gopInfo &&
                                (this.gopBuffer_ = (function (e, t, i) {
                                    if (!t.length) return e
                                    if (i) return t.slice()
                                    for (var n = t[0].pts, r = 0; r < e.length && !(e[r].pts >= n); r++);
                                    return e.slice(0, r).concat(t)
                                })(this.gopBuffer_, i.gopInfo, this.safeAppend_)),
                            (this.state = 'APPENDING'),
                            this.trigger('appending'),
                            this.waitForAppendsToComplete_(e)
                    }
                }),
                (t.setTimeMapping_ = function (e) {
                    e = this.syncController_.mappingForTimeline(e)
                    null !== e && (this.timeMapping_ = e)
                }),
                (t.updateMediaSecondsLoaded_ = function (e) {
                    'number' == typeof e.start && 'number' == typeof e.end ? (this.mediaSecondsLoaded += e.end - e.start) : (this.mediaSecondsLoaded += e.duration)
                }),
                (t.shouldUpdateTransmuxerTimestampOffset_ = function (e) {
                    return (
                        null !== e && (('main' === this.loaderType_ && e !== this.sourceUpdater_.videoTimestampOffset()) || (!this.audioDisabled_ && e !== this.sourceUpdater_.audioTimestampOffset()))
                    )
                }),
                (t.trueSegmentStart_ = function (e) {
                    var t = e.currentStart,
                        i = e.playlist,
                        n = e.mediaIndex,
                        r = e.firstVideoFrameTimeForData,
                        a = e.currentVideoTimestampOffset,
                        s = e.useVideoTimingInfo,
                        o = e.videoTimingInfo,
                        e = e.audioTimingInfo
                    if ('undefined' != typeof t) return t
                    if (!s) return e.start
                    i = i.segments[n - 1]
                    return 0 !== n && i && 'undefined' != typeof i.start && i.end === r + a ? o.start : r
                }),
                (t.waitForAppendsToComplete_ = function (e) {
                    var t = this.getCurrentMediaInfo_(e)
                    if (!t) return this.error({ message: 'No starting media returned, likely due to an unsupported media format.', blacklistDuration: 1 / 0 }), void this.trigger('error')
                    var i = t.hasAudio,
                        n = t.hasVideo,
                        t = t.isMuxed,
                        n = 'main' === this.loaderType_ && n,
                        t = !this.audioDisabled_ && i && !t
                    if (((e.waitingOnAppends = 0), !e.hasAppendedData_))
                        return (
                            e.timingInfo || 'number' != typeof e.timestampOffset || (this.isPendingTimestampOffset_ = !0),
                            (e.timingInfo = { start: 0 }),
                            e.waitingOnAppends++,
                            this.isPendingTimestampOffset_ || (this.updateSourceBufferTimestampOffset_(e), this.processMetadataQueue_()),
                            void this.checkAppendsDone_(e)
                        )
                    n && e.waitingOnAppends++,
                        t && e.waitingOnAppends++,
                        n && this.sourceUpdater_.videoQueueCallback(this.checkAppendsDone_.bind(this, e)),
                        t && this.sourceUpdater_.audioQueueCallback(this.checkAppendsDone_.bind(this, e))
                }),
                (t.checkAppendsDone_ = function (e) {
                    this.checkForAbort_(e.requestId) || (e.waitingOnAppends--, 0 === e.waitingOnAppends && this.handleAppendsDone_())
                }),
                (t.checkForIllegalMediaSwitch = function (e) {
                    var t,
                        i,
                        e =
                            ((t = this.loaderType_),
                            (i = this.getCurrentMediaInfo_()),
                            (e = e),
                            'main' === t && i && e
                                ? e.hasAudio || e.hasVideo
                                    ? i.hasVideo && !e.hasVideo
                                        ? "Only audio found in segment when we expected video. We can't switch to audio only from a stream that had video. To get rid of this message, please add codec information to the manifest."
                                        : !i.hasVideo && e.hasVideo
                                        ? "Video found in segment when we expected only audio. We can't switch to a stream with video from an audio only stream. To get rid of this message, please add codec information to the manifest."
                                        : null
                                    : 'Neither audio nor video found in segment.'
                                : null)
                    return !!e && (this.error({ message: e, blacklistDuration: 1 / 0 }), this.trigger('error'), !0)
                }),
                (t.updateSourceBufferTimestampOffset_ = function (e) {
                    var t
                    null === e.timestampOffset ||
                        'number' != typeof e.timingInfo.start ||
                        e.changedTimestampOffset ||
                        'main' !== this.loaderType_ ||
                        ((t = !1),
                        (e.timestampOffset -= this.getSegmentStartTimeForTimestampOffsetCalculation_({
                            videoTimingInfo: e.segment.videoTimingInfo,
                            audioTimingInfo: e.segment.audioTimingInfo,
                            timingInfo: e.timingInfo,
                        })),
                        (e.changedTimestampOffset = !0),
                        e.timestampOffset !== this.sourceUpdater_.videoTimestampOffset() && (this.sourceUpdater_.videoTimestampOffset(e.timestampOffset), (t = !0)),
                        e.timestampOffset !== this.sourceUpdater_.audioTimestampOffset() && (this.sourceUpdater_.audioTimestampOffset(e.timestampOffset), (t = !0)),
                        t && this.trigger('timestampoffset'))
                }),
                (t.getSegmentStartTimeForTimestampOffsetCalculation_ = function (e) {
                    var t = e.videoTimingInfo,
                        i = e.audioTimingInfo,
                        e = e.timingInfo
                    return this.useDtsForTimestampOffset_
                        ? t && 'number' == typeof t.transmuxedDecodeStart
                            ? t.transmuxedDecodeStart
                            : i && 'number' == typeof i.transmuxedDecodeStart
                            ? i.transmuxedDecodeStart
                            : e.start
                        : e.start
                }),
                (t.updateTimingInfoEnd_ = function (e) {
                    e.timingInfo = e.timingInfo || {}
                    var t = this.getMediaInfo_(),
                        t = 'main' === this.loaderType_ && t && t.hasVideo && e.videoTimingInfo ? e.videoTimingInfo : e.audioTimingInfo
                    t && (e.timingInfo.end = 'number' == typeof t.end ? t.end : t.start + e.duration)
                }),
                (t.handleAppendsDone_ = function () {
                    if ((this.pendingSegment_ && this.trigger('appendsdone'), !this.pendingSegment_)) return (this.state = 'READY'), void (this.paused() || this.monitorBuffer_())
                    var e = this.pendingSegment_
                    this.updateTimingInfoEnd_(e),
                        this.shouldSaveSegmentTimingInfo_ && this.syncController_.saveSegmentTimingInfo({ segmentInfo: e, shouldSaveTimelineMapping: 'main' === this.loaderType_ })
                    var t = cl(e, this.sourceType_)
                    if (
                        (t && ('warn' === t.severity ? tr.log.warn(t.message) : this.logger_(t.message)),
                        this.recordThroughput_(e),
                        (this.pendingSegment_ = null),
                        (this.state = 'READY'),
                        !e.isSyncRequest || (this.trigger('syncinfoupdate'), e.hasAppendedData_))
                    ) {
                        this.logger_('Appended ' + sl(e)),
                            this.addSegmentMetadataCue_(e),
                            (this.fetchAtBuffer_ = !0),
                            this.currentTimeline_ !== e.timeline &&
                                (this.timelineChangeController_.lastTimelineChange({ type: this.loaderType_, from: this.currentTimeline_, to: e.timeline }),
                                'main' !== this.loaderType_ ||
                                    this.audioDisabled_ ||
                                    this.timelineChangeController_.lastTimelineChange({ type: 'audio', from: this.currentTimeline_, to: e.timeline })),
                            (this.currentTimeline_ = e.timeline),
                            this.trigger('syncinfoupdate')
                        var i = e.segment,
                            t = e.part,
                            i = i.end && this.currentTime_() - i.end > 3 * e.playlist.targetDuration,
                            t = t && t.end && this.currentTime_() - t.end > 3 * e.playlist.partTargetDuration
                        if (i || t) return this.logger_('bad ' + (i ? 'segment' : 'part') + ' ' + sl(e)), void this.resetEverything()
                        null !== this.mediaIndex && this.trigger('bandwidthupdate'),
                            this.trigger('progress'),
                            (this.mediaIndex = e.mediaIndex),
                            (this.partIndex = e.partIndex),
                            this.isEndOfStream_(e.mediaIndex, e.playlist, e.partIndex) && this.endOfStream(),
                            this.trigger('appended'),
                            e.hasAppendedData_ && this.mediaAppends++,
                            this.paused() || this.monitorBuffer_()
                    } else this.logger_('Throwing away un-appended sync request ' + sl(e))
                }),
                (t.recordThroughput_ = function (e) {
                    var t, i
                    e.duration < 1 / 60
                        ? this.logger_("Ignoring segment's throughput because its duration of " + e.duration + ' is less than the min to record ' + 1 / 60)
                        : ((t = this.throughput.rate),
                          (i = Date.now() - e.endOfAllRequests + 1),
                          (i = Math.floor((e.byteLength / i) * 8 * 1e3)),
                          (this.throughput.rate += (i - t) / ++this.throughput.count))
                }),
                (t.addSegmentMetadataCue_ = function (e) {
                    var t, i, n, r
                    this.segmentMetadataTrack_ &&
                        ((i = (t = e.segment).start),
                        (r = t.end),
                        al(i) &&
                            al(r) &&
                            (rl(i, r, this.segmentMetadataTrack_),
                            (n = window.WebKitDataCue || window.VTTCue),
                            (e = {
                                custom: t.custom,
                                dateTimeObject: t.dateTimeObject,
                                dateTimeString: t.dateTimeString,
                                bandwidth: e.playlist.attributes.BANDWIDTH,
                                resolution: e.playlist.attributes.RESOLUTION,
                                codecs: e.playlist.attributes.CODECS,
                                byteLength: e.byteLength,
                                uri: e.uri,
                                timeline: e.timeline,
                                playlist: e.playlist.id,
                                start: i,
                                end: r,
                            }),
                            ((r = new n(i, r, JSON.stringify(e))).value = e),
                            this.segmentMetadataTrack_.addCue(r)))
                }),
                e
            )
        })(tr.EventTarget)
    function Rl() {}
    function Nl(e) {
        return 'string' != typeof e
            ? e
            : e.replace(/./, function (e) {
                  return e.toUpperCase()
              })
    }
    function Ul(e, t) {
        var i = t[e + 'Buffer']
        return (i && i.updating) || t.queuePending[e]
    }
    function Bl(e, t) {
        if (0 !== t.queue.length) {
            var i = 0,
                n = t.queue[i]
            if ('mediaSource' !== n.type) {
                if ('mediaSource' !== e && t.ready() && 'closed' !== t.mediaSource.readyState && !Ul(e, t)) {
                    if (n.type !== e) {
                        if (
                            null ===
                            (i = (function (e, t) {
                                for (var i = 0; i < t.length; i++) {
                                    var n = t[i]
                                    if ('mediaSource' === n.type) return null
                                    if (n.type === e) return i
                                }
                                return null
                            })(e, t.queue))
                        )
                            return
                        n = t.queue[i]
                    }
                    t.queue.splice(i, 1), (t.queuePending[e] = n).action(e, t), n.doneFn || ((t.queuePending[e] = null), Bl(e, t))
                }
            } else t.updating() || 'closed' === t.mediaSource.readyState || (t.queue.shift(), n.action(t), n.doneFn && n.doneFn(), Bl('audio', t), Bl('video', t))
        }
    }
    function Fl(e, t) {
        var i = t[e + 'Buffer'],
            n = Nl(e)
        i && (i.removeEventListener('updateend', t['on' + n + 'UpdateEnd_']), i.removeEventListener('error', t['on' + n + 'Error_']), (t.codecs[e] = null), (t[e + 'Buffer'] = null))
    }
    function jl(e, t) {
        return e && t && -1 !== Array.prototype.indexOf.call(e.sourceBuffers, t)
    }
    function Hl(e) {
        var t = e.type,
            i = e.sourceUpdater,
            n = e.action,
            r = e.doneFn,
            e = e.name
        i.queue.push({ type: t, action: n, doneFn: r, name: e }), Bl(t, i)
    }
    function ql(i, n) {
        return function (e) {
            var t
            n.queuePending[i] && ((t = n.queuePending[i].doneFn), (n.queuePending[i] = null), t && t(n[i + 'Error_'])), Bl(i, n)
        }
    }
    function Vl(e) {
        return decodeURIComponent(escape(String.fromCharCode.apply(null, e)))
    }
    function Wl(e, t) {
        e.abort(), e.pause(), t && t.activePlaylistLoader && (t.activePlaylistLoader.pause(), (t.activePlaylistLoader = null))
    }
    function Gl(e, t) {
        ;(t.activePlaylistLoader = e).load()
    }
    function zl(e, t) {
        for (var i = 0; i < e.length; i++) {
            if (nu(t, e[i])) return !0
            if (e[i].playlists && zl(e[i].playlists, t)) return !0
        }
        return !1
    }
    function Xl(a) {
        ;['AUDIO', 'SUBTITLES', 'CLOSED-CAPTIONS'].forEach(function (e) {
            yc[e](e, a)
        })
        var e,
            s = a.mediaTypes,
            t = a.masterPlaylistLoader,
            i = a.tech,
            n = a.vhs,
            r = a.segmentLoaders,
            o = r.AUDIO,
            u = r.main
        function l() {
            s.AUDIO.onTrackChanged(), i.trigger({ type: 'usage', name: 'vhs-audio-change' }), i.trigger({ type: 'usage', name: 'hls-audio-change' })
        }
        for (e in (['AUDIO', 'SUBTITLES'].forEach(function (e) {
            var u, l, o, c, t, i, d, h, n, r
            ;(s[e].activeGroup =
                ((u = e),
                (l = a),
                function (t) {
                    var e = l.masterPlaylistLoader,
                        i = l.mediaTypes[u].groups,
                        n = e.media()
                    if (!n) return null
                    var r = null
                    n.attributes[u] && (r = i[n.attributes[u]])
                    var a = Object.keys(i)
                    if (!r)
                        if ('AUDIO' === u && 1 < a.length && au(l.master))
                            for (var s = 0; s < a.length; s++) {
                                var o = i[a[s]]
                                if (zl(o, n)) {
                                    r = o
                                    break
                                }
                            }
                        else i.main ? (r = i.main) : 1 === a.length && (r = i[a[0]])
                    return 'undefined' == typeof t
                        ? r
                        : (null !== t &&
                              r &&
                              r.filter(function (e) {
                                  return e.id === t.id
                              })[0]) ||
                              null
                })),
                (s[e].activeTrack = vc[e](e, a)),
                (s[e].onGroupChanged =
                    ((o = e),
                    (c = a),
                    function () {
                        var e = c.segmentLoaders,
                            t = e[o],
                            i = e.main,
                            n = c.mediaTypes[o],
                            r = n.activeTrack(),
                            a = n.getActiveGroup(),
                            s = n.activePlaylistLoader,
                            e = n.lastGroup_
                        ;(a && e && a.id === e.id) ||
                            ((n.lastGroup_ = a), (n.lastTrack_ = r), Wl(t, n), a && !a.isMasterPlaylist && (a.playlistLoader ? (t.resyncLoader(), Gl(a.playlistLoader, n)) : s && i.resetEverything()))
                    })),
                (s[e].onGroupChanging =
                    ((t = e),
                    (i = a),
                    function () {
                        var e = i.segmentLoaders[t]
                        ;(i.mediaTypes[t].lastGroup_ = null), e.abort(), e.pause()
                    })),
                (s[e].onTrackChanged =
                    ((d = e),
                    (h = a),
                    function () {
                        var e = h.masterPlaylistLoader,
                            t = h.segmentLoaders,
                            i = t[d],
                            n = t.main,
                            r = h.mediaTypes[d],
                            a = r.activeTrack(),
                            s = r.getActiveGroup(),
                            o = r.activePlaylistLoader,
                            u = r.lastTrack_
                        if ((!u || !a || u.id !== a.id) && ((r.lastGroup_ = s), (r.lastTrack_ = a), Wl(i, r), s)) {
                            if (s.isMasterPlaylist) {
                                if (!a || !u || a.id === u.id) return
                                var l = h.vhs.masterPlaylistController_,
                                    t = l.selectPlaylist()
                                return l.media() === t
                                    ? void 0
                                    : (r.logger_('track change. Switching master audio from ' + u.id + ' to ' + a.id), e.pause(), n.resetEverything(), void l.fastQualityChange_(t))
                            }
                            if ('AUDIO' === d) {
                                if (!s.playlistLoader) return n.setAudio(!0), void n.resetEverything()
                                i.setAudio(!0), n.setAudio(!1)
                            }
                            o !== s.playlistLoader && (i.track && i.track(a), i.resetEverything()), Gl(s.playlistLoader, r)
                        }
                    })),
                (s[e].getActiveGroup =
                    ((n = e),
                    (r = a.mediaTypes),
                    function () {
                        var e = r[n].activeTrack()
                        return e ? r[n].activeGroup(e) : null
                    }))
        }),
        (r = s.AUDIO.activeGroup()) &&
            ((r = (
                r.filter(function (e) {
                    return e.default
                })[0] || r[0]
            ).id),
            (s.AUDIO.tracks[r].enabled = !0),
            s.AUDIO.onGroupChanged(),
            s.AUDIO.onTrackChanged(),
            s.AUDIO.getActiveGroup().playlistLoader ? (u.setAudio(!1), o.setAudio(!0)) : u.setAudio(!0)),
        t.on('mediachange', function () {
            ;['AUDIO', 'SUBTITLES'].forEach(function (e) {
                return s[e].onGroupChanged()
            })
        }),
        t.on('mediachanging', function () {
            ;['AUDIO', 'SUBTITLES'].forEach(function (e) {
                return s[e].onGroupChanging()
            })
        }),
        i.audioTracks().addEventListener('change', l),
        i.remoteTextTracks().addEventListener('change', s.SUBTITLES.onTrackChanged),
        n.on('dispose', function () {
            i.audioTracks().removeEventListener('change', l), i.remoteTextTracks().removeEventListener('change', s.SUBTITLES.onTrackChanged)
        }),
        i.clearTracks('audio'),
        s.AUDIO.tracks))
            i.audioTracks().addTrack(s.AUDIO.tracks[e])
    }
    function Kl(e, t, i) {
        var n,
            r,
            a,
            s,
            o = e.masterPlaylistController_,
            u = o[(e.options_.smoothQualityChange ? 'smooth' : 'fast') + 'QualityChange_'].bind(o)
        t.attributes && ((n = t.attributes.RESOLUTION), (this.width = n && n.width), (this.height = n && n.height), (this.bandwidth = t.attributes.BANDWIDTH)),
            (this.codecs = $u(o.master(), t)),
            (this.playlist = t),
            (this.id = i),
            (this.enabled =
                ((r = e.playlists),
                (a = t.id),
                (s = u),
                function (e) {
                    var t = r.master.playlists[a],
                        i = Zo(t),
                        n = eu(t)
                    return 'undefined' == typeof e ? n : (e ? delete t.disabled : (t.disabled = !0), e === n || i || (s(), e ? r.trigger('renditionenabled') : r.trigger('renditiondisabled')), e)
                }))
    }
    function Yl(t, e) {
        var i = 0,
            n = 0,
            r = tr.mergeOptions(wc, e)
        function a() {
            n && t.currentTime(n)
        }
        function s(e) {
            null != e &&
                ((n = (t.duration() !== 1 / 0 && t.currentTime()) || 0),
                t.one('loadedmetadata', a),
                t.src(e),
                t.trigger({ type: 'usage', name: 'vhs-error-reload' }),
                t.trigger({ type: 'usage', name: 'hls-error-reload' }),
                t.play())
        }
        function o() {
            return Date.now() - i < 1e3 * r.errorInterval
                ? (t.trigger({ type: 'usage', name: 'vhs-error-reload-canceled' }), void t.trigger({ type: 'usage', name: 'hls-error-reload-canceled' }))
                : r.getSource && 'function' == typeof r.getSource
                ? ((i = Date.now()), r.getSource.call(t, s))
                : void tr.log.error('ERROR: reloadSourceOnError - The option getSource must be a function!')
        }
        function u() {
            t.off('loadedmetadata', a), t.off('error', o), t.off('dispose', u)
        }
        t.ready(function () {
            t.trigger({ type: 'usage', name: 'vhs-error-reload-initialized' }), t.trigger({ type: 'usage', name: 'hls-error-reload-initialized' })
        }),
            t.on('error', o),
            t.on('dispose', u),
            (t.reloadSourceOnError = function (e) {
                u(), Yl(t, e)
            })
    }
    var Ql,
        $l = ['video', 'audio'],
        Jl = function (n, r, a) {
            return function (t, i) {
                var e = i[t + 'Buffer']
                if (jl(i.mediaSource, e)) {
                    i.logger_('Appending segment ' + r.mediaIndex + "'s " + n.length + ' bytes to ' + t + 'Buffer')
                    try {
                        e.appendBuffer(n)
                    } catch (e) {
                        i.logger_('Error with code ' + e.code + ' ' + (22 === e.code ? '(QUOTA_EXCEEDED_ERR) ' : '') + 'when appending segment ' + r.mediaIndex + ' to ' + t + 'Buffer'),
                            (i.queuePending[t] = null),
                            a(e)
                    }
                }
            }
        },
        Zl = function (n, r) {
            return function (t, i) {
                var e = i[t + 'Buffer']
                if (jl(i.mediaSource, e)) {
                    i.logger_('Removing ' + n + ' to ' + r + ' from ' + t + 'Buffer')
                    try {
                        e.remove(n, r)
                    } catch (e) {
                        i.logger_('Remove ' + n + ' to ' + r + ' from ' + t + 'Buffer failed')
                    }
                }
            }
        },
        ec = function (n) {
            return function (e, t) {
                var i = t[e + 'Buffer']
                jl(t.mediaSource, i) && (t.logger_('Setting ' + e + 'timestampOffset to ' + n), (i.timestampOffset = n))
            }
        },
        tc = function (i) {
            return function (e, t) {
                i()
            }
        },
        ic = function (t) {
            return function (e) {
                if ('open' === e.mediaSource.readyState) {
                    e.logger_('Calling mediaSource endOfStream(' + (t || '') + ')')
                    try {
                        e.mediaSource.endOfStream(t)
                    } catch (e) {
                        tr.log.warn('Failed to call media source endOfStream', e)
                    }
                }
            }
        },
        nc = function (t) {
            return function (e) {
                e.logger_('Setting mediaSource duration to ' + t)
                try {
                    e.mediaSource.duration = t
                } catch (e) {
                    tr.log.warn('Failed to set media source duration', e)
                }
            }
        },
        rc = function () {
            return function (t, e) {
                if ('open' === e.mediaSource.readyState) {
                    var i = e[t + 'Buffer']
                    if (jl(e.mediaSource, i)) {
                        e.logger_('calling abort on ' + t + 'Buffer')
                        try {
                            i.abort()
                        } catch (e) {
                            tr.log.warn('Failed to abort on ' + t + 'Buffer', e)
                        }
                    }
                }
            }
        },
        ac = function (n, r) {
            return function (e) {
                var t = Nl(n),
                    i = mr(r)
                e.logger_('Adding ' + n + 'Buffer with codec ' + r + ' to mediaSource')
                i = e.mediaSource.addSourceBuffer(i)
                i.addEventListener('updateend', e['on' + t + 'UpdateEnd_']), i.addEventListener('error', e['on' + t + 'Error_']), (e.codecs[n] = r), (e[n + 'Buffer'] = i)
            }
        },
        sc = function (i) {
            return function (e) {
                var t = e[i + 'Buffer']
                if ((Fl(i, e), jl(e.mediaSource, t))) {
                    e.logger_('Removing ' + i + 'Buffer with codec ' + e.codecs[i] + ' from mediaSource')
                    try {
                        e.mediaSource.removeSourceBuffer(t)
                    } catch (e) {
                        tr.log.warn('Failed to removeSourceBuffer ' + i + 'Buffer', e)
                    }
                }
            }
        },
        oc = function (r) {
            return function (e, t) {
                var i = t[e + 'Buffer'],
                    n = mr(r)
                jl(t.mediaSource, i) && t.codecs[e] !== r && (t.logger_('changing ' + e + 'Buffer codec from ' + t.codecs[e] + ' to ' + r), i.changeType(n), (t.codecs[e] = r))
            }
        },
        uc = (function (i) {
            function e(e) {
                var t = i.call(this) || this
                return (
                    (t.mediaSource = e),
                    (t.sourceopenListener_ = function () {
                        return Bl('mediaSource', ft(t))
                    }),
                    t.mediaSource.addEventListener('sourceopen', t.sourceopenListener_),
                    (t.logger_ = Ro('SourceUpdater')),
                    (t.audioTimestampOffset_ = 0),
                    (t.videoTimestampOffset_ = 0),
                    (t.queue = []),
                    (t.queuePending = { audio: null, video: null }),
                    (t.delayedAudioAppendQueue_ = []),
                    (t.videoAppendQueued_ = !1),
                    (t.codecs = {}),
                    (t.onVideoUpdateEnd_ = ql('video', ft(t))),
                    (t.onAudioUpdateEnd_ = ql('audio', ft(t))),
                    (t.onVideoError_ = function (e) {
                        t.videoError_ = e
                    }),
                    (t.onAudioError_ = function (e) {
                        t.audioError_ = e
                    }),
                    (t.createdSourceBuffers_ = !1),
                    (t.initializedEme_ = !1),
                    (t.triggeredReady_ = !1),
                    t
                )
            }
            mt(e, i)
            var t = e.prototype
            return (
                (t.initializedEme = function () {
                    ;(this.initializedEme_ = !0), this.triggerReady()
                }),
                (t.hasCreatedSourceBuffers = function () {
                    return this.createdSourceBuffers_
                }),
                (t.hasInitializedAnyEme = function () {
                    return this.initializedEme_
                }),
                (t.ready = function () {
                    return this.hasCreatedSourceBuffers() && this.hasInitializedAnyEme()
                }),
                (t.createSourceBuffers = function (e) {
                    this.hasCreatedSourceBuffers() || (this.addOrChangeSourceBuffers(e), (this.createdSourceBuffers_ = !0), this.trigger('createdsourcebuffers'), this.triggerReady())
                }),
                (t.triggerReady = function () {
                    this.ready() && !this.triggeredReady_ && ((this.triggeredReady_ = !0), this.trigger('ready'))
                }),
                (t.addSourceBuffer = function (e, t) {
                    Hl({ type: 'mediaSource', sourceUpdater: this, action: ac(e, t), name: 'addSourceBuffer' })
                }),
                (t.abort = function (e) {
                    Hl({ type: e, sourceUpdater: this, action: rc(e), name: 'abort' })
                }),
                (t.removeSourceBuffer = function (e) {
                    this.canRemoveSourceBuffer() ? Hl({ type: 'mediaSource', sourceUpdater: this, action: sc(e), name: 'removeSourceBuffer' }) : tr.log.error('removeSourceBuffer is not supported!')
                }),
                (t.canRemoveSourceBuffer = function () {
                    return (
                        !tr.browser.IE_VERSION && !tr.browser.IS_FIREFOX && window.MediaSource && window.MediaSource.prototype && 'function' == typeof window.MediaSource.prototype.removeSourceBuffer
                    )
                }),
                (e.canChangeType = function () {
                    return window.SourceBuffer && window.SourceBuffer.prototype && 'function' == typeof window.SourceBuffer.prototype.changeType
                }),
                (t.canChangeType = function () {
                    return this.constructor.canChangeType()
                }),
                (t.changeType = function (e, t) {
                    this.canChangeType() ? Hl({ type: e, sourceUpdater: this, action: oc(t), name: 'changeType' }) : tr.log.error('changeType is not supported!')
                }),
                (t.addOrChangeSourceBuffers = function (i) {
                    var n = this
                    if (!i || 'object' != typeof i || 0 === Object.keys(i).length) throw new Error('Cannot addOrChangeSourceBuffers to undefined codecs')
                    Object.keys(i).forEach(function (e) {
                        var t = i[e]
                        if (!n.hasCreatedSourceBuffers()) return n.addSourceBuffer(e, t)
                        n.canChangeType() && n.changeType(e, t)
                    })
                }),
                (t.appendBuffer = function (e, t) {
                    var i = this,
                        n = e.segmentInfo,
                        r = e.type,
                        a = e.bytes
                    if (((this.processedAppend_ = !0), 'audio' === r && this.videoBuffer && !this.videoAppendQueued_))
                        return this.delayedAudioAppendQueue_.push([e, t]), void this.logger_('delayed audio append of ' + a.length + ' until video append')
                    Hl({ type: r, sourceUpdater: this, action: Jl(a, n || { mediaIndex: -1 }, t), doneFn: t, name: 'appendBuffer' }),
                        'video' === r &&
                            ((this.videoAppendQueued_ = !0),
                            this.delayedAudioAppendQueue_.length &&
                                ((r = this.delayedAudioAppendQueue_.slice()),
                                this.logger_('queuing delayed audio ' + r.length + ' appendBuffers'),
                                (this.delayedAudioAppendQueue_.length = 0),
                                r.forEach(function (e) {
                                    i.appendBuffer.apply(i, e)
                                })))
                }),
                (t.audioBuffered = function () {
                    return (jl(this.mediaSource, this.audioBuffer) && this.audioBuffer.buffered) || tr.createTimeRange()
                }),
                (t.videoBuffered = function () {
                    return (jl(this.mediaSource, this.videoBuffer) && this.videoBuffer.buffered) || tr.createTimeRange()
                }),
                (t.buffered = function () {
                    var e = jl(this.mediaSource, this.videoBuffer) ? this.videoBuffer : null,
                        t = jl(this.mediaSource, this.audioBuffer) ? this.audioBuffer : null
                    return t && !e
                        ? this.audioBuffered()
                        : e && !t
                        ? this.videoBuffered()
                        : (function (e, t) {
                              var i = null,
                                  n = null,
                                  r = 0,
                                  a = [],
                                  s = []
                              if (!(e && e.length && t && t.length)) return tr.createTimeRange()
                              for (var o = e.length; o--; ) a.push({ time: e.start(o), type: 'start' }), a.push({ time: e.end(o), type: 'end' })
                              for (o = t.length; o--; ) a.push({ time: t.start(o), type: 'start' }), a.push({ time: t.end(o), type: 'end' })
                              for (
                                  a.sort(function (e, t) {
                                      return e.time - t.time
                                  }),
                                      o = 0;
                                  o < a.length;
                                  o++
                              )
                                  'start' === a[o].type ? 2 === ++r && (i = a[o].time) : 'end' === a[o].type && 1 === --r && (n = a[o].time),
                                      null !== i && null !== n && (s.push([i, n]), (n = i = null))
                              return tr.createTimeRanges(s)
                          })(this.audioBuffered(), this.videoBuffered())
                }),
                (t.setDuration = function (e, t) {
                    void 0 === t && (t = Rl), Hl({ type: 'mediaSource', sourceUpdater: this, action: nc(e), name: 'duration', doneFn: t })
                }),
                (t.endOfStream = function (e, t) {
                    void 0 === t && (t = Rl),
                        Hl({ type: 'mediaSource', sourceUpdater: this, action: ic((e = 'string' != typeof (e = void 0 === e ? null : e) ? void 0 : e)), name: 'endOfStream', doneFn: t })
                }),
                (t.removeAudio = function (e, t, i) {
                    void 0 === i && (i = Rl),
                        this.audioBuffered().length && 0 !== this.audioBuffered().end(0) ? Hl({ type: 'audio', sourceUpdater: this, action: Zl(e, t), doneFn: i, name: 'remove' }) : i()
                }),
                (t.removeVideo = function (e, t, i) {
                    void 0 === i && (i = Rl),
                        this.videoBuffered().length && 0 !== this.videoBuffered().end(0) ? Hl({ type: 'video', sourceUpdater: this, action: Zl(e, t), doneFn: i, name: 'remove' }) : i()
                }),
                (t.updating = function () {
                    return !(!Ul('audio', this) && !Ul('video', this))
                }),
                (t.audioTimestampOffset = function (e) {
                    return (
                        'undefined' != typeof e &&
                            this.audioBuffer &&
                            this.audioTimestampOffset_ !== e &&
                            (Hl({ type: 'audio', sourceUpdater: this, action: ec(e), name: 'timestampOffset' }), (this.audioTimestampOffset_ = e)),
                        this.audioTimestampOffset_
                    )
                }),
                (t.videoTimestampOffset = function (e) {
                    return (
                        'undefined' != typeof e &&
                            this.videoBuffer &&
                            this.videoTimestampOffset !== e &&
                            (Hl({ type: 'video', sourceUpdater: this, action: ec(e), name: 'timestampOffset' }), (this.videoTimestampOffset_ = e)),
                        this.videoTimestampOffset_
                    )
                }),
                (t.audioQueueCallback = function (e) {
                    this.audioBuffer && Hl({ type: 'audio', sourceUpdater: this, action: tc(e), name: 'callback' })
                }),
                (t.videoQueueCallback = function (e) {
                    this.videoBuffer && Hl({ type: 'video', sourceUpdater: this, action: tc(e), name: 'callback' })
                }),
                (t.dispose = function () {
                    var t = this
                    this.trigger('dispose'),
                        $l.forEach(function (e) {
                            t.abort(e),
                                t.canRemoveSourceBuffer()
                                    ? t.removeSourceBuffer(e)
                                    : t[e + 'QueueCallback'](function () {
                                          return Fl(e, t)
                                      })
                        }),
                        (this.videoAppendQueued_ = !1),
                        (this.delayedAudioAppendQueue_.length = 0),
                        this.sourceopenListener_ && this.mediaSource.removeEventListener('sourceopen', this.sourceopenListener_),
                        this.off()
                }),
                e
            )
        })(tr.EventTarget),
        lc = new Uint8Array(
            '\n\n'.split('').map(function (e) {
                return e.charCodeAt(0)
            })
        ),
        cc = (function (i) {
            function e(e, t) {
                return (
                    ((t = i.call(this, e, (t = void 0 === t ? {} : t)) || this).mediaSource_ = null),
                    (t.subtitlesTrack_ = null),
                    (t.loaderType_ = 'subtitle'),
                    (t.featuresNativeTextTracks_ = e.featuresNativeTextTracks),
                    (t.shouldSaveSegmentTimingInfo_ = !1),
                    t
                )
            }
            mt(e, i)
            var t = e.prototype
            return (
                (t.createTransmuxer_ = function () {
                    return null
                }),
                (t.buffered_ = function () {
                    if (!this.subtitlesTrack_ || !this.subtitlesTrack_.cues || !this.subtitlesTrack_.cues.length) return tr.createTimeRanges()
                    var e = this.subtitlesTrack_.cues,
                        t = e[0].startTime,
                        e = e[e.length - 1].startTime
                    return tr.createTimeRanges([[t, e]])
                }),
                (t.initSegmentForMap = function (e, t) {
                    if ((void 0 === t && (t = !1), !e)) return null
                    var i = Su(e),
                        n = this.initSegments_[i]
                    return (
                        t &&
                            !n &&
                            e.bytes &&
                            ((t = lc.byteLength + e.bytes.byteLength),
                            (t = new Uint8Array(t)).set(e.bytes),
                            t.set(lc, e.bytes.byteLength),
                            (this.initSegments_[i] = n = { resolvedUri: e.resolvedUri, byterange: e.byterange, bytes: t })),
                        n || e
                    )
                }),
                (t.couldBeginLoading_ = function () {
                    return this.playlist_ && this.subtitlesTrack_ && !this.paused()
                }),
                (t.init_ = function () {
                    return (this.state = 'READY'), this.resetEverything(), this.monitorBuffer_()
                }),
                (t.track = function (e) {
                    return 'undefined' == typeof e || ((this.subtitlesTrack_ = e), 'INIT' === this.state && this.couldBeginLoading_() && this.init_()), this.subtitlesTrack_
                }),
                (t.remove = function (e, t) {
                    rl(e, t, this.subtitlesTrack_)
                }),
                (t.fillBuffer_ = function () {
                    var e = this,
                        t = this.chooseNextRequest_()
                    if (t) {
                        if (null === this.syncController_.timestampOffsetForTimeline(t.timeline))
                            return (
                                this.syncController_.one('timestampoffset', function () {
                                    ;(e.state = 'READY'), e.paused() || e.monitorBuffer_()
                                }),
                                void (this.state = 'WAITING_ON_TIMELINE')
                            )
                        this.loadSegment_(t)
                    }
                }),
                (t.timestampOffsetForSegment_ = function () {
                    return null
                }),
                (t.chooseNextRequest_ = function () {
                    return this.skipEmptySegments_(i.prototype.chooseNextRequest_.call(this))
                }),
                (t.skipEmptySegments_ = function (e) {
                    for (; e && e.segment.empty; ) {
                        if (e.mediaIndex + 1 >= e.playlist.segments.length) {
                            e = null
                            break
                        }
                        e = this.generateSegmentInfo_({ playlist: e.playlist, mediaIndex: e.mediaIndex + 1, startOfSegment: e.startOfSegment + e.duration, isSyncRequest: e.isSyncRequest })
                    }
                    return e
                }),
                (t.stopForError = function (e) {
                    this.error(e), (this.state = 'READY'), this.pause(), this.trigger('error')
                }),
                (t.segmentRequestFinished_ = function (e, t, i) {
                    var n = this
                    if (this.subtitlesTrack_) {
                        if ((this.saveTransferStats_(t.stats), !this.pendingSegment_)) return (this.state = 'READY'), void (this.mediaRequestsAborted += 1)
                        if (e) return e.code === Pl && this.handleTimeout_(), e.code === Ll ? (this.mediaRequestsAborted += 1) : (this.mediaRequestsErrored += 1), void this.stopForError(e)
                        var r = this.pendingSegment_
                        this.saveBandwidthRelatedStats_(r.duration, t.stats), (this.state = 'APPENDING'), this.trigger('appending')
                        var a = r.segment
                        if ((a.map && (a.map.bytes = t.map.bytes), (r.bytes = t.bytes), 'function' != typeof window.WebVTT && this.subtitlesTrack_ && this.subtitlesTrack_.tech_)) {
                            var s = function () {
                                    n.subtitlesTrack_.tech_.off('vttjsloaded', o), n.stopForError({ message: 'Error loading vtt.js' })
                                },
                                o = function () {
                                    n.subtitlesTrack_.tech_.off('vttjserror', s), n.segmentRequestFinished_(e, t, i)
                                }
                            return (this.state = 'WAITING_ON_VTTJS'), this.subtitlesTrack_.tech_.one('vttjsloaded', o), void this.subtitlesTrack_.tech_.one('vttjserror', s)
                        }
                        a.requested = !0
                        try {
                            this.parseVTTCues_(r)
                        } catch (e) {
                            return void this.stopForError({ message: e.message })
                        }
                        if (
                            (this.updateTimeMapping_(r, this.syncController_.timelines[r.timeline], this.playlist_),
                            r.cues.length
                                ? (r.timingInfo = { start: r.cues[0].startTime, end: r.cues[r.cues.length - 1].endTime })
                                : (r.timingInfo = { start: r.startOfSegment, end: r.startOfSegment + r.duration }),
                            r.isSyncRequest)
                        )
                            return this.trigger('syncinfoupdate'), (this.pendingSegment_ = null), void (this.state = 'READY')
                        ;(r.byteLength = r.bytes.byteLength),
                            (this.mediaSecondsLoaded += a.duration),
                            r.cues.forEach(function (e) {
                                n.subtitlesTrack_.addCue(n.featuresNativeTextTracks_ ? new window.VTTCue(e.startTime, e.endTime, e.text) : e)
                            }),
                            (function (t) {
                                var e = t.cues
                                if (e)
                                    for (var i = 0; i < e.length; i++) {
                                        for (var n = [], r = 0, a = 0; a < e.length; a++)
                                            e[i].startTime === e[a].startTime && e[i].endTime === e[a].endTime && e[i].text === e[a].text && 1 < ++r && n.push(e[a])
                                        n.length &&
                                            n.forEach(function (e) {
                                                return t.removeCue(e)
                                            })
                                    }
                            })(this.subtitlesTrack_),
                            this.handleAppendsDone_()
                    } else this.state = 'READY'
                }),
                (t.handleData_ = function () {}),
                (t.updateTimingInfoEnd_ = function () {}),
                (t.parseVTTCues_ = function (t) {
                    var e = !1
                    'function' == typeof window.TextDecoder ? (i = new window.TextDecoder('utf8')) : ((i = window.WebVTT.StringDecoder()), (e = !0))
                    var i = new window.WebVTT.Parser(window, window.vttjs, i)
                    ;(t.cues = []),
                        (t.timestampmap = { MPEGTS: 0, LOCAL: 0 }),
                        (i.oncue = t.cues.push.bind(t.cues)),
                        (i.ontimestampmap = function (e) {
                            t.timestampmap = e
                        }),
                        (i.onparsingerror = function (e) {
                            tr.log.warn('Error encountered when parsing cues: ' + e.message)
                        }),
                        t.segment.map && ((n = t.segment.map.bytes), e && (n = Vl(n)), i.parse(n))
                    var n = t.bytes
                    e && (n = Vl(n)), i.parse(n), i.flush()
                }),
                (t.updateTimeMapping_ = function (e, t, i) {
                    var n,
                        r,
                        a = e.segment
                    t &&
                        (e.cues.length
                            ? ((r = e.timestampmap),
                              (n = r.MPEGTS / hl - r.LOCAL + t.mapping),
                              e.cues.forEach(function (e) {
                                  ;(e.startTime += n), (e.endTime += n)
                              }),
                              i.syncInfo ||
                                  ((r = e.cues[0].startTime),
                                  (t = e.cues[e.cues.length - 1].startTime),
                                  (i.syncInfo = { mediaSequence: i.mediaSequence + e.mediaIndex, time: Math.min(r, t - a.duration) })))
                            : (a.empty = !0))
                }),
                e
            )
        })(Ml),
        dc = [
            {
                name: 'VOD',
                run: function (e, t, i, n, r) {
                    if (i === 1 / 0) return null
                    return { time: 0, segmentIndex: 0, partIndex: null }
                },
            },
            {
                name: 'ProgramDateTime',
                run: function (e, t, i, n, r) {
                    if (!Object.keys(e.timelineToDatetimeMappings).length) return null
                    var a = null,
                        s = null,
                        o = Wo(t)
                    r = r || 0
                    for (var u = 0; u < o.length; u++) {
                        var l = o[t.endList || 0 === r ? u : o.length - (u + 1)],
                            c = l.segment,
                            d = e.timelineToDatetimeMappings[c.timeline]
                        if (d && c.dateTimeObject) {
                            var h = c.dateTimeObject.getTime() / 1e3 + d
                            if (c.parts && 'number' == typeof l.partIndex) for (var p = 0; p < l.partIndex; p++) h += c.parts[p].duration
                            d = Math.abs(r - h)
                            if (null !== s && (0 === d || s < d)) break
                            ;(s = d), (a = { time: h, segmentIndex: l.segmentIndex, partIndex: l.partIndex })
                        }
                    }
                    return a
                },
            },
            {
                name: 'Segment',
                run: function (e, t, i, n, r) {
                    var a = null,
                        s = null
                    r = r || 0
                    for (var o = Wo(t), u = 0; u < o.length; u++) {
                        var l = o[t.endList || 0 === r ? u : o.length - (u + 1)],
                            c = l.segment,
                            d = (l.part && l.part.start) || (c && c.start)
                        if (c.timeline === n && 'undefined' != typeof d) {
                            c = Math.abs(r - d)
                            if (null !== s && s < c) break
                            ;(!a || null === s || c <= s) && ((s = c), (a = { time: d, segmentIndex: l.segmentIndex, partIndex: l.partIndex }))
                        }
                    }
                    return a
                },
            },
            {
                name: 'Discontinuity',
                run: function (e, t, i, n, r) {
                    var a = null
                    if (((r = r || 0), t.discontinuityStarts && t.discontinuityStarts.length))
                        for (var s = null, o = 0; o < t.discontinuityStarts.length; o++) {
                            var u = t.discontinuityStarts[o],
                                l = t.discontinuitySequence + o + 1,
                                c = e.discontinuities[l]
                            if (c) {
                                l = Math.abs(r - c.time)
                                if (null !== s && s < l) break
                                ;(!a || null === s || l <= s) && ((s = l), (a = { time: c.time, segmentIndex: u, partIndex: null }))
                            }
                        }
                    return a
                },
            },
            {
                name: 'Playlist',
                run: function (e, t, i, n, r) {
                    return t.syncInfo ? { time: t.syncInfo.time, segmentIndex: t.syncInfo.mediaSequence - t.mediaSequence, partIndex: null } : null
                },
            },
        ],
        hc = (function (i) {
            function e(e) {
                var t = i.call(this) || this
                return (t.timelines = []), (t.discontinuities = []), (t.timelineToDatetimeMappings = {}), (t.logger_ = Ro('SyncController')), t
            }
            mt(e, i)
            var t = e.prototype
            return (
                (t.getSyncPoint = function (e, t, i, n) {
                    i = this.runStrategies_(e, t, i, n)
                    return i.length ? this.selectSyncPoint_(i, { key: 'time', value: n }) : null
                }),
                (t.getExpiredTime = function (e, t) {
                    if (!e || !e.segments) return null
                    t = this.runStrategies_(e, t, e.discontinuitySequence, 0)
                    if (!t.length) return null
                    t = this.selectSyncPoint_(t, { key: 'segmentIndex', value: 0 })
                    return 0 < t.segmentIndex && (t.time *= -1), Math.abs(t.time + Qo({ defaultDuration: e.targetDuration, durationList: e.segments, startIndex: t.segmentIndex, endIndex: 0 }))
                }),
                (t.runStrategies_ = function (e, t, i, n) {
                    for (var r = [], a = 0; a < dc.length; a++) {
                        var s = dc[a],
                            o = s.run(this, e, t, i, n)
                        o && ((o.strategy = s.name), r.push({ strategy: s.name, syncPoint: o }))
                    }
                    return r
                }),
                (t.selectSyncPoint_ = function (e, t) {
                    for (var i = e[0].syncPoint, n = Math.abs(e[0].syncPoint[t.key] - t.value), r = e[0].strategy, a = 1; a < e.length; a++) {
                        var s = Math.abs(e[a].syncPoint[t.key] - t.value)
                        s < n && ((n = s), (i = e[a].syncPoint), (r = e[a].strategy))
                    }
                    return (
                        this.logger_(
                            'syncPoint for [' +
                                t.key +
                                ': ' +
                                t.value +
                                '] chosen with strategy [' +
                                r +
                                ']: [time:' +
                                i.time +
                                ', segmentIndex:' +
                                i.segmentIndex +
                                ('number' == typeof i.partIndex ? ',partIndex:' + i.partIndex : '') +
                                ']'
                        ),
                        i
                    )
                }),
                (t.saveExpiredSegmentInfo = function (e, t) {
                    var i = t.mediaSequence - e.mediaSequence
                    if (86400 < i) tr.log.warn('Not saving expired segment info. Media sequence gap ' + i + ' is too large.')
                    else
                        for (var n = i - 1; 0 <= n; n--) {
                            var r = e.segments[n]
                            if (r && 'undefined' != typeof r.start) {
                                ;(t.syncInfo = { mediaSequence: e.mediaSequence + n, time: r.start }),
                                    this.logger_('playlist refresh sync: [time:' + t.syncInfo.time + ', mediaSequence: ' + t.syncInfo.mediaSequence + ']'),
                                    this.trigger('syncinfoupdate')
                                break
                            }
                        }
                }),
                (t.setDateTimeMappingForStart = function (e) {
                    var t
                    ;(this.timelineToDatetimeMappings = {}),
                        e.segments &&
                            e.segments.length &&
                            e.segments[0].dateTimeObject &&
                            ((e = (t = e.segments[0]).dateTimeObject.getTime() / 1e3), (this.timelineToDatetimeMappings[t.timeline] = -e))
                }),
                (t.saveSegmentTimingInfo = function (e) {
                    var t = e.segmentInfo,
                        i = e.shouldSaveTimelineMapping,
                        n = this.calculateSegmentTimeMapping_(t, t.timingInfo, i),
                        e = t.segment
                    n && (this.saveDiscontinuitySyncInfo_(t), t.playlist.syncInfo || (t.playlist.syncInfo = { mediaSequence: t.playlist.mediaSequence + t.mediaIndex, time: e.start }))
                    t = e.dateTimeObject
                    e.discontinuity && i && t && (this.timelineToDatetimeMappings[e.timeline] = -t.getTime() / 1e3)
                }),
                (t.timestampOffsetForTimeline = function (e) {
                    return 'undefined' == typeof this.timelines[e] ? null : this.timelines[e].time
                }),
                (t.mappingForTimeline = function (e) {
                    return 'undefined' == typeof this.timelines[e] ? null : this.timelines[e].mapping
                }),
                (t.calculateSegmentTimeMapping_ = function (e, t, i) {
                    var n,
                        r,
                        a = e.segment,
                        s = e.part,
                        o = this.timelines[e.timeline]
                    if ('number' == typeof e.timestampOffset)
                        (o = { time: e.startOfSegment, mapping: e.startOfSegment - t.start }),
                            i &&
                                ((this.timelines[e.timeline] = o),
                                this.trigger('timestampoffset'),
                                this.logger_('time mapping for timeline ' + e.timeline + ': [time: ' + o.time + '] [mapping: ' + o.mapping + ']')),
                            (n = e.startOfSegment),
                            (r = t.end + o.mapping)
                    else {
                        if (!o) return !1
                        ;(n = t.start + o.mapping), (r = t.end + o.mapping)
                    }
                    return s && ((s.start = n), (s.end = r)), (!a.start || n < a.start) && (a.start = n), (a.end = r), !0
                }),
                (t.saveDiscontinuitySyncInfo_ = function (e) {
                    var t = e.playlist,
                        i = e.segment
                    if (i.discontinuity) this.discontinuities[i.timeline] = { time: i.start, accuracy: 0 }
                    else if (t.discontinuityStarts && t.discontinuityStarts.length)
                        for (var n = 0; n < t.discontinuityStarts.length; n++) {
                            var r,
                                a = t.discontinuityStarts[n],
                                s = t.discontinuitySequence + n + 1,
                                o = a - e.mediaIndex,
                                u = Math.abs(o)
                            ;(!this.discontinuities[s] || this.discontinuities[s].accuracy > u) &&
                                ((r = void 0),
                                (r =
                                    o < 0
                                        ? i.start - Qo({ defaultDuration: t.targetDuration, durationList: t.segments, startIndex: e.mediaIndex, endIndex: a })
                                        : i.end + Qo({ defaultDuration: t.targetDuration, durationList: t.segments, startIndex: e.mediaIndex + 1, endIndex: a })),
                                (this.discontinuities[s] = { time: r, accuracy: u }))
                        }
                }),
                (t.dispose = function () {
                    this.trigger('dispose'), this.off()
                }),
                e
            )
        })(tr.EventTarget),
        pc = (function (t) {
            function e() {
                var e = t.call(this) || this
                return (e.pendingTimelineChanges_ = {}), (e.lastTimelineChanges_ = {}), e
            }
            mt(e, t)
            var i = e.prototype
            return (
                (i.clearPendingTimelineChange = function (e) {
                    ;(this.pendingTimelineChanges_[e] = null), this.trigger('pendingtimelinechange')
                }),
                (i.pendingTimelineChange = function (e) {
                    var t = e.type,
                        i = e.from,
                        e = e.to
                    return (
                        'number' == typeof i && 'number' == typeof e && ((this.pendingTimelineChanges_[t] = { type: t, from: i, to: e }), this.trigger('pendingtimelinechange')),
                        this.pendingTimelineChanges_[t]
                    )
                }),
                (i.lastTimelineChange = function (e) {
                    var t = e.type,
                        i = e.from,
                        e = e.to
                    return (
                        'number' == typeof i &&
                            'number' == typeof e &&
                            ((this.lastTimelineChanges_[t] = { type: t, from: i, to: e }), delete this.pendingTimelineChanges_[t], this.trigger('timelinechange')),
                        this.lastTimelineChanges_[t]
                    )
                }),
                (i.dispose = function () {
                    this.trigger('dispose'), (this.pendingTimelineChanges_ = {}), (this.lastTimelineChanges_ = {}), this.off()
                }),
                e
            )
        })(tr.EventTarget),
        fc = x(
            U(
                W(function () {
                    var e = 'undefined' != typeof globalThis ? globalThis : 'undefined' != typeof window ? window : 'undefined' != typeof global ? global : 'undefined' != typeof self ? self : {}
                    function t(e, t, i) {
                        return (
                            e(
                                (i = {
                                    path: t,
                                    exports: {},
                                    require: function (e, t) {
                                        return (function () {
                                            throw new Error('Dynamic requires are not currently supported by @rollup/plugin-commonjs')
                                        })(null == t && i.path)
                                    },
                                }),
                                i.exports
                            ),
                            i.exports
                        )
                    }
                    var i = t(function (e) {
                            function n(e, t) {
                                for (var i = 0; i < t.length; i++) {
                                    var n = t[i]
                                    ;(n.enumerable = n.enumerable || !1), (n.configurable = !0), 'value' in n && (n.writable = !0), Object.defineProperty(e, n.key, n)
                                }
                            }
                            ;(e.exports = function (e, t, i) {
                                return t && n(e.prototype, t), i && n(e, i), e
                            }),
                                (e.exports.default = e.exports),
                                (e.exports.__esModule = !0)
                        }),
                        n = t(function (i) {
                            function n(e, t) {
                                return (
                                    (i.exports = n =
                                        Object.setPrototypeOf ||
                                        function (e, t) {
                                            return (e.__proto__ = t), e
                                        }),
                                    (i.exports.default = i.exports),
                                    (i.exports.__esModule = !0),
                                    n(e, t)
                                )
                            }
                            ;(i.exports = n), (i.exports.default = i.exports), (i.exports.__esModule = !0)
                        }),
                        r = t(function (e) {
                            ;(e.exports = function (e, t) {
                                ;(e.prototype = Object.create(t.prototype)), (e.prototype.constructor = e), n(e, t)
                            }),
                                (e.exports.default = e.exports),
                                (e.exports.__esModule = !0)
                        }),
                        a = (function () {
                            function e() {
                                this.listeners = {}
                            }
                            var t = e.prototype
                            return (
                                (t.on = function (e, t) {
                                    this.listeners[e] || (this.listeners[e] = []), this.listeners[e].push(t)
                                }),
                                (t.off = function (e, t) {
                                    if (!this.listeners[e]) return !1
                                    t = this.listeners[e].indexOf(t)
                                    return (this.listeners[e] = this.listeners[e].slice(0)), this.listeners[e].splice(t, 1), -1 < t
                                }),
                                (t.trigger = function (e) {
                                    var t = this.listeners[e]
                                    if (t)
                                        if (2 === arguments.length) for (var i = t.length, n = 0; n < i; ++n) t[n].call(this, arguments[1])
                                        else for (var r = Array.prototype.slice.call(arguments, 1), a = t.length, s = 0; s < a; ++s) t[s].apply(this, r)
                                }),
                                (t.dispose = function () {
                                    this.listeners = {}
                                }),
                                (t.pipe = function (t) {
                                    this.on('data', function (e) {
                                        t.push(e)
                                    })
                                }),
                                e
                            )
                        })()
                    /*! @name aes-decrypter @version 3.1.3 @license Apache-2.0 */
                    var c = null,
                        m = (function () {
                            function e(e) {
                                var t, i, n
                                ;(c =
                                    c ||
                                    (function () {
                                        for (
                                            var e,
                                                t,
                                                i,
                                                n,
                                                r,
                                                a,
                                                s,
                                                o = [
                                                    [[], [], [], [], []],
                                                    [[], [], [], [], []],
                                                ],
                                                u = o[0],
                                                l = o[1],
                                                c = u[4],
                                                d = l[4],
                                                h = [],
                                                p = [],
                                                f = 0;
                                            f < 256;
                                            f++
                                        )
                                            p[(h[f] = (f << 1) ^ (283 * (f >> 7))) ^ f] = f
                                        for (e = t = 0; !c[e]; e ^= i || 1, t = p[t] || 1)
                                            for (
                                                s =
                                                    (16843009 * h[(n = h[(i = h[(d[(c[e] = r = ((r = t ^ (t << 1) ^ (t << 2) ^ (t << 3) ^ (t << 4)) >> 8) ^ (255 & r) ^ 99)] = e)])])]) ^
                                                    (65537 * n) ^
                                                    (257 * i) ^
                                                    (16843008 * e),
                                                    a = (257 * h[r]) ^ (16843008 * r),
                                                    f = 0;
                                                f < 4;
                                                f++
                                            )
                                                (u[f][e] = a = (a << 24) ^ (a >>> 8)), (l[f][r] = s = (s << 24) ^ (s >>> 8))
                                        for (f = 0; f < 5; f++) (u[f] = u[f].slice(0)), (l[f] = l[f].slice(0))
                                        return o
                                    })()),
                                    (this._tables = [
                                        [c[0][0].slice(), c[0][1].slice(), c[0][2].slice(), c[0][3].slice(), c[0][4].slice()],
                                        [c[1][0].slice(), c[1][1].slice(), c[1][2].slice(), c[1][3].slice(), c[1][4].slice()],
                                    ])
                                var r = this._tables[0][4],
                                    a = this._tables[1],
                                    s = e.length,
                                    o = 1
                                if (4 !== s && 6 !== s && 8 !== s) throw new Error('Invalid aes key size')
                                var u = e.slice(0),
                                    l = []
                                for (this._key = [u, l], t = s; t < 4 * s + 28; t++)
                                    (n = u[t - 1]),
                                        (t % s == 0 || (8 === s && t % s == 4)) &&
                                            ((n = (r[n >>> 24] << 24) ^ (r[(n >> 16) & 255] << 16) ^ (r[(n >> 8) & 255] << 8) ^ r[255 & n]),
                                            t % s == 0 && ((n = (n << 8) ^ (n >>> 24) ^ (o << 24)), (o = (o << 1) ^ (283 * (o >> 7))))),
                                        (u[t] = u[t - s] ^ n)
                                for (i = 0; t; i++, t--)
                                    (n = u[3 & i ? t : t - 4]), (l[i] = t <= 4 || i < 4 ? n : a[0][r[n >>> 24]] ^ a[1][r[(n >> 16) & 255]] ^ a[2][r[(n >> 8) & 255]] ^ a[3][r[255 & n]])
                            }
                            return (
                                (e.prototype.decrypt = function (e, t, i, n, r, a) {
                                    for (
                                        var s,
                                            o,
                                            u,
                                            l = this._key[1],
                                            c = e ^ l[0],
                                            d = n ^ l[1],
                                            h = i ^ l[2],
                                            p = t ^ l[3],
                                            f = l.length / 4 - 2,
                                            m = 4,
                                            t = this._tables[1],
                                            g = t[0],
                                            y = t[1],
                                            v = t[2],
                                            _ = t[3],
                                            b = t[4],
                                            T = 0;
                                        T < f;
                                        T++
                                    )
                                        (s = g[c >>> 24] ^ y[(d >> 16) & 255] ^ v[(h >> 8) & 255] ^ _[255 & p] ^ l[m]),
                                            (o = g[d >>> 24] ^ y[(h >> 16) & 255] ^ v[(p >> 8) & 255] ^ _[255 & c] ^ l[m + 1]),
                                            (u = g[h >>> 24] ^ y[(p >> 16) & 255] ^ v[(c >> 8) & 255] ^ _[255 & d] ^ l[m + 2]),
                                            (p = g[p >>> 24] ^ y[(c >> 16) & 255] ^ v[(d >> 8) & 255] ^ _[255 & h] ^ l[m + 3]),
                                            (m += 4),
                                            (c = s),
                                            (d = o),
                                            (h = u)
                                    for (T = 0; T < 4; T++)
                                        (r[(3 & -T) + a] = (b[c >>> 24] << 24) ^ (b[(d >> 16) & 255] << 16) ^ (b[(h >> 8) & 255] << 8) ^ b[255 & p] ^ l[m++]),
                                            (s = c),
                                            (c = d),
                                            (d = h),
                                            (h = p),
                                            (p = s)
                                }),
                                e
                            )
                        })(),
                        l = (function (t) {
                            function e() {
                                var e = t.call(this, a) || this
                                return (e.jobs = []), (e.delay = 1), (e.timeout_ = null), e
                            }
                            r(e, t)
                            var i = e.prototype
                            return (
                                (i.processJob_ = function () {
                                    this.jobs.shift()(), this.jobs.length ? (this.timeout_ = setTimeout(this.processJob_.bind(this), this.delay)) : (this.timeout_ = null)
                                }),
                                (i.push = function (e) {
                                    this.jobs.push(e), this.timeout_ || (this.timeout_ = setTimeout(this.processJob_.bind(this), this.delay))
                                }),
                                e
                            )
                        })(a),
                        g = function (e) {
                            return (e << 24) | ((65280 & e) << 8) | ((16711680 & e) >> 8) | (e >>> 24)
                        },
                        s = (function () {
                            function u(e, t, i, n) {
                                var r = u.STEP,
                                    a = new Int32Array(e.buffer),
                                    s = new Uint8Array(e.byteLength),
                                    o = 0
                                for (this.asyncStream_ = new l(), this.asyncStream_.push(this.decryptChunk_(a.subarray(o, o + r), t, i, s)), o = r; o < a.length; o += r)
                                    (i = new Uint32Array([g(a[o - 4]), g(a[o - 3]), g(a[o - 2]), g(a[o - 1])])), this.asyncStream_.push(this.decryptChunk_(a.subarray(o, o + r), t, i, s))
                                this.asyncStream_.push(function () {
                                    /*! @name pkcs7 @version 1.0.4 @license Apache-2.0 */
                                    var e
                                    n(null, (e = s).subarray(0, e.byteLength - e[e.byteLength - 1]))
                                })
                            }
                            return (
                                (u.prototype.decryptChunk_ = function (t, i, n, r) {
                                    return function () {
                                        var e = (function (e, t, i) {
                                            for (
                                                var n,
                                                    r,
                                                    a,
                                                    s,
                                                    o = new Int32Array(e.buffer, e.byteOffset, e.byteLength >> 2),
                                                    u = new m(Array.prototype.slice.call(t)),
                                                    e = new Uint8Array(e.byteLength),
                                                    l = new Int32Array(e.buffer),
                                                    c = i[0],
                                                    d = i[1],
                                                    h = i[2],
                                                    p = i[3],
                                                    f = 0;
                                                f < o.length;
                                                f += 4
                                            )
                                                (n = g(o[f])),
                                                    (r = g(o[f + 1])),
                                                    (a = g(o[f + 2])),
                                                    (s = g(o[f + 3])),
                                                    u.decrypt(n, r, a, s, l, f),
                                                    (l[f] = g(l[f] ^ c)),
                                                    (l[f + 1] = g(l[f + 1] ^ d)),
                                                    (l[f + 2] = g(l[f + 2] ^ h)),
                                                    (l[f + 3] = g(l[f + 3] ^ p)),
                                                    (c = n),
                                                    (d = r),
                                                    (h = a),
                                                    (p = s)
                                            return e
                                        })(t, i, n)
                                        r.set(e, t.byteOffset)
                                    }
                                }),
                                i(u, null, [
                                    {
                                        key: 'STEP',
                                        get: function () {
                                            return 32e3
                                        },
                                    },
                                ]),
                                u
                            )
                        })(),
                        e = 'undefined' != typeof window ? window : 'undefined' != typeof e ? e : 'undefined' != typeof self ? self : {},
                        e = e.BigInt || Number
                    e('0x1'), e('0x100'), e('0x10000'), e('0x1000000'), e('0x100000000'), e('0x10000000000'), e('0x1000000000000'), e('0x100000000000000'), e('0x10000000000000000')
                    function o(n) {
                        var r = {}
                        return (
                            Object.keys(n).forEach(function (e) {
                                var t,
                                    i = n[e]
                                ;(t = i),
                                    ('function' === ArrayBuffer.isView ? ArrayBuffer.isView(t) : t && t.buffer instanceof ArrayBuffer)
                                        ? (r[e] = { bytes: i.buffer, byteOffset: i.byteOffset, byteLength: i.byteLength })
                                        : (r[e] = i)
                            }),
                            r
                        )
                    }
                    self.onmessage = function (e) {
                        var i = e.data,
                            t = new Uint8Array(i.encrypted.bytes, i.encrypted.byteOffset, i.encrypted.byteLength),
                            n = new Uint32Array(i.key.bytes, i.key.byteOffset, i.key.byteLength / 4),
                            e = new Uint32Array(i.iv.bytes, i.iv.byteOffset, i.iv.byteLength / 4)
                        new s(t, n, e, function (e, t) {
                            self.postMessage(o({ source: i.source, decrypted: t }), [t.buffer])
                        })
                    }
                })
            )
        ),
        mc = {
            AUDIO: function (s, o) {
                return function () {
                    var e = o.segmentLoaders[s],
                        t = o.mediaTypes[s],
                        i = o.blacklistCurrentPlaylist
                    Wl(e, t)
                    var n = t.activeTrack(),
                        e = t.activeGroup(),
                        e = (
                            e.filter(function (e) {
                                return e.default
                            })[0] || e[0]
                        ).id,
                        r = t.tracks[e]
                    if (n !== r) {
                        for (var a in (tr.log.warn('Problem encountered loading the alternate audio track.Switching back to default.'), t.tracks)) t.tracks[a].enabled = t.tracks[a] === r
                        t.onTrackChanged()
                    } else i({ message: 'Problem encountered loading the default audio track.' })
                }
            },
            SUBTITLES: function (i, n) {
                return function () {
                    var e = n.segmentLoaders[i],
                        t = n.mediaTypes[i]
                    tr.log.warn('Problem encountered loading the subtitle track.Disabling subtitle track.'), Wl(e, t)
                    e = t.activeTrack()
                    e && (e.mode = 'disabled'), t.onTrackChanged()
                }
            },
        },
        gc = {
            AUDIO: function (e, t, i) {
                var n, r, a
                t &&
                    ((n = i.tech),
                    (r = i.requestOptions),
                    (a = i.segmentLoaders[e]),
                    t.on('loadedmetadata', function () {
                        var e = t.media()
                        a.playlist(e, r), (!n.paused() || (e.endList && 'none' !== n.preload())) && a.load()
                    }),
                    t.on('loadedplaylist', function () {
                        a.playlist(t.media(), r), n.paused() || a.load()
                    }),
                    t.on('error', mc[e](e, i)))
            },
            SUBTITLES: function (e, t, i) {
                var n = i.tech,
                    r = i.requestOptions,
                    a = i.segmentLoaders[e],
                    s = i.mediaTypes[e]
                t.on('loadedmetadata', function () {
                    var e = t.media()
                    a.playlist(e, r), a.track(s.activeTrack()), (!n.paused() || (e.endList && 'none' !== n.preload())) && a.load()
                }),
                    t.on('loadedplaylist', function () {
                        a.playlist(t.media(), r), n.paused() || a.load()
                    }),
                    t.on('error', mc[e](e, i))
            },
        },
        yc = {
            AUDIO: function (e, t) {
                var i,
                    n,
                    r = t.vhs,
                    a = t.sourceType,
                    s = t.segmentLoaders[e],
                    o = t.requestOptions,
                    u = t.master.mediaGroups,
                    l = t.mediaTypes[e],
                    c = l.groups,
                    d = l.tracks,
                    h = l.logger_,
                    p = t.masterPlaylistLoader,
                    f = au(p.master)
                for (i in ((u[e] && 0 !== Object.keys(u[e]).length) || ((u[e] = { main: { default: { default: !0 } } }), f && (u[e].main.default.playlists = p.master.playlists)), u[e]))
                    for (var m in (c[i] || (c[i] = []), u[e][i])) {
                        var g = u[e][i][m],
                            y = void 0,
                            y = f
                                ? (h("AUDIO group '" + i + "' label '" + m + "' is a master playlist"), (g.isMasterPlaylist = !0), null)
                                : 'vhs-json' === a && g.playlists
                                ? new _l(g.playlists[0], r, o)
                                : g.resolvedUri
                                ? new _l(g.resolvedUri, r, o)
                                : g.playlists && 'dash' === a
                                ? new wl(g.playlists[0], r, o, p)
                                : null,
                            g = tr.mergeOptions({ id: m, playlistLoader: y }, g)
                        gc[e](e, g.playlistLoader, t),
                            c[i].push(g),
                            'undefined' == typeof d[m] &&
                                ((g = new tr.AudioTrack({
                                    id: m,
                                    kind:
                                        ((n = void 0),
                                        (n = (y = g).default ? 'main' : 'alternative'),
                                        (n = y.characteristics && 0 <= y.characteristics.indexOf('public.accessibility.describes-video') ? 'main-desc' : n)),
                                    enabled: !1,
                                    language: g.language,
                                    default: g.default,
                                    label: m,
                                })),
                                (d[m] = g))
                    }
                s.on('error', mc[e](e, t))
            },
            SUBTITLES: function (e, t) {
                var i,
                    n = t.tech,
                    r = t.vhs,
                    a = t.sourceType,
                    s = t.segmentLoaders[e],
                    o = t.requestOptions,
                    u = t.master.mediaGroups,
                    l = t.mediaTypes[e],
                    c = l.groups,
                    d = l.tracks,
                    h = t.masterPlaylistLoader
                for (i in u[e])
                    for (var p in (c[i] || (c[i] = []), u[e][i]))
                        if (!u[e][i][p].forced) {
                            var f = u[e][i][p],
                                m = void 0
                            if ('hls' === a) m = new _l(f.resolvedUri, r, o)
                            else if ('dash' === a) {
                                if (
                                    !f.playlists.filter(function (e) {
                                        return e.excludeUntil !== 1 / 0
                                    }).length
                                )
                                    return
                                m = new wl(f.playlists[0], r, o, h)
                            } else 'vhs-json' === a && (m = new _l(f.playlists ? f.playlists[0] : f.resolvedUri, r, o))
                            ;(f = tr.mergeOptions({ id: p, playlistLoader: m }, f)),
                                gc[e](e, f.playlistLoader, t),
                                c[i].push(f),
                                'undefined' == typeof d[p] &&
                                    ((f = n.addRemoteTextTrack({ id: p, kind: 'subtitles', default: f.default && f.autoselect, language: f.language, label: p }, !1).track), (d[p] = f))
                        }
                s.on('error', mc[e](e, t))
            },
            'CLOSED-CAPTIONS': function (e, t) {
                var i,
                    n = t.tech,
                    r = t.master.mediaGroups,
                    t = t.mediaTypes[e],
                    a = t.groups,
                    s = t.tracks
                for (i in r[e])
                    for (var o in (a[i] || (a[i] = []), r[e][i])) {
                        var u,
                            l,
                            c = r[e][i][o]
                        ;/^(?:CC|SERVICE)/.test(c.instreamId) &&
                            (void 0 ===
                                (l = (u = (n.options_.vhs && n.options_.vhs.captionServices) || {})[
                                    (l = { label: o, language: c.language, instreamId: c.instreamId, default: c.default && c.autoselect }).instreamId
                                ]
                                    ? tr.mergeOptions(l, u[l.instreamId])
                                    : l).default && delete l.default,
                            a[i].push(tr.mergeOptions({ id: o }, c)),
                            'undefined' == typeof s[o] &&
                                ((l = n.addRemoteTextTrack({ id: l.instreamId, kind: 'captions', default: l.default, language: l.language, label: l.label }, !1).track), (s[o] = l)))
                    }
            },
        },
        vc = {
            AUDIO: function (i, n) {
                return function () {
                    var e,
                        t = n.mediaTypes[i].tracks
                    for (e in t) if (t[e].enabled) return t[e]
                    return null
                }
            },
            SUBTITLES: function (i, n) {
                return function () {
                    var e,
                        t = n.mediaTypes[i].tracks
                    for (e in t) if ('showing' === t[e].mode || 'hidden' === t[e].mode) return t[e]
                    return null
                }
            },
        },
        _c = ['mediaRequests', 'mediaRequestsAborted', 'mediaRequestsTimedout', 'mediaRequestsErrored', 'mediaTransferDuration', 'mediaBytesTransferred', 'mediaAppends'],
        bc = (function (v) {
            function e(e) {
                var t = v.call(this) || this,
                    i = e.src,
                    n = e.handleManifestRedirects,
                    r = e.withCredentials,
                    a = e.tech,
                    s = e.bandwidth,
                    o = e.externVhs,
                    u = e.useCueTags,
                    l = e.blacklistDuration,
                    c = e.enableLowInitialPlaylist,
                    d = e.sourceType,
                    h = e.cacheEncryptionKeys,
                    p = e.experimentalBufferBasedABR,
                    f = e.experimentalLeastPixelDiffSelector,
                    m = e.captionServices
                if (!i) throw new Error('A non-empty playlist URL or JSON manifest string is required')
                var g,
                    y = e.maxPlaylistRetries
                ;(null !== y && 'undefined' != typeof y) || (y = 1 / 0),
                    (Ql = o),
                    (t.experimentalBufferBasedABR = Boolean(p)),
                    (t.experimentalLeastPixelDiffSelector = Boolean(f)),
                    (t.withCredentials = r),
                    (t.tech_ = a),
                    (t.vhs_ = a.vhs),
                    (t.sourceType_ = d),
                    (t.useCueTags_ = u),
                    (t.blacklistDuration = l),
                    (t.maxPlaylistRetries = y),
                    (t.enableLowInitialPlaylist = c),
                    t.useCueTags_ && ((t.cueTagsTrack_ = t.tech_.addTextTrack('metadata', 'ad-cues')), (t.cueTagsTrack_.inBandMetadataTrackDispatchType = '')),
                    (t.requestOptions_ = { withCredentials: r, handleManifestRedirects: n, maxPlaylistRetries: y, timeout: null }),
                    t.on('error', t.pauseLoading),
                    (t.mediaTypes_ =
                        ((g = {}),
                        ['AUDIO', 'SUBTITLES', 'CLOSED-CAPTIONS'].forEach(function (e) {
                            g[e] = {
                                groups: {},
                                tracks: {},
                                activePlaylistLoader: null,
                                activeGroup: Rl,
                                activeTrack: Rl,
                                getActiveGroup: Rl,
                                onGroupChanged: Rl,
                                onTrackChanged: Rl,
                                lastTrack_: null,
                                logger_: Ro('MediaGroups[' + e + ']'),
                            }
                        }),
                        g)),
                    (t.mediaSource = new window.MediaSource()),
                    (t.handleDurationChange_ = t.handleDurationChange_.bind(ft(t))),
                    (t.handleSourceOpen_ = t.handleSourceOpen_.bind(ft(t))),
                    (t.handleSourceEnded_ = t.handleSourceEnded_.bind(ft(t))),
                    t.mediaSource.addEventListener('durationchange', t.handleDurationChange_),
                    t.mediaSource.addEventListener('sourceopen', t.handleSourceOpen_),
                    t.mediaSource.addEventListener('sourceended', t.handleSourceEnded_),
                    (t.seekable_ = tr.createTimeRanges()),
                    (t.hasPlayed_ = !1),
                    (t.syncController_ = new hc(e)),
                    (t.segmentMetadataTrack_ = a.addRemoteTextTrack({ kind: 'metadata', label: 'segment-metadata' }, !1).track),
                    (t.decrypter_ = new fc()),
                    (t.sourceUpdater_ = new uc(t.mediaSource)),
                    (t.inbandTextTracks_ = {}),
                    (t.timelineChangeController_ = new pc())
                h = {
                    vhs: t.vhs_,
                    parse708captions: e.parse708captions,
                    useDtsForTimestampOffset: e.useDtsForTimestampOffset,
                    captionServices: m,
                    mediaSource: t.mediaSource,
                    currentTime: t.tech_.currentTime.bind(t.tech_),
                    seekable: function () {
                        return t.seekable()
                    },
                    seeking: function () {
                        return t.tech_.seeking()
                    },
                    duration: function () {
                        return t.duration()
                    },
                    hasPlayed: function () {
                        return t.hasPlayed_
                    },
                    goalBufferLength: function () {
                        return t.goalBufferLength()
                    },
                    bandwidth: s,
                    syncController: t.syncController_,
                    decrypter: t.decrypter_,
                    sourceType: t.sourceType_,
                    inbandTextTracks: t.inbandTextTracks_,
                    cacheEncryptionKeys: h,
                    sourceUpdater: t.sourceUpdater_,
                    timelineChangeController: t.timelineChangeController_,
                    experimentalExactManifestTimings: e.experimentalExactManifestTimings,
                }
                ;(t.masterPlaylistLoader_ = new ('dash' === t.sourceType_ ? wl : _l)(i, t.vhs_, t.requestOptions_)),
                    t.setupMasterPlaylistLoaderListeners_(),
                    (t.mainSegmentLoader_ = new Ml(tr.mergeOptions(h, { segmentMetadataTrack: t.segmentMetadataTrack_, loaderType: 'main' }), e)),
                    (t.audioSegmentLoader_ = new Ml(tr.mergeOptions(h, { loaderType: 'audio' }), e)),
                    (t.subtitleSegmentLoader_ = new cc(tr.mergeOptions(h, { loaderType: 'vtt', featuresNativeTextTracks: t.tech_.featuresNativeTextTracks }), e)),
                    t.setupSegmentLoaderListeners_(),
                    t.experimentalBufferBasedABR &&
                        (t.masterPlaylistLoader_.one('loadedplaylist', function () {
                            return t.startABRTimer_()
                        }),
                        t.tech_.on('pause', function () {
                            return t.stopABRTimer_()
                        }),
                        t.tech_.on('play', function () {
                            return t.startABRTimer_()
                        })),
                    _c.forEach(function (e) {
                        t[e + '_'] = function (e) {
                            return this.audioSegmentLoader_[e] + this.mainSegmentLoader_[e]
                        }.bind(ft(t), e)
                    }),
                    (t.logger_ = Ro('MPC')),
                    (t.triggeredFmp4Usage = !1),
                    'none' === t.tech_.preload()
                        ? ((t.loadOnPlay_ = function () {
                              ;(t.loadOnPlay_ = null), t.masterPlaylistLoader_.load()
                          }),
                          t.tech_.one('play', t.loadOnPlay_))
                        : t.masterPlaylistLoader_.load(),
                    (t.timeToLoadedData__ = -1),
                    (t.mainAppendsToLoadedData__ = -1),
                    (t.audioAppendsToLoadedData__ = -1)
                e = 'none' === t.tech_.preload() ? 'play' : 'loadstart'
                return (
                    t.tech_.one(e, function () {
                        var e = Date.now()
                        t.tech_.one('loadeddata', function () {
                            ;(t.timeToLoadedData__ = Date.now() - e),
                                (t.mainAppendsToLoadedData__ = t.mainSegmentLoader_.mediaAppends),
                                (t.audioAppendsToLoadedData__ = t.audioSegmentLoader_.mediaAppends)
                        })
                    }),
                    t
                )
            }
            mt(e, v)
            var t = e.prototype
            return (
                (t.mainAppendsToLoadedData_ = function () {
                    return this.mainAppendsToLoadedData__
                }),
                (t.audioAppendsToLoadedData_ = function () {
                    return this.audioAppendsToLoadedData__
                }),
                (t.appendsToLoadedData_ = function () {
                    var e = this.mainAppendsToLoadedData_(),
                        t = this.audioAppendsToLoadedData_()
                    return -1 === e || -1 === t ? -1 : e + t
                }),
                (t.timeToLoadedData_ = function () {
                    return this.timeToLoadedData__
                }),
                (t.checkABR_ = function () {
                    var e = this.selectPlaylist()
                    e && this.shouldSwitchToMedia_(e) && this.switchMedia_(e, 'abr')
                }),
                (t.switchMedia_ = function (e, t, i) {
                    var n = this.media(),
                        r = n && (n.id || n.uri),
                        n = e.id || e.uri
                    r && r !== n && (this.logger_('switch media ' + r + ' -> ' + n + ' from ' + t), this.tech_.trigger({ type: 'usage', name: 'vhs-rendition-change-' + t })),
                        this.masterPlaylistLoader_.media(e, i)
                }),
                (t.startABRTimer_ = function () {
                    var e = this
                    this.stopABRTimer_(),
                        (this.abrTimer_ = window.setInterval(function () {
                            return e.checkABR_()
                        }, 250))
                }),
                (t.stopABRTimer_ = function () {
                    ;(this.tech_.scrubbing && this.tech_.scrubbing()) || (window.clearInterval(this.abrTimer_), (this.abrTimer_ = null))
                }),
                (t.getAudioTrackPlaylists_ = function () {
                    var e = this.master(),
                        t = (e && e.playlists) || []
                    if (!e || !e.mediaGroups || !e.mediaGroups.AUDIO) return t
                    var i,
                        n = e.mediaGroups.AUDIO,
                        r = Object.keys(n)
                    if (Object.keys(this.mediaTypes_.AUDIO.groups).length) i = this.mediaTypes_.AUDIO.activeTrack()
                    else {
                        var a,
                            s = n.main || (r.length && n[r[0]])
                        for (a in s)
                            if (s[a].default) {
                                i = { label: a }
                                break
                            }
                    }
                    if (!i) return t
                    var o,
                        u = []
                    for (o in n)
                        if (n[o][i.label]) {
                            var l = n[o][i.label]
                            if (l.playlists && l.playlists.length) u.push.apply(u, l.playlists)
                            else if (l.uri) u.push(l)
                            else if (e.playlists.length)
                                for (var c = 0; c < e.playlists.length; c++) {
                                    var d = e.playlists[c]
                                    d.attributes && d.attributes.AUDIO && d.attributes.AUDIO === o && u.push(d)
                                }
                        }
                    return u.length ? u : t
                }),
                (t.setupMasterPlaylistLoaderListeners_ = function () {
                    var i = this
                    this.masterPlaylistLoader_.on('loadedmetadata', function () {
                        var e = i.masterPlaylistLoader_.media(),
                            t = 1.5 * e.targetDuration * 1e3
                        iu(i.masterPlaylistLoader_.master, i.masterPlaylistLoader_.media()) ? (i.requestOptions_.timeout = 0) : (i.requestOptions_.timeout = t),
                            e.endList && 'none' !== i.tech_.preload() && (i.mainSegmentLoader_.playlist(e, i.requestOptions_), i.mainSegmentLoader_.load()),
                            Xl({
                                sourceType: i.sourceType_,
                                segmentLoaders: { AUDIO: i.audioSegmentLoader_, SUBTITLES: i.subtitleSegmentLoader_, main: i.mainSegmentLoader_ },
                                tech: i.tech_,
                                requestOptions: i.requestOptions_,
                                masterPlaylistLoader: i.masterPlaylistLoader_,
                                vhs: i.vhs_,
                                master: i.master(),
                                mediaTypes: i.mediaTypes_,
                                blacklistCurrentPlaylist: i.blacklistCurrentPlaylist.bind(i),
                            }),
                            i.triggerPresenceUsage_(i.master(), e),
                            i.setupFirstPlay(),
                            !i.mediaTypes_.AUDIO.activePlaylistLoader || i.mediaTypes_.AUDIO.activePlaylistLoader.media()
                                ? i.trigger('selectedinitialmedia')
                                : i.mediaTypes_.AUDIO.activePlaylistLoader.one('loadedmetadata', function () {
                                      i.trigger('selectedinitialmedia')
                                  })
                    }),
                        this.masterPlaylistLoader_.on('loadedplaylist', function () {
                            i.loadOnPlay_ && i.tech_.off('play', i.loadOnPlay_)
                            var e,
                                t = i.masterPlaylistLoader_.media()
                            if (!t) {
                                if ((i.excludeUnsupportedVariants_(), !(e = (e = i.enableLowInitialPlaylist ? i.selectInitialPlaylist() : e) || i.selectPlaylist()) || !i.shouldSwitchToMedia_(e)))
                                    return
                                if (((i.initialMedia_ = e), i.switchMedia_(i.initialMedia_, 'initial'), !('vhs-json' === i.sourceType_ && i.initialMedia_.segments))) return
                                t = i.initialMedia_
                            }
                            i.handleUpdatedMediaPlaylist(t)
                        }),
                        this.masterPlaylistLoader_.on('error', function () {
                            i.blacklistCurrentPlaylist(i.masterPlaylistLoader_.error)
                        }),
                        this.masterPlaylistLoader_.on('mediachanging', function () {
                            i.mainSegmentLoader_.abort(), i.mainSegmentLoader_.pause()
                        }),
                        this.masterPlaylistLoader_.on('mediachange', function () {
                            var e = i.masterPlaylistLoader_.media(),
                                t = 1.5 * e.targetDuration * 1e3
                            iu(i.masterPlaylistLoader_.master, i.masterPlaylistLoader_.media()) ? (i.requestOptions_.timeout = 0) : (i.requestOptions_.timeout = t),
                                i.mainSegmentLoader_.playlist(e, i.requestOptions_),
                                i.mainSegmentLoader_.load(),
                                i.tech_.trigger({ type: 'mediachange', bubbles: !0 })
                        }),
                        this.masterPlaylistLoader_.on('playlistunchanged', function () {
                            var e = i.masterPlaylistLoader_.media()
                            'playlist-unchanged' !== e.lastExcludeReason_ &&
                                i.stuckAtPlaylistEnd_(e) &&
                                (i.blacklistCurrentPlaylist({ message: 'Playlist no longer updating.', reason: 'playlist-unchanged' }), i.tech_.trigger('playliststuck'))
                        }),
                        this.masterPlaylistLoader_.on('renditiondisabled', function () {
                            i.tech_.trigger({ type: 'usage', name: 'vhs-rendition-disabled' }), i.tech_.trigger({ type: 'usage', name: 'hls-rendition-disabled' })
                        }),
                        this.masterPlaylistLoader_.on('renditionenabled', function () {
                            i.tech_.trigger({ type: 'usage', name: 'vhs-rendition-enabled' }), i.tech_.trigger({ type: 'usage', name: 'hls-rendition-enabled' })
                        })
                }),
                (t.handleUpdatedMediaPlaylist = function (e) {
                    this.useCueTags_ && this.updateAdCues_(e),
                        this.mainSegmentLoader_.playlist(e, this.requestOptions_),
                        this.updateDuration(!e.endList),
                        this.tech_.paused() || (this.mainSegmentLoader_.load(), this.audioSegmentLoader_ && this.audioSegmentLoader_.load())
                }),
                (t.triggerPresenceUsage_ = function (e, t) {
                    var i,
                        n = e.mediaGroups || {},
                        r = !0,
                        e = Object.keys(n.AUDIO)
                    for (i in n.AUDIO) for (var a in n.AUDIO[i]) n.AUDIO[i][a].uri || (r = !1)
                    r && (this.tech_.trigger({ type: 'usage', name: 'vhs-demuxed' }), this.tech_.trigger({ type: 'usage', name: 'hls-demuxed' })),
                        Object.keys(n.SUBTITLES).length && (this.tech_.trigger({ type: 'usage', name: 'vhs-webvtt' }), this.tech_.trigger({ type: 'usage', name: 'hls-webvtt' })),
                        Ql.Playlist.isAes(t) && (this.tech_.trigger({ type: 'usage', name: 'vhs-aes' }), this.tech_.trigger({ type: 'usage', name: 'hls-aes' })),
                        e.length &&
                            1 < Object.keys(n.AUDIO[e[0]]).length &&
                            (this.tech_.trigger({ type: 'usage', name: 'vhs-alternate-audio' }), this.tech_.trigger({ type: 'usage', name: 'hls-alternate-audio' })),
                        this.useCueTags_ && (this.tech_.trigger({ type: 'usage', name: 'vhs-playlist-cue-tags' }), this.tech_.trigger({ type: 'usage', name: 'hls-playlist-cue-tags' }))
                }),
                (t.shouldSwitchToMedia_ = function (e) {
                    var t = this.masterPlaylistLoader_.media() || this.masterPlaylistLoader_.pendingMedia_,
                        i = this.tech_.currentTime(),
                        n = this.bufferLowWaterLine(),
                        r = this.bufferHighWaterLine()
                    return (function (e) {
                        var t = e.currentPlaylist,
                            i = e.buffered,
                            n = e.currentTime,
                            r = e.nextPlaylist,
                            a = e.bufferLowWaterLine,
                            s = e.bufferHighWaterLine,
                            o = e.duration,
                            u = e.experimentalBufferBasedABR,
                            l = e.log
                        if (!r) return tr.log.warn('We received no playlist to switch to. Please check your stream.'), !1
                        var c = 'allowing switch ' + ((t && t.id) || 'null') + ' -> ' + r.id
                        if (!t) return l(c + ' as current playlist is not set'), !0
                        if (r.id === t.id) return !1
                        e = Boolean(Uo(i, n).length)
                        if (!t.endList)
                            return e || 'number' != typeof t.partTargetDuration
                                ? (l(c + ' as current playlist is live'), !0)
                                : (l('not ' + c + " as current playlist is live llhls, but currentTime isn't in buffered."), !1)
                        ;(i = qo(i, n)), (n = u ? El.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE : El.MAX_BUFFER_LOW_WATER_LINE)
                        if (o < n) return l(c + ' as duration < max low water line (' + o + ' < ' + n + ')'), !0
                        ;(n = r.attributes.BANDWIDTH), (r = t.attributes.BANDWIDTH)
                        if (n < r && (!u || i < s)) {
                            t = c + ' as next bandwidth < current bandwidth (' + n + ' < ' + r + ')'
                            return u && (t += ' and forwardBuffer < bufferHighWaterLine (' + i + ' < ' + s + ')'), l(t), !0
                        }
                        if ((!u || r < n) && a <= i) {
                            a = c + ' as forwardBuffer >= bufferLowWaterLine (' + i + ' >= ' + a + ')'
                            return u && (a += ' and next bandwidth > current bandwidth (' + n + ' > ' + r + ')'), l(a), !0
                        }
                        return l('not ' + c + ' as no switching criteria met'), !1
                    })({
                        buffered: this.tech_.buffered(),
                        currentTime: i,
                        currentPlaylist: t,
                        nextPlaylist: e,
                        bufferLowWaterLine: n,
                        bufferHighWaterLine: r,
                        duration: this.duration(),
                        experimentalBufferBasedABR: this.experimentalBufferBasedABR,
                        log: this.logger_,
                    })
                }),
                (t.setupSegmentLoaderListeners_ = function () {
                    var t = this
                    this.experimentalBufferBasedABR ||
                        (this.mainSegmentLoader_.on('bandwidthupdate', function () {
                            var e = t.selectPlaylist()
                            t.shouldSwitchToMedia_(e) && t.switchMedia_(e, 'bandwidthupdate'), t.tech_.trigger('bandwidthupdate')
                        }),
                        this.mainSegmentLoader_.on('progress', function () {
                            t.trigger('progress')
                        })),
                        this.mainSegmentLoader_.on('error', function () {
                            t.blacklistCurrentPlaylist(t.mainSegmentLoader_.error())
                        }),
                        this.mainSegmentLoader_.on('appenderror', function () {
                            ;(t.error = t.mainSegmentLoader_.error_), t.trigger('error')
                        }),
                        this.mainSegmentLoader_.on('syncinfoupdate', function () {
                            t.onSyncInfoUpdate_()
                        }),
                        this.mainSegmentLoader_.on('timestampoffset', function () {
                            t.tech_.trigger({ type: 'usage', name: 'vhs-timestamp-offset' }), t.tech_.trigger({ type: 'usage', name: 'hls-timestamp-offset' })
                        }),
                        this.audioSegmentLoader_.on('syncinfoupdate', function () {
                            t.onSyncInfoUpdate_()
                        }),
                        this.audioSegmentLoader_.on('appenderror', function () {
                            ;(t.error = t.audioSegmentLoader_.error_), t.trigger('error')
                        }),
                        this.mainSegmentLoader_.on('ended', function () {
                            t.logger_('main segment loader ended'), t.onEndOfStream()
                        }),
                        this.mainSegmentLoader_.on('earlyabort', function (e) {
                            t.experimentalBufferBasedABR ||
                                (t.delegateLoaders_('all', ['abort']),
                                t.blacklistCurrentPlaylist({ message: "Aborted early because there isn't enough bandwidth to complete the request without rebuffering." }, 120))
                        })
                    function e() {
                        if (!t.sourceUpdater_.hasCreatedSourceBuffers()) return t.tryToCreateSourceBuffers_()
                        var e = t.getCodecsOrExclude_()
                        e && t.sourceUpdater_.addOrChangeSourceBuffers(e)
                    }
                    this.mainSegmentLoader_.on('trackinfo', e),
                        this.audioSegmentLoader_.on('trackinfo', e),
                        this.mainSegmentLoader_.on('fmp4', function () {
                            t.triggeredFmp4Usage || (t.tech_.trigger({ type: 'usage', name: 'vhs-fmp4' }), t.tech_.trigger({ type: 'usage', name: 'hls-fmp4' }), (t.triggeredFmp4Usage = !0))
                        }),
                        this.audioSegmentLoader_.on('fmp4', function () {
                            t.triggeredFmp4Usage || (t.tech_.trigger({ type: 'usage', name: 'vhs-fmp4' }), t.tech_.trigger({ type: 'usage', name: 'hls-fmp4' }), (t.triggeredFmp4Usage = !0))
                        }),
                        this.audioSegmentLoader_.on('ended', function () {
                            t.logger_('audioSegmentLoader ended'), t.onEndOfStream()
                        })
                }),
                (t.mediaSecondsLoaded_ = function () {
                    return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded + this.mainSegmentLoader_.mediaSecondsLoaded)
                }),
                (t.load = function () {
                    this.mainSegmentLoader_.load(),
                        this.mediaTypes_.AUDIO.activePlaylistLoader && this.audioSegmentLoader_.load(),
                        this.mediaTypes_.SUBTITLES.activePlaylistLoader && this.subtitleSegmentLoader_.load()
                }),
                (t.smoothQualityChange_ = function (e) {
                    void 0 === e && (e = this.selectPlaylist()), this.fastQualityChange_(e)
                }),
                (t.fastQualityChange_ = function (e) {
                    var t = this
                    ;(e = void 0 === e ? this.selectPlaylist() : e) !== this.masterPlaylistLoader_.media()
                        ? (this.switchMedia_(e, 'fast-quality'),
                          this.mainSegmentLoader_.resetEverything(function () {
                              tr.browser.IE_VERSION || tr.browser.IS_EDGE ? t.tech_.setCurrentTime(t.tech_.currentTime() + 0.04) : t.tech_.setCurrentTime(t.tech_.currentTime())
                          }))
                        : this.logger_('skipping fastQualityChange because new media is same as old')
                }),
                (t.play = function () {
                    if (!this.setupFirstPlay()) {
                        this.tech_.ended() && this.tech_.setCurrentTime(0), this.hasPlayed_ && this.load()
                        var e = this.tech_.seekable()
                        return this.tech_.duration() === 1 / 0 && this.tech_.currentTime() < e.start(0) ? this.tech_.setCurrentTime(e.end(e.length - 1)) : void 0
                    }
                }),
                (t.setupFirstPlay = function () {
                    var e = this,
                        t = this.masterPlaylistLoader_.media()
                    if (!t || this.tech_.paused() || this.hasPlayed_) return !1
                    if (!t.endList) {
                        var i = this.seekable()
                        if (!i.length) return !1
                        if (tr.browser.IE_VERSION && 0 === this.tech_.readyState())
                            return (
                                this.tech_.one('loadedmetadata', function () {
                                    e.trigger('firstplay'), e.tech_.setCurrentTime(i.end(0)), (e.hasPlayed_ = !0)
                                }),
                                !1
                            )
                        this.trigger('firstplay'), this.tech_.setCurrentTime(i.end(0))
                    }
                    return (this.hasPlayed_ = !0), this.load(), !0
                }),
                (t.handleSourceOpen_ = function () {
                    var e
                    this.tryToCreateSourceBuffers_(),
                        !this.tech_.autoplay() || ('undefined' != typeof (e = this.tech_.play()) && 'function' == typeof e.then && e.then(null, function (e) {})),
                        this.trigger('sourceopen')
                }),
                (t.handleSourceEnded_ = function () {
                    var e, t
                    !this.inbandTextTracks_.metadataTrack_ ||
                        ((e = this.inbandTextTracks_.metadataTrack_.cues) && e.length && ((t = this.duration()), (e[e.length - 1].endTime = isNaN(t) || Math.abs(t) === 1 / 0 ? Number.MAX_VALUE : t)))
                }),
                (t.handleDurationChange_ = function () {
                    this.tech_.trigger('durationchange')
                }),
                (t.onEndOfStream = function () {
                    var e,
                        t = this.mainSegmentLoader_.ended_
                    ;(t = this.mediaTypes_.AUDIO.activePlaylistLoader ? (((e = this.mainSegmentLoader_.getCurrentMediaInfo_()) && !e.hasVideo) || t) && this.audioSegmentLoader_.ended_ : t) &&
                        (this.stopABRTimer_(), this.sourceUpdater_.endOfStream())
                }),
                (t.stuckAtPlaylistEnd_ = function (e) {
                    if (!this.seekable().length) return !1
                    var t = this.syncController_.getExpiredTime(e, this.duration())
                    if (null === t) return !1
                    var i = Ql.Playlist.playlistEnd(e, t),
                        e = this.tech_.currentTime(),
                        t = this.tech_.buffered()
                    if (!t.length) return i - e <= 0.1
                    t = t.end(t.length - 1)
                    return t - e <= 0.1 && i - t <= 0.1
                }),
                (t.blacklistCurrentPlaylist = function (e, t) {
                    var i = (e = void 0 === e ? {} : e).playlist || this.masterPlaylistLoader_.media()
                    if (((t = t || e.blacklistDuration || this.blacklistDuration), !i))
                        return (this.error = e), void ('open' !== this.mediaSource.readyState ? this.trigger('error') : this.sourceUpdater_.endOfStream('network'))
                    i.playlistErrors_++
                    var n,
                        r = this.masterPlaylistLoader_.master.playlists,
                        a = r.filter(eu),
                        s = 1 === a.length && a[0] === i
                    if (1 === r.length && t !== 1 / 0)
                        return (
                            tr.log.warn('Problem encountered with playlist ' + i.id + '. Trying again since it is the only playlist.'),
                            this.tech_.trigger('retryplaylist'),
                            this.masterPlaylistLoader_.load(s)
                        )
                    s &&
                        ((n = !1),
                        r.forEach(function (e) {
                            var t
                            e === i || ('undefined' != typeof (t = e.excludeUntil) && t !== 1 / 0 && ((n = !0), delete e.excludeUntil))
                        }),
                        n && (tr.log.warn('Removing other playlists from the exclusion list because the last rendition is about to be excluded.'), this.tech_.trigger('retryplaylist'))),
                        (a = i.playlistErrors_ > this.maxPlaylistRetries ? 1 / 0 : Date.now() + 1e3 * t),
                        (i.excludeUntil = a),
                        e.reason && (i.lastExcludeReason_ = e.reason),
                        this.tech_.trigger('blacklistplaylist'),
                        this.tech_.trigger({ type: 'usage', name: 'vhs-rendition-blacklisted' }),
                        this.tech_.trigger({ type: 'usage', name: 'hls-rendition-blacklisted' })
                    r = this.selectPlaylist()
                    if (!r) return (this.error = 'Playback cannot continue. No available working or supported playlists.'), void this.trigger('error')
                    ;(t = e.internal ? this.logger_ : tr.log.warn), (a = e.message ? ' ' + e.message : '')
                    t((e.internal ? 'Internal problem' : 'Problem') + ' encountered with playlist ' + i.id + '.' + a + ' Switching to playlist ' + r.id + '.'),
                        r.attributes.AUDIO !== i.attributes.AUDIO && this.delegateLoaders_('audio', ['abort', 'pause']),
                        r.attributes.SUBTITLES !== i.attributes.SUBTITLES && this.delegateLoaders_('subtitle', ['abort', 'pause']),
                        this.delegateLoaders_('main', ['abort', 'pause'])
                    ;(a = (r.targetDuration / 2) * 1e3 || 5e3), (a = 'number' == typeof r.lastRequest && Date.now() - r.lastRequest <= a)
                    return this.switchMedia_(r, 'exclude', s || a)
                }),
                (t.pauseLoading = function () {
                    this.delegateLoaders_('all', ['abort', 'pause']), this.stopABRTimer_()
                }),
                (t.delegateLoaders_ = function (i, e) {
                    var n = this,
                        r = [],
                        t = 'all' === i
                    ;(!t && 'main' !== i) || r.push(this.masterPlaylistLoader_)
                    var a = []
                    ;(!t && 'audio' !== i) || a.push('AUDIO'),
                        (!t && 'subtitle' !== i) || (a.push('CLOSED-CAPTIONS'), a.push('SUBTITLES')),
                        a.forEach(function (e) {
                            e = n.mediaTypes_[e] && n.mediaTypes_[e].activePlaylistLoader
                            e && r.push(e)
                        }),
                        ['main', 'audio', 'subtitle'].forEach(function (e) {
                            var t = n[e + 'SegmentLoader_']
                            !t || (i !== e && 'all' !== i) || r.push(t)
                        }),
                        r.forEach(function (t) {
                            return e.forEach(function (e) {
                                'function' == typeof t[e] && t[e]()
                            })
                        })
                }),
                (t.setCurrentTime = function (e) {
                    var t = Uo(this.tech_.buffered(), e)
                    return this.masterPlaylistLoader_ && this.masterPlaylistLoader_.media() && this.masterPlaylistLoader_.media().segments
                        ? t && t.length
                            ? e
                            : (this.mainSegmentLoader_.resetEverything(),
                              this.mainSegmentLoader_.abort(),
                              this.mediaTypes_.AUDIO.activePlaylistLoader && (this.audioSegmentLoader_.resetEverything(), this.audioSegmentLoader_.abort()),
                              this.mediaTypes_.SUBTITLES.activePlaylistLoader && (this.subtitleSegmentLoader_.resetEverything(), this.subtitleSegmentLoader_.abort()),
                              void this.load())
                        : 0
                }),
                (t.duration = function () {
                    if (!this.masterPlaylistLoader_) return 0
                    var e = this.masterPlaylistLoader_.media()
                    return e ? (e.endList ? (this.mediaSource ? this.mediaSource.duration : Ql.Playlist.duration(e)) : 1 / 0) : 0
                }),
                (t.seekable = function () {
                    return this.seekable_
                }),
                (t.onSyncInfoUpdate_ = function () {
                    var e
                    if (this.masterPlaylistLoader_) {
                        var t = this.masterPlaylistLoader_.media()
                        if (t) {
                            var i = this.syncController_.getExpiredTime(t, this.duration())
                            if (null !== i) {
                                var n,
                                    r,
                                    a = this.masterPlaylistLoader_.master,
                                    s = Ql.Playlist.seekable(t, i, Ql.Playlist.liveEdgeDelay(a, t))
                                if (0 !== s.length) {
                                    if (this.mediaTypes_.AUDIO.activePlaylistLoader) {
                                        if (((t = this.mediaTypes_.AUDIO.activePlaylistLoader.media()), null === (i = this.syncController_.getExpiredTime(t, this.duration())))) return
                                        if (0 === (e = Ql.Playlist.seekable(t, i, Ql.Playlist.liveEdgeDelay(a, t))).length) return
                                    }
                                    this.seekable_ && this.seekable_.length && ((n = this.seekable_.end(0)), (r = this.seekable_.start(0))),
                                        !e || e.start(0) > s.end(0) || s.start(0) > e.end(0)
                                            ? (this.seekable_ = s)
                                            : (this.seekable_ = tr.createTimeRanges([[(e.start(0) > s.start(0) ? e : s).start(0), (e.end(0) < s.end(0) ? e : s).end(0)]])),
                                        (this.seekable_ && this.seekable_.length && this.seekable_.end(0) === n && this.seekable_.start(0) === r) ||
                                            (this.logger_('seekable updated [' + Fo(this.seekable_) + ']'), this.tech_.trigger('seekablechanged'))
                                }
                            }
                        }
                    }
                }),
                (t.updateDuration = function (e) {
                    if ((this.updateDuration_ && (this.mediaSource.removeEventListener('sourceopen', this.updateDuration_), (this.updateDuration_ = null)), 'open' !== this.mediaSource.readyState))
                        return (this.updateDuration_ = this.updateDuration.bind(this, e)), void this.mediaSource.addEventListener('sourceopen', this.updateDuration_)
                    if (e) {
                        var t = this.seekable()
                        return t.length ? void ((isNaN(this.mediaSource.duration) || this.mediaSource.duration < t.end(t.length - 1)) && this.sourceUpdater_.setDuration(t.end(t.length - 1))) : void 0
                    }
                    ;(e = this.tech_.buffered()), (t = Ql.Playlist.duration(this.masterPlaylistLoader_.media()))
                    0 < e.length && (t = Math.max(t, e.end(e.length - 1))), this.mediaSource.duration !== t && this.sourceUpdater_.setDuration(t)
                }),
                (t.dispose = function () {
                    var n = this
                    this.trigger('dispose'),
                        this.decrypter_.terminate(),
                        this.masterPlaylistLoader_.dispose(),
                        this.mainSegmentLoader_.dispose(),
                        this.loadOnPlay_ && this.tech_.off('play', this.loadOnPlay_),
                        ['AUDIO', 'SUBTITLES'].forEach(function (e) {
                            var t,
                                i = n.mediaTypes_[e].groups
                            for (t in i)
                                i[t].forEach(function (e) {
                                    e.playlistLoader && e.playlistLoader.dispose()
                                })
                        }),
                        this.audioSegmentLoader_.dispose(),
                        this.subtitleSegmentLoader_.dispose(),
                        this.sourceUpdater_.dispose(),
                        this.timelineChangeController_.dispose(),
                        this.stopABRTimer_(),
                        this.updateDuration_ && this.mediaSource.removeEventListener('sourceopen', this.updateDuration_),
                        this.mediaSource.removeEventListener('durationchange', this.handleDurationChange_),
                        this.mediaSource.removeEventListener('sourceopen', this.handleSourceOpen_),
                        this.mediaSource.removeEventListener('sourceended', this.handleSourceEnded_),
                        this.off()
                }),
                (t.master = function () {
                    return this.masterPlaylistLoader_.master
                }),
                (t.media = function () {
                    return this.masterPlaylistLoader_.media() || this.initialMedia_
                }),
                (t.areMediaTypesKnown_ = function () {
                    var e = !!this.mediaTypes_.AUDIO.activePlaylistLoader,
                        t = !!this.mainSegmentLoader_.getCurrentMediaInfo_(),
                        e = !e || !!this.audioSegmentLoader_.getCurrentMediaInfo_()
                    return t && e
                }),
                (t.getCodecsOrExclude_ = function () {
                    var n = this,
                        r = { main: this.mainSegmentLoader_.getCurrentMediaInfo_() || {}, audio: this.audioSegmentLoader_.getCurrentMediaInfo_() || {} }
                    r.video = r.main
                    var e = $u(this.master(), this.media()),
                        a = {},
                        t = !!this.mediaTypes_.AUDIO.activePlaylistLoader
                    if (
                        (r.main.hasVideo && (a.video = e.video || r.main.videoCodec || 'avc1.4d400d'),
                        r.main.isMuxed && (a.video += ',' + (e.audio || r.main.audioCodec || Lr)),
                        ((r.main.hasAudio && !r.main.isMuxed) || r.audio.hasAudio || t) &&
                            ((a.audio = e.audio || r.main.audioCodec || r.audio.audioCodec || Lr), (r.audio.isFmp4 = (r.main.hasAudio && !r.main.isMuxed ? r.main : r.audio).isFmp4)),
                        a.audio || a.video)
                    ) {
                        var s,
                            i,
                            o = {}
                        if (
                            (['video', 'audio'].forEach(function (e) {
                                var t, i
                                a.hasOwnProperty(e) &&
                                    ((t = r[e].isFmp4), (i = a[e]), !(t ? gr : yr)(i)) &&
                                    ((i = r[e].isFmp4 ? 'browser' : 'muxer'), (o[i] = o[i] || []), o[i].push(a[e]), 'audio' === e && (s = i))
                            }),
                            t &&
                                s &&
                                this.media().attributes.AUDIO &&
                                ((i = this.media().attributes.AUDIO),
                                this.master().playlists.forEach(function (e) {
                                    ;(e.attributes && e.attributes.AUDIO) === i && e !== n.media() && (e.excludeUntil = 1 / 0)
                                }),
                                this.logger_('excluding audio group ' + i + ' as ' + s + ' does not support codec(s): "' + a.audio + '"')),
                            !Object.keys(o).length)
                        ) {
                            if (this.sourceUpdater_.hasCreatedSourceBuffers() && !this.sourceUpdater_.canChangeType()) {
                                var u = []
                                if (
                                    (['video', 'audio'].forEach(function (e) {
                                        var t = (pr(n.sourceUpdater_.codecs[e] || '')[0] || {}).type,
                                            i = (pr(a[e] || '')[0] || {}).type
                                        t && i && t.toLowerCase() !== i.toLowerCase() && u.push('"' + n.sourceUpdater_.codecs[e] + '" -> "' + a[e] + '"')
                                    }),
                                    u.length)
                                )
                                    return void this.blacklistCurrentPlaylist({
                                        playlist: this.media(),
                                        message: 'Codec switching not supported: ' + u.join(', ') + '.',
                                        blacklistDuration: 1 / 0,
                                        internal: !0,
                                    })
                            }
                            return a
                        }
                        t =
                            Object.keys(o).reduce(function (e, t) {
                                return e && (e += ', '), (e += t + ' does not support codec(s): "' + o[t].join(',') + '"')
                            }, '') + '.'
                        this.blacklistCurrentPlaylist({ playlist: this.media(), internal: !0, message: t, blacklistDuration: 1 / 0 })
                    } else this.blacklistCurrentPlaylist({ playlist: this.media(), message: 'Could not determine codecs for playlist.', blacklistDuration: 1 / 0 })
                }),
                (t.tryToCreateSourceBuffers_ = function () {
                    var e
                    'open' !== this.mediaSource.readyState ||
                        this.sourceUpdater_.hasCreatedSourceBuffers() ||
                        !this.areMediaTypesKnown_() ||
                        ((e = this.getCodecsOrExclude_()) && (this.sourceUpdater_.createSourceBuffers(e), (e = [e.video, e.audio].filter(Boolean).join(',')), this.excludeIncompatibleVariants_(e)))
                }),
                (t.excludeUnsupportedVariants_ = function () {
                    var n = this,
                        r = this.master().playlists,
                        a = []
                    Object.keys(r).forEach(function (e) {
                        var t,
                            i = r[e]
                        ;-1 === a.indexOf(i.id) &&
                            (a.push(i.id),
                            (t = []),
                            !(e = $u(n.master, i)).audio || yr(e.audio) || gr(e.audio) || t.push('audio codec ' + e.audio),
                            !e.video || yr(e.video) || gr(e.video) || t.push('video codec ' + e.video),
                            e.text && 'stpp.ttml.im1t' === e.text && t.push('text codec ' + e.text),
                            t.length && ((i.excludeUntil = 1 / 0), n.logger_('excluding ' + i.id + ' for unsupported: ' + t.join(', '))))
                    })
                }),
                (t.excludeIncompatibleVariants_ = function (e) {
                    var r = this,
                        a = [],
                        s = this.master().playlists,
                        e = Yu(pr(e)),
                        o = Qu(e),
                        u = (e.video && pr(e.video)[0]) || null,
                        l = (e.audio && pr(e.audio)[0]) || null
                    Object.keys(s).forEach(function (e) {
                        var t,
                            i,
                            n = s[e]
                        ;-1 === a.indexOf(n.id) &&
                            n.excludeUntil !== 1 / 0 &&
                            (a.push(n.id),
                            (t = []),
                            (i = $u(r.masterPlaylistLoader_.master, n)),
                            (e = Qu(i)),
                            (i.audio || i.video) &&
                                (e !== o && t.push('codec count "' + e + '" !== "' + o + '"'),
                                r.sourceUpdater_.canChangeType() ||
                                    ((e = (i.video && pr(i.video)[0]) || null),
                                    (i = (i.audio && pr(i.audio)[0]) || null),
                                    e && u && e.type.toLowerCase() !== u.type.toLowerCase() && t.push('video codec "' + e.type + '" !== "' + u.type + '"'),
                                    i && l && i.type.toLowerCase() !== l.type.toLowerCase() && t.push('audio codec "' + i.type + '" !== "' + l.type + '"')),
                                t.length && ((n.excludeUntil = 1 / 0), r.logger_('blacklisting ' + n.id + ': ' + t.join(' && ')))))
                    })
                }),
                (t.updateAdCues_ = function (e) {
                    var t = 0,
                        i = this.seekable()
                    i.length && (t = i.start(0)),
                        (function (e, t, i) {
                            if ((void 0 === i && (i = 0), e.segments))
                                for (var n = i, r = 0; r < e.segments.length; r++) {
                                    var a,
                                        s,
                                        o,
                                        u = e.segments[r]
                                    if (
                                        (o =
                                            o ||
                                            (function (e, t) {
                                                for (var i = e.cues, n = 0; n < i.length; n++) {
                                                    var r = i[n]
                                                    if (t >= r.adStartTime && t <= r.adEndTime) return r
                                                }
                                                return null
                                            })(t, n + u.duration / 2))
                                    ) {
                                        if ('cueIn' in u) {
                                            ;(o.endTime = n), (o.adEndTime = n), (n += u.duration), (o = null)
                                            continue
                                        }
                                        if (n < o.endTime) {
                                            n += u.duration
                                            continue
                                        }
                                        o.endTime += u.duration
                                    } else
                                        'cueOut' in u && (((o = new window.VTTCue(n, n + u.duration, u.cueOut)).adStartTime = n), (o.adEndTime = n + parseFloat(u.cueOut)), t.addCue(o)),
                                            'cueOutCont' in u &&
                                                ((a = (s = u.cueOutCont.split('/').map(parseFloat))[0]),
                                                (s = s[1]),
                                                ((o = new window.VTTCue(n, n + u.duration, '')).adStartTime = n - a),
                                                (o.adEndTime = o.adStartTime + s),
                                                t.addCue(o))
                                    n += u.duration
                                }
                        })(e, this.cueTagsTrack_, t)
                }),
                (t.goalBufferLength = function () {
                    var e = this.tech_.currentTime(),
                        t = El.GOAL_BUFFER_LENGTH,
                        i = El.GOAL_BUFFER_LENGTH_RATE,
                        n = Math.max(t, El.MAX_GOAL_BUFFER_LENGTH)
                    return Math.min(t + e * i, n)
                }),
                (t.bufferLowWaterLine = function () {
                    var e = this.tech_.currentTime(),
                        t = El.BUFFER_LOW_WATER_LINE,
                        i = El.BUFFER_LOW_WATER_LINE_RATE,
                        n = Math.max(t, El.MAX_BUFFER_LOW_WATER_LINE),
                        r = Math.max(t, El.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE)
                    return Math.min(t + e * i, this.experimentalBufferBasedABR ? r : n)
                }),
                (t.bufferHighWaterLine = function () {
                    return El.BUFFER_HIGH_WATER_LINE
                }),
                e
            )
        })(tr.EventTarget),
        Tc = ['seeking', 'seeked', 'pause', 'playing', 'error'],
        Sc = (function () {
            function e(e) {
                var i = this
                ;(this.masterPlaylistController_ = e.masterPlaylistController),
                    (this.tech_ = e.tech),
                    (this.seekable = e.seekable),
                    (this.allowSeeksWithinUnsafeLiveWindow = e.allowSeeksWithinUnsafeLiveWindow),
                    (this.liveRangeSafeTimeDelta = e.liveRangeSafeTimeDelta),
                    (this.media = e.media),
                    (this.consecutiveUpdates = 0),
                    (this.lastRecordedTime = null),
                    (this.timer_ = null),
                    (this.checkCurrentTimeTimeout_ = null),
                    (this.logger_ = Ro('PlaybackWatcher')),
                    this.logger_('initialize')
                function t() {
                    return i.monitorCurrentTime_()
                }
                function n() {
                    return i.monitorCurrentTime_()
                }
                function r() {
                    return i.techWaiting_()
                }
                function a() {
                    return i.cancelTimer_()
                }
                var s = this.masterPlaylistController_,
                    o = ['main', 'subtitle', 'audio'],
                    u = {}
                o.forEach(function (e) {
                    ;(u[e] = {
                        reset: function () {
                            return i.resetSegmentDownloads_(e)
                        },
                        updateend: function () {
                            return i.checkSegmentDownloads_(e)
                        },
                    }),
                        s[e + 'SegmentLoader_'].on('appendsdone', u[e].updateend),
                        s[e + 'SegmentLoader_'].on('playlistupdate', u[e].reset),
                        i.tech_.on(['seeked', 'seeking'], u[e].reset)
                })
                function l(t) {
                    ;['main', 'audio'].forEach(function (e) {
                        s[e + 'SegmentLoader_'][t]('appended', i.seekingAppendCheck_)
                    })
                }
                ;(this.seekingAppendCheck_ = function () {
                    i.fixesBadSeeks_() && ((i.consecutiveUpdates = 0), (i.lastRecordedTime = i.tech_.currentTime()), l('off'))
                }),
                    (this.clearSeekingAppendCheck_ = function () {
                        return l('off')
                    }),
                    (this.watchForBadSeeking_ = function () {
                        i.clearSeekingAppendCheck_(), l('on')
                    }),
                    this.tech_.on('seeked', this.clearSeekingAppendCheck_),
                    this.tech_.on('seeking', this.watchForBadSeeking_),
                    this.tech_.on('waiting', r),
                    this.tech_.on(Tc, a),
                    this.tech_.on('canplay', n),
                    this.tech_.one('play', t),
                    (this.dispose = function () {
                        i.clearSeekingAppendCheck_(),
                            i.logger_('dispose'),
                            i.tech_.off('waiting', r),
                            i.tech_.off(Tc, a),
                            i.tech_.off('canplay', n),
                            i.tech_.off('play', t),
                            i.tech_.off('seeking', i.watchForBadSeeking_),
                            i.tech_.off('seeked', i.clearSeekingAppendCheck_),
                            o.forEach(function (e) {
                                s[e + 'SegmentLoader_'].off('appendsdone', u[e].updateend), s[e + 'SegmentLoader_'].off('playlistupdate', u[e].reset), i.tech_.off(['seeked', 'seeking'], u[e].reset)
                            }),
                            i.checkCurrentTimeTimeout_ && window.clearTimeout(i.checkCurrentTimeTimeout_),
                            i.cancelTimer_()
                    })
            }
            var t = e.prototype
            return (
                (t.monitorCurrentTime_ = function () {
                    this.checkCurrentTime_(),
                        this.checkCurrentTimeTimeout_ && window.clearTimeout(this.checkCurrentTimeTimeout_),
                        (this.checkCurrentTimeTimeout_ = window.setTimeout(this.monitorCurrentTime_.bind(this), 250))
                }),
                (t.resetSegmentDownloads_ = function (e) {
                    var t = this.masterPlaylistController_[e + 'SegmentLoader_']
                    0 < this[e + 'StalledDownloads_'] && this.logger_('resetting possible stalled download count for ' + e + ' loader'),
                        (this[e + 'StalledDownloads_'] = 0),
                        (this[e + 'Buffered_'] = t.buffered_())
                }),
                (t.checkSegmentDownloads_ = function (e) {
                    var t = this.masterPlaylistController_,
                        i = t[e + 'SegmentLoader_'],
                        n = i.buffered_(),
                        r = (function (e, t) {
                            if (e === t) return !1
                            if ((!e && t) || (!t && e)) return !0
                            if (e.length !== t.length) return !0
                            for (var i = 0; i < e.length; i++) if (e.start(i) !== t.start(i) || e.end(i) !== t.end(i)) return !0
                            return !1
                        })(this[e + 'Buffered_'], n)
                    ;(this[e + 'Buffered_'] = n),
                        r
                            ? this.resetSegmentDownloads_(e)
                            : (this[e + 'StalledDownloads_']++,
                              this.logger_('found #' + this[e + 'StalledDownloads_'] + ' ' + e + ' appends that did not increase buffer (possible stalled download)', {
                                  playlistId: i.playlist_ && i.playlist_.id,
                                  buffered: jo(n),
                              }),
                              this[e + 'StalledDownloads_'] < 10 ||
                                  (this.logger_(e + ' loader stalled download exclusion'),
                                  this.resetSegmentDownloads_(e),
                                  this.tech_.trigger({ type: 'usage', name: 'vhs-' + e + '-download-exclusion' }),
                                  'subtitle' !== e && t.blacklistCurrentPlaylist({ message: 'Excessive ' + e + ' segment downloading detected.' }, 1 / 0)))
                }),
                (t.checkCurrentTime_ = function () {
                    if (!this.tech_.paused() && !this.tech_.seeking()) {
                        var e = this.tech_.currentTime(),
                            t = this.tech_.buffered()
                        if (this.lastRecordedTime === e && (!t.length || e + 0.1 >= t.end(t.length - 1))) return this.techWaiting_()
                        5 <= this.consecutiveUpdates && e === this.lastRecordedTime
                            ? (this.consecutiveUpdates++, this.waiting_())
                            : e === this.lastRecordedTime
                            ? this.consecutiveUpdates++
                            : ((this.consecutiveUpdates = 0), (this.lastRecordedTime = e))
                    }
                }),
                (t.cancelTimer_ = function () {
                    ;(this.consecutiveUpdates = 0), this.timer_ && (this.logger_('cancelTimer_'), clearTimeout(this.timer_)), (this.timer_ = null)
                }),
                (t.fixesBadSeeks_ = function () {
                    if (!this.tech_.seeking()) return !1
                    var e,
                        t = this.seekable(),
                        i = this.tech_.currentTime()
                    if (
                        (this.afterSeekableWindow_(t, i, this.media(), this.allowSeeksWithinUnsafeLiveWindow) && (e = t.end(t.length - 1)),
                        'undefined' != typeof (e = this.beforeSeekableWindow_(t, i) ? (a = t.start(0)) + (a === t.end(0) ? 0 : 0.1) : e))
                    )
                        return this.logger_('Trying to seek outside of seekable at time ' + i + ' with seekable range ' + Fo(t) + '. Seeking to ' + e + '.'), this.tech_.setCurrentTime(e), !0
                    for (
                        var n = this.masterPlaylistController_.sourceUpdater_,
                            r = this.tech_.buffered(),
                            a = n.audioBuffer ? n.audioBuffered() : null,
                            t = n.videoBuffer ? n.videoBuffered() : null,
                            n = this.media(),
                            s = n.partTargetDuration || 2 * (n.targetDuration - fl),
                            o = [a, t],
                            u = 0;
                        u < o.length;
                        u++
                    )
                        if (o[u]) if (qo(o[u], i) < s) return !1
                    r = Bo(r, i)
                    return (
                        0 !== r.length &&
                        ((e = r.start(0) + 0.1),
                        this.logger_('Buffered region starts (' + r.start(0) + ')  just beyond seek point (' + i + '). Seeking to ' + e + '.'),
                        this.tech_.setCurrentTime(e),
                        !0)
                    )
                }),
                (t.waiting_ = function () {
                    var e, t
                    this.techWaiting_() ||
                        ((e = this.tech_.currentTime()),
                        (t = this.tech_.buffered()),
                        (t = Uo(t, e)).length &&
                            e + 3 <= t.end(0) &&
                            (this.cancelTimer_(),
                            this.tech_.setCurrentTime(e),
                            this.logger_('Stopped at ' + e + ' while inside a buffered region [' + t.start(0) + ' -> ' + t.end(0) + ']. Attempting to resume playback by seeking to the current time.'),
                            this.tech_.trigger({ type: 'usage', name: 'vhs-unknown-waiting' }),
                            this.tech_.trigger({ type: 'usage', name: 'hls-unknown-waiting' })))
                }),
                (t.techWaiting_ = function () {
                    var e = this.seekable(),
                        t = this.tech_.currentTime()
                    if (this.tech_.seeking() || null !== this.timer_) return !0
                    if (this.beforeSeekableWindow_(e, t)) {
                        var i = e.end(e.length - 1)
                        return (
                            this.logger_('Fell out of live window at time ' + t + '. Seeking to live point (seekable end) ' + i),
                            this.cancelTimer_(),
                            this.tech_.setCurrentTime(i),
                            this.tech_.trigger({ type: 'usage', name: 'vhs-live-resync' }),
                            this.tech_.trigger({ type: 'usage', name: 'hls-live-resync' }),
                            !0
                        )
                    }
                    ;(e = this.tech_.vhs.masterPlaylistController_.sourceUpdater_), (i = this.tech_.buffered())
                    if (this.videoUnderflow_({ audioBuffered: e.audioBuffered(), videoBuffered: e.videoBuffered(), currentTime: t }))
                        return (
                            this.cancelTimer_(),
                            this.tech_.setCurrentTime(t),
                            this.tech_.trigger({ type: 'usage', name: 'vhs-video-underflow' }),
                            this.tech_.trigger({ type: 'usage', name: 'hls-video-underflow' }),
                            !0
                        )
                    e = Bo(i, t)
                    if (0 < e.length) {
                        i = e.start(0) - t
                        return (
                            this.logger_('Stopped at ' + t + ', setting timer for ' + i + ', seeking to ' + e.start(0)),
                            this.cancelTimer_(),
                            (this.timer_ = setTimeout(this.skipTheGap_.bind(this), 1e3 * i, t)),
                            !0
                        )
                    }
                    return !1
                }),
                (t.afterSeekableWindow_ = function (e, t, i, n) {
                    if ((void 0 === n && (n = !1), !e.length)) return !1
                    var r = e.end(e.length - 1) + 0.1
                    return (r = !i.endList && n ? e.end(e.length - 1) + 3 * i.targetDuration : r) < t
                }),
                (t.beforeSeekableWindow_ = function (e, t) {
                    return !!(e.length && 0 < e.start(0) && t < e.start(0) - this.liveRangeSafeTimeDelta)
                }),
                (t.videoUnderflow_ = function (e) {
                    var t,
                        i,
                        n = e.videoBuffered,
                        r = e.audioBuffered,
                        a = e.currentTime
                    if (n)
                        return (
                            n.length && r.length
                                ? ((i = Uo(n, a - 3)), (e = Uo(n, a)), (r = Uo(r, a)).length && !e.length && i.length && (t = { start: i.end(0), end: r.end(0) }))
                                : Bo(n, a).length || (t = this.gapFromVideoUnderflow_(n, a)),
                            !!t && (this.logger_('Encountered a gap in video from ' + t.start + ' to ' + t.end + '. Seeking to current time ' + a), !0)
                        )
                }),
                (t.skipTheGap_ = function (e) {
                    var t = this.tech_.buffered(),
                        i = this.tech_.currentTime(),
                        t = Bo(t, i)
                    this.cancelTimer_(),
                        0 !== t.length &&
                            i === e &&
                            (this.logger_('skipTheGap_:', 'currentTime:', i, 'scheduled currentTime:', e, 'nextRange start:', t.start(0)),
                            this.tech_.setCurrentTime(t.start(0) + fl),
                            this.tech_.trigger({ type: 'usage', name: 'vhs-gap-skip' }),
                            this.tech_.trigger({ type: 'usage', name: 'hls-gap-skip' }))
                }),
                (t.gapFromVideoUnderflow_ = function (e, t) {
                    for (
                        var i = (function (e) {
                                if (e.length < 2) return tr.createTimeRanges()
                                for (var t = [], i = 1; i < e.length; i++) {
                                    var n = e.end(i - 1),
                                        r = e.start(i)
                                    t.push([n, r])
                                }
                                return tr.createTimeRanges(t)
                            })(e),
                            n = 0;
                        n < i.length;
                        n++
                    ) {
                        var r = i.start(n),
                            a = i.end(n)
                        if (t - r < 4 && 2 < t - r) return { start: r, end: a }
                    }
                    return null
                }),
                e
            )
        })(),
        wc = {
            errorInterval: 30,
            getSource: function (e) {
                return e(this.tech({ IWillNotUseThisInPlugins: !0 }).currentSource_ || this.currentSource())
            },
        },
        Ec = {
            PlaylistLoader: _l,
            Playlist: gl,
            utils: zt,
            STANDARD_PLAYLIST_SELECTOR: ar,
            INITIAL_PLAYLIST_SELECTOR: function () {
                var t = this,
                    e = this.playlists.master.playlists.filter(gl.isEnabled)
                return (
                    el(e, tl),
                    e.filter(function (e) {
                        return !!$u(t.playlists.master, e).video
                    })[0] || null
                )
            },
            lastBandwidthSelector: ar,
            movingAverageBandwidthSelector: function (t) {
                var i = -1,
                    n = -1
                if (t < 0 || 1 < t) throw new Error('Moving average bandwidth decay must be between 0 and 1.')
                return function () {
                    var e = (this.useDevicePixelRatio && window.devicePixelRatio) || 1
                    return (
                        i < 0 && ((i = this.systemBandwidth), (n = this.systemBandwidth)),
                        0 < this.systemBandwidth && this.systemBandwidth !== n && ((i = t * this.systemBandwidth + (1 - t) * i), (n = this.systemBandwidth)),
                        il(
                            this.playlists.master,
                            i,
                            parseInt(Zu(this.tech_.el(), 'width'), 10) * e,
                            parseInt(Zu(this.tech_.el(), 'height'), 10) * e,
                            this.limitRenditionByPlayerDimensions,
                            this.masterPlaylistController_
                        )
                    )
                }
            },
            comparePlaylistBandwidth: tl,
            comparePlaylistResolution: function (e, t) {
                var i, n
                return (i = (i = e.attributes.RESOLUTION && e.attributes.RESOLUTION.width ? e.attributes.RESOLUTION.width : i) || window.Number.MAX_VALUE) ===
                    (n = (n = t.attributes.RESOLUTION && t.attributes.RESOLUTION.width ? t.attributes.RESOLUTION.width : n) || window.Number.MAX_VALUE) &&
                    e.attributes.BANDWIDTH &&
                    t.attributes.BANDWIDTH
                    ? e.attributes.BANDWIDTH - t.attributes.BANDWIDTH
                    : i - n
            },
            xhr: yu(),
        }
    Object.keys(El).forEach(function (t) {
        Object.defineProperty(Ec, t, {
            get: function () {
                return tr.log.warn('using Vhs.' + t + ' is UNSAFE be sure you know what you are doing'), El[t]
            },
            set: function (e) {
                tr.log.warn('using Vhs.' + t + ' is UNSAFE be sure you know what you are doing'),
                    'number' != typeof e || e < 0 ? tr.log.warn('value of Vhs.' + t + ' must be greater than or equal to 0') : (El[t] = e)
            },
        })
    })
    function kc(e, t) {
        for (var i = t.media(), n = -1, r = 0; r < e.length; r++)
            if (e[r].id === i.id) {
                n = r
                break
            }
        ;(e.selectedIndex_ = n), e.trigger({ selectedIndex: n, type: 'change' })
    }
    var Cc = 'videojs-vhs'
    Ec.canPlaySource = function () {
        return tr.log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")
    }
    function Ic(e) {
        var n = e.player,
            t = e.sourceKeySystems,
            i = e.audioMedia,
            e = e.mainPlaylists
        if (!n.eme.initializeMediaKeys) return Promise.resolve()
        var r,
            e =
                ((e = e = i ? e.concat([i]) : e),
                (r = Object.keys(t)),
                e.reduce(function (e, n) {
                    if (!n.contentProtection) return e
                    var t = r.reduce(function (e, t) {
                        var i = n.contentProtection[t]
                        return i && i.pssh && (e[t] = { pssh: i.pssh }), e
                    }, {})
                    return Object.keys(t).length && e.push(t), e
                }, [])),
            a = [],
            s = []
        return (
            e.forEach(function (e) {
                s.push(
                    new Promise(function (e, t) {
                        n.tech_.one('keysessioncreated', e)
                    })
                ),
                    a.push(
                        new Promise(function (t, i) {
                            n.eme.initializeMediaKeys({ keySystems: e }, function (e) {
                                e ? i(e) : t()
                            })
                        })
                    )
            }),
            Promise.race([Promise.all(a), Promise.race(s)])
        )
    }
    function xc(e) {
        var t = e.player
        return (
            !!(e = (function (e, t, i) {
                if (!e) return e
                var n = {}
                t && t.attributes && t.attributes.CODECS && (n = Yu(pr(t.attributes.CODECS))), i && i.attributes && i.attributes.CODECS && (n.audio = i.attributes.CODECS)
                var r,
                    a = mr(n.video),
                    s = mr(n.audio),
                    o = {}
                for (r in e)
                    (o[r] = {}),
                        s && (o[r].audioContentType = s),
                        a && (o[r].videoContentType = a),
                        t.contentProtection && t.contentProtection[r] && t.contentProtection[r].pssh && (o[r].pssh = t.contentProtection[r].pssh),
                        'string' == typeof e[r] && (o[r].url = e[r])
                return tr.mergeOptions(e, o)
            })(e.sourceKeySystems, e.media, e.audioMedia)) &&
            (!((t.currentSource().keySystems = e) && !t.eme) || (tr.log.warn('DRM encrypted source cannot be decrypted without a DRM plugin'), !1))
        )
    }
    function Ac() {
        if (!window.localStorage) return null
        var e = window.localStorage.getItem(Cc)
        if (!e) return null
        try {
            return JSON.parse(e)
        } catch (e) {
            return null
        }
    }
    ;(Ec.supportsNativeHls = (function () {
        if (!document || !document.createElement) return !1
        var t = document.createElement('video')
        if (!tr.getTech('Html5').isSupported()) return !1
        return ['application/vnd.apple.mpegurl', 'audio/mpegurl', 'audio/x-mpegurl', 'application/x-mpegurl', 'video/x-mpegurl', 'video/mpegurl', 'application/mpegurl'].some(function (e) {
            return /maybe|probably/i.test(t.canPlayType(e))
        })
    })()),
        (Ec.supportsNativeDash =
            !!(document && document.createElement && tr.getTech('Html5').isSupported()) && /maybe|probably/i.test(document.createElement('video').canPlayType('application/dash+xml'))),
        (Ec.supportsTypeNatively = function (e) {
            return 'hls' === e ? Ec.supportsNativeHls : 'dash' === e && Ec.supportsNativeDash
        }),
        (Ec.isSupported = function () {
            return tr.log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")
        })
    var Pc = (function (r) {
            function e(e, t, i) {
                var n = r.call(this, t, tr.mergeOptions(i.hls, i.vhs)) || this
                if (
                    (i.hls && Object.keys(i.hls).length && tr.log.warn('Using hls options is deprecated. Please rename `hls` to `vhs` in your options object.'),
                    'number' == typeof i.initialBandwidth && (n.options_.bandwidth = i.initialBandwidth),
                    (n.logger_ = Ro('VhsHandler')),
                    t.options_ &&
                        t.options_.playerId &&
                        ((i = tr(t.options_.playerId)).hasOwnProperty('hls') ||
                            Object.defineProperty(i, 'hls', {
                                get: function () {
                                    return tr.log.warn('player.hls is deprecated. Use player.tech().vhs instead.'), t.trigger({ type: 'usage', name: 'hls-player-access' }), ft(n)
                                },
                                configurable: !0,
                            }),
                        i.hasOwnProperty('vhs') ||
                            Object.defineProperty(i, 'vhs', {
                                get: function () {
                                    return tr.log.warn('player.vhs is deprecated. Use player.tech().vhs instead.'), t.trigger({ type: 'usage', name: 'vhs-player-access' }), ft(n)
                                },
                                configurable: !0,
                            }),
                        i.hasOwnProperty('dash') ||
                            Object.defineProperty(i, 'dash', {
                                get: function () {
                                    return tr.log.warn('player.dash is deprecated. Use player.tech().vhs instead.'), ft(n)
                                },
                                configurable: !0,
                            }),
                        (n.player_ = i)),
                    (n.tech_ = t),
                    (n.source_ = e),
                    (n.stats = {}),
                    (n.ignoreNextSeekingEvent_ = !1),
                    n.setOptions_(),
                    n.options_.overrideNative && t.overrideNativeAudioTracks && t.overrideNativeVideoTracks)
                )
                    t.overrideNativeAudioTracks(!0), t.overrideNativeVideoTracks(!0)
                else if (n.options_.overrideNative && (t.featuresNativeVideoTracks || t.featuresNativeAudioTracks))
                    throw new Error('Overriding native HLS requires emulated tracks. See https://git.io/vMpjB')
                return (
                    n.on(document, ['fullscreenchange', 'webkitfullscreenchange', 'mozfullscreenchange', 'MSFullscreenChange'], function (e) {
                        var t = document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement
                        t && t.contains(n.tech_.el()) ? n.masterPlaylistController_.fastQualityChange_() : n.masterPlaylistController_.checkABR_()
                    }),
                    n.on(n.tech_, 'seeking', function () {
                        this.ignoreNextSeekingEvent_ ? (this.ignoreNextSeekingEvent_ = !1) : this.setCurrentTime(this.tech_.currentTime())
                    }),
                    n.on(n.tech_, 'error', function () {
                        this.tech_.error() && this.masterPlaylistController_ && this.masterPlaylistController_.pauseLoading()
                    }),
                    n.on(n.tech_, 'play', n.play),
                    n
                )
            }
            mt(e, r)
            var t = e.prototype
            return (
                (t.setOptions_ = function () {
                    var e,
                        t = this
                    ;(this.options_.withCredentials = this.options_.withCredentials || !1),
                        (this.options_.handleManifestRedirects = !1 !== this.options_.handleManifestRedirects),
                        (this.options_.limitRenditionByPlayerDimensions = !1 !== this.options_.limitRenditionByPlayerDimensions),
                        (this.options_.useDevicePixelRatio = this.options_.useDevicePixelRatio || !1),
                        (this.options_.smoothQualityChange = this.options_.smoothQualityChange || !1),
                        (this.options_.useBandwidthFromLocalStorage =
                            'undefined' != typeof this.source_.useBandwidthFromLocalStorage ? this.source_.useBandwidthFromLocalStorage : this.options_.useBandwidthFromLocalStorage || !1),
                        (this.options_.useNetworkInformationApi = this.options_.useNetworkInformationApi || !1),
                        (this.options_.useDtsForTimestampOffset = this.options_.useDtsForTimestampOffset || !1),
                        (this.options_.customTagParsers = this.options_.customTagParsers || []),
                        (this.options_.customTagMappers = this.options_.customTagMappers || []),
                        (this.options_.cacheEncryptionKeys = this.options_.cacheEncryptionKeys || !1),
                        'number' != typeof this.options_.blacklistDuration && (this.options_.blacklistDuration = 300),
                        'number' != typeof this.options_.bandwidth &&
                            this.options_.useBandwidthFromLocalStorage &&
                            ((e = Ac()) &&
                                e.bandwidth &&
                                ((this.options_.bandwidth = e.bandwidth),
                                this.tech_.trigger({ type: 'usage', name: 'vhs-bandwidth-from-local-storage' }),
                                this.tech_.trigger({ type: 'usage', name: 'hls-bandwidth-from-local-storage' })),
                            e &&
                                e.throughput &&
                                ((this.options_.throughput = e.throughput),
                                this.tech_.trigger({ type: 'usage', name: 'vhs-throughput-from-local-storage' }),
                                this.tech_.trigger({ type: 'usage', name: 'hls-throughput-from-local-storage' }))),
                        'number' != typeof this.options_.bandwidth && (this.options_.bandwidth = El.INITIAL_BANDWIDTH),
                        (this.options_.enableLowInitialPlaylist = this.options_.enableLowInitialPlaylist && this.options_.bandwidth === El.INITIAL_BANDWIDTH),
                        [
                            'withCredentials',
                            'useDevicePixelRatio',
                            'limitRenditionByPlayerDimensions',
                            'bandwidth',
                            'smoothQualityChange',
                            'customTagParsers',
                            'customTagMappers',
                            'handleManifestRedirects',
                            'cacheEncryptionKeys',
                            'playlistSelector',
                            'initialPlaylistSelector',
                            'experimentalBufferBasedABR',
                            'liveRangeSafeTimeDelta',
                            'experimentalLLHLS',
                            'useNetworkInformationApi',
                            'useDtsForTimestampOffset',
                            'experimentalExactManifestTimings',
                            'experimentalLeastPixelDiffSelector',
                        ].forEach(function (e) {
                            'undefined' != typeof t.source_[e] && (t.options_[e] = t.source_[e])
                        }),
                        (this.limitRenditionByPlayerDimensions = this.options_.limitRenditionByPlayerDimensions),
                        (this.useDevicePixelRatio = this.options_.useDevicePixelRatio)
                }),
                (t.src = function (e, t) {
                    var n = this
                    e &&
                        (this.setOptions_(),
                        (this.options_.src = 0 === (e = this.source_.src).toLowerCase().indexOf('data:application/vnd.videojs.vhs+json,') ? JSON.parse(e.substring(e.indexOf(',') + 1)) : e),
                        (this.options_.tech = this.tech_),
                        (this.options_.externVhs = Ec),
                        (this.options_.sourceType = vr(t)),
                        (this.options_.seekTo = function (e) {
                            n.tech_.setCurrentTime(e)
                        }),
                        this.options_.smoothQualityChange && tr.log.warn('smoothQualityChange is deprecated and will be removed in the next major version'),
                        (this.masterPlaylistController_ = new bc(this.options_)),
                        (t = tr.mergeOptions({ liveRangeSafeTimeDelta: 0.1 }, this.options_, {
                            seekable: function () {
                                return n.seekable()
                            },
                            media: function () {
                                return n.masterPlaylistController_.media()
                            },
                            masterPlaylistController: this.masterPlaylistController_,
                        })),
                        (this.playbackWatcher_ = new Sc(t)),
                        this.masterPlaylistController_.on('error', function () {
                            var e = tr.players[n.tech_.options_.playerId],
                                t = n.masterPlaylistController_.error
                            'object' != typeof t || t.code ? 'string' == typeof t && (t = { message: t, code: 3 }) : (t.code = 3), e.error(t)
                        }),
                        (t = this.options_.experimentalBufferBasedABR ? Ec.movingAverageBandwidthSelector(0.55) : Ec.STANDARD_PLAYLIST_SELECTOR),
                        (this.masterPlaylistController_.selectPlaylist = (this.selectPlaylist || t).bind(this)),
                        (this.masterPlaylistController_.selectInitialPlaylist = Ec.INITIAL_PLAYLIST_SELECTOR.bind(this)),
                        (this.playlists = this.masterPlaylistController_.masterPlaylistLoader_),
                        (this.mediaSource = this.masterPlaylistController_.mediaSource),
                        Object.defineProperties(this, {
                            selectPlaylist: {
                                get: function () {
                                    return this.masterPlaylistController_.selectPlaylist
                                },
                                set: function (e) {
                                    this.masterPlaylistController_.selectPlaylist = e.bind(this)
                                },
                            },
                            throughput: {
                                get: function () {
                                    return this.masterPlaylistController_.mainSegmentLoader_.throughput.rate
                                },
                                set: function (e) {
                                    ;(this.masterPlaylistController_.mainSegmentLoader_.throughput.rate = e), (this.masterPlaylistController_.mainSegmentLoader_.throughput.count = 1)
                                },
                            },
                            bandwidth: {
                                get: function () {
                                    var e = this.masterPlaylistController_.mainSegmentLoader_.bandwidth,
                                        t = window.navigator.connection || window.navigator.mozConnection || window.navigator.webkitConnection
                                    return (e = this.options_.useNetworkInformationApi && t ? (1e7 <= (t = 1e3 * t.downlink * 1e3) && 1e7 <= e ? Math.max(e, t) : t) : e)
                                },
                                set: function (e) {
                                    ;(this.masterPlaylistController_.mainSegmentLoader_.bandwidth = e), (this.masterPlaylistController_.mainSegmentLoader_.throughput = { rate: 0, count: 0 })
                                },
                            },
                            systemBandwidth: {
                                get: function () {
                                    var e = 1 / (this.bandwidth || 1),
                                        t = 0 < this.throughput ? 1 / this.throughput : 0
                                    return Math.floor(1 / (e + t))
                                },
                                set: function () {
                                    tr.log.error('The "systemBandwidth" property is read-only')
                                },
                            },
                        }),
                        this.options_.bandwidth && (this.bandwidth = this.options_.bandwidth),
                        this.options_.throughput && (this.throughput = this.options_.throughput),
                        Object.defineProperties(this.stats, {
                            bandwidth: {
                                get: function () {
                                    return n.bandwidth || 0
                                },
                                enumerable: !0,
                            },
                            mediaRequests: {
                                get: function () {
                                    return n.masterPlaylistController_.mediaRequests_() || 0
                                },
                                enumerable: !0,
                            },
                            mediaRequestsAborted: {
                                get: function () {
                                    return n.masterPlaylistController_.mediaRequestsAborted_() || 0
                                },
                                enumerable: !0,
                            },
                            mediaRequestsTimedout: {
                                get: function () {
                                    return n.masterPlaylistController_.mediaRequestsTimedout_() || 0
                                },
                                enumerable: !0,
                            },
                            mediaRequestsErrored: {
                                get: function () {
                                    return n.masterPlaylistController_.mediaRequestsErrored_() || 0
                                },
                                enumerable: !0,
                            },
                            mediaTransferDuration: {
                                get: function () {
                                    return n.masterPlaylistController_.mediaTransferDuration_() || 0
                                },
                                enumerable: !0,
                            },
                            mediaBytesTransferred: {
                                get: function () {
                                    return n.masterPlaylistController_.mediaBytesTransferred_() || 0
                                },
                                enumerable: !0,
                            },
                            mediaSecondsLoaded: {
                                get: function () {
                                    return n.masterPlaylistController_.mediaSecondsLoaded_() || 0
                                },
                                enumerable: !0,
                            },
                            mediaAppends: {
                                get: function () {
                                    return n.masterPlaylistController_.mediaAppends_() || 0
                                },
                                enumerable: !0,
                            },
                            mainAppendsToLoadedData: {
                                get: function () {
                                    return n.masterPlaylistController_.mainAppendsToLoadedData_() || 0
                                },
                                enumerable: !0,
                            },
                            audioAppendsToLoadedData: {
                                get: function () {
                                    return n.masterPlaylistController_.audioAppendsToLoadedData_() || 0
                                },
                                enumerable: !0,
                            },
                            appendsToLoadedData: {
                                get: function () {
                                    return n.masterPlaylistController_.appendsToLoadedData_() || 0
                                },
                                enumerable: !0,
                            },
                            timeToLoadedData: {
                                get: function () {
                                    return n.masterPlaylistController_.timeToLoadedData_() || 0
                                },
                                enumerable: !0,
                            },
                            buffered: {
                                get: function () {
                                    return jo(n.tech_.buffered())
                                },
                                enumerable: !0,
                            },
                            currentTime: {
                                get: function () {
                                    return n.tech_.currentTime()
                                },
                                enumerable: !0,
                            },
                            currentSource: {
                                get: function () {
                                    return n.tech_.currentSource_
                                },
                                enumerable: !0,
                            },
                            currentTech: {
                                get: function () {
                                    return n.tech_.name_
                                },
                                enumerable: !0,
                            },
                            duration: {
                                get: function () {
                                    return n.tech_.duration()
                                },
                                enumerable: !0,
                            },
                            master: {
                                get: function () {
                                    return n.playlists.master
                                },
                                enumerable: !0,
                            },
                            playerDimensions: {
                                get: function () {
                                    return n.tech_.currentDimensions()
                                },
                                enumerable: !0,
                            },
                            seekable: {
                                get: function () {
                                    return jo(n.tech_.seekable())
                                },
                                enumerable: !0,
                            },
                            timestamp: {
                                get: function () {
                                    return Date.now()
                                },
                                enumerable: !0,
                            },
                            videoPlaybackQuality: {
                                get: function () {
                                    return n.tech_.getVideoPlaybackQuality()
                                },
                                enumerable: !0,
                            },
                        }),
                        this.tech_.one('canplay', this.masterPlaylistController_.setupFirstPlay.bind(this.masterPlaylistController_)),
                        this.tech_.on('bandwidthupdate', function () {
                            n.options_.useBandwidthFromLocalStorage &&
                                (function (e) {
                                    if (!window.localStorage) return
                                    var t = (t = Ac()) ? tr.mergeOptions(t, e) : e
                                    try {
                                        window.localStorage.setItem(Cc, JSON.stringify(t))
                                    } catch (e) {
                                        return
                                    }
                                })({ bandwidth: n.bandwidth, throughput: Math.round(n.throughput) })
                        }),
                        this.masterPlaylistController_.on('selectedinitialmedia', function () {
                            var i
                            ;(i = n).representations = function () {
                                var e = i.masterPlaylistController_.master(),
                                    e = au(e) ? i.masterPlaylistController_.getAudioTrackPlaylists_() : e.playlists
                                return e
                                    ? e
                                          .filter(function (e) {
                                              return !Zo(e)
                                          })
                                          .map(function (e, t) {
                                              return new Kl(i, e, e.id)
                                          })
                                    : []
                            }
                        }),
                        this.masterPlaylistController_.sourceUpdater_.on('createdsourcebuffers', function () {
                            n.setupEme_()
                        }),
                        this.on(this.masterPlaylistController_, 'progress', function () {
                            this.tech_.trigger('progress')
                        }),
                        this.on(this.masterPlaylistController_, 'firstplay', function () {
                            this.ignoreNextSeekingEvent_ = !0
                        }),
                        this.setupQualityLevels_(),
                        this.tech_.el() && ((this.mediaSourceUrl_ = window.URL.createObjectURL(this.masterPlaylistController_.mediaSource)), this.tech_.src(this.mediaSourceUrl_)))
                }),
                (t.createKeySessions_ = function () {
                    var t = this,
                        e = this.masterPlaylistController_.mediaTypes_.AUDIO.activePlaylistLoader
                    this.logger_('waiting for EME key session creation'),
                        Ic({ player: this.player_, sourceKeySystems: this.source_.keySystems, audioMedia: e && e.media(), mainPlaylists: this.playlists.master.playlists })
                            .then(function () {
                                t.logger_('created EME key session'), t.masterPlaylistController_.sourceUpdater_.initializedEme()
                            })
                            .catch(function (e) {
                                t.logger_('error while creating EME key session', e), t.player_.error({ message: 'Failed to initialize media keys for EME', code: 3 })
                            })
                }),
                (t.handleWaitingForKey_ = function () {
                    this.logger_('waitingforkey fired, attempting to create any new key sessions'), this.createKeySessions_()
                }),
                (t.setupEme_ = function () {
                    var t = this,
                        e = this.masterPlaylistController_.mediaTypes_.AUDIO.activePlaylistLoader,
                        e = xc({ player: this.player_, sourceKeySystems: this.source_.keySystems, media: this.playlists.media(), audioMedia: e && e.media() })
                    this.player_.tech_.on('keystatuschange', function (e) {
                        'output-restricted' === e.status &&
                            t.masterPlaylistController_.blacklistCurrentPlaylist({
                                playlist: t.masterPlaylistController_.media(),
                                message: 'DRM keystatus changed to ' + e.status + '. Playlist will fail to play. Check for HDCP content.',
                                blacklistDuration: 1 / 0,
                            })
                    }),
                        (this.handleWaitingForKey_ = this.handleWaitingForKey_.bind(this)),
                        this.player_.tech_.on('waitingforkey', this.handleWaitingForKey_),
                        11 !== tr.browser.IE_VERSION && e ? this.createKeySessions_() : this.masterPlaylistController_.sourceUpdater_.initializedEme()
                }),
                (t.setupQualityLevels_ = function () {
                    var i = this,
                        e = tr.players[this.tech_.options_.playerId]
                    e &&
                        e.qualityLevels &&
                        !this.qualityLevels_ &&
                        ((this.qualityLevels_ = e.qualityLevels()),
                        this.masterPlaylistController_.on('selectedinitialmedia', function () {
                            var t, e
                            ;(t = i.qualityLevels_),
                                (e = i).representations().forEach(function (e) {
                                    t.addQualityLevel(e)
                                }),
                                kc(t, e.playlists)
                        }),
                        this.playlists.on('mediachange', function () {
                            kc(i.qualityLevels_, i.playlists)
                        }))
                }),
                (e.version = function () {
                    return { '@videojs/http-streaming': '2.14.2', 'mux.js': '6.0.1', 'mpd-parser': '0.21.1', 'm3u8-parser': '4.7.1', 'aes-decrypter': '3.1.3' }
                }),
                (t.version = function () {
                    return this.constructor.version()
                }),
                (t.canChangeType = function () {
                    return uc.canChangeType()
                }),
                (t.play = function () {
                    this.masterPlaylistController_.play()
                }),
                (t.setCurrentTime = function (e) {
                    this.masterPlaylistController_.setCurrentTime(e)
                }),
                (t.duration = function () {
                    return this.masterPlaylistController_.duration()
                }),
                (t.seekable = function () {
                    return this.masterPlaylistController_.seekable()
                }),
                (t.dispose = function () {
                    this.playbackWatcher_ && this.playbackWatcher_.dispose(),
                        this.masterPlaylistController_ && this.masterPlaylistController_.dispose(),
                        this.qualityLevels_ && this.qualityLevels_.dispose(),
                        this.player_ && (delete this.player_.vhs, delete this.player_.dash, delete this.player_.hls),
                        this.tech_ && this.tech_.vhs && delete this.tech_.vhs,
                        this.tech_ && delete this.tech_.hls,
                        this.mediaSourceUrl_ && window.URL.revokeObjectURL && (window.URL.revokeObjectURL(this.mediaSourceUrl_), (this.mediaSourceUrl_ = null)),
                        this.tech_ && this.tech_.off('waitingforkey', this.handleWaitingForKey_),
                        r.prototype.dispose.call(this)
                }),
                (t.convertToProgramTime = function (e, t) {
                    return ku({ playlist: this.masterPlaylistController_.media(), time: e, callback: t })
                }),
                (t.seekToProgramTime = function (e, t, i, n) {
                    return (
                        void 0 === i && (i = !0),
                        void 0 === n && (n = 2),
                        Cu({ programTime: e, playlist: this.masterPlaylistController_.media(), retryCount: n, pauseAfterSeek: i, seekTo: this.options_.seekTo, tech: this.options_.tech, callback: t })
                    )
                }),
                e
            )
        })(tr.getComponent('Component')),
        Lc = {
            name: 'videojs-http-streaming',
            VERSION: '2.14.2',
            canHandleSource: function (e, t) {
                t = tr.mergeOptions(tr.options, (t = void 0 === t ? {} : t))
                return Lc.canPlayType(e.type, t)
            },
            handleSource: function (e, t, i) {
                i = tr.mergeOptions(tr.options, (i = void 0 === i ? {} : i))
                return (
                    (t.vhs = new Pc(e, t, i)),
                    tr.hasOwnProperty('hls') ||
                        Object.defineProperty(t, 'hls', {
                            get: function () {
                                return tr.log.warn('player.tech().hls is deprecated. Use player.tech().vhs instead.'), t.vhs
                            },
                            configurable: !0,
                        }),
                    (t.vhs.xhr = yu()),
                    t.vhs.src(e.src, e.type),
                    t.vhs
                )
            },
            canPlayType: function (e, t) {
                var i = tr.mergeOptions(tr.options, (t = void 0 === t ? {} : t)),
                    t = i.vhs,
                    t = (t = void 0 === t ? {} : t).overrideNative,
                    t = void 0 === t ? !tr.browser.IS_ANY_SAFARI : t,
                    i = i.hls,
                    i = (i = void 0 === i ? {} : i).overrideNative,
                    i = void 0 !== i && i,
                    e = vr(e)
                return e && (!Ec.supportsTypeNatively(e) || i || t) ? 'maybe' : ''
            },
        }
    return (
        gr('avc1.4d400d,mp4a.40.2') && tr.getTech('Html5').registerSourceHandler(Lc, 0),
        (tr.VhsHandler = Pc),
        Object.defineProperty(tr, 'HlsHandler', {
            get: function () {
                return tr.log.warn('videojs.HlsHandler is deprecated. Use videojs.VhsHandler instead.'), Pc
            },
            configurable: !0,
        }),
        (tr.VhsSourceHandler = Lc),
        Object.defineProperty(tr, 'HlsSourceHandler', {
            get: function () {
                return tr.log.warn('videojs.HlsSourceHandler is deprecated. Use videojs.VhsSourceHandler instead.'), Lc
            },
            configurable: !0,
        }),
        (tr.Vhs = Ec),
        Object.defineProperty(tr, 'Hls', {
            get: function () {
                return tr.log.warn('videojs.Hls is deprecated. Use videojs.Vhs instead.'), Ec
            },
            configurable: !0,
        }),
        tr.use || (tr.registerComponent('Hls', Ec), tr.registerComponent('Vhs', Ec)),
        (tr.options.vhs = tr.options.vhs || {}),
        (tr.options.hls = tr.options.hls || {}),
        (tr.getPlugin && tr.getPlugin('reloadSourceOnError')) ||
            (tr.registerPlugin || tr.plugin)('reloadSourceOnError', function (e) {
                Yl(this, e)
            }),
        tr
    )
})
;
var Medici=function(t){"use strict";var e=function(){return e=Object.assign||function(t){for(var e,r=1,s=arguments.length;r<s;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},e.apply(this,arguments)};const r=(t,e,r)=>{const s=t[e];return(...e)=>(r.apply(null,e),s.apply(t,e))},s={};function i(){return"undefined"!=typeof window?window:"undefined"!=typeof self?self:s}const n=t=>{if(null===t)return t;if(t instanceof Date)return new Date(t.getTime());if(t instanceof Array){const e=[];return t.forEach((t=>{e.push(t)})),e.map((t=>n(t)))}if("object"==typeof t&&t!=={}){const e=Object.assign({},t);return Object.keys(e).forEach((t=>{e[t]=n(e[t])})),e}return t},a=(t,e,r)=>{return s={url:t,data:{type:e,payload:r}},new Promise(((t,e)=>{const r=new XMLHttpRequest;r.open("POST",s.url,!0),r.setRequestHeader("Content-Type","application/json"),r.onerror=e,r.onreadystatechange=()=>{4===r.readyState&&t(r.response)},r.send(JSON.stringify(s.data))}));var s};class o{constructor(t){this._config=Object.assign({user:"",version:""},t.config),this._platform=t.platform,this._appId=t.appId,this._endPoint=t.endPoint}get _stopTrack(){return o._stopTrack}get trackUrl(){return this._endPoint+"/tracking/log/save"}get trackPageViewUrl(){return this._endPoint+"/tracking/log/save"}toTrackEntity(t){const e={appId:this._appId,module:t.module,type:t.type,url:t.url||this._history.playload.url,eventType:t.eventType,referrer:t.referrer||this._history.currentRef,requestData:t.requestData};return t.language&&(e.language=t.language),t.networkType&&(e.networkType=t.networkType),t.userId&&(e.userId=t.userId),e}trackView(t,e,r){if(!this._stopTrack){this._history.playload.url=t;const e={module:"pageview",url:t,type:"pageview",eventType:"pageview",language:n(this._history.playload).language,userId:this._config.user};return a(this.trackPageViewUrl,"pageview",this.toTrackEntity(e))}}trackEvent(t,e,r,s){if(!this._stopTrack){this._history.playload.url=r;const s={module:t,url:r,type:"event",eventType:e,language:n(this._history.playload).language,userId:this._config.user};return a(this.trackPageViewUrl,"event",this.toTrackEntity(s))}}track(t,e){if(!this._stopTrack){const r=n(this._history.playload),s=n(e);delete s.eventType,delete s.maxWaitTime;const i={module:t,type:"track",eventType:e.eventType,requestData:Object.assign({screen:r.screen},s,this._config),language:r.language,networkType:e.networkType,userId:this._config.user};return a(this.trackUrl,"track",this.toTrackEntity(i))}}startTrack(t,e){if(!this._stopTrack){const r=n(this._history.playload),s=n(e);delete s.eventType,delete s.maxWaitTime;const i={module:t,type:"start_track",eventType:e.eventType,requestData:Object.assign({},s,this._config),language:r.language,networkType:e.networkType,userId:this._config.user};return e.maxWaitTime&&(this._timeOut=setTimeout((()=>{this.endTrack(t,e)}),e.maxWaitTime)),a(this.trackUrl,"period_track",this.toTrackEntity(i))}}endTrack(t,e){if(this._timeOut&&clearTimeout(this._timeOut),!this._stopTrack){const r=n(this._history.playload),s=n(e);delete s.eventType,delete s.maxWaitTime;const i={module:t,type:"end_track",eventType:e.eventType,requestData:Object.assign({},s,this._config),language:r.language,networkType:e.networkType,userId:this._config.user};return a(this.trackUrl,"period_track",this.toTrackEntity(i))}}}o._stopTrack=!1;const c=i();class h{constructor(t,e){this._sdk=t,this._appId=e,this.init(),this._playload.website=e}get playload(){return this._playload}get currentUrl(){return this._currentUrl}get currentRef(){return this._currentRef}init(){window.mediciRegisterIds||(window.mediciRegisterIds=[]);const t=window.mediciRegisterIds;!Array.from(t).includes(this._appId)&&this._appId&&(c.document.addEventListener("readystatechange",this.handleReadystatechange.bind(this),!0),c.history.pushState=r(c.history,"pushState",this.handlePushState.bind(this)),c.history.replaceState=r(c.history,"replaceState",this.handlePushState.bind(this)),window.mediciRegisterIds.push(this._appId)),this.initPlayload()}initPlayload(){const{screen:{width:t,height:e},navigator:{language:r},location:{hostname:s,pathname:i,search:n}}=c,a=`${t}x${e}`;this._currentUrl=`${i}${n}`,this._currentRef=c.document.referrer,this._playload={website:"",hostname:s,screen:a,language:r,url:this._currentUrl,referrer:this._currentRef}}handleReadystatechange(){"complete"===c.document.readyState&&(this.observeDocument(),this._sdk.eventer.initElementCssEvents(c.document.body),this._sdk.trackView(this._currentUrl,this._currentRef,this._playload.website))}handlePushState(t,e,r){try{if(!r)return;const{hash:t}=c.location;this._currentRef=this._currentUrl;const e=r.toString();"http"===e.substring(0,4)?this._currentUrl="/"+e.split("/").splice(3).join("/"):this._currentUrl=e,t&&(this._currentUrl="/"+e.replace(t,"")),this._currentUrl!==this._currentRef&&this._sdk.trackView(this._currentUrl,this._currentRef,this._playload.website)}catch(t){}}handleBackState(t,e,r){}observeDocument(){new MutationObserver((t=>{const e=[];t.forEach((t=>{e.push(Array.from(t.addedNodes))})),Array.from(e.flat()).forEach((t=>{if("getAttribute"in t&&(this._sdk.eventer.addCssEvent(t),t.hasChildNodes)){t.querySelectorAll(this._sdk.eventer.eventSelect).forEach((t=>{"getAttribute"in t&&this._sdk.eventer.addCssEvent(t)}))}}))})).observe(c.document,{childList:!0,subtree:!0})}}class l{constructor(t){this.listeners={},this._sdk=t,this._identifier="mdc",this._eventSelect=`[class*='${this._identifier}--']`,this.eventClassValidate=/^mdc--([a-z]+)--([\w]+[\w-]*)$/}updateIdentifier(t){this._identifier=t,this.eventClassValidate=new RegExp("^"+t+"--([a-z]+)--([w]+[w-]*)$")}get eventSelect(){return this._eventSelect}initElementCssEvents(t){const e=t.querySelectorAll(this.eventSelect);Array.prototype.forEach.call(e,this.addCssEvent.bind(this))}addCssEvent(t){(t.getAttribute("class")||"").split(" ").forEach((e=>{if(!this.eventClassValidate.test(e))return;const[,r,s]=e.split("--"),i=this.listeners[e]?this.listeners[e]:this.listeners[e]=()=>{t.tagName,this._sdk.trackEvent(s,r)};t.addEventListener(r,i,!0)}))}}class u extends o{constructor(t){super(t),this.eventer=new l(this),this._history=new h(this,t.appId),super._history=this._history,"stopTrack"in t&&(o._stopTrack=t.stopTrack),this.setConfig(t.config)}setConfig(t){this._config=Object.assign({user:"",version:""},t),super._config=this._config}stop(){o._stopTrack=!0}resume(){o._stopTrack=!1}}var d=function(t){var r=e(e({},t),{platform:"web"});return new u(r)},p=i().document.currentScript;if(p){var y=p.getAttribute.bind(p),g=y("data-app-id"),_=y("data-url");g&&_&&(window.medici=d({platform:"web",appId:g,endPoint:_}))}return t.init=d,Object.defineProperty(t,"__esModule",{value:!0}),t}({});